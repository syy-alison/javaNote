<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-variant-emoji: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>redis</title>
</head>
<body class='typora-export typora-export-show-outline typora-export-no-collapse-outline'><div class='typora-export-content'>
<div class="typora-export-sidebar"><div class="outline-content"><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#"><strong>ğŸ </strong></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#21-ä»€ä¹ˆæ˜¯redis">2.1 ä»€ä¹ˆæ˜¯redis</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#22-ä¸ºä»€ä¹ˆéœ€è¦redis">2.2 ä¸ºä»€ä¹ˆéœ€è¦redis</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#23-åº”ç”¨åœºæ™¯">2.3 åº”ç”¨åœºæ™¯</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#24-åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ">2.4 åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#241-redis-vs-memcached">2.4.1 Redis VS Memcached</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#äºŒæ•°æ®ç±»å‹">äºŒã€æ•°æ®ç±»å‹</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#11-string">1.1 String</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#22-hash">2.2 Hash</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#23-list">2.3 List</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#24-set">2.4 Set</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#25-sortedset">2.5 sorted_set</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#26-é€šç”¨æŒ‡ä»¤">2.6 é€šç”¨æŒ‡ä»¤</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#27-bitmaps">2.7 Bitmaps </a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸºç¡€æ“ä½œ">åŸºç¡€æ“ä½œ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ‰©å±•æ“ä½œ">æ‰©å±•æ“ä½œ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#25-å•çº¿ç¨‹">2.5 å•çº¿ç¨‹</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸‰æ•°æ®ç»“æ„">ä¸‰ã€æ•°æ®ç»“æ„</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#31-è·³è·ƒè¡¨">3.1 è·³è·ƒè¡¨</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#311-è·³è·ƒè¡¨çš„æœç´¢">3.1.1 è·³è·ƒè¡¨çš„æœç´¢</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#312-è·³è·ƒè¡¨çš„æ’å…¥">3.1.2 è·³è·ƒè¡¨çš„æ’å…¥</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#313-è·³è·ƒè¡¨çš„åˆ é™¤">3.1.3 è·³è·ƒè¡¨çš„åˆ é™¤</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#314-è·³è·ƒè¡¨çš„ä¼˜ç‚¹">3.1.4 è·³è·ƒè¡¨çš„ä¼˜ç‚¹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#315-ä¸ºä»€ä¹ˆredisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨bæ ‘">3.1.5 ä¸ºä»€ä¹ˆRedisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨B+æ ‘</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#316-ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘">3.1.6 ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å››æŒä¹…åŒ–">å››ã€æŒä¹…åŒ–</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#41-rdb">4.1 RDB</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#411-saveæ–¹å¼">4.1.1 saveæ–¹å¼</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#412-bgsaveæ–¹å¼">4.1.2 bgsaveæ–¹å¼</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#413-save-é…ç½®">4.1.3 Save é…ç½®</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#414-rdbå¯åŠ¨æ–¹å¼å¯¹æ¯”">4.1.4 RDBå¯åŠ¨æ–¹å¼å¯¹æ¯”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#415-rdbä¼˜ç‚¹">4.1.5 RDBä¼˜ç‚¹</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#42-aof">4.2 AOF</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#421-aof-æ¦‚å¿µ">4.2.1 AOF æ¦‚å¿µ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#422--aofå†™æ•°æ®">4.2.2  AOFå†™æ•°æ®</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#423-aofå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥">4.2.3 AOFå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#424-aofé‡å†™">4.2.4 AOFé‡å†™</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#43-rdb-vs-aof">4.3 RDB VS AOF</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#44-å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“">4.4 å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#45-æ··åˆæŒä¹…åŒ–">4.5 æ··åˆæŒä¹…åŒ–</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#äº”äº‹åŠ¡">äº”ã€äº‹åŠ¡</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#51-äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ">5.1 äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#52-äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹">5.2 äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#52-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ">5.2 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#521--é”">5.2.1  é”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#521-åˆ†å¸ƒå¼é”">5.2.1 åˆ†å¸ƒå¼é”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#522--æ­»é”">5.2.2  æ­»é”</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å…­åˆ é™¤ç­–ç•¥">å…­ã€åˆ é™¤ç­–ç•¥</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#61-è¿‡æœŸæ•°æ®">6.1 è¿‡æœŸæ•°æ®</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#62-è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥">6.2 è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#621-å®šæ—¶åˆ é™¤">6.2.1 å®šæ—¶åˆ é™¤</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#622-æƒ°æ€§åˆ é™¤">6.2.2 æƒ°æ€§åˆ é™¤</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#623-å®šæœŸåˆ é™¤">6.2.3 å®šæœŸåˆ é™¤</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#624-å¯¹æ¯”">6.2.4 å¯¹æ¯”</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#63-å†…å­˜æ·˜æ±°ç­–ç•¥">6.3 å†…å­˜æ·˜æ±°ç­–ç•¥</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#64-redis-æŒä¹…åŒ–æ—¶å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„">6.4 Redis æŒä¹…åŒ–æ—¶ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„ï¼Ÿ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-ä¸»ä»æ¨¡å¼ä¸­å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†">Redis ä¸»ä»æ¨¡å¼ä¸­ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸ƒä¸»ä»å¤åˆ¶">ä¸ƒã€ä¸»ä»å¤åˆ¶</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä½œç”¨"><strong>ä½œç”¨</strong></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æµç¨‹">æµç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ€ä¹ˆåˆ¤æ–­-redis-æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ">æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸»ä»å¤åˆ¶æ¶æ„ä¸­è¿‡æœŸkeyå¦‚ä½•å¤„ç†">ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶">Redis æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª-bufferreplication-buffer-repl-backlog-bufferæœ‰ä»€ä¹ˆåŒºåˆ«">ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª Buffer(replication buffer ã€repl backlog buffer)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´">å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±">ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å…«å“¨å…µ">å…«ã€å“¨å…µ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#81-ç›‘æ§">8.1 ç›‘æ§</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#82-é€šçŸ¥">8.2 é€šçŸ¥</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#83-æ•…éšœè½¬ç§»">8.3 æ•…éšœè½¬ç§»</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¹é›†ç¾¤">ä¹ã€é›†ç¾¤</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#91-redis-cluster">9.1 <strong>Redis Cluster</strong></a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#911-redis-é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜">9.1.1 Redis é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#912-redis-clusterç®€ä»‹">9.1.2 Redis Clusterç®€ä»‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#913-ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹">9.1.3. ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#914-redis-cluster-æ˜¯å¦‚ä½•åˆ†ç‰‡çš„">9.1.4 Redis Cluster æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#915-ä¸ºä»€ä¹ˆ-redis-cluster-çš„å“ˆå¸Œæ§½æ˜¯-16384-ä¸ª">9.1.5 ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½æ˜¯ 16384 ä¸ª?</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#916-redis-cluster-å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½">9.1.6 <strong>Redis Cluster å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼Ÿ</strong></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-cluster-æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—"><strong>Redis Cluster æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—ï¼Ÿ</strong></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-cluster-ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„"><strong>Redis Cluster ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Ÿ</strong></a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©">åã€ç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#101-ç¼“å­˜ç©¿é€">10.1 ç¼“å­˜ç©¿é€</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¸ƒéš†è¿‡æ»¤å™¨">å¸ƒéš†è¿‡æ»¤å™¨</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#102-ç¼“å­˜é›ªå´©">10.2 ç¼“å­˜é›ªå´©</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#103-ç¼“å­˜å‡»ç©¿">10.3 ç¼“å­˜å‡»ç©¿</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åä¸€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§">åä¸€ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#cache-aside-patternæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰">Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#readwrite-through-patternè¯»å†™ç©¿é€ï¼‰">Read/Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#write-behind-patternå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰">Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åäºŒredis-å®æˆ˜">åäºŒã€Redis å®æˆ˜</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—">Redis å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-ç®¡é“æœ‰ä»€ä¹ˆç”¨">Redis ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#redis-äº‹åŠ¡æ”¯æŒå›æ»šå—">Redis äº‹åŠ¡æ”¯æŒå›æ»šå—ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•ç”¨-redis-å®ç°åˆ†å¸ƒå¼é”çš„">å¦‚ä½•ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”çš„ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li></div></div><div id='write'  class=''><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n18651"><a class="md-toc-inner" href="#"><strong>ğŸ </strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n18652"><a class="md-toc-inner" href="#ä¸€æ¦‚è¿°">ä¸€ã€æ¦‚è¿°</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18653"><a class="md-toc-inner" href="#21-ä»€ä¹ˆæ˜¯redis">2.1 ä»€ä¹ˆæ˜¯redis</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18661"><a class="md-toc-inner" href="#22-ä¸ºä»€ä¹ˆéœ€è¦redis">2.2 ä¸ºä»€ä¹ˆéœ€è¦redis</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18670"><a class="md-toc-inner" href="#23-åº”ç”¨åœºæ™¯">2.3 åº”ç”¨åœºæ™¯</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18682"><a class="md-toc-inner" href="#24-åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ">2.4 åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n18687"><a class="md-toc-inner" href="#241-redis-vs-memcached">2.4.1 Redis VS Memcached</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n18715"><a class="md-toc-inner" href="#äºŒæ•°æ®ç±»å‹">äºŒã€æ•°æ®ç±»å‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18733"><a class="md-toc-inner" href="#11-string">1.1 String</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18754"><a class="md-toc-inner" href="#22-hash">2.2 Hash</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18782"><a class="md-toc-inner" href="#23-list">2.3 List</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18813"><a class="md-toc-inner" href="#24-set">2.4 Set</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18833"><a class="md-toc-inner" href="#25-sortedset">2.5 sorted_set</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18870"><a class="md-toc-inner" href="#26-é€šç”¨æŒ‡ä»¤">2.6 é€šç”¨æŒ‡ä»¤</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18880"><a class="md-toc-inner" href="#27-bitmaps">2.7 Bitmaps </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n18883"><a class="md-toc-inner" href="#åŸºç¡€æ“ä½œ">åŸºç¡€æ“ä½œ</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n18891"><a class="md-toc-inner" href="#æ‰©å±•æ“ä½œ">æ‰©å±•æ“ä½œ</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n18908"><a class="md-toc-inner" href="#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18910"><a class="md-toc-inner" href="#25-å•çº¿ç¨‹">2.5 å•çº¿ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n18996"><a class="md-toc-inner" href="#ä¸‰æ•°æ®ç»“æ„">ä¸‰ã€æ•°æ®ç»“æ„</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n18997"><a class="md-toc-inner" href="#31-è·³è·ƒè¡¨">3.1 è·³è·ƒè¡¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19003"><a class="md-toc-inner" href="#311-è·³è·ƒè¡¨çš„æœç´¢">3.1.1 è·³è·ƒè¡¨çš„æœç´¢</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19008"><a class="md-toc-inner" href="#312-è·³è·ƒè¡¨çš„æ’å…¥">3.1.2 è·³è·ƒè¡¨çš„æ’å…¥</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19023"><a class="md-toc-inner" href="#313-è·³è·ƒè¡¨çš„åˆ é™¤">3.1.3 è·³è·ƒè¡¨çš„åˆ é™¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19025"><a class="md-toc-inner" href="#314-è·³è·ƒè¡¨çš„ä¼˜ç‚¹">3.1.4 è·³è·ƒè¡¨çš„ä¼˜ç‚¹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19034"><a class="md-toc-inner" href="#315-ä¸ºä»€ä¹ˆredisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨bæ ‘">3.1.5 ä¸ºä»€ä¹ˆRedisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨B+æ ‘</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19038"><a class="md-toc-inner" href="#316-ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘">3.1.6 ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n19046"><a class="md-toc-inner" href="#å››æŒä¹…åŒ–">å››ã€æŒä¹…åŒ–</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19069"><a class="md-toc-inner" href="#41-rdb">4.1 RDB</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19083"><a class="md-toc-inner" href="#411-saveæ–¹å¼">4.1.1 saveæ–¹å¼</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19124"><a class="md-toc-inner" href="#412-bgsaveæ–¹å¼">4.1.2 bgsaveæ–¹å¼</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19141"><a class="md-toc-inner" href="#413-save-é…ç½®">4.1.3 Save é…ç½®</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19172"><a class="md-toc-inner" href="#414-rdbå¯åŠ¨æ–¹å¼å¯¹æ¯”">4.1.4 RDBå¯åŠ¨æ–¹å¼å¯¹æ¯”</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19174"><a class="md-toc-inner" href="#415-rdbä¼˜ç‚¹">4.1.5 RDBä¼˜ç‚¹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19196"><a class="md-toc-inner" href="#42-aof">4.2 AOF</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19197"><a class="md-toc-inner" href="#421-aof-æ¦‚å¿µ">4.2.1 AOF æ¦‚å¿µ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19205"><a class="md-toc-inner" href="#422--aofå†™æ•°æ®">4.2.2  AOFå†™æ•°æ®</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19225"><a class="md-toc-inner" href="#423-aofå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥">4.2.3 AOFå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19252"><a class="md-toc-inner" href="#424-aofé‡å†™">4.2.4 AOFé‡å†™</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19329"><a class="md-toc-inner" href="#43-rdb-vs-aof">4.3 RDB VS AOF</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19356"><a class="md-toc-inner" href="#44-å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“">4.4 å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19383"><a class="md-toc-inner" href="#45-æ··åˆæŒä¹…åŒ–">4.5 æ··åˆæŒä¹…åŒ–</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n19405"><a class="md-toc-inner" href="#äº”äº‹åŠ¡">äº”ã€äº‹åŠ¡</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19407"><a class="md-toc-inner" href="#51-äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ">5.1 äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19420"><a class="md-toc-inner" href="#52-äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹">5.2 äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19449"><a class="md-toc-inner" href="#52-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ">5.2 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19450"><a class="md-toc-inner" href="#521--é”">5.2.1  é”</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19464"><a class="md-toc-inner" href="#521-åˆ†å¸ƒå¼é”">5.2.1 åˆ†å¸ƒå¼é”</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19484"><a class="md-toc-inner" href="#522--æ­»é”">5.2.2  æ­»é”</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n19508"><a class="md-toc-inner" href="#å…­åˆ é™¤ç­–ç•¥">å…­ã€åˆ é™¤ç­–ç•¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19509"><a class="md-toc-inner" href="#61-è¿‡æœŸæ•°æ®">6.1 è¿‡æœŸæ•°æ®</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19518"><a class="md-toc-inner" href="#62-è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥">6.2 è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19556"><a class="md-toc-inner" href="#621-å®šæ—¶åˆ é™¤">6.2.1 å®šæ—¶åˆ é™¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19566"><a class="md-toc-inner" href="#622-æƒ°æ€§åˆ é™¤">6.2.2 æƒ°æ€§åˆ é™¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19581"><a class="md-toc-inner" href="#623-å®šæœŸåˆ é™¤">6.2.3 å®šæœŸåˆ é™¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19615"><a class="md-toc-inner" href="#624-å¯¹æ¯”">6.2.4 å¯¹æ¯”</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19637"><a class="md-toc-inner" href="#63-å†…å­˜æ·˜æ±°ç­–ç•¥">6.3 å†…å­˜æ·˜æ±°ç­–ç•¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19723"><a class="md-toc-inner" href="#64-redis-æŒä¹…åŒ–æ—¶å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„">6.4 Redis æŒä¹…åŒ–æ—¶ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n19743"><a class="md-toc-inner" href="#redis-ä¸»ä»æ¨¡å¼ä¸­å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†">Redis ä¸»ä»æ¨¡å¼ä¸­ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n19746"><a class="md-toc-inner" href="#ä¸ƒä¸»ä»å¤åˆ¶">ä¸ƒã€ä¸»ä»å¤åˆ¶</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19751"><a class="md-toc-inner" href="#ä½œç”¨"><strong>ä½œç”¨</strong></a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19763"><a class="md-toc-inner" href="#æµç¨‹">æµç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19848"><a class="md-toc-inner" href="#æ€ä¹ˆåˆ¤æ–­-redis-æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ">æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19861"><a class="md-toc-inner" href="#ä¸»ä»å¤åˆ¶æ¶æ„ä¸­è¿‡æœŸkeyå¦‚ä½•å¤„ç†">ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19863"><a class="md-toc-inner" href="#redis-æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶">Redis æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19865"><a class="md-toc-inner" href="#ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª-bufferreplication-buffer-repl-backlog-bufferæœ‰ä»€ä¹ˆåŒºåˆ«">ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª Buffer(replication buffer ã€repl backlog buffer)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19882"><a class="md-toc-inner" href="#å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´">å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19892"><a class="md-toc-inner" href="#ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±">ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n19919"><a class="md-toc-inner" href="#å…«å“¨å…µ">å…«ã€å“¨å…µ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19947"><a class="md-toc-inner" href="#81-ç›‘æ§">8.1 ç›‘æ§</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19964"><a class="md-toc-inner" href="#82-é€šçŸ¥">8.2 é€šçŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n19971"><a class="md-toc-inner" href="#83-æ•…éšœè½¬ç§»">8.3 æ•…éšœè½¬ç§»</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n20033"><a class="md-toc-inner" href="#ä¹é›†ç¾¤">ä¹ã€é›†ç¾¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n20050"><a class="md-toc-inner" href="#91-redis-cluster">9.1 <strong>Redis Cluster</strong></a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20051"><a class="md-toc-inner" href="#911-redis-é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜">9.1.1 Redis é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20055"><a class="md-toc-inner" href="#912-redis-clusterç®€ä»‹">9.1.2 Redis Clusterç®€ä»‹</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20073"><a class="md-toc-inner" href="#913-ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹">9.1.3. ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20091"><a class="md-toc-inner" href="#914-redis-cluster-æ˜¯å¦‚ä½•åˆ†ç‰‡çš„">9.1.4 Redis Cluster æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20112"><a class="md-toc-inner" href="#915-ä¸ºä»€ä¹ˆ-redis-cluster-çš„å“ˆå¸Œæ§½æ˜¯-16384-ä¸ª">9.1.5 ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½æ˜¯ 16384 ä¸ª?</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20121"><a class="md-toc-inner" href="#916-redis-cluster-å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½">9.1.6 <strong>Redis Cluster å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼Ÿ</strong></a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20136"><a class="md-toc-inner" href="#redis-cluster-æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—"><strong>Redis Cluster æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—ï¼Ÿ</strong></a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n20161"><a class="md-toc-inner" href="#redis-cluster-ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„"><strong>Redis Cluster ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Ÿ</strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n20172"><a class="md-toc-inner" href="#åç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©">åã€ç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20173"><a class="md-toc-inner" href="#101-ç¼“å­˜ç©¿é€">10.1 ç¼“å­˜ç©¿é€</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n20183"><a class="md-toc-inner" href="#å¸ƒéš†è¿‡æ»¤å™¨">å¸ƒéš†è¿‡æ»¤å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20211"><a class="md-toc-inner" href="#102-ç¼“å­˜é›ªå´©">10.2 ç¼“å­˜é›ªå´©</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20237"><a class="md-toc-inner" href="#103-ç¼“å­˜å‡»ç©¿">10.3 ç¼“å­˜å‡»ç©¿</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n20266"><a class="md-toc-inner" href="#åä¸€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§">åä¸€ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20267"><a class="md-toc-inner" href="#cache-aside-patternæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰">Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20292"><a class="md-toc-inner" href="#readwrite-through-patternè¯»å†™ç©¿é€ï¼‰">Read/Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20315"><a class="md-toc-inner" href="#write-behind-patternå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰">Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n20320"><a class="md-toc-inner" href="#åäºŒredis-å®æˆ˜">åäºŒã€Redis å®æˆ˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20321"><a class="md-toc-inner" href="#redis-å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—">Redis å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20332"><a class="md-toc-inner" href="#redis-ç®¡é“æœ‰ä»€ä¹ˆç”¨">Redis ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20341"><a class="md-toc-inner" href="#redis-äº‹åŠ¡æ”¯æŒå›æ»šå—">Redis äº‹åŠ¡æ”¯æŒå›æ»šå—ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n20357"><a class="md-toc-inner" href="#å¦‚ä½•ç”¨-redis-å®ç°åˆ†å¸ƒå¼é”çš„">å¦‚ä½•ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”çš„ï¼Ÿ</a></span></p></div><h1><a href='../../README.html'><strong>ğŸ </strong></a></h1><h1 id='ä¸€æ¦‚è¿°'><span>ä¸€ã€æ¦‚è¿°</span></h1><h2 id='21-ä»€ä¹ˆæ˜¯redis'><span>2.1 ä»€ä¹ˆæ˜¯redis</span></h2><ul><li><p><span>Redis æ˜¯ä¸€ç§åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œå¯¹æ•°æ®çš„è¯»å†™æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå› æ­¤</span><strong><span>è¯»å†™é€Ÿåº¦éå¸¸å¿«</span></strong><span>ï¼Œå¸¸ç”¨äº</span><strong><span>ç¼“å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”ç­‰åœºæ™¯</span></strong><span>ã€‚</span></p></li><li><p><span>Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚ String(å­—ç¬¦ä¸²)ã€Hash(å“ˆå¸Œ)ã€ List (åˆ—è¡¨)ã€Set(é›†åˆ)ã€Zset(æœ‰åºé›†åˆ)ã€Bitmapsï¼ˆä½å›¾ï¼‰ã€HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ã€GEOï¼ˆåœ°ç†ä¿¡æ¯ï¼‰ã€Streamï¼ˆæµï¼‰ï¼Œå¹¶ä¸”å¯¹æ•°æ®ç±»å‹çš„æ“ä½œéƒ½æ˜¯</span><strong><span>åŸå­æ€§</span></strong><span>çš„ï¼Œå› ä¸ºæ‰§è¡Œå‘½ä»¤ç”±å•çº¿ç¨‹è´Ÿè´£çš„ï¼Œä¸å­˜åœ¨å¹¶å‘ç«äº‰çš„é—®é¢˜ã€‚</span></p></li><li><p><span>é™¤æ­¤ä¹‹å¤–ï¼ŒRedis è¿˜æ”¯æŒ</span><strong><span>äº‹åŠ¡ ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆï¼ˆä¸»ä»å¤åˆ¶æ¨¡å¼ã€å“¨å…µæ¨¡å¼ã€åˆ‡ç‰‡æœºç¾¤æ¨¡å¼ï¼‰ã€å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå†…å­˜æ·˜æ±°æœºåˆ¶ã€è¿‡æœŸåˆ é™¤æœºåˆ¶</span></strong><span>ç­‰ç­‰ã€‚</span></p></li></ul><h2 id='22-ä¸ºä»€ä¹ˆéœ€è¦redis'><span>2.2 ä¸ºä»€ä¹ˆéœ€è¦redis</span></h2><p><em><strong><span>ç®€å•æ¥è¯´ä½¿ç”¨ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒä»¥åŠåº”å¯¹æ›´å¤šçš„ç”¨æˆ·ã€‚</span></strong></em></p><p><span>ä»é«˜æ€§èƒ½å’Œé«˜å¹¶å‘ä¸¤ä¸ªè§’åº¦æ¥çœ‹ï¼š</span></p><p><strong><span>é«˜æ€§èƒ½</span></strong><span> ï¼š</span></p><p><span>å‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„æŸäº›æ•°æ®çš„è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒæ…¢ï¼Œæ¯•ç«Ÿæ˜¯ä»ç¡¬ç›˜ä¸­è¯»å–çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¯´ï¼Œç”¨æˆ·è®¿é—®çš„æ•°æ®å±äºé«˜é¢‘æ•°æ®å¹¶ä¸”ä¸ä¼šç»å¸¸æ”¹å˜çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ”¾å¿ƒåœ°å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®å­˜åœ¨ç¼“å­˜ä¸­ã€‚</span></p><p><strong><span>è¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</span></strong><span> é‚£å°±æ˜¯ä¿è¯ç”¨æˆ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ã€‚æ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚</span></p><p><span>ä¸è¿‡ï¼Œè¦ä¿æŒæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®çš„ä¸€è‡´æ€§ã€‚ å¦‚æœæ•°æ®åº“ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼</span></p><p><strong><span>é«˜å¹¶å‘ï¼š</span></strong></p><p><span>ä¸€èˆ¬åƒ MySQL è¿™ç±»çš„æ•°æ®åº“çš„ QPS å¤§æ¦‚éƒ½åœ¨ 1w å·¦å³ï¼ˆ4 æ ¸ 8gï¼‰ ï¼Œä½†æ˜¯ä½¿ç”¨ Redis ç¼“å­˜ä¹‹åå¾ˆå®¹æ˜“è¾¾åˆ° 10w+ï¼Œç”šè‡³æœ€é«˜èƒ½è¾¾åˆ° 30w+ï¼ˆå°±å•æœº redis çš„æƒ…å†µï¼Œredis é›†ç¾¤çš„è¯ä¼šæ›´é«˜ï¼‰ã€‚</span></p><h2 id='23-åº”ç”¨åœºæ™¯'><span>2.3 åº”ç”¨åœºæ™¯</span></h2><ul><li><p><strong><span>åˆ†å¸ƒå¼é”</span></strong><span> ï¼š é€šè¿‡ Redis æ¥åšåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäº Redisson æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚ç›¸å…³é˜…è¯»ï¼š</span><a href='https://mp.weixin.qq.com/s/CbnPRfvq4m1sqo2uKI6qQw'><span>ã€Šåˆ†å¸ƒå¼é”ä¸­çš„ç‹è€…æ–¹æ¡ˆ - Redissonã€‹</span></a><span>ã€‚</span></p></li><li><p><strong><span>é™æµ</span></strong><span> ï¼šä¸€èˆ¬æ˜¯é€šè¿‡ Redis + Lua è„šæœ¬çš„æ–¹å¼æ¥å®ç°é™æµã€‚ç›¸å…³é˜…è¯»ï¼š</span><a href='https://mp.weixin.qq.com/s/kyFAWH3mVNJvurQDt4vchA'><span>ã€Šæˆ‘å¸ç”¨äº† 6 å¹´çš„ Redis åˆ†å¸ƒå¼é™æµå™¨ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å‰å®³äº†ï¼ã€‹</span></a><span>ã€‚</span></p></li><li><p><strong><span>æ¶ˆæ¯é˜Ÿåˆ—</span></strong><span> ï¼šRedis è‡ªå¸¦çš„ list æ•°æ®ç»“æ„å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ä½¿ç”¨ã€‚Redis5.0 ä¸­å¢åŠ çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´åŠ é€‚åˆç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒæ¯”è¾ƒç±»ä¼¼äº Kafkaï¼Œæœ‰ä¸»é¢˜å’Œæ¶ˆè´¹ç»„çš„æ¦‚å¿µï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠ ACK æœºåˆ¶ã€‚</span></p></li><li><p><strong><span>å¤æ‚ä¸šåŠ¡åœºæ™¯</span></strong><span> ï¼šé€šè¿‡ Redis ä»¥åŠ Redis æ‰©å±•ï¼ˆæ¯”å¦‚ Redissonï¼‰æä¾›çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯æ¯”å¦‚é€šè¿‡ bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ã€é€šè¿‡ sorted set ç»´æŠ¤æ’è¡Œæ¦œã€‚</span></p></li><li><p><strong><span>å»¶è¿Ÿé˜Ÿåˆ—ï¼š</span></strong></p></li></ul><h2 id='24-åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ'><span>2.4 åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ</span></h2><p><span>åˆ†å¸ƒå¼ç¼“å­˜çš„è¯ï¼Œä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸»è¦æ˜¯ </span><strong><span>Memcached</span></strong><span> å’Œ </span><strong><span>Redis</span></strong><span>ã€‚ä¸è¿‡ï¼Œç°åœ¨åŸºæœ¬æ²¡æœ‰çœ‹è¿‡è¿˜æœ‰é¡¹ç›®ä½¿ç”¨ </span><strong><span>Memcached</span></strong><span> æ¥åšç¼“å­˜ï¼Œéƒ½æ˜¯ç›´æ¥ç”¨ </span><strong><span>Redis</span></strong><span>ã€‚</span></p><p><span>Memcached æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æœ€å¼€å§‹å…´èµ·çš„é‚£ä¼šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ã€‚åæ¥ï¼Œéšç€ Redis çš„å‘å±•ï¼Œå¤§å®¶æ…¢æ…¢éƒ½è½¬è€Œä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ Redis äº†ã€‚</span></p><p><span>åˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯å•æœºç¼“å­˜çš„å®¹é‡å—æœåŠ¡å™¨é™åˆ¶å¹¶ä¸”æ— æ³•ä¿å­˜é€šç”¨ä¿¡æ¯çš„é—®é¢˜ã€‚å› ä¸ºï¼Œæœ¬åœ°ç¼“å­˜åªåœ¨å½“å‰æœåŠ¡é‡Œæœ‰æ•ˆï¼Œæ¯”å¦‚å¦‚æœä½ éƒ¨ç½²äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œä»–ä»¬ä¸¤è€…ä¹‹é—´çš„ç¼“å­˜æ•°æ®æ˜¯æ— æ³•å…±åŒçš„ã€‚</span></p><p><span>ç°åœ¨å…¬å¸ä¸€èˆ¬éƒ½æ˜¯ç”¨ Redis æ¥å®ç°ç¼“å­˜ï¼Œè€Œä¸” Redis è‡ªèº«ä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ï¼ä¸è¿‡ï¼Œäº†è§£ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨åšç›¸åº”çš„æŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œèƒ½å¤Ÿåšåˆ°æœ‰ç†æœ‰æ®ï¼</span></p><h3 id='241-redis-vs-memcached'><span>2.4.1 Redis VS Memcached</span></h3><p><strong><span>å…±åŒç‚¹</span></strong><span> ï¼š</span></p><ol start='' ><li><p><span>éƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚</span></p></li><li><p><span>éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚</span></p></li><li><p><span>ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚</span></p></li></ol><p><strong><span>åŒºåˆ«</span></strong><span> ï¼š</span></p><ol start='' ><li><p><strong><span>Redis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰</span></strong><span>ã€‚Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ k/v ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚Memcached åªæ”¯æŒæœ€ç®€å•çš„ k/v æ•°æ®ç±»å‹ã€‚</span></p></li><li><p><strong><span>Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€Œ Memecache æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼ŒMemcached é‡å¯æˆ–è€…æŒ‚æ‰åï¼Œæ•°æ®å°±æ²¡äº†ã€‚</span></strong></p></li><li><p><strong><span>Redis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ã€‚</span></strong><span> å› ä¸ºå¯ä»¥æŠŠç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</span></p></li><li><p><strong><span>Redis åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå¯ä»¥å°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯ï¼ŒMemcached åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°±ä¼šç›´æ¥æŠ¥å¼‚å¸¸ã€‚</span></strong></p></li><li><p><strong><span>Memcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯ Redis ç›®å‰æ˜¯åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼çš„ã€‚</span></strong></p></li><li><p><strong><span>Memcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redis ä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚</span></strong><span> ï¼ˆRedis 6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ IO ï¼‰</span></p></li><li><p><strong><span>Redis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼ŒRedis æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚</span></strong></p></li><li><p><strong><span>Memcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ï¼Œè€Œ Redis åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ã€‚</span></strong></p></li></ol><p><span>ç›¸ä¿¡çœ‹äº†ä¸Šé¢çš„å¯¹æ¯”ä¹‹åï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰ä»€ä¹ˆç†ç”±å¯ä»¥é€‰æ‹©ä½¿ç”¨ Memcached æ¥ä½œä¸ºè‡ªå·±é¡¹ç›®çš„åˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚</span></p><h1 id='äºŒæ•°æ®ç±»å‹'><span>äºŒã€æ•°æ®ç±»å‹</span></h1><ul><li><p><strong><span>redis è‡ªèº«æ˜¯ä¸€ä¸ª Mapï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨ key : value çš„å½¢å¼å­˜å‚¨</span></strong></p></li><li><p><strong><span>æ•°æ®ç±»å‹æŒ‡çš„æ˜¯å­˜å‚¨çš„æ•°æ®çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ value éƒ¨åˆ†çš„ç±»å‹ï¼Œkey éƒ¨åˆ†æ°¸è¿œéƒ½æ˜¯å­—ç¬¦ä¸²,å¸¸è§æœ‰äº”ç§æ•°æ®ç±»å‹</span></strong><span>ã€‚</span></p><ul><li><p><span>Stringï¼šç”¨äºç¼“å­˜å¯¹è±¡ã€å¸¸è§„è®¡æ•°ã€åˆ†å¸ƒå¼é”ã€å…±äº« session ä¿¡æ¯ç­‰ã€‚</span></p></li><li><p><span>hashï¼š ç”¨äºç¼“å­˜å¯¹è±¡ã€è´­ç‰©è½¦ç­‰</span></p></li><li><p><span>listï¼šç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š1. ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼›2. ä¸èƒ½ä»¥æ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ®ï¼‰ç­‰ã€‚</span></p></li><li><p><span>setï¼šç”¨äºèšåˆè®¡ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ã€å·®é›†ï¼‰åœºæ™¯ï¼Œæ¯”å¦‚ç‚¹èµã€å…±åŒå…³æ³¨ã€æŠ½å¥–æ´»åŠ¨ç­‰ã€‚</span></p></li><li><p><span>sorted_setï¼š</span></p></li></ul></li></ul><p><img src="./images/rediså­˜å‚¨ç©ºé—´.png" referrerpolicy="no-referrer" alt="rediså­˜å‚¨ç©ºé—´.png"></p><h2 id='11-string'><span>1.1 String</span></h2><ul><li><p><span>stringåœ¨rediså†…éƒ¨å­˜å‚¨é»˜è®¤å°±æ˜¯ä¸€ä¸ª</span><strong><span>å­—ç¬¦ä¸²</span></strong><span>ï¼Œå½“é‡åˆ°å¢å‡ç±»æ“ä½œincrï¼Œdecræ—¶ä¼š</span><strong><span>è½¬æˆæ•°å€¼å‹</span></strong><span>è¿›è¡Œè®¡ç®—ã€‚</span></p></li><li><p><span>redisæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯</span><strong><span>åŸå­æ€§</span></strong><span>çš„ï¼Œé‡‡ç”¨</span><strong><span>å•çº¿ç¨‹</span></strong><span>å¤„ç†æ‰€æœ‰ä¸šåŠ¡ï¼Œå‘½ä»¤æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå› æ­¤æ— éœ€è€ƒè™‘å¹¶å‘å¸¦æ¥çš„æ•°æ®å½±å“ã€‚</span></p></li><li><p><span>æ³¨æ„ï¼šæŒ‰æ•°å€¼è¿›è¡Œæ“ä½œçš„æ•°æ®ï¼Œå¦‚æœåŸå§‹æ•°æ®ä¸èƒ½è½¬æˆæ•°å€¼ï¼Œæˆ–è¶…è¶Šäº†redis æ•°å€¼ä¸Šé™èŒƒå›´ï¼Œå°†æŠ¥é”™ã€‚ 9223372036854775807ï¼ˆjavaä¸­longå‹æ•°æ®æœ€å¤§å€¼ï¼ŒLong.MAX_VALUEï¼‰</span></p></li><li><p><span>redis æ§åˆ¶æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡æ•°æ®æ˜¯å¦å¤±æ•ˆæ§åˆ¶ä¸šåŠ¡è¡Œä¸ºï¼Œé€‚ç”¨äºæ‰€æœ‰å…·æœ‰æ—¶æ•ˆæ€§é™å®šæ§åˆ¶çš„æ“ä½œã€‚</span></p></li><li><p><span>String ç±»å‹çš„åº•å±‚çš„æ•°æ®ç»“æ„å®ç°ä¸»è¦æ˜¯ </span><strong><span>SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²</span></strong><span>ï¼‰ã€‚ SDS å’Œæˆ‘ä»¬è®¤è¯†çš„ C å­—ç¬¦ä¸²ä¸å¤ªä¸€æ ·ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå› ä¸º SDS ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼š</span></p><ul><li><p><strong><span>SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®</span></strong><span>ã€‚å› ä¸º SDS ä½¿ç”¨ len å±æ€§çš„å€¼è€Œä¸æ˜¯ç©ºå­—ç¬¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸï¼Œå¹¶ä¸” SDS çš„æ‰€æœ‰ API éƒ½ä¼šä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† SDS å­˜æ”¾åœ¨ buf[] æ•°ç»„é‡Œçš„æ•°æ®ã€‚æ‰€ä»¥ SDS ä¸å…‰èƒ½å­˜æ”¾æ–‡æœ¬æ•°æ®ï¼Œè€Œä¸”èƒ½ä¿å­˜å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€å‹ç¼©æ–‡ä»¶è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</span></p></li><li><p><strong><span>SDS è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)</span></strong><span>ã€‚å› ä¸º C è¯­è¨€çš„å­—ç¬¦ä¸²å¹¶ä¸è®°å½•è‡ªèº«é•¿åº¦ï¼Œæ‰€ä»¥è·å–é•¿åº¦çš„å¤æ‚åº¦ä¸º O(n)ï¼›è€Œ SDS ç»“æ„é‡Œç”¨ len å±æ€§è®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸º O(1)ã€‚</span></p></li><li><p><strong><span>Redis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡º</span></strong><span>ã€‚å› ä¸º SDS åœ¨æ‹¼æ¥å­—ç¬¦ä¸²ä¹‹å‰ä¼šæ£€æŸ¥ SDS ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</span></p></li></ul></li></ul><p><strong><span>åŸºæœ¬æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- æ·»åŠ æ•°æ®</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> <span class="cm-keyword">key</span> <span class="cm-keyword">value</span> &nbsp; &nbsp;<span class="cm-comment">-- æ·»åŠ å•ä¸ªæ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mset key1 value1 key2 value2... <span class="cm-comment">-- æ·»åŠ å¤šä¸ªæ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">setex <span class="cm-keyword">key</span> seconds <span class="cm-keyword">value</span> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">psetex <span class="cm-keyword">key</span> milliseconds <span class="cm-keyword">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- å¾—åˆ°String</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">get</span> <span class="cm-keyword">key</span> &nbsp; <span class="cm-comment">-- è·å¾—å•ä¸ªæ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mget key1 key2... &nbsp;<span class="cm-comment">-- è·å¾—å¤šä¸ªæ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- åˆ é™¤æ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">del <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- è®¾ç½®æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">incr <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">incrby <span class="cm-keyword">key</span> increment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">incrbyfloat <span class="cm-keyword">key</span> increment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- è®¾ç½®æ•°å€¼æ•°æ®å‡å°‘æŒ‡å®šèŒƒå›´çš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">decr <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">decrby <span class="cm-keyword">key</span> increment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- è·å–æ•°æ®å­—ç¬¦ä¸ªæ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">strlen <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- å‘å­—ç¬¦ä¸²çš„åé¢è¿½åŠ å­—ç¬¦ï¼Œå¦‚æœæœ‰å°±è¡¥åœ¨åé¢ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">append <span class="cm-keyword">key</span> <span class="cm-keyword">value</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 621px;"></div><div class="CodeMirror-gutters" style="display: none; height: 621px;"></div></div></div></pre><h2 id='22-hash'><span>2.2 Hash</span></h2><ul><li><p><span>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå¯¹ä¸€ç³»åˆ—å­˜å‚¨çš„æ•°æ®è¿›è¡Œç¼–ç»„ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå…¸å‹åº”ç”¨å­˜å‚¨å¯¹è±¡ä¿¡æ¯</span></p></li><li><p><span>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ®</span></p></li><li><p><span>Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±</span><strong><span>å‹ç¼©åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨</span></strong><span>å®ç°çš„ï¼š</span></p><ul><li><p><span>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± hash-max-ziplist-entries é…ç½®ï¼‰ï¼Œæ‰€æœ‰å€¼å°äº 64 å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± hash-max-ziplist-value é…ç½®ï¼‰çš„è¯ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>å‹ç¼©åˆ—è¡¨</span></strong><span>ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li><li><p><span>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>å“ˆå¸Œè¡¨</span></strong><span>ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</span></p></li></ul><p><strong><span>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†</span></strong><span>ã€‚</span></p></li></ul><p><img src="./images/hash.png" referrerpolicy="no-referrer" alt="hash.png"></p><p><strong><span>åŸºæœ¬æ“ä½œ</span></strong></p><p><strong><span>hash ç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</span></strong></p><ul><li><p><span>hashç±»å‹ä¸‹çš„value</span><strong><span>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</span></strong><span>ï¼Œä¸å…è®¸å­˜å‚¨å…¶ä»–æ•°æ®ç±»å‹ï¼Œ</span><strong><span>ä¸å­˜åœ¨åµŒå¥—ç°è±¡</span></strong><span>ã€‚å¦‚æœæ•°æ®æœªè·å–åˆ°ï¼Œ å¯¹åº”çš„å€¼ä¸ºï¼ˆnilï¼‰</span></p></li><li><p><span>æ¯ä¸ª hash å¯ä»¥å­˜å‚¨ 2^32 - 1 ä¸ªé”®å€¼</span></p></li><li><p><span>hashç±»å‹ååˆ†è´´è¿‘å¯¹è±¡çš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ·»åŠ åˆ é™¤å¯¹è±¡å±æ€§ã€‚ä½†hashè®¾è®¡åˆè¡·ä¸æ˜¯ä¸ºäº†å­˜å‚¨å¤§é‡å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œ</span><strong><span>åˆ‡è®°ä¸å¯æ»¥ç”¨</span></strong><span>ï¼Œæ›´</span><strong><span>ä¸å¯ä»¥å°†hashä½œä¸ºå¯¹è±¡åˆ—è¡¨ä½¿ç”¨</span></strong></p></li><li><p><span>hgetall æ“ä½œå¯ä»¥è·å–å…¨éƒ¨å±æ€§ï¼Œå¦‚æœå†…éƒ¨fieldè¿‡å¤šï¼Œéå†æ•´ä½“</span><strong><span>æ•°æ®æ•ˆç‡å°±å¾ˆä¼šä½</span></strong><span>ï¼Œæœ‰å¯èƒ½æˆä¸ºæ•°æ®è®¿é—®ç“¶é¢ˆ.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¼šè¢«è¦†ç›–ï¼‰</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hset <span class="cm-keyword">key</span> <span class="cm-keyword">field</span> <span class="cm-keyword">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hmset <span class="cm-keyword">key</span> field1 value1 field2 value2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¸ä¼šè¢«è¦†ç›–ï¼‰</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hsetnx <span class="cm-keyword">key</span> <span class="cm-keyword">field</span> <span class="cm-keyword">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//å–å‡º</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hget <span class="cm-keyword">key</span> <span class="cm-keyword">field</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hgetall <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//åˆ é™¤</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hdel <span class="cm-keyword">key</span> field1 field2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è·å–fieldæ•°é‡</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hlen <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hexists <span class="cm-keyword">key</span> <span class="cm-keyword">field</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µåæˆ–å­—æ®µå€¼ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hkeys <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hvals <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è®¾ç½®æŒ‡å®šå­—æ®µçš„æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hincrby <span class="cm-keyword">key</span> <span class="cm-keyword">field</span> increment </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hdecrby <span class="cm-keyword">key</span> <span class="cm-keyword">field</span> increment</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 598px;"></div><div class="CodeMirror-gutters" style="display: none; height: 598px;"></div></div></div></pre><p>&nbsp;</p><h2 id='23-list'><span>2.3 List</span></h2><ul><li><p><span>æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤šä¸ªæ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›å…¥å­˜å‚¨ç©ºé—´çš„é¡ºåºè¿›è¡ŒåŒºåˆ†</span></p></li><li><p><span>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œä¸”é€šè¿‡æ•°æ®å¯ä»¥ä½“ç°è¿›å…¥é¡ºåº</span></p></li><li><p><strong><span>å…ƒç´ æœ‰åºï¼Œä¸”å¯é‡</span></strong></p></li><li><p><span>List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±</span><strong><span>åŒå‘é“¾è¡¨æˆ–å‹ç¼©åˆ—è¡¨</span></strong><span>å®ç°çš„ï¼š</span></p><ul><li><p><span>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-entries é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº 64 å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± list-max-ziplist-value é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>å‹ç¼©åˆ—è¡¨</span></strong><span>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li><li><p><span>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>åŒå‘é“¾è¡¨</span></strong><span>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li></ul><p><span>ä½†æ˜¯</span><strong><span>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± quicklist å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨</span></strong><span>ã€‚</span></p></li></ul><p><img src="./images/list.png" referrerpolicy="no-referrer" alt="list.png"></p><p><strong><span>åŸºæœ¬æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ·»åŠ ä¿®æ”¹æ•°æ®<span class="cm-punctuation">,</span>lpushä¸ºä»å·¦è¾¹æ·»åŠ ï¼Œrpushä¸ºä»å³è¾¹æ·»åŠ </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lpush <span class="cm-keyword">key</span> value1 value2 value3...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rpush <span class="cm-keyword">key</span> value1 value2 value3...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æ•°æ®<span class="cm-punctuation">,</span> ä»å·¦è¾¹å¼€å§‹å‘å³æŸ¥çœ‹. å¦‚æœä¸çŸ¥é“listæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œendçš„å€¼å¯ä»¥ä¸º<span class="cm-operator">-</span><span class="cm-number">1</span><span class="cm-punctuation">,</span>ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//lpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å<span class="cm-punctuation">,</span>rpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å‰é¢</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lrange <span class="cm-keyword">key</span> <span class="cm-keyword">start</span> <span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//å¾—åˆ°é•¿åº¦</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">llen <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//å–å‡ºå¯¹åº”ç´¢å¼•çš„å…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lindex <span class="cm-keyword">key</span> <span class="cm-keyword">index</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è·å–å¹¶ç§»é™¤å…ƒç´ ï¼ˆä»listå·¦è¾¹æˆ–è€…å³è¾¹ç§»é™¤ï¼‰</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lpop <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rpop <span class="cm-keyword">key</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 345px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><p><strong><span>æ‰©å±•æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è§„å®šæ—¶é—´å†…è·å–å¹¶ç§»é™¤æ•°æ®<span class="cm-punctuation">,</span>b<span class="cm-operator">=</span>block<span class="cm-punctuation">,</span>ç»™å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ”¾å…¥äº†å…ƒç´ ï¼Œå°±ç§»é™¤</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">blpop key1 key2... timeout</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">brpop key1 key2... timeout</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ç§»é™¤æŒ‡å®šå…ƒç´  <span class="cm-keyword">count</span><span class="cm-punctuation">:</span>ç§»é™¤çš„ä¸ªæ•° <span class="cm-keyword">value</span><span class="cm-punctuation">:</span>ç§»é™¤çš„å€¼ã€‚ ç§»é™¤å¤šä¸ªç›¸åŒå…ƒç´ æ—¶ï¼Œä»å·¦è¾¹å¼€å§‹ç§»é™¤</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lrem <span class="cm-keyword">key</span> <span class="cm-keyword">count</span> <span class="cm-keyword">value</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><p><strong><span>æ³¨æ„äº‹é¡¹</span></strong></p><ul><li><p><span>listä¸­ä¿å­˜çš„æ•°æ®éƒ½æ˜¯stringç±»å‹çš„ï¼Œæ•°æ®æ€»å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæœ€å¤š2^32 - 1 ä¸ªå…ƒç´  (4294967295)ã€‚</span></p></li><li><p><span>listå…·æœ‰ç´¢å¼•çš„æ¦‚å¿µï¼Œä½†æ˜¯æ“ä½œæ•°æ®æ—¶é€šå¸¸ä»¥</span><strong><span>é˜Ÿåˆ—</span></strong><span>çš„å½¢å¼è¿›è¡Œå…¥é˜Ÿå‡ºé˜Ÿ(rpush, rpop)æ“ä½œï¼Œæˆ–ä»¥</span><strong><span>æ ˆ</span></strong><span>çš„å½¢å¼è¿›è¡Œå…¥æ ˆå‡ºæ ˆ(lpush, lpop)æ“ä½œ</span></p></li><li><p><span>è·å–å…¨éƒ¨æ•°æ®æ“ä½œç»“æŸç´¢å¼•è®¾ç½®ä¸º-1 (å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ )</span></p></li><li><p><span>listå¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µæ“ä½œï¼Œé€šå¸¸ç¬¬ä¸€é¡µçš„ä¿¡æ¯æ¥è‡ªäºlistï¼Œç¬¬2é¡µåŠæ›´å¤šçš„ä¿¡æ¯é€šè¿‡æ•°æ®åº“çš„å½¢å¼åŠ è½½.</span></p></li></ul><h2 id='24-set'><span>2.4 Set</span></h2><ul><li><p><span>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ–¹é¢æä¾›æ›´é«˜çš„æ•ˆç‡</span></p></li><li><p><span>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šèƒ½å¤Ÿä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé«˜æ•ˆçš„å†…éƒ¨å­˜å‚¨æœºåˆ¶ï¼Œä¾¿äºæŸ¥è¯¢</span></p></li><li><p><span>setç±»å‹ï¼šä¸hashå­˜å‚¨ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…å­˜å‚¨é”®ï¼Œä¸å­˜å‚¨å€¼ï¼ˆnilï¼‰ï¼Œå¹¶ä¸”å€¼æ˜¯ä¸å…è®¸é‡å¤çš„</span></p></li><li><p><span>Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±</span><strong><span>å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆ</span></strong><span>å®ç°çš„ï¼š</span></p><ul><li><p><span>å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº 512 ï¼ˆé»˜è®¤å€¼ï¼Œset-maxintset-entriesé…ç½®ï¼‰ä¸ªï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>æ•´æ•°é›†åˆ</span></strong><span>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li><li><p><span>å¦‚æœé›†åˆä¸­çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼Œåˆ™ Redis ä½¿ç”¨</span><strong><span>å“ˆå¸Œè¡¨</span></strong><span>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</span></p></li></ul></li></ul><p><img src="./images/set.png" referrerpolicy="no-referrer" alt="set.png"></p><p><strong><span>åŸºæœ¬æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ·»åŠ å…ƒç´ </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sadd <span class="cm-keyword">key</span> member1 member2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹å…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">smembers <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ç§»é™¤å…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">srem <span class="cm-keyword">key</span> member</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">scard <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sismember <span class="cm-keyword">key</span> member</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><strong><span>æ‰©å±•æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ä»setä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">srandmember <span class="cm-keyword">key</span> <span class="cm-keyword">count</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ä»setä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ å¹¶ç§»é™¤</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spop <span class="cm-keyword">key</span> <span class="cm-keyword">count</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sinter key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sunion key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sdiff key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ±‚ä¸¤ä¸ªsetçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼Œå¹¶æ”¾å…¥å¦ä¸€ä¸ªsetä¸­</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sinterstore destination key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sunionstore destination key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sdiffstore destination key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ±‚æŒ‡å®šå…ƒç´ ä»åŸé›†åˆæ”¾å…¥ç›®æ ‡é›†åˆä¸­</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">smove <span class="cm-builtin">source</span> destination <span class="cm-keyword">key</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 414px;"></div><div class="CodeMirror-gutters" style="display: none; height: 414px;"></div></div></div></pre><h2 id='25-sortedset'><span>2.5 sorted_set</span></h2><ul><li><p><strong><span>ä¸é‡ä½†æœ‰åºï¼ˆscoreï¼‰</span></strong></p></li><li><p><span>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šæ•°æ®æ’åºæœ‰åˆ©äºæ•°æ®çš„æœ‰æ•ˆå±•ç¤ºï¼Œéœ€è¦æä¾›ä¸€ç§å¯ä»¥æ ¹æ®è‡ªèº«ç‰¹å¾è¿›è¡Œ</span><strong><span>æ’åº</span></strong><span>çš„æ–¹å¼</span></p></li><li><p><span>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šæ–°çš„å­˜å‚¨æ¨¡å‹ï¼Œå¯ä»¥ä¿å­˜</span><strong><span>å¯æ’åº</span></strong><span>çš„æ•°æ®</span></p></li><li><p><span>sorted_setç±»å‹ï¼šåœ¨setçš„å­˜å‚¨ç»“æ„åŸºç¡€ä¸Šæ·»åŠ å¯æ’åºå­—æ®µ</span></p></li><li><p><span>Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±</span><strong><span>å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨</span></strong><span>å®ç°çš„ï¼š</span></p><ul><li><p><span>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>å‹ç¼©åˆ—è¡¨</span></strong><span>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li><li><p><span>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨</span><strong><span>è·³è¡¨</span></strong><span>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</span></p></li></ul></li></ul><p><img src="./images/sorted_set.png" referrerpolicy="no-referrer" alt="sorted_set.png"></p><p>&nbsp;</p><p><strong><span>åŸºæœ¬æ“ä½œ</span></strong></p><ul><li><p><span>minä¸maxç”¨äºé™å®šæœç´¢æŸ¥è¯¢çš„</span><strong><span>æ¡ä»¶</span></strong></p></li><li><p><span>startä¸stopç”¨äºé™å®š</span><strong><span>æŸ¥è¯¢èŒƒå›´</span></strong><span>ï¼Œä½œç”¨äºç´¢å¼•ï¼Œè¡¨ç¤ºå¼€å§‹å’Œç»“æŸç´¢å¼•</span></p></li><li><p><span>offsetä¸countç”¨äºé™å®šæŸ¥è¯¢èŒƒå›´ï¼Œä½œç”¨äºæŸ¥è¯¢ç»“æœï¼Œè¡¨ç¤º</span><strong><span>å¼€å§‹ä½ç½®</span></strong><span>å’Œ</span><strong><span>æ•°æ®æ€»é‡</span></strong></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ’å…¥å…ƒç´ <span class="cm-punctuation">,</span> éœ€è¦æŒ‡å®šscore<span class="cm-bracket">(</span>ç”¨äºæ’åº<span class="cm-bracket">)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zadd <span class="cm-keyword">key</span> score1 member1 score2 member2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹å…ƒç´ <span class="cm-bracket">(</span>scoreå‡åº<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrange <span class="cm-keyword">key</span> <span class="cm-keyword">start</span> <span class="cm-keyword">end</span> <span class="cm-bracket">(</span>withscore<span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹å…ƒç´ <span class="cm-bracket">(</span>scoreé™åº<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrevrange <span class="cm-keyword">key</span> <span class="cm-keyword">start</span> <span class="cm-keyword">end</span> <span class="cm-bracket">(</span>withscore<span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ç§»é™¤å…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrem <span class="cm-keyword">key</span> member1 member2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŒ‰æ¡ä»¶è·å–æ•°æ®<span class="cm-punctuation">,</span> å…¶ä¸­offsetä¸ºç´¢å¼•å¼€å§‹ä½ç½®ï¼Œcountä¸ºè·å–çš„æ•°ç›®</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrangebyscore <span class="cm-keyword">key</span> <span class="cm-keyword">min</span> <span class="cm-keyword">max</span> <span class="cm-bracket">[</span>withscore<span class="cm-bracket">]</span> <span class="cm-bracket">[</span><span class="cm-keyword">limit</span> <span class="cm-keyword">offset</span> <span class="cm-keyword">count</span><span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrevrangebyscore <span class="cm-keyword">key</span> <span class="cm-keyword">max</span> <span class="cm-keyword">min</span> <span class="cm-bracket">[</span>withscore<span class="cm-bracket">]</span> <span class="cm-bracket">[</span><span class="cm-keyword">limit</span> <span class="cm-keyword">offset</span> <span class="cm-keyword">count</span><span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŒ‰æ¡ä»¶ç§»é™¤å…ƒç´ </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zremrangebyrank <span class="cm-keyword">key</span> <span class="cm-keyword">start</span> <span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zremrangebysocre <span class="cm-keyword">key</span> <span class="cm-keyword">min</span> <span class="cm-keyword">max</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºç§»é™¤countä¸ªå€¼</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zpopmax <span class="cm-keyword">key</span> <span class="cm-bracket">[</span><span class="cm-keyword">count</span><span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºç§»é™¤countä¸ªå€¼</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zpopmin <span class="cm-keyword">key</span> <span class="cm-bracket">[</span><span class="cm-keyword">count</span><span class="cm-bracket">]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è·å¾—å…ƒç´ ä¸ªæ•°</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zcard <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è·å¾—å…ƒç´ åœ¨èŒƒå›´å†…çš„ä¸ªæ•°</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zcount <span class="cm-keyword">min</span> <span class="cm-keyword">max</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ±‚äº¤é›†ã€å¹¶é›†å¹¶æ”¾å…¥destinationä¸­<span class="cm-punctuation">,</span> å…¶ä¸­numkey1ä¸ºè¦å»äº¤é›†æˆ–å¹¶é›†é›†åˆçš„æ•°ç›®</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zinterstore destination numkeys key1 key2...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zunionstore destination numkeys key1 key2...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 736px;"></div><div class="CodeMirror-gutters" style="display: none; height: 736px;"></div></div></div></pre><p><strong><span>æ‹“å±•æ“ä½œ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æŸä¸ªå…ƒç´ çš„ç´¢å¼•<span class="cm-bracket">(</span>æ’å<span class="cm-bracket">)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrank <span class="cm-keyword">key</span> member</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zrevrank <span class="cm-keyword">key</span> member</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zscore <span class="cm-keyword">key</span> member</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//å¢åŠ æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">zincrby <span class="cm-keyword">key</span> increment member</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><ul><li><p><span>scoreä¿å­˜çš„æ•°æ®å­˜å‚¨ç©ºé—´æ˜¯64ä½ï¼Œå¦‚æœæ˜¯æ•´æ•°èŒƒå›´æ˜¯-9007199254740992~9007199254740992</span></p></li><li><p><span>scoreä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒç²¾åº¦çš„doubleå€¼ï¼ŒåŸºäºåŒç²¾åº¦æµ®ç‚¹æ•°çš„ç‰¹å¾ï¼Œ</span><strong><span>å¯èƒ½ä¼šä¸¢å¤±ç²¾åº¦</span></strong><span>ï¼Œä½¿ç”¨æ—¶å€™è¦</span><strong><span>æ…é‡</span></strong></p></li><li><p><span>sorted_set åº•å±‚å­˜å‚¨è¿˜æ˜¯</span><strong><span>åŸºäºset</span></strong><span>ç»“æ„çš„ï¼Œå› æ­¤æ•°æ®</span><strong><span>ä¸èƒ½é‡å¤</span></strong><span>ï¼Œå¦‚æœé‡å¤æ·»åŠ ç›¸åŒçš„æ•°æ®ï¼Œscoreå€¼å°†è¢«åå¤è¦†ç›–ï¼Œ</span><strong><span>ä¿ç•™æœ€åä¸€æ¬¡</span></strong><span>ä¿®æ”¹çš„ç»“æœ</span></p></li></ul><h2 id='26-é€šç”¨æŒ‡ä»¤'><span>2.6 é€šç”¨æŒ‡ä»¤</span></h2><ol start='' ><li><p><strong><span>keyçš„ç‰¹å¾</span></strong></p><ul><li><p><span>keyæ˜¯ä¸€ä¸ª</span><strong><span>å­—ç¬¦ä¸²</span></strong><span>ï¼Œé€šè¿‡keyè·å–redisä¸­ä¿å­˜çš„æ•°æ®</span></p></li></ul></li><li><p><strong><span>keyçš„æ“ä½œ</span></strong></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">exists</span> <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//åˆ é™¤key</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">del <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹keyçš„ç±»å‹</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">type <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//è®¾ç½®ç”Ÿå‘½å‘¨æœŸ</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">expire <span class="cm-keyword">key</span> seconds</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pexpire <span class="cm-keyword">key</span> milliseconds</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æœ‰æ•ˆæ—¶é—´<span class="cm-punctuation">,</span> å¦‚æœæœ‰æœ‰æ•ˆæ—¶é—´åˆ™è¿”å›å‰©ä½™æœ‰æ•ˆæ—¶é—´<span class="cm-punctuation">,</span> å¦‚æœä¸ºæ°¸ä¹…æœ‰æ•ˆï¼Œåˆ™è¿”å›<span class="cm-operator">-</span><span class="cm-number">1</span><span class="cm-punctuation">,</span> å¦‚æœKeyä¸å­˜åœ¨åˆ™è¿”å›<span class="cm-operator">-</span><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ttl <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pttl <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//å°†æœ‰æ—¶é™çš„æ•°æ®è®¾ç½®ä¸ºæ°¸ä¹…æœ‰æ•ˆ</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">persist <span class="cm-keyword">key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æ ¹æ®keyæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">keys</span> <span class="cm-operator">*</span> <span class="cm-comment">-- æŸ¥è¯¢æ‰€æœ‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">keys</span> it<span class="cm-operator">*</span> <span class="cm-comment">-- æŸ¥è¯¢ä»¥itå¼€å¤´</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">keys</span> <span class="cm-operator">*</span>it <span class="cm-comment">-- æŸ¥è¯¢ä»¥itç»“å°¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">keys</span> ??it <span class="cm-comment">-- æŸ¥è¯¢å‰é¢ä¸ºä¸¤ä¸ªä»»æ„å­—ç¬¦å¹¶ä»¥itç»“å°¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">keys</span> it<span class="cm-bracket">[</span>st<span class="cm-bracket">]</span>s <span class="cm-comment">-- æŸ¥è¯¢ä»¥itå¼€å¤´ï¼Œsç»“å°¾ï¼Œä¸­é—´åŒ…å«ä¸€ä¸ªå­—æ¯sæˆ–t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//é‡å‘½åkeyï¼Œä¸ºäº†é¿å…è¦†ç›–å·²æœ‰æ•°æ®ï¼Œå°½é‡å°‘å»ä¿®æ”¹å·²æœ‰keyçš„åå­—ï¼Œå¦‚æœè¦ä½¿ç”¨æœ€å¥½ä½¿ç”¨renamenx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">rename</span> <span class="cm-keyword">key</span> newKey</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">renamenx <span class="cm-keyword">key</span> newKey</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//æŸ¥çœ‹æ‰€æœ‰å…³äºkeyçš„æ“ä½œ<span class="cm-punctuation">,</span> å¯ä»¥ä½¿ç”¨Tabå¿«é€Ÿåˆ‡æ¢</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">help</span> <span class="cm-variable-2">@generic</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 782px;"></div><div class="CodeMirror-gutters" style="display: none; height: 782px;"></div></div></div></pre><h2 id='27-bitmaps'><span>2.7 Bitmaps </span></h2><p><span>Bitmaps å¹¶ä¸æ˜¯å®é™…çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯å®šä¹‰åœ¨Stringç±»å‹ä¸Šçš„ä¸€ä¸ªé¢å‘å­—èŠ‚æ“ä½œçš„é›†åˆã€‚å› ä¸ºå­—ç¬¦ä¸²æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„å—ï¼Œä»–ä»¬çš„æœ€å¤§é•¿åº¦æ˜¯512Mï¼Œæœ€é€‚åˆè®¾ç½®æˆ2^32ä¸ªä¸åŒå­—èŠ‚ã€‚</span></p><p><span>bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚</span></p><h4 id='åŸºç¡€æ“ä½œ'><span>åŸºç¡€æ“ä½œ</span></h4><ul><li><p><span>è·å–æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">getbit key offsetCopy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li><li><p><span>è®¾ç½®æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼ï¼Œvalueåªèƒ½æ˜¯1æˆ–0</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">setbit key offset value</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li></ul><h4 id='æ‰©å±•æ“ä½œ'><span>æ‰©å±•æ“ä½œ</span></h4><ul><li><p><span>å¯¹æŒ‡å®škeyæŒ‰ä½è¿›è¡Œäº¤ã€å¹¶ã€éã€å¼‚æˆ–æ“ä½œï¼Œå¹¶å°†ç»“æœ</span><strong><span>ä¿å­˜åˆ°destKey</span></strong><span>ä¸­</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bitop op destKey key1 [key2...]Copy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>andï¼šäº¤</span></p></li><li><p><span>orï¼šå¹¶</span></p></li><li><p><span>notï¼šé</span></p></li><li><p><span>xorï¼šå¼‚æˆ–</span></p></li></ul></li><li><p><span>ç»Ÿè®¡æŒ‡å®škeyä¸­1çš„æ•°é‡</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bitcount key [start end]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li></ul><h4 id='åº”ç”¨åœºæ™¯'><span>åº”ç”¨åœºæ™¯</span></h4><p><span>é€‚åˆéœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦ç™»å½•...ï¼‰å¹¶éœ€è¦è¿›ä¸€æ­¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æçš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚</span></p><h2 id='25-å•çº¿ç¨‹'><span>2.5 å•çº¿ç¨‹</span></h2><p><strong><span>å•çº¿ç¨‹æ¦‚å¿µ</span></strong></p><p><strong><span>Redis å•çº¿ç¨‹æŒ‡çš„æ˜¯ã€Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚-&gt;è§£æè¯·æ±‚ -&gt;è¿›è¡Œæ•°æ®è¯»å†™ç­‰æ“ä½œ-&gt;å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ¥å®Œæˆçš„</span></strong><span>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´ Redis æ˜¯å•çº¿ç¨‹çš„åŸå› ã€‚</span></p><p><span>ä½†æ˜¯ï¼Œ</span><strong><span>Redis ç¨‹åºå¹¶ä¸æ˜¯å•çº¿ç¨‹çš„</span></strong><span>ï¼ŒRedis åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯ä¼š</span><strong><span>å¯åŠ¨åå°çº¿ç¨‹</span></strong><span>ï¼ˆBIOï¼‰çš„ï¼š</span></p><ul><li><p><strong><span>Redis åœ¨ 2.6 ç‰ˆæœ¬</span></strong><span>ï¼Œä¼šå¯åŠ¨ 2 ä¸ªåå°çº¿ç¨‹ï¼Œåˆ†åˆ«å¤„ç†å…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜è¿™ä¸¤ä¸ªä»»åŠ¡ï¼›</span></p></li><li><p><strong><span>Redis åœ¨ 4.0 ç‰ˆæœ¬ä¹‹å</span></strong><span>ï¼Œæ–°å¢äº†ä¸€ä¸ªæ–°çš„åå°çº¿ç¨‹ï¼Œç”¨æ¥å¼‚æ­¥é‡Šæ”¾ Redis å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ lazyfree çº¿ç¨‹ã€‚ä¾‹å¦‚æ‰§è¡Œ unlink key / flushdb async / flushall async ç­‰å‘½ä»¤ï¼Œä¼šæŠŠè¿™äº›åˆ é™¤æ“ä½œäº¤ç»™åå°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œå¥½å¤„æ˜¯ä¸ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è¦åˆ é™¤ä¸€ä¸ªå¤§ key çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨ del å‘½ä»¤åˆ é™¤ï¼Œå› ä¸º del æ˜¯åœ¨ä¸»çº¿ç¨‹å¤„ç†çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ unlink å‘½ä»¤æ¥å¼‚æ­¥åˆ é™¤å¤§keyã€‚</span></p></li></ul><p><span>ä¹‹æ‰€ä»¥ Redis ä¸ºã€Œå…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜ã€é‡Šæ”¾å†…å­˜ã€è¿™äº›ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œæ˜¯å› ä¸ºè¿™äº›ä»»åŠ¡çš„æ“ä½œéƒ½æ˜¯å¾ˆè€—æ—¶çš„ï¼Œå¦‚æœæŠŠè¿™äº›ä»»åŠ¡éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹æ¥å¤„ç†ï¼Œé‚£ä¹ˆ Redis ä¸»çº¿ç¨‹å°±å¾ˆå®¹æ˜“å‘ç”Ÿé˜»å¡ï¼Œè¿™æ ·å°±æ— æ³•å¤„ç†åç»­çš„è¯·æ±‚äº†ã€‚</span></p><p><strong><span>åå°çº¿ç¨‹ç›¸å½“äºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…æŠŠè€—æ—¶ä»»åŠ¡ä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ï¼ˆBIOï¼‰ä¸åœè½®è¯¢è¿™ä¸ªé˜Ÿåˆ—ï¼Œæ‹¿å‡ºä»»åŠ¡å°±å»æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</span></strong></p><p><span>å…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜ã€é‡Šæ”¾å†…å­˜è¿™ä¸‰ä¸ªä»»åŠ¡éƒ½æœ‰å„è‡ªçš„ä»»åŠ¡é˜Ÿåˆ—ï¼š</span></p><ul><li><p><span>BIO_CLOSE_FILEï¼Œå…³é—­æ–‡ä»¶ä»»åŠ¡é˜Ÿåˆ—ï¼šå½“é˜Ÿåˆ—æœ‰ä»»åŠ¡åï¼Œåå°çº¿ç¨‹ä¼šè°ƒç”¨ close(fd) ï¼Œå°†æ–‡ä»¶å…³é—­ï¼›</span></p></li><li><p><span>BIO_AOF_FSYNCï¼ŒAOFåˆ·ç›˜ä»»åŠ¡é˜Ÿåˆ—ï¼šå½“ AOF æ—¥å¿—é…ç½®æˆ everysec é€‰é¡¹åï¼Œä¸»çº¿ç¨‹ä¼šæŠŠ AOF å†™æ—¥å¿—æ“ä½œå°è£…æˆä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚å½“å‘ç°é˜Ÿåˆ—æœ‰ä»»åŠ¡åï¼Œåå°çº¿ç¨‹ä¼šè°ƒç”¨ fsync(fd)ï¼Œå°† AOF æ–‡ä»¶åˆ·ç›˜ï¼Œ</span></p></li><li><p><span>BIO_LAZY_FREEï¼Œlazy free ä»»åŠ¡é˜Ÿåˆ—ï¼šå½“é˜Ÿåˆ—æœ‰ä»»åŠ¡åï¼Œåå°çº¿ç¨‹ä¼š free(obj) é‡Šæ”¾å¯¹è±¡ / free(dict) åˆ é™¤æ•°æ®åº“æ‰€æœ‰å¯¹è±¡ / free(skiplist) é‡Šæ”¾è·³è¡¨å¯¹è±¡ï¼›</span></p></li></ul><p>&nbsp;</p><p><strong><span>å•çº¿ç¨‹æ¨¡å‹</span></strong></p><p><img src="assets/image-20240622133327637.png" referrerpolicy="no-referrer" alt="image-20240622133327637"></p><p><span>å›¾ä¸­çš„è“è‰²éƒ¨åˆ†æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ˜¯ç”±ä¸»çº¿ç¨‹è´Ÿè´£çš„ï¼Œå¯ä»¥çœ‹åˆ°ç½‘ç»œ I/O å’Œå‘½ä»¤å¤„ç†éƒ½æ˜¯å•çº¿ç¨‹ã€‚ Redis åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåšä¸‹é¢è¿™å‡ ä»¶äº‹æƒ…ï¼š</span></p><ul><li><p><span>é¦–å…ˆï¼Œè°ƒç”¨ epoll_create() åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡å’Œè°ƒç”¨ socket() åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ socket</span></p></li><li><p><span>ç„¶åï¼Œè°ƒç”¨ bind() ç»‘å®šç«¯å£å’Œè°ƒç”¨ listen() ç›‘å¬è¯¥ socketï¼›</span></p></li><li><p><span>ç„¶åï¼Œå°†è°ƒç”¨ epoll_ctl() å°† listen socket åŠ å…¥åˆ° epollï¼ŒåŒæ—¶æ³¨å†Œã€Œè¿æ¥äº‹ä»¶ã€å¤„ç†å‡½æ•°ã€‚</span></p></li></ul><p><span>åˆå§‹åŒ–å®Œåï¼Œä¸»çº¿ç¨‹å°±è¿›å…¥åˆ°ä¸€ä¸ª</span><strong><span>äº‹ä»¶å¾ªç¯å‡½æ•°</span></strong><span>ï¼Œä¸»è¦ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</span></p><ul><li><p><span>é¦–å…ˆï¼Œå…ˆè°ƒç”¨</span><strong><span>å¤„ç†å‘é€é˜Ÿåˆ—å‡½æ•°</span></strong><span>ï¼Œçœ‹æ˜¯å‘é€é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å‘é€ä»»åŠ¡ï¼Œåˆ™é€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šæ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</span></p></li><li><p><span>æ¥ç€ï¼Œè°ƒç”¨ epoll_wait å‡½æ•°ç­‰å¾…äº‹ä»¶çš„åˆ°æ¥ï¼š</span></p><ul><li><p><span>å¦‚æœæ˜¯</span><strong><span>è¿æ¥äº‹ä»¶</span></strong><span>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨</span><strong><span>è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°</span></strong><span>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt; è°ƒç”¨ epoll_ctl å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</span></p></li><li><p><span>å¦‚æœæ˜¯</span><strong><span>è¯»äº‹ä»¶</span></strong><span>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨</span><strong><span>è¯»äº‹ä»¶å¤„ç†å‡½æ•°</span></strong><span>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</span></p></li><li><p><span>å¦‚æœæ˜¯</span><strong><span>å†™äº‹ä»¶</span></strong><span>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨</span><strong><span>å†™äº‹ä»¶å¤„ç†å‡½æ•°</span></strong><span>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</span></p></li></ul></li></ul><p>&nbsp;</p><p><strong><span>Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ</span></strong></p><p><span>å®˜æ–¹ä½¿ç”¨åŸºå‡†æµ‹è¯•çš„ç»“æœæ˜¯ï¼Œ</span><strong><span>å•çº¿ç¨‹çš„ Redis ååé‡å¯ä»¥è¾¾åˆ° 10W/æ¯ç§’</span></strong><span>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><span>ä¹‹æ‰€ä»¥ Redis é‡‡ç”¨å•çº¿ç¨‹ï¼ˆç½‘ç»œ I/O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰é‚£ä¹ˆå¿«ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ï¼š</span></p><ul><li><p><span>Redis çš„å¤§éƒ¨åˆ†æ“ä½œ</span><strong><span>éƒ½åœ¨å†…å­˜ä¸­å®Œæˆ</span></strong><span>ï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› æ­¤ Redis ç“¶é¢ˆå¯èƒ½æ˜¯æœºå™¨çš„å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ï¼Œè€Œå¹¶é CPUï¼Œæ—¢ç„¶ CPU ä¸æ˜¯ç“¶é¢ˆï¼Œé‚£ä¹ˆè‡ªç„¶å°±é‡‡ç”¨å•çº¿ç¨‹çš„è§£å†³æ–¹æ¡ˆäº†ï¼›</span></p></li><li><p><span>Redis é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹å¯ä»¥</span><strong><span>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰</span></strong><span>ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</span></p></li><li><p><span>Redis é‡‡ç”¨äº† </span><strong><span>I/O å¤šè·¯å¤ç”¨æœºåˆ¶</span></strong><span>å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯ Socket è¯·æ±‚ï¼ŒIO å¤šè·¯å¤ç”¨æœºåˆ¶æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO æµï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„ select/epoll æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨ Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬ Socket å’Œå·²è¿æ¥ Socketã€‚å†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº› Socket ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚ä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ª Redis çº¿ç¨‹å¤„ç†å¤šä¸ª IO æµçš„æ•ˆæœã€‚</span></p></li></ul><p><span>å‡è®¾æœ‰ä¸¤ä¸ªä»»åŠ¡Aå’ŒBï¼Œåˆ†åˆ«æœ‰ä¸¤ç§æ–¹æ³•æ¥æ‰§è¡Œä»–ä»¬</span></p><ul><li><p><span>ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼šå…ˆæ‰§è¡ŒAä¸€æ®µæ—¶é—´ï¼Œç„¶ååˆ‡æ¢åˆ°Bå†æ‰§è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶ååˆåˆ‡æ¢å›Aæ‰§è¡Œâ€¦ ç›´åˆ°Aå’ŒBéƒ½æ‰§è¡Œå®Œæ¯•</span></p></li><li><p><span>ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼šå…ˆæ‰§è¡ŒAï¼ŒAæ‰§è¡Œå®Œäº†åœ¨æ‰§è¡ŒB</span></p></li></ul><p><span>å¯¹äºå•æ ¸CPUæ¥è¯´ï¼Œç¬¬äºŒç§æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ›´çŸ­ï¼Œæ•ˆç‡æ›´é«˜ã€‚å› ä¸ºå•æ ¸CPUä¸‹çš„å¹¶å‘æ“ä½œï¼Œä¼šå¯¼è‡´ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œéœ€è¦ä¿å­˜åˆ‡æ¢çº¿ç¨‹çš„ä¿¡æ¯ï¼Œè¿™æ®µæ—¶é—´CPUæ— æ³•å»æ‰§è¡Œä»»ä½•ä»»åŠ¡ä¸­çš„æŒ‡ä»¤ï¼Œæ—¶é—´ç™½ç™½æµªè´¹äº†.</span></p><p><strong><span>å¯¹äºI/Oæ“ä½œï¼Œå¹¶å‘æ‰§è¡Œæ•ˆç‡æ›´é«˜</span></strong></p><p><span>å› ä¸ºI/Oæ“ä½œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹</span></p><ul><li><p><span>ç­‰å¾…I/Oå‡†å¤‡å°±ç»ª</span></p></li><li><p><span>çœŸæ­£æ“ä½œI/Oèµ„æº</span></p></li></ul><p><strong><span>ç­‰å¾…I/Oå‡†å¤‡å°±ç»ª</span></strong><span>è¿™ä¸ªé˜¶æ®µï¼ŒCPUæ˜¯ç©ºé—²çš„ï¼Œè¿™æ—¶ä¾¿å¯ä»¥å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè¿™æ ·ä¹Ÿå°±æé«˜äº†CPUçš„åˆ©ç”¨ç‡</span></p><p><strong><span>è€ŒRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼Œæ²¡æœ‰I/Oæ“ä½œï¼Œæ‰€ä»¥å•çº¿ç¨‹æ‰§è¡Œæ•ˆç‡æ›´é«˜</span></strong></p><p>&nbsp;</p><p><strong><span>Redis6.0 ä¹‹å‰ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</span></strong></p><p><span>æˆ‘è§‰å¾—ä¸»è¦åŸå› æœ‰ä¸‹é¢ 3 ä¸ªï¼š</span></p><ol start='' ><li><p><span>å•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼›</span></p></li><li><p><span>Redis çš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼›</span></p></li><li><p><span>å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚</span></p></li></ol><p><strong><span>Redis6.0 å¼•å…¥å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½</span></strong><span>ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯ Redis ä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆï¼ˆRedis çš„ç“¶é¢ˆä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œï¼‰ã€‚</span></p><p><span>è™½ç„¶ï¼ŒRedis6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯ Redis çš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨äº†ï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</span></p><p><span>Redis6.0 çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ </span><code>redis.conf</code><span> ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">io-threads-do-reads yesCopy to clipboardErrorCopied</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>å¼€å¯å¤šçº¿ç¨‹åï¼Œè¿˜éœ€è¦è®¾ç½®çº¿ç¨‹æ•°ï¼Œå¦åˆ™æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚åŒæ ·éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ </span><code>redis.conf</code><span> :</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">io-threads <span class="cm-number">4</span> <span class="cm-comment">#å®˜ç½‘å»ºè®®4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h1 id='ä¸‰æ•°æ®ç»“æ„'><span>ä¸‰ã€æ•°æ®ç»“æ„</span></h1><h2 id='31-è·³è·ƒè¡¨'><span>3.1 è·³è·ƒè¡¨</span></h2><p><span>è·³è·ƒè¡¨(shiplist)æ˜¯å®ç°sortset(</span><strong><span>æœ‰åº</span></strong><span>é›†åˆ)çš„åº•å±‚æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚è·³è¡¨çš„ä¼˜åŠ¿æ˜¯èƒ½æ”¯æŒå¹³å‡ O(logN) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</span></p><p><span>zset ç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯è·³è¡¨ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½è¿›è¡Œé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿèƒ½è¿›è¡Œé«˜æ•ˆå•ç‚¹æŸ¥è¯¢ã€‚</span></p><p><span>è·³è·ƒè¡¨æ˜¯åŸºäºå¤šæŒ‡é’ˆæœ‰åºé“¾è¡¨å®ç°çš„ï¼Œå¯ä»¥çœ‹æˆå¤šä¸ªæœ‰åºé“¾è¡¨ã€‚</span></p><p><img src="./images/è·³è·ƒè¡¨.png" referrerpolicy="no-referrer"></p><p><span>(1) ç”±å¾ˆå¤šå±‚ç»“æ„ç»„æˆ</span>
<span> (2) æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„é“¾è¡¨</span>
<span> (3) æœ€åº•å±‚(Level 1)çš„é“¾è¡¨åŒ…å«æ‰€æœ‰å…ƒç´ </span>
<span> (4) å¦‚æœä¸€ä¸ªå…ƒç´ å‡ºç°åœ¨ Level i çš„é“¾è¡¨ä¸­ï¼Œåˆ™å®ƒåœ¨ Level i ä¹‹ä¸‹çš„é“¾è¡¨ä¹Ÿéƒ½ä¼šå‡ºç°ã€‚</span>
<span> (5) æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åŒä¸€é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹é¢ä¸€å±‚çš„å…ƒç´ ã€‚</span></p><h3 id='311-è·³è·ƒè¡¨çš„æœç´¢'><span>3.1.1 è·³è·ƒè¡¨çš„æœç´¢</span></h3><ul><li><p><span>æˆ‘ä»¬æœç´¢å…ƒç´ æ—¶ï¼Œä»æœ€ä¸Šå±‚çš„é“¾è¡¨å¼€å§‹æœç´¢ã€‚å½“æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹å¤§äºç›®æ ‡å€¼æˆ–å…¶åç»§èŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œä»è¯¥èŠ‚ç‚¹å‘ä¸‹å±‚é“¾è¡¨æœå¯»ï¼Œç„¶åé¡ºç€è¯¥èŠ‚ç‚¹åˆ°ä¸‹ä¸€å±‚ç»§ç»­æœç´¢ã€‚</span></p><p><span>æ¯”å¦‚æˆ‘ä»¬è¦æ‰¾87è¿™ä¸ªå…ƒç´ ï¼Œåˆ™ä¼šç»å†ï¼š2-&gt;54-&gt;87</span></p></li></ul><h3 id='312-è·³è·ƒè¡¨çš„æ’å…¥'><span>3.1.2 è·³è·ƒè¡¨çš„æ’å…¥</span></h3><ul><li><p><span>å…ˆæ‰¾åˆ°åˆé€‚çš„ä½ç½®ä»¥ä¾¿æ’å…¥å…ƒç´ </span></p></li><li><p><span>æ‰¾åˆ°åï¼Œå°†è¯¥å…ƒç´ æ’å…¥åˆ°æœ€åº•å±‚çš„é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”æŠ›æ·ç¡¬å¸ï¼ˆ1/2çš„æ¦‚ç‡ï¼‰</span></p><ul><li><p><span>è‹¥ç¡¬å¸ä¸ºæ­£é¢ï¼Œåˆ™å°†è¯¥å…ƒç´ æ™‹å‡åˆ°ä¸Šä¸€å±‚é“¾è¡¨ä¸­ï¼Œ</span><strong><span>å¹¶å†æŠ›ä¸€æ¬¡</span></strong></p></li><li><p><span>è‹¥ç¡¬å¸ä¸ºåé¢ï¼Œåˆ™æ’å…¥è¿‡ç¨‹ç»“æŸ</span></p></li></ul></li><li><p><span>ä¸ºäº†é¿å…ä»¥ä¸‹æƒ…å†µï¼Œéœ€è¦åœ¨æ¯ä¸ªé“¾è¡¨çš„å¤´éƒ¨è®¾ç½®ä¸€ä¸ª </span><strong><span>è´Ÿæ— ç©·</span></strong><span> çš„å…ƒç´ </span></p></li></ul><p><img src="./images/è·³è·ƒè¡¨æ’å…¥.jpg" referrerpolicy="no-referrer" alt="è·³è·ƒè¡¨æ’å…¥.jpg"></p><p><span>å¦‚æœKå¤§äºé“¾è¡¨çš„å±‚æ•°,éœ€è¦æ·»åŠ æ–°çš„å±‚ã€‚</span></p><h3 id='313-è·³è·ƒè¡¨çš„åˆ é™¤'><span>3.1.3 è·³è·ƒè¡¨çš„åˆ é™¤</span></h3><p><span>å„ä¸ªå±‚ä¸­æ‰¾åˆ°åŒ…å« x çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨æ ‡å‡†çš„ delete from list æ–¹æ³•åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</span></p><h3 id='314-è·³è·ƒè¡¨çš„ä¼˜ç‚¹'><span>3.1.4 è·³è·ƒè¡¨çš„ä¼˜ç‚¹</span></h3><p><span>ä¸çº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ç›¸æ¯”ï¼Œè·³è·ƒè¡¨å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</span></p><ul><li><p><span>æ’å…¥é€Ÿåº¦éå¸¸å¿«é€Ÿï¼Œå› ä¸ºä¸éœ€è¦è¿›è¡Œæ—‹è½¬ç­‰æ“ä½œæ¥ç»´æŠ¤å¹³è¡¡æ€§ï¼›</span></p></li><li><p><span>æ›´å®¹æ˜“å®ç°ï¼›</span></p></li><li><p><span>æ”¯æŒæ— é”æ“ä½œã€‚</span></p></li></ul><h3 id='315-ä¸ºä»€ä¹ˆredisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨bæ ‘'><span>3.1.5 ä¸ºä»€ä¹ˆRedisè¦ä½¿ç”¨è·³è·ƒè¡¨è€Œä¸æ˜¯ç”¨B+æ ‘</span></h3><p><span>MySQLä½¿ç”¨B+æ ‘çš„æ˜¯å› ä¸ºï¼š</span><strong><span>å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•</span></strong><span>ï¼ŒB+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨å¤šä¸ªå…³é”®å­—ï¼Œå®ƒå°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºç£ç›˜é¡µçš„å¤§å°ï¼Œ</span><strong><span>å……åˆ†åˆ©ç”¨äº†ç£ç›˜é¢„è¯»çš„åŠŸèƒ½</span></strong><span>ã€‚æ¯æ¬¡è¯»å–ç£ç›˜é¡µæ—¶å°±ä¼šè¯»å–ä¸€æ•´ä¸ªèŠ‚ç‚¹,æ¯ä¸ªå¶å­èŠ‚ç‚¹è¿˜æœ‰æŒ‡å‘å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä¸ºçš„æ˜¯æœ€å¤§é™åº¦çš„é™ä½ç£ç›˜çš„IO;å› ä¸ºæ•°æ®åœ¨å†…å­˜ä¸­è¯»å–è€—è´¹çš„æ—¶é—´æ˜¯ä»ç£ç›˜çš„IOè¯»å–çš„ç™¾ä¸‡åˆ†ä¹‹ä¸€</span></p><p><span>è€ŒRedisæ˜¯</span><strong><span>å†…å­˜ä¸­è¯»å–æ•°æ®ï¼Œä¸æ¶‰åŠIOï¼Œå› æ­¤ä½¿ç”¨äº†è·³è·ƒè¡¨</span></strong></p><p><span>æ—¢ç„¶æåˆ°äº†Redisæ˜¯å¯¹</span><strong><span>å†…å­˜æ“ä½œ</span></strong><span>çš„ï¼Œé‚£ä¹ˆå†è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š</span><strong><span>ä¸ºä»€ä¹ˆRedisæ˜¯å•çº¿ç¨‹çš„è¿˜è¿™ä¹ˆå¿«å‘¢</span></strong></p><h3 id='316-ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘'><span>3.1.6 ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</span></h3><ul><li><p><strong><span>ä»å†…å­˜å ç”¨ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›</span></strong><span>ã€‚å¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œè·³è¡¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º 1/(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•° p çš„å¤§å°ã€‚å¦‚æœåƒ Redisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå– p=1/4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</span></p></li><li><p><strong><span>åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ“ä½œè¦ç®€å•</span></strong><span>ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨è·³è¡¨ä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬ 1 å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚</span></p></li><li><p><strong><span>ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤š</span></strong><span>ã€‚å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œè·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚</span></p></li></ul><h1 id='å››æŒä¹…åŒ–'><span>å››ã€æŒä¹…åŒ–</span></h1><ul><li><p><span>æŒä¹…åŒ–æ˜¯åˆ©ç”¨</span><strong><span>æ°¸ä¹…æ€§</span></strong><span>å­˜å‚¨ä»‹è´¨å°†æ•°æ®è¿›è¡Œä¿å­˜ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´å°†ä¿å­˜çš„æ•°æ®è¿›è¡Œæ¢å¤çš„å·¥ä½œæœºåˆ¶ç§°ä¸ºæŒä¹…åŒ–</span></p></li><li><p><span>å¯ä»¥é˜²æ­¢æ•°æ®æ„å¤–ä¸¢å¤±ï¼Œç¡®ä¿æ•°æ®å®‰å…¨</span></p></li><li><p><span>æŒä¹…åŒ–ä¿å­˜ä»€ä¹ˆï¼Ÿ</span></p><ul><li><p><span>å°†å½“å‰</span><strong><span>æ•°æ®çŠ¶æ€</span></strong><span>è¿›è¡Œä¿å­˜ï¼Œ</span><strong><span>å¿«ç…§å½¢å¼</span></strong><span>ï¼Œå­˜å‚¨æ•°æ®ç»“æœï¼Œå­˜å‚¨æ ¼å¼ç®€å•ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º</span><strong><span>RDB</span></strong></p></li><li><p><span>å°†æ•°æ®çš„</span><strong><span>æ“ä½œè¿‡ç¨‹</span></strong><span>è¿›è¡Œä¿å­˜ï¼Œ</span><strong><span>æ—¥å¿—å½¢å¼</span></strong><span>ï¼Œå­˜å‚¨æ“ä½œè¿‡ç¨‹ï¼Œå­˜å‚¨æ ¼å¼å¤æ‚ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®çš„æ“ä½œè¿‡ç¨‹ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º</span><strong><span>AOF</span></strong></p></li></ul></li><li><p><span>Redis å…±æœ‰ä¸‰ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ï¼š</span></p><ul><li><p><strong><span>AOF æ—¥å¿—</span></strong><span>ï¼šæ¯æ‰§è¡Œä¸€æ¡å†™æ“ä½œå‘½ä»¤ï¼Œå°±æŠŠè¯¥å‘½ä»¤ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼›</span></p></li><li><p><strong><span>RDB å¿«ç…§</span></strong><span>ï¼šå°†æŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ï¼Œä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å†™å…¥ç£ç›˜ï¼›</span></p></li><li><p><strong><span>æ··åˆæŒä¹…åŒ–æ–¹å¼</span></strong><span>ï¼šRedis 4.0 æ–°å¢çš„æ–¹å¼ï¼Œé›†æˆäº† AOF å’Œ RBD çš„ä¼˜ç‚¹ï¼›</span></p></li></ul></li></ul><p><img src="./images/redisæŒä¹…åŒ–.png" referrerpolicy="no-referrer" alt="redisæŒä¹…åŒ–.png"></p><h2 id='41-rdb'><span>4.1 RDB</span></h2><p><span>å°†æŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ï¼Œä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å†™å…¥ç£ç›˜ï¼›Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveï¼Œä»–ä»¬çš„åŒºåˆ«å°±åœ¨äºæ˜¯å¦åœ¨ã€Œä¸»çº¿ç¨‹ã€é‡Œæ‰§è¡Œï¼š</span></p><ul><li><p><span>æ‰§è¡Œäº† save å‘½ä»¤ï¼Œå°±ä¼šåœ¨ä¸»çº¿ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç”±äºå’Œæ‰§è¡Œæ“ä½œå‘½ä»¤åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¦‚æœå†™å…¥ RDB æ–‡ä»¶çš„æ—¶é—´å¤ªé•¿ï¼Œ</span><strong><span>ä¼šé˜»å¡ä¸»çº¿ç¨‹</span></strong><span>ï¼›</span></p></li><li><p><span>æ‰§è¡Œäº† bgsave å‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥</span><strong><span>é¿å…ä¸»çº¿ç¨‹çš„é˜»å¡</span></strong><span>ï¼›</span></p></li></ul><p><span>RDB åœ¨æ‰§è¡Œå¿«ç…§çš„æ—¶å€™ï¼Œæ•°æ®èƒ½ä¿®æ”¹å—ï¼Ÿ</span></p><p><span>å¯ä»¥çš„ï¼Œæ‰§è¡Œ bgsave è¿‡ç¨‹ä¸­ï¼ŒRedis ä¾ç„¶</span><strong><span>å¯ä»¥ç»§ç»­å¤„ç†æ“ä½œå‘½ä»¤</span></strong><span>çš„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ˜¯èƒ½è¢«ä¿®æ”¹çš„ï¼Œå…³é”®çš„æŠ€æœ¯å°±åœ¨äº</span><strong><span>å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ã€‚</span></strong></p><p><span>æ‰§è¡Œ bgsave å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œæ­¤æ—¶å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹æ˜¯å…±äº«åŒä¸€ç‰‡å†…å­˜æ•°æ®çš„ï¼Œå› ä¸ºåˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œä½†æ˜¯é¡µè¡¨æŒ‡å‘çš„ç‰©ç†å†…å­˜è¿˜æ˜¯ä¸€ä¸ªï¼Œæ­¤æ—¶å¦‚æœä¸»çº¿ç¨‹æ‰§è¡Œè¯»æ“ä½œï¼Œåˆ™ä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹äº’ç›¸ä¸å½±å“ã€‚</span></p><p><span>åªæœ‰åœ¨å‘ç”Ÿä¿®æ”¹å†…å­˜æ•°æ®çš„æƒ…å†µæ—¶ï¼Œç‰©ç†å†…å­˜æ‰ä¼šè¢«å¤åˆ¶ä¸€ä»½ã€‚</span><strong><span>ç„¶åä¸»çº¿ç¨‹åœ¨è¿™ä¸ªè¢«å¤åˆ¶çš„å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹æ“ä½œ</span></strong><span>è¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘åˆ›å»ºå­è¿›ç¨‹æ—¶çš„æ€§èƒ½æŸè€—ï¼Œä»è€ŒåŠ å¿«åˆ›å»ºå­è¿›ç¨‹çš„é€Ÿåº¦ï¼Œæ¯•ç«Ÿåˆ›å»ºå­è¿›ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ã€‚</span></p><p><span>Redis åœ¨ä½¿ç”¨ bgsave å¿«ç…§è¿‡ç¨‹ä¸­</span><strong><span>ï¼Œå¦‚æœä¸»çº¿ç¨‹ä¿®æ”¹äº†å†…å­˜æ•°æ®ï¼Œä¸ç®¡æ˜¯å¦æ˜¯å…±äº«çš„å†…å­˜æ•°æ®ï¼ŒRDB å¿«ç…§éƒ½æ— æ³•å†™å…¥ä¸»çº¿ç¨‹åˆšä¿®æ”¹çš„æ•°æ®</span></strong><span>ï¼Œå› ä¸ºæ­¤æ—¶ä¸»çº¿ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰çš„å†…å­˜æ•°æ®å’Œå­è¿›ç¨‹çš„å†…å­˜æ•°æ®å·²ç»åˆ†ç¦»äº†ï¼Œå­è¿›ç¨‹å†™å…¥åˆ° RDB æ–‡ä»¶çš„å†…å­˜æ•°æ®åªèƒ½æ˜¯åŸæœ¬çš„å†…å­˜æ•°æ®ã€‚</span></p><p><span>å¦‚æœç³»ç»Ÿæ°å¥½åœ¨ RDB å¿«ç…§æ–‡ä»¶åˆ›å»ºå®Œæ¯•åå´©æºƒäº†ï¼Œé‚£ä¹ˆ Redis å°†ä¼šä¸¢å¤±ä¸»çº¿ç¨‹åœ¨å¿«ç…§æœŸé—´ä¿®æ”¹çš„æ•°æ®ã€‚</span></p><p><span>æç«¯æƒ…å†µä¸‹ï¼Œ</span><strong><span>å¦‚æœæ‰€æœ‰çš„å…±äº«å†…å­˜éƒ½è¢«ä¿®æ”¹ï¼Œåˆ™æ­¤æ—¶çš„å†…å­˜å ç”¨æ˜¯åŸå…ˆçš„ 2 å€ã€‚</span></strong></p><h3 id='411-saveæ–¹å¼'><span>4.1.1 saveæ–¹å¼</span></h3><ul><li><p><strong><span>å‘½ä»¤</span></strong></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">save</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><strong><span>ä½œç”¨ï¼šæ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œ</span></strong></p></li><li><p><strong><span>RDBé…ç½®ç›¸å…³å‘½ä»¤</span></strong></p><ul><li><p><span>dbfilename dump.rdb</span></p><ul><li><p><span>è¯´æ˜ï¼šè®¾ç½®æœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb</span></p></li><li><p><span>ç»éªŒï¼šé€šå¸¸è®¾ç½®ä¸ºdump-ç«¯å£å·.rdb</span></p></li></ul></li><li><p><span>dir</span></p><ul><li><p><span>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨.rdbæ–‡ä»¶çš„è·¯å¾„</span></p></li><li><p><span>ç»éªŒï¼šé€šå¸¸è®¾ç½®æˆå­˜å‚¨ç©ºé—´è¾ƒå¤§çš„ç›®å½•ä¸­ï¼Œç›®å½•åç§°data</span></p></li></ul></li><li><p><span>rdbcompression yes</span></p><ul><li><p><span>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼Œé‡‡ç”¨ LZF å‹ç¼©</span></p></li><li><p><span>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çœ CPU è¿è¡Œæ—¶é—´ï¼Œä½†ä¼šä½¿å­˜å‚¨çš„æ–‡ä»¶å˜å¤§ï¼ˆå·¨å¤§ï¼‰</span></p></li></ul></li><li><p><span>rdbchecksum yes</span></p><ul><li><p><span>è¯´æ˜ï¼šè®¾ç½®æ˜¯å¦è¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼æ ¡éªŒï¼Œè¯¥æ ¡éªŒè¿‡ç¨‹åœ¨å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶è¿‡ç¨‹å‡è¿›è¡Œ</span></p></li><li><p><span>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çº¦è¯»å†™æ€§è¿‡ç¨‹çº¦10%æ—¶é—´æ¶ˆè€—ï¼Œä½†æ˜¯å­˜å‚¨ä¸€å®šçš„æ•°æ®æŸåé£é™©</span></p></li></ul></li></ul></li><li><p><span>ä¸è¶³ï¼š</span><strong><span>saveæŒ‡ä»¤</span></strong><span>çš„æ‰§è¡Œä¼š</span><strong><span>é˜»å¡</span></strong><span>å½“å‰RedisæœåŠ¡å™¨ï¼Œç›´åˆ°å½“å‰RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆ</span><strong><span>é•¿æ—¶é—´é˜»å¡</span></strong><span>ï¼Œçº¿ä¸Šç¯å¢ƒ</span><strong><span>ä¸å»ºè®®ä½¿ç”¨</span></strong><span>ã€‚</span></p></li></ul><h3 id='412-bgsaveæ–¹å¼'><span>4.1.2 bgsaveæ–¹å¼</span></h3><ul><li><p><span>å‘½ä»¤</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bgsave</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>ä½œç”¨</span></p><p><span>æ‰‹åŠ¨å¯åŠ¨åå°ä¿å­˜æ“ä½œï¼Œä½†</span><strong><span>ä¸æ˜¯ç«‹å³æ‰§è¡Œ</span></strong></p></li><li><p><span>åŸç†</span></p><ul><li><p><span>æ‰§è¡Œforkæ“ä½œ</span><strong><span>åˆ›å»ºå­è¿›ç¨‹</span></strong></p></li><li><p><strong><span>bgsaveå‘½ä»¤</span></strong><span>æ˜¯é’ˆå¯¹saveé˜»å¡é—®é¢˜åšçš„</span><strong><span>ä¼˜åŒ–</span></strong><span>ã€‚Rediså†…éƒ¨æ‰€æœ‰æ¶‰åŠåˆ°RDBæ“ä½œéƒ½é‡‡ç”¨bgsaveçš„æ–¹å¼ï¼Œsaveå‘½ä»¤å¯ä»¥æ”¾å¼ƒä½¿ç”¨ï¼Œæ¨èä½¿ç”¨bgsave</span></p></li></ul></li></ul><p><img src="./images/bgsave.png" referrerpolicy="no-referrer"></p><h3 id='413-save-é…ç½®'><span>4.1.3 Save é…ç½®</span></h3><ul><li><p><span>é…ç½®</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">save second changes</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>ä½œç”¨</span></p><p><span>æ»¡è¶³</span><strong><span>é™å®šæ—¶é—´</span></strong><span>èŒƒå›´å†…keyçš„å˜åŒ–æ•°é‡è¾¾åˆ°</span><strong><span>æŒ‡å®šæ•°é‡</span></strong><span>å³è¿›è¡ŒæŒä¹…åŒ–</span></p></li><li><p><span>å‚æ•°</span></p><ul><li><p><span>secondï¼šç›‘æ§æ—¶é—´èŒƒå›´</span></p></li><li><p><span>changesï¼šç›‘æ§keyçš„å˜åŒ–é‡</span></p></li></ul></li><li><p><span>é…ç½®ä½ç½®</span></p><ul><li><p><span>åœ¨</span><strong><span>confæ–‡ä»¶</span></strong><span>ä¸­è¿›è¡Œé…ç½®</span></p></li></ul></li><li><p><span>é…ç½®åŸç†</span></p></li></ul><p><img src="./images/saveé…ç½®åŸç†.png" referrerpolicy="no-referrer" alt="saveé…ç½®åŸç†.png"></p><ul><li><p><span>saveé…ç½®è¦æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè¿›è¡Œè®¾ç½®ï¼Œé¢‘åº¦è¿‡é«˜æˆ–è¿‡ä½éƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ï¼Œç»“æœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„</span></p></li><li><p><span>saveé…ç½®ä¸­å¯¹äºsecondä¸changesè®¾ç½®é€šå¸¸å…·æœ‰</span><strong><span>äº’è¡¥å¯¹åº”</span></strong><span>å…³ç³»ï¼ˆä¸€ä¸ªå¤§ä¸€ä¸ªå°ï¼‰ï¼Œå°½é‡ä¸è¦è®¾ç½®æˆåŒ…å«æ€§å…³ç³».</span></p></li><li><p><span>saveé…ç½®å¯åŠ¨åæ‰§è¡Œçš„æ˜¯</span><strong><span>bgsaveæ“ä½œ</span></strong></p></li></ul><h3 id='414-rdbå¯åŠ¨æ–¹å¼å¯¹æ¯”'><span>4.1.4 RDBå¯åŠ¨æ–¹å¼å¯¹æ¯”</span></h3><p><img src="./images/RDBå¯¹æ¯”.png" referrerpolicy="no-referrer" alt="RDBå¯¹æ¯”.png"></p><h3 id='415-rdbä¼˜ç‚¹'><span>4.1.5 RDBä¼˜ç‚¹</span></h3><ul><li><p><span>ä¼˜ç‚¹</span></p><ul><li><p><span>RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ</span><strong><span>å­˜å‚¨æ•ˆç‡è¾ƒé«˜</span></strong></p></li><li><p><span>RDBå†…éƒ¨å­˜å‚¨çš„æ˜¯redisåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§ï¼Œéå¸¸é€‚åˆç”¨äº</span><strong><span>æ•°æ®å¤‡ä»½ï¼Œå…¨é‡å¤åˆ¶</span></strong><span>ç­‰åœºæ™¯</span></p></li><li><p><span>RDBæ¢å¤æ•°æ®çš„</span><strong><span>é€Ÿåº¦</span></strong><span>è¦æ¯”AOF</span><strong><span>å¿«</span></strong><span>å¾ˆå¤š</span></p></li><li><p><span>åº”ç”¨ï¼šæœåŠ¡å™¨ä¸­æ¯Xå°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå¹¶å°†RDBæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸­ï¼Œ</span><strong><span>ç”¨äºç¾éš¾æ¢å¤</span></strong></p></li></ul></li><li><p><span>ç¼ºç‚¹</span></p><ul><li><p><span>RDBæ–¹å¼æ— è®ºæ˜¯æ‰§è¡ŒæŒ‡ä»¤è¿˜æ˜¯åˆ©ç”¨é…ç½®ï¼Œ</span><strong><span>æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–</span></strong><span>ï¼Œå…·æœ‰è¾ƒå¤§çš„å¯èƒ½æ€§ä¸¢å¤±æ•°æ®</span></p></li><li><p><span>bgsaveæŒ‡ä»¤æ¯æ¬¡è¿è¡Œè¦æ‰§è¡Œforkæ“ä½œ</span><strong><span>åˆ›å»ºå­è¿›ç¨‹</span></strong><span>ï¼Œè¦</span><strong><span>ç‰ºç‰²</span></strong><span>æ‰ä¸€äº›</span><strong><span>æ€§èƒ½</span></strong></p></li><li><p><span>Redisçš„ä¼—å¤šç‰ˆæœ¬ä¸­æœªè¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ç»Ÿä¸€ï¼Œæœ‰å¯èƒ½å‡ºç°å„ç‰ˆæœ¬æœåŠ¡ä¹‹é—´æ•°æ®æ ¼å¼</span><strong><span>æ— æ³•å…¼å®¹</span></strong><span>ç°è±¡</span></p></li></ul></li></ul><h2 id='42-aof'><span>4.2 AOF</span></h2><h3 id='421-aof-æ¦‚å¿µ'><span>4.2.1 AOF æ¦‚å¿µ</span></h3><ul><li><p><span>AOF(append only file)æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•</span><strong><span>æ¯æ¬¡</span></strong><span>å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤ï¼Œä»¥è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸ºæ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹</span></p></li><li><p><span>AOFçš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„</span><strong><span>ä¸»æµ</span></strong><span>æ–¹å¼ã€‚</span></p></li></ul><p><strong><span>å¼€å¯AOF</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">appendonly yes<span class="cm-operator">|</span><span class="cm-keyword">no</span> &nbsp;<span class="cm-comment">-- æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œé»˜è®¤ä¸ºä¸å¼€å¯çŠ¶æ€</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">appendfsync <span class="cm-keyword">always</span><span class="cm-operator">|</span>everysec<span class="cm-operator">|</span><span class="cm-keyword">no</span> &nbsp; <span class="cm-comment">-- AOFå†™çš„ä¸‰ç§ç­–ç•¥</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><h3 id='422--aofå†™æ•°æ®'><span>4.2.2  AOFå†™æ•°æ®</span></h3><ul><li><p><span>AOFå†™å‘½ä»¤åˆ·æ–°ç¼“å­˜åŒº</span></p></li><li><p><span>æ ¹æ®å†™æ•°æ®çš„ç­–ç•¥å°†å‘½ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚</span></p></li><li><p><strong><span>Reids æ˜¯å…ˆæ‰§è¡Œå†™æ“ä½œå‘½ä»¤åï¼Œæ‰å°†è¯¥å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œçš„ï¼Œ</span></strong><span>è¿™ä¹ˆåšå…¶å®æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</span></p><ul><li><p><strong><span>é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€</span></strong><span>ï¼šå› ä¸ºå¦‚æœå…ˆå°†å†™æ“ä½œå‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œï¼Œå†æ‰§è¡Œè¯¥å‘½ä»¤çš„è¯ï¼Œå¦‚æœå½“å‰çš„å‘½ä»¤è¯­æ³•æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœä¸è¿›è¡Œå‘½ä»¤è¯­æ³•æ£€æŸ¥ï¼Œè¯¥é”™è¯¯çš„å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—é‡Œåï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚</span></p></li><li><p><strong><span>ä¸ä¼šé˜»å¡å½“å‰å†™æ“ä½œå‘½ä»¤çš„æ‰§è¡Œ</span></strong><span>ï¼šå› ä¸ºå½“å†™æ“ä½œå‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œæ‰ä¼šå°†å‘½ä»¤è®°å½•åˆ° AOF æ—¥å¿—ã€‚</span></p></li></ul></li><li><p><span>å½“ç„¶ï¼Œè¿™æ ·åšä¹Ÿä¼šå¸¦æ¥é£é™©ï¼š</span></p><ul><li><p><strong><span>æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼š</span></strong><span> æ‰§è¡Œå†™æ“ä½œå‘½ä»¤å’Œè®°å½•æ—¥å¿—æ˜¯ä¸¤ä¸ªè¿‡ç¨‹ï¼Œé‚£å½“ Redis åœ¨è¿˜æ²¡æ¥å¾—åŠå°†å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜æ—¶ï¼ŒæœåŠ¡å™¨å‘ç”Ÿå®•æœºäº†ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šæœ‰ä¸¢å¤±çš„é£é™©ã€‚</span></p></li><li><p><strong><span>å¯èƒ½é˜»å¡å…¶ä»–æ“ä½œï¼š</span></strong><span> ç”±äºå†™æ“ä½œå‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰è®°å½•åˆ° AOF æ—¥å¿—ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡å½“å‰å‘½ä»¤çš„æ‰§è¡Œï¼Œä½†å› ä¸º AOF æ—¥å¿—ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥å½“ Redis æŠŠæ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šé˜»å¡åç»­çš„æ“ä½œæ— æ³•æ‰§è¡Œã€‚</span></p></li></ul></li></ul><h3 id='423-aofå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥'><span>4.2.3 AOFå†™è¾“å…¥çš„ä¸‰ç§ç­–ç•¥</span></h3><ul><li><p><span>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° server.aof_buf ç¼“å†²åŒºï¼›ï¼ˆç”¨æˆ·æ€ï¼‰</span></p></li><li><p><span>ç„¶åé€šè¿‡ I/Oç³»ç»Ÿè°ƒç”¨write() ï¼Œå°† aof_buf ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œæ­¤æ—¶æ•°æ®å¹¶æ²¡æœ‰å†™å…¥åˆ°ç¡¬ç›˜ï¼Œè€Œæ˜¯æ‹·è´åˆ°äº†å†…æ ¸ç¼“å†²åŒº page cacheï¼Œç­‰å¾…å†…æ ¸å°†æ•°æ®å†™å…¥ç¡¬ç›˜ï¼›ï¼ˆå†…æ ¸æ€ï¼‰</span></p></li><li><p><span>å…·ä½“å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®ä»€ä¹ˆæ—¶å€™å†™å…¥åˆ°ç¡¬ç›˜ï¼Œç”±å†…æ ¸å†³å®šã€‚Redis æä¾›äº† 3 ç§å†™å›ç¡¬ç›˜çš„ç­–ç•¥ï¼Œåœ¨ </span><code>redis.conf</code><span> é…ç½®æ–‡ä»¶ä¸­çš„ </span><code>appendfsync</code><span> é…ç½®é¡¹å¯ä»¥æœ‰ä»¥ä¸‹ 3 ç§å‚æ•°å¯å¡«ï¼ˆè¿™ä¸‰ç§ç­–ç•¥åªæ˜¯åœ¨æ§åˆ¶ </span><code>fsync()</code><span> å‡½æ•°çš„è°ƒç”¨æ—¶æœºï¼‰ï¼š</span></p><ul><li><p><span>always</span></p><ul><li><p><span>æ¯æ¬¡å†™å…¥æ“ä½œå‡åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼ˆæ‰§è¡Œ</span><code>fsync()</code><span> å‡½æ•°ï¼‰ï¼Œæ•°æ®é›¶è¯¯å·®ï¼Œ</span><strong><span>æ€§èƒ½è¾ƒä½</span></strong><span>,</span><strong><span>ä¸å»ºè®®ä½¿ç”¨</span></strong></p></li></ul></li><li><p><span>everysec</span></p><ul><li><p><span>åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¯ç§’å°†ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼ˆæ‰§è¡Œ </span><code>fsync()</code><span>å‡½æ•°ï¼‰ï¼Œæ•°æ®å‡†ç¡®æ€§è¾ƒé«˜ï¼Œ</span><strong><span>æ€§èƒ½è¾ƒé«˜</span></strong><span> ï¼Œ</span><strong><span>å»ºè®®ä½¿ç”¨</span></strong><span>ï¼Œä¹Ÿæ˜¯é»˜è®¤é…ç½®</span></p></li><li><p><span>åœ¨ç³»ç»Ÿçªç„¶å®•æœºçš„æƒ…å†µä¸‹ä¸¢å¤±1ç§’å†…çš„æ•°æ®</span></p></li></ul></li><li><p><span>no</span></p><ul><li><p><span>æ°¸ä¸æ‰§è¡Œ </span><code>fsync()</code><span>å‡½æ•°, ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æ¯æ¬¡åŒæ­¥åˆ°AOFæ–‡ä»¶çš„å‘¨æœŸï¼Œæ•´ä½“è¿‡ç¨‹</span><strong><span>ä¸å¯æ§</span></strong></p></li></ul></li></ul></li></ul><h3 id='424-aofé‡å†™'><span>4.2.4 AOFé‡å†™</span></h3><p><span>éšç€å‘½ä»¤ä¸æ–­å†™å…¥AOFï¼Œ</span><strong><span>æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§</span></strong><span>ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRediså¼•å…¥äº†AOFé‡å†™æœºåˆ¶å‹ç¼©æ–‡ä»¶ä½“ç§¯ã€‚</span></p><p><span>AOF é‡å†™æœºåˆ¶æ˜¯åœ¨é‡å†™æ—¶ï¼Œè¯»å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å‘½ä»¤è®°å½•åˆ°ã€Œæ–°çš„ AOF æ–‡ä»¶ã€ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œåï¼Œå°±å°†æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ‰ç°æœ‰çš„ AOF æ–‡ä»¶ã€‚</span></p><ul><li><p><span>ä½œç”¨</span></p><ul><li><p><span>é™ä½ç£ç›˜å ç”¨é‡ï¼Œæé«˜ç£ç›˜åˆ©ç”¨ç‡</span></p></li><li><p><span>æé«˜æŒä¹…åŒ–æ•ˆç‡ï¼Œé™ä½æŒä¹…åŒ–å†™æ—¶é—´ï¼Œæé«˜IOæ€§èƒ½</span></p></li><li><p><span>é™ä½æ•°æ®æ¢å¤ç”¨æ—¶ï¼Œæé«˜æ•°æ®æ¢å¤æ•ˆç‡</span></p></li></ul></li><li><p><span>è§„åˆ™</span></p><ul><li><p><span>è¿›ç¨‹å†…å·²è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶</span></p></li><li><p><span>å¿½ç•¥æ— æ•ˆæŒ‡ä»¤ï¼Œé‡å†™æ—¶ä½¿ç”¨è¿›ç¨‹å†…æ•°æ®ç›´æ¥ç”Ÿæˆï¼Œè¿™æ ·æ–°çš„AOFæ–‡ä»¶åªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤ï¼Œå¦‚del key1ã€ hdel key2ã€srem key3ã€set key4 111ã€set key4 222ç­‰</span></p></li><li><p><span>å¯¹åŒä¸€æ•°æ®çš„å¤šæ¡å†™å‘½ä»¤åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤ï¼Œå¦‚lpush list1 aã€lpush list1 bã€ lpush list1 c å¯ä»¥è½¬åŒ–ä¸ºï¼šlpush list1 a b cï¼Œä¸ºé˜²æ­¢æ•°æ®é‡è¿‡å¤§é€ æˆå®¢æˆ·ç«¯ç¼“å†²åŒºæº¢å‡ºï¼Œå¯¹listã€setã€hashã€zsetç­‰ç±»å‹ï¼Œæ¯æ¡æŒ‡ä»¤æœ€å¤šå†™å…¥64ä¸ªå…ƒç´ </span></p></li></ul></li><li><p><span>ä½¿ç”¨</span></p><ul><li><p><span>æ‰‹åŠ¨é‡å†™</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bgrewriteaof</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>è‡ªåŠ¨é‡å†™</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">auto<span class="cm-operator">-</span>aof<span class="cm-operator">-</span>rewrite<span class="cm-operator">-</span><span class="cm-keyword">min</span><span class="cm-operator">-</span>size size </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">auto<span class="cm-operator">-</span>aof<span class="cm-operator">-</span>rewrite<span class="cm-operator">-</span>percentage percentage</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre></li><li><p><span>åŸç†</span></p><ul><li><p><span>Redis çš„</span><strong><span>é‡å†™ AOF è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹ bgrewriteaof æ¥å®Œæˆçš„</span></strong><span>ï¼Œè¿™ä¹ˆåšå¯ä»¥è¾¾åˆ°ä¸¤ä¸ªå¥½å¤„ï¼š</span></p><ul><li><p><span>å­è¿›ç¨‹è¿›è¡Œ AOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œä»è€Œé¿å…é˜»å¡ä¸»è¿›ç¨‹ï¼›</span></p></li><li><p><span>å­è¿›ç¨‹å¸¦æœ‰ä¸»è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼ˆ</span><em><span>æ•°æ®å‰¯æœ¬æ€ä¹ˆäº§ç”Ÿçš„åé¢ä¼šè¯´</span></em><span>ï¼‰ï¼Œè¿™é‡Œä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ï¼Œå› ä¸ºå¦‚æœæ˜¯ä½¿ç”¨çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ä¹‹é—´ä¼šå…±äº«å†…å­˜ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹å…±äº«å†…å­˜æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡åŠ é”æ¥ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œè€Œè¿™æ ·å°±ä¼šé™ä½æ€§èƒ½ã€‚è€Œä½¿ç”¨å­è¿›ç¨‹ï¼Œåˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œçˆ¶å­è¿›ç¨‹æ˜¯å…±äº«å†…å­˜æ•°æ®çš„ï¼Œä¸è¿‡è¿™ä¸ªå…±äº«çš„å†…å­˜åªèƒ½ä»¥åªè¯»çš„æ–¹å¼ï¼Œè€Œå½“çˆ¶å­è¿›ç¨‹ä»»æ„ä¸€æ–¹ä¿®æ”¹äº†è¯¥å…±äº«å†…å­˜ï¼Œå°±ä¼šå‘ç”Ÿã€Œå†™æ—¶å¤åˆ¶ã€ï¼Œäºæ˜¯çˆ¶å­è¿›ç¨‹å°±æœ‰äº†ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ï¼Œå°±ä¸ç”¨åŠ é”æ¥ä¿è¯æ•°æ®å®‰å…¨ã€‚</span></p></li></ul></li><li><p><strong><span>åœ¨ bgrewriteaof å­è¿›ç¨‹æ‰§è¡Œ AOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œ:</span></strong></p><ul><li><p><span>æ‰§è¡Œå®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼›</span></p></li><li><p><span>æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF ç¼“å†²åŒºã€ï¼›</span></p></li><li><p><span>å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF é‡å†™ç¼“å†²åŒºã€ï¼›</span></p></li></ul></li><li><p><span>å½“</span><strong><span>å­è¿›ç¨‹å®Œæˆ AOF é‡å†™å·¥ä½œ</span></strong><span>ï¼ˆæ‰«ææ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®ï¼Œé€ä¸€æŠŠå†…å­˜æ•°æ®çš„é”®å€¼å¯¹è½¬æ¢æˆä¸€æ¡å‘½ä»¤ï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°é‡å†™æ—¥å¿—ï¼‰åï¼Œä¼šå‘ä¸»è¿›ç¨‹å‘é€ä¸€æ¡ä¿¡å·ï¼Œä¿¡å·æ˜¯è¿›ç¨‹é—´é€šè®¯çš„ä¸€ç§æ–¹å¼ï¼Œä¸”æ˜¯å¼‚æ­¥çš„ã€‚ä¸»è¿›ç¨‹æ”¶åˆ°è¯¥ä¿¡å·åï¼Œä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦åšä»¥ä¸‹å·¥ä½œï¼š</span></p><ul><li><p><span>å°† AOF é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–°çš„ AOF çš„æ–‡ä»¶ä¸­ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼›</span></p></li><li><p><span>æ–°çš„ AOF çš„æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–ç°æœ‰çš„ AOF æ–‡ä»¶ã€‚</span></p></li><li><p><span>ä¿¡å·å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­åƒå¾€å¸¸ä¸€æ ·å¤„ç†å‘½ä»¤äº†ã€‚</span></p></li></ul></li><li><p><strong><span>ä¸»è¿›ç¨‹åœ¨é€šè¿‡ </span><code>fork</code><span> ç³»ç»Ÿè°ƒç”¨ç”Ÿæˆ </span><code>bgrewriteaof</code><span> å­è¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠä¸»è¿›ç¨‹çš„ã€Œé¡µè¡¨ã€å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹</span></strong><span>ï¼Œè¿™ä¸ªé¡µè¡¨è®°å½•ç€è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜ å°„å…³ç³»ï¼Œè€Œä¸ä¼šå¤åˆ¶ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤è€…çš„è™šæ‹Ÿç©ºé—´ä¸åŒï¼Œä½†å…¶å¯¹åº”çš„ç‰©ç†ç©ºé—´æ˜¯åŒä¸€ä¸ªã€‚è¿™æ ·ä¸€æ¥ï¼Œ</span><strong><span>å­è¿›ç¨‹å°±å…±äº«äº†çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜æ•°æ®äº†</span></strong><span>ï¼Œè¿™æ ·èƒ½å¤Ÿ</span><strong><span>èŠ‚çº¦ç‰©ç†å†…å­˜èµ„æº</span></strong><span>ï¼Œé¡µè¡¨å¯¹åº”çš„é¡µè¡¨é¡¹çš„å±æ€§ä¼šæ ‡è®°è¯¥ç‰©ç†å†…å­˜çš„æƒé™ä¸º</span><strong><span>åªè¯»</span></strong><span>ã€‚</span></p><ul><li><p><strong><span>ä¸»çº¿ç¨‹æ— å†™æ•°æ®</span></strong><span>ï¼šè§¦å‘é‡å†™æœºåˆ¶åï¼Œä¸»è¿›ç¨‹å°±ä¼šåˆ›å»ºé‡å†™ AOF çš„å­è¿›ç¨‹ï¼Œæ­¤æ—¶çˆ¶å­è¿›ç¨‹å…±äº«ç‰©ç†å†…å­˜ï¼Œé‡å†™å­è¿›ç¨‹åªä¼šå¯¹è¿™ä¸ªå†…å­˜è¿›è¡Œåªè¯»ï¼Œé‡å†™ AOF å­è¿›ç¨‹ä¼šè¯»å–æ•°æ®åº“é‡Œçš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶é€ä¸€æŠŠå†…å­˜æ•°æ®çš„é”®å€¼å¯¹è½¬æ¢æˆä¸€æ¡å‘½ä»¤ï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°é‡å†™æ—¥å¿—ï¼ˆæ–°çš„ AOF æ–‡ä»¶ï¼‰ã€‚</span></p></li><li><p><strong><span>ä¸»çº¿ç¨‹æœ‰å†™æ•°æ®</span></strong><span>ï¼šå½“çˆ¶è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹åœ¨å‘è¿™ä¸ªå†…å­˜å‘èµ·å†™æ“ä½œæ—¶ï¼ŒCPU å°±ä¼šè§¦å‘</span><strong><span>å†™ä¿æŠ¤ä¸­æ–­</span></strong><span>ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œ</span><strong><span>ç‰©ç†å†…å­˜çš„å¤åˆ¶</span></strong><span>ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸º</span><strong><span>å¯è¯»å†™</span></strong><span>ï¼Œæœ€åæ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºã€Œ</span><strong><span>å†™æ—¶å¤åˆ¶(Copy On Write)</span></strong><span>ã€ã€‚å†™æ—¶å¤åˆ¶é¡¾åæ€ä¹‰ï¼Œ</span><strong><span>åœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜</span></strong><span>ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´çˆ¶è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚</span></p><ul><li><p><span>ä¸»è¿›ç¨‹ä¿®æ”¹äº†å·²ç»å­˜åœ¨ key-valueï¼Œæ­¤æ—¶è¿™ä¸ª key-value æ•°æ®åœ¨å­è¿›ç¨‹çš„å†…å­˜æ•°æ®å°±è·Ÿä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ä¸ä¸€è‡´äº†ã€‚ä¸ºäº†è§£å†³è¿™ç§æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒRedis è®¾ç½®äº†ä¸€ä¸ª </span><strong><span>AOF é‡å†™ç¼“å†²åŒº</span></strong><span>ï¼Œè¿™ä¸ªç¼“å†²åŒºåœ¨åˆ›å»º bgrewriteaof å­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨ã€‚åœ¨é‡å†™ AOF æœŸé—´ï¼Œå½“ Redis æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œå®ƒä¼š</span><strong><span>åŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤å†™å…¥åˆ° ã€ŒAOF ç¼“å†²åŒºã€å’Œ ã€ŒAOF é‡å†™ç¼“å†²åŒºã€</span></strong><span>ã€‚</span></p></li></ul></li></ul></li><li><p><span>æœ‰ä¸¤ä¸ªé˜¶æ®µä¼šå¯¼è‡´é˜»å¡çˆ¶è¿›ç¨‹ï¼š</span></p><ul><li><p><span>åˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­ï¼Œç”±äºè¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ç­‰æ•°æ®ç»“æ„ï¼Œé˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³ï¼Œé¡µè¡¨è¶Šå¤§ï¼Œé˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼›</span></p></li><li><p><span>åˆ›å»ºå®Œå­è¿›ç¨‹åï¼Œå¦‚æœå­è¿›ç¨‹æˆ–è€…çˆ¶è¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼Œå°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œè¿™æœŸé—´ä¼šæ‹·è´ç‰©ç†å†…å­˜ï¼Œå¦‚æœå†…å­˜è¶Šå¤§ï¼Œè‡ªç„¶é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼›</span></p></li></ul></li></ul></li></ul><h2 id='43-rdb-vs-aof'><span>4.3 RDB VS AOF</span></h2><p><img src="./images/RDBVSAOF.png" referrerpolicy="no-referrer" alt="RDBVSAOF.png"></p><p><strong><span>RDBå’ŒAOFå¦‚ä½•é€‰æ‹©</span></strong></p><ul><li><p><span>å¯¹æ•°æ®éå¸¸</span><strong><span>æ•æ„Ÿ</span></strong><span>ï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤çš„</span><strong><span>AOF</span></strong><span>æŒä¹…åŒ–æ–¹æ¡ˆ</span></p><ul><li><p><span>AOFæŒä¹…åŒ–ç­–ç•¥ä½¿ç”¨</span><strong><span>everysecond</span></strong><span>ï¼Œæ¯ç§’é’Ÿfsyncä¸€æ¬¡ã€‚è¯¥ç­–ç•¥redisä»å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œæœ€å¤šä¸¢å¤±0-1ç§’å†…çš„æ•°æ®ã€‚</span></p></li></ul></li><li><p><span>æ•°æ®å‘ˆç°</span><strong><span>é˜¶æ®µæœ‰æ•ˆæ€§</span></strong><span>ï¼Œå»ºè®®ä½¿ç”¨RDBæŒä¹…åŒ–æ–¹æ¡ˆ</span></p><ul><li><p><span>æ•°æ®å¯ä»¥è‰¯å¥½çš„åšåˆ°é˜¶æ®µå†…æ— ä¸¢å¤±ï¼ˆè¯¥é˜¶æ®µæ˜¯å¼€å‘è€…æˆ–è¿ç»´äººå‘˜æ‰‹å·¥ç»´æŠ¤çš„ï¼‰ï¼Œä¸”</span><strong><span>æ¢å¤é€Ÿåº¦è¾ƒå¿«</span></strong><span>ï¼Œé˜¶æ®µ ç‚¹æ•°æ®æ¢å¤é€šå¸¸é‡‡ç”¨RDBæ–¹æ¡ˆ</span></p></li></ul></li><li><p><span>ç»¼åˆæ¯”å¯¹</span></p><ul><li><p><span>RDBä¸AOFçš„é€‰æ‹©å®é™…ä¸Šæ˜¯åœ¨åšä¸€ç§æƒè¡¡ï¼Œæ¯ç§éƒ½æœ‰åˆ©æœ‰å¼Š</span></p></li><li><p><span>å¦‚ä¸èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯¹ä¸šåŠ¡æ•°æ®éå¸¸æ•æ„Ÿï¼Œé€‰ç”¨AOF</span></p></li><li><p><span>å¦‚èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œä¸”è¿½æ±‚å¤§æ•°æ®é›†çš„æ¢å¤é€Ÿåº¦ï¼Œé€‰ç”¨RDB</span></p></li><li><p><span>ç¾éš¾æ¢å¤é€‰ç”¨RDB</span></p></li><li><p><span>åŒä¿é™©ç­–ç•¥ï¼ŒåŒæ—¶å¼€å¯ RDB å’Œ AOFï¼Œé‡å¯åï¼ŒRedisä¼˜å…ˆä½¿ç”¨ AOF æ¥æ¢å¤æ•°æ®ï¼Œé™ä½ä¸¢å¤±æ•°æ®çš„é‡</span></p></li></ul></li></ul><h2 id='44-å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“'><span>4.4 å¤§keyå¯¹æŒä¹…åŒ–çš„å½±å“</span></h2><ul><li><p><span>å½“ AOF å†™å›ç­–ç•¥é…ç½®äº† Always ç­–ç•¥ï¼Œå¦‚æœå†™å…¥æ˜¯ä¸€ä¸ªå¤§ Keyï¼Œä¸»çº¿ç¨‹åœ¨æ‰§è¡Œ fsync() å‡½æ•°çš„æ—¶å€™ï¼Œé˜»å¡çš„æ—¶é—´ä¼šæ¯”è¾ƒä¹…ï¼Œå› ä¸ºå½“å†™å…¥çš„æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œæ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆè€—æ—¶çš„ã€‚</span></p></li><li><p><span>AOF é‡å†™æœºåˆ¶å’Œ RDB å¿«ç…§ï¼ˆbgsave å‘½ä»¤ï¼‰çš„è¿‡ç¨‹ï¼Œéƒ½ä¼šåˆ†åˆ«é€šè¿‡ </span><code>fork()</code><span> å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚ä¼šæœ‰ä¸¤ä¸ªé˜¶æ®µä¼šå¯¼è‡´é˜»å¡çˆ¶è¿›ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼š</span></p><ul><li><p><span>åˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­ï¼Œç”±äºè¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ç­‰æ•°æ®ç»“æ„ï¼Œé˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³ï¼Œé¡µè¡¨è¶Šå¤§ï¼Œé˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼›</span></p></li><li><p><span>åˆ›å»ºå®Œå­è¿›ç¨‹åï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ä¸­çš„å¤§ Keyï¼Œå°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œè¿™æœŸé—´ä¼šæ‹·è´ç‰©ç†å†…å­˜ï¼Œç”±äºå¤§ Key å ç”¨çš„ç‰©ç†å†…å­˜ä¼šå¾ˆå¤§ï¼Œé‚£ä¹ˆåœ¨å¤åˆ¶ç‰©ç†å†…å­˜è¿™ä¸€è¿‡ç¨‹ï¼Œå°±ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šé˜»å¡çˆ¶è¿›ç¨‹ã€‚</span></p></li></ul></li><li><p><span>å¤§ key é™¤äº†ä¼šå½±å“æŒä¹…åŒ–ä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰ä»¥ä¸‹çš„å½±å“ã€‚</span></p><ul><li><p><span>å®¢æˆ·ç«¯è¶…æ—¶é˜»å¡ã€‚ç”±äº Redis æ‰§è¡Œå‘½ä»¤æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œç„¶ååœ¨æ“ä½œå¤§ key æ—¶ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡ Redisï¼Œä»å®¢æˆ·ç«¯è¿™ä¸€è§†è§’çœ‹ï¼Œå°±æ˜¯å¾ˆä¹…å¾ˆä¹…éƒ½æ²¡æœ‰å“åº”ã€‚</span></p></li><li><p><span>å¼•å‘ç½‘ç»œé˜»å¡ã€‚æ¯æ¬¡è·å–å¤§ key äº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå¦‚æœä¸€ä¸ª key çš„å¤§å°æ˜¯ 1 MBï¼Œæ¯ç§’è®¿é—®é‡ä¸º 1000ï¼Œé‚£ä¹ˆæ¯ç§’ä¼šäº§ç”Ÿ 1000MB çš„æµé‡ï¼Œè¿™å¯¹äºæ™®é€šåƒå…†ç½‘å¡çš„æœåŠ¡å™¨æ¥è¯´æ˜¯ç¾éš¾æ€§çš„ã€‚</span></p></li><li><p><span>é˜»å¡å·¥ä½œçº¿ç¨‹ã€‚å¦‚æœä½¿ç”¨ del åˆ é™¤å¤§ key æ—¶ï¼Œä¼šé˜»å¡å·¥ä½œçº¿ç¨‹ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å¤„ç†åç»­çš„å‘½ä»¤ã€‚</span></p></li><li><p><span>å†…å­˜åˆ†å¸ƒä¸å‡ã€‚é›†ç¾¤æ¨¡å‹åœ¨ slot åˆ†ç‰‡å‡åŒ€æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ•°æ®å’ŒæŸ¥è¯¢å€¾æ–œæƒ…å†µï¼Œéƒ¨åˆ†æœ‰å¤§ key çš„ Redis èŠ‚ç‚¹å ç”¨å†…å­˜å¤šï¼ŒQPS ä¹Ÿä¼šæ¯”è¾ƒå¤§ã€‚</span></p></li></ul></li><li><p><span>å¦‚ä½•é¿å…å¤§ Key å‘¢ï¼Ÿ</span></p><ul><li><p><span>æœ€å¥½åœ¨è®¾è®¡é˜¶æ®µï¼Œå°±æŠŠå¤§ key æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå° keyã€‚æˆ–è€…ï¼Œå®šæ—¶æ£€æŸ¥ Redis æ˜¯å¦å­˜åœ¨å¤§ key ï¼Œå¦‚æœè¯¥å¤§ key æ˜¯å¯ä»¥åˆ é™¤çš„ï¼Œä¸è¦ä½¿ç”¨ DEL å‘½ä»¤åˆ é™¤ï¼Œå› ä¸ºè¯¥å‘½ä»¤åˆ é™¤è¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯ç”¨ unlink å‘½ä»¤ï¼ˆRedis 4.0+ï¼‰åˆ é™¤å¤§ keyï¼Œå› ä¸ºè¯¥å‘½ä»¤çš„åˆ é™¤è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</span></p></li></ul></li></ul><h2 id='45-æ··åˆæŒä¹…åŒ–'><span>4.5 æ··åˆæŒä¹…åŒ–</span></h2><p><span>RDB ä¼˜ç‚¹æ˜¯æ•°æ®æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ã€‚é¢‘ç‡å¤ªä½ï¼Œä¸¢å¤±çš„æ•°æ®å°±ä¼šæ¯”è¾ƒå¤šï¼Œé¢‘ç‡å¤ªé«˜ï¼Œå°±ä¼šå½±å“æ€§èƒ½ã€‚</span></p><p><span>AOF ä¼˜ç‚¹æ˜¯ä¸¢å¤±æ•°æ®å°‘ï¼Œä½†æ˜¯æ•°æ®æ¢å¤ä¸å¿«ã€‚</span></p><p><span>ä¸ºäº†é›†æˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œ Redis 4.0 æå‡ºäº†</span><strong><span>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</span></strong><span>ï¼Œä¹Ÿå«æ··åˆæŒä¹…åŒ–ï¼Œæ—¢ä¿è¯äº† Redis é‡å¯é€Ÿåº¦ï¼Œåˆé™ä½æ•°æ®ä¸¢å¤±é£é™©ã€‚</span></p><ul><li><p><span>æ··åˆæŒä¹…åŒ–å·¥ä½œåœ¨ </span><strong><span>AOF æ—¥å¿—é‡å†™è¿‡ç¨‹</span></strong><span>ï¼Œå½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œfork å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œç„¶åä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„</span><strong><span>å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®</span></strong><span>ã€‚</span></p></li><li><p><span>è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œé‡å¯ Redis åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯ RDB å†…å®¹ï¼Œè¿™æ ·</span><strong><span>åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«</span></strong><span>ã€‚</span></p></li><li><p><span>åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—</span><strong><span>æ•°æ®æ›´å°‘çš„ä¸¢å¤±</span></strong><span>ã€‚</span></p></li></ul><p><strong><span>æ··åˆæŒä¹…åŒ–ä¼˜ç‚¹ï¼š</span></strong></p><ul><li><p><span>æ··åˆæŒä¹…åŒ–ç»“åˆäº† RDB å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹ï¼Œå¼€å¤´ä¸º RDB çš„æ ¼å¼ï¼Œä½¿å¾— Redis å¯ä»¥æ›´å¿«çš„å¯åŠ¨ï¼ŒåŒæ—¶ç»“åˆ AOF çš„ä¼˜ç‚¹ï¼Œæœ‰å‡ä½äº†å¤§é‡æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</span></p></li></ul><p><strong><span>æ··åˆæŒä¹…åŒ–ç¼ºç‚¹ï¼š</span></strong></p><ul><li><p><span>AOF æ–‡ä»¶ä¸­æ·»åŠ äº† RDB æ ¼å¼çš„å†…å®¹ï¼Œä½¿å¾— AOF æ–‡ä»¶çš„å¯è¯»æ€§å˜å¾—å¾ˆå·®ï¼›</span></p></li><li><p><span>å…¼å®¹æ€§å·®ï¼Œå¦‚æœå¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ­¤æ··åˆæŒä¹…åŒ– AOF æ–‡ä»¶ï¼Œå°±ä¸èƒ½ç”¨åœ¨ Redis 4.0 ä¹‹å‰ç‰ˆæœ¬äº†ã€‚</span></p></li></ul><p>&nbsp;</p><h1 id='äº”äº‹åŠ¡'><span>äº”ã€äº‹åŠ¡</span></h1><p><span>redisäº‹åŠ¡å°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„é˜Ÿåˆ—ï¼Œå°†ä¸€ç³»åˆ—é¢„å®šä¹‰å‘½ä»¤</span><strong><span>åŒ…è£…æˆä¸€ä¸ªæ•´ä½“</span></strong><span>ï¼ˆä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚å½“æ‰§è¡Œæ—¶ï¼Œ</span><strong><span>ä¸€æ¬¡æ€§æŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œ</span></strong><span>ï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­æˆ–è€…å¹²æ‰°ã€‚</span></p><h2 id='51-äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ'><span>5.1 äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ</span></h2><ul><li><p><span>å¼€å¯äº‹åŠ¡ </span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">multi &nbsp; <span class="cm-comment">-- ä½œè®¾å®šäº‹åŠ¡çš„å¼€å¯ä½ç½®ï¼Œæ­¤æŒ‡ä»¤æ‰§è¡Œåï¼Œåç»­çš„æ‰€æœ‰æŒ‡ä»¤å‡åŠ å…¥åˆ°äº‹åŠ¡ä¸­</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>å–æ¶ˆäº‹åŠ¡</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">discard</span> &nbsp;<span class="cm-comment">-- ç»ˆæ­¢å½“å‰äº‹åŠ¡çš„å®šä¹‰ï¼Œå‘ç”Ÿåœ¨multiä¹‹åï¼Œexecä¹‹å‰</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>æ‰§è¡Œäº‹åŠ¡</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exec &nbsp;<span class="cm-comment">-- è®¾å®šäº‹åŠ¡çš„ç»“æŸä½ç½®ï¼ŒåŒæ—¶æ‰§è¡Œäº‹åŠ¡ã€‚ä¸multiæˆå¯¹å‡ºç°ï¼Œæˆå¯¹ä½¿ç”¨</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h2 id='52-äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹'><span>5.2 äº‹åŠ¡æ“ä½œçš„åŸºæœ¬æµç¨‹</span></h2><ul><li><p><span>æœåŠ¡å™¨æ¥æ”¶åˆ°æŒ‡ä»¤ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ˜¯äº‹åŠ¡çŠ¶æ€</span></p><ul><li><p><span>å¦‚æœä¸æ˜¯äº‹åŠ¡çŠ¶æ€ï¼Œå°±è¯†åˆ«æŒ‡ä»¤çš„ç±»å‹</span></p><ul><li><p><span>å¯¹äºæ™®é€šæŒ‡ä»¤ï¼Œç›´æ¥æ‰§è¡Œï¼Œç„¶åè¿”å›ç›¸åº”çš„ç»“æœ</span></p></li><li><p><span>å¯¹äºmulti æŒ‡ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿”å›OK</span></p></li></ul></li><li><p><span>å¦‚æœæ˜¯äº‹åŠ¡çŠ¶æ€ï¼Œå°±è¯†åˆ«æŒ‡ä»¤çš„ç±»å‹</span></p><ul><li><p><span>å¯¹äºæ™®é€šæŒ‡ä»¤ï¼Œå°±åŠ å…¥é˜Ÿåˆ—ï¼Œè¿”å›QUEUE</span></p></li><li><p><span>å¯¹äºEXECæŒ‡ä»¤ï¼Œå°±æ‰§è¡Œäº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æŒ‡ä»¤ï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚</span></p></li><li><p><span>å¯¹äºdiscardæŒ‡ä»¤ï¼Œå°±é”€æ¯é˜Ÿåˆ—ï¼Œè¿”å›OKã€‚</span></p></li></ul></li></ul></li></ul><p><strong><span>äº‹åŠ¡æ“ä½œä¸­çš„æ³¨æ„äº‹é¡¹</span></strong></p><ul><li><p><span>å¦‚æœå®šä¹‰çš„äº‹åŠ¡ä¸­æ‰€åŒ…å«çš„å‘½ä»¤å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ•´ä½“äº‹åŠ¡ä¸­</span><strong><span>æ‰€æœ‰å‘½ä»¤å‡ä¸ä¼šæ‰§è¡Œ</span></strong><span>ã€‚åŒ…æ‹¬é‚£äº›è¯­æ³•æ­£ç¡®çš„å‘½ä»¤ã€‚</span></p></li><li><p><span>å¦‚æœå‘½ä»¤</span><strong><span>æ ¼å¼æ­£ç¡®</span></strong><span>ï¼Œä½†æ˜¯</span><strong><span>æ— æ³•æ­£ç¡®çš„æ‰§è¡Œ</span></strong><span>ã€‚æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„å‘½ä»¤ä¼šæ‰§è¡Œï¼Œè¿è¡Œé”™è¯¯çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œã€‚</span></p></li><li><p><span>å·²ç»æ‰§è¡Œå®Œæ¯•çš„å‘½ä»¤å¯¹åº”çš„æ•°æ®</span><strong><span>ä¸ä¼šè‡ªåŠ¨å›æ»š</span></strong><span>ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±åœ¨ä»£ç ä¸­å®ç°å›æ»šã€‚</span></p></li></ul><h2 id='52-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ'><span>5.2 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œ</span></h2><h3 id='521--é”'><span>5.2.1  é”</span></h3><p><strong><span>åœºæ™¯</span></strong></p><p><span>å¤©çŒ«åŒ11çƒ­å–è¿‡ç¨‹ä¸­ï¼Œå¯¹å·²ç»å”®ç½„çš„è´§ç‰©è¿½åŠ è¡¥è´§ï¼Œ4ä¸ªä¸šåŠ¡å‘˜éƒ½æœ‰æƒé™è¿›è¡Œè¡¥è´§ã€‚è¡¥è´§çš„æ“ä½œå¯èƒ½æ˜¯ä¸€ç³» åˆ—çš„æ“ä½œï¼Œç‰µæ‰¯åˆ°å¤šä¸ªè¿ç»­æ“ä½œï¼Œå¦‚ä½•ä¿éšœä¸ä¼šé‡å¤æ“ä½œï¼Ÿ</span></p><p><strong><span>åˆ†æ</span></strong></p><ul><li><p><span>å¤šä¸ªå®¢æˆ·ç«¯æœ‰å¯èƒ½åŒæ—¶æ“ä½œåŒä¸€ç»„æ•°æ®ï¼Œå¹¶ä¸”è¯¥æ•°æ®ä¸€æ—¦è¢«æ“ä½œä¿®æ”¹åï¼Œå°†ä¸é€‚ç”¨äºç»§ç»­æ“ä½œ </span></p></li><li><p><span>åœ¨æ“ä½œä¹‹å‰é”å®šè¦æ“ä½œçš„æ•°æ®ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œç»ˆæ­¢å½“å‰æ“ä½œ.</span></p></li></ul><p><strong><span>æ“ä½œ</span></strong></p><p><span>å¯¹ key æ·»åŠ ç›‘è§†é”ï¼Œåœ¨æ‰§è¡Œexecå‰å¦‚æœkeyå‘ç”Ÿäº†å˜åŒ–ï¼Œç»ˆæ­¢äº‹åŠ¡æ‰§è¡Œã€‚watchä¸èƒ½åœ¨äº‹åŠ¡ä¸­å®šä¹‰(ä¸»è¦ç›‘æ§å…¶ä»–äººèƒ½ä¸èƒ½æ”¹è¿™ä¸ªå€¼)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">watch key1<span class="cm-punctuation">,</span> key2.... <span class="cm-comment">-- ä¸ºkeyåŠ é”</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">..</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">multi </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exec </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><span>å–æ¶ˆå¯¹</span><strong><span>æ‰€æœ‰</span></strong><span>keyçš„ç›‘è§†</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">unwatch</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h3 id='521-åˆ†å¸ƒå¼é”'><span>5.2.1 åˆ†å¸ƒå¼é”</span></h3><p><strong><span>åœºæ™¯</span></strong></p><p><span>å¤©çŒ«åŒ11çƒ­å–è¿‡ç¨‹ä¸­ï¼Œå¯¹å·²ç»å”®ç½„çš„è´§ç‰©è¿½åŠ è¡¥è´§ï¼Œä¸”è¡¥è´§å®Œæˆã€‚å®¢æˆ·è´­ä¹°çƒ­æƒ…é«˜æ¶¨ï¼Œ3ç§’å†…å°†æ‰€æœ‰å•†å“è´­ ä¹°å®Œæ¯•ã€‚æœ¬æ¬¡è¡¥è´§å·²ç»å°†åº“å­˜å…¨éƒ¨æ¸…ç©ºï¼Œå¦‚ä½•é¿å…æœ€åä¸€ä»¶å•†å“ä¸è¢«å¤šäººåŒæ—¶è´­ä¹°ï¼Ÿã€è¶…å–é—®é¢˜ã€‘</span></p><p><strong><span>åˆ†æ</span></strong></p><ul><li><p><span>ä½¿ç”¨watchç›‘æ§ä¸€ä¸ªkeyæœ‰æ²¡æœ‰æ”¹å˜å·²ç»ä¸èƒ½è§£å†³é—®é¢˜ï¼Œæ­¤å¤„è¦ç›‘æ§çš„æ˜¯å…·ä½“æ•°æ® </span></p></li><li><p><span>è™½ç„¶redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯å¤šä¸ªå®¢æˆ·ç«¯å¯¹åŒä¸€æ•°æ®åŒæ—¶è¿›è¡Œæ“ä½œæ—¶ï¼Œå¦‚ä½•é¿å…ä¸è¢«åŒæ—¶ä¿®æ”¹ï¼Ÿ</span></p></li></ul><p><strong><span>æ“ä½œ</span></strong></p><p><span>ä½¿ç”¨ setnx è®¾ç½®ä¸€ä¸ªå…¬å…±é”</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//ä¸Šé”</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">setnx <span class="cm-keyword">lock</span><span class="cm-operator">-</span><span class="cm-keyword">key</span> <span class="cm-keyword">value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//é‡Šæ”¾é”</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">del <span class="cm-keyword">lock</span><span class="cm-operator">-</span><span class="cm-keyword">key</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><ul><li><p><span>åˆ©ç”¨setnxå‘½ä»¤çš„è¿”å›å€¼ç‰¹å¾ï¼Œæœ‰å€¼åˆ™è¿”å›è®¾ç½®å¤±è´¥ï¼Œæ— å€¼åˆ™è¿”å›è®¾ç½®æˆåŠŸ </span></p><ul><li><p><span>å¯¹äºè¿”å›è®¾ç½®æˆåŠŸçš„ï¼Œæ‹¥æœ‰æ§åˆ¶æƒï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„å…·ä½“ä¸šåŠ¡æ“ä½œ </span></p></li><li><p><span>å¯¹äºè¿”å›è®¾ç½®å¤±è´¥çš„ï¼Œä¸å…·æœ‰æ§åˆ¶æƒï¼Œæ’é˜Ÿæˆ–ç­‰å¾…,æ“ä½œå®Œæ¯•é€šè¿‡delæ“ä½œé‡Šæ”¾é”.</span></p></li></ul></li></ul><h3 id='522--æ­»é”'><span>5.2.2  æ­»é”</span></h3><p><strong><span>åœºæ™¯</span></strong></p><p><span>ä¾èµ–åˆ†å¸ƒå¼é”çš„æœºåˆ¶ï¼ŒæŸä¸ªç”¨æˆ·æ“ä½œæ—¶å¯¹åº”å®¢æˆ·ç«¯å®•æœºï¼Œä¸”æ­¤æ—¶å·²ç»è·å–åˆ°é”ã€‚å¦‚ä½•è§£å†³ï¼Ÿ</span></p><p><strong><span>åˆ†æ</span></strong></p><ul><li><p><span>ç”±äºé”æ“ä½œç”±ç”¨æˆ·æ§åˆ¶åŠ é”è§£é”ï¼Œå¿…å®šä¼šå­˜åœ¨åŠ é”åæœªè§£é”çš„é£é™© </span></p></li><li><p><span>éœ€è¦è§£é”æ“ä½œä¸èƒ½ä»…ä¾èµ–ç”¨æˆ·æ§åˆ¶ï¼Œç³»ç»Ÿçº§åˆ«è¦ç»™å‡ºå¯¹åº”çš„ä¿åº•å¤„ç†æ–¹æ¡ˆ</span></p></li></ul><p><strong><span>æ“ä½œ</span></strong></p><p><span>ä½¿ç”¨ expire ä¸ºé”keyæ·»åŠ </span><strong><span>æ—¶é—´é™å®š</span></strong><span>ï¼Œåˆ°æ—¶ä¸é‡Šæ”¾ï¼Œæ”¾å¼ƒé”</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">expire <span class="cm-keyword">lock</span><span class="cm-operator">-</span><span class="cm-keyword">key</span> seconds</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pexpire <span class="cm-keyword">lock</span><span class="cm-operator">-</span><span class="cm-keyword">key</span> milliseconds</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><ul><li><p><span>ç”±äºæ“ä½œé€šå¸¸éƒ½æ˜¯å¾®ç§’æˆ–æ¯«ç§’çº§ï¼Œå› æ­¤è¯¥é”å®šæ—¶é—´</span><strong><span>ä¸å®œè®¾ç½®è¿‡å¤§</span></strong><span>ã€‚å…·ä½“æ—¶é—´éœ€è¦ä¸šåŠ¡æµ‹è¯•åç¡®è®¤ã€‚</span></p><ul><li><p><span>ä¾‹å¦‚ï¼šæŒæœ‰é”çš„æ“ä½œæœ€é•¿æ‰§è¡Œæ—¶é—´127msï¼Œæœ€çŸ­æ‰§è¡Œæ—¶é—´7msã€‚</span></p></li><li><p><span>æµ‹è¯•ç™¾ä¸‡æ¬¡æœ€é•¿æ‰§è¡Œæ—¶é—´å¯¹åº”å‘½ä»¤çš„æœ€å¤§è€—æ—¶ï¼Œæµ‹è¯•ç™¾ä¸‡æ¬¡ç½‘ç»œå»¶è¿Ÿå¹³å‡è€—æ—¶</span></p></li><li><p><span>é”æ—¶é—´è®¾å®šæ¨èï¼šæœ€å¤§è€—æ—¶</span><em><span>120%+å¹³å‡ç½‘ç»œå»¶è¿Ÿ</span></em><span>110%</span></p></li><li><p><span>å¦‚æœä¸šåŠ¡æœ€å¤§è€—æ—¶&lt;&lt;ç½‘ç»œå¹³å‡å»¶è¿Ÿï¼Œé€šå¸¸ä¸º2ä¸ªæ•°é‡çº§ï¼Œå–å…¶ä¸­å•ä¸ªè€—æ—¶è¾ƒé•¿å³å¯</span></p></li></ul></li></ul><h1 id='å…­åˆ é™¤ç­–ç•¥'><span>å…­ã€åˆ é™¤ç­–ç•¥</span></h1><h2 id='61-è¿‡æœŸæ•°æ®'><span>6.1 è¿‡æœŸæ•°æ®</span></h2><p><span>Redisæ˜¯ä¸€ç§å†…å­˜çº§æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜ä¸­çš„æ•°æ®å¯ä»¥é€šè¿‡TTLæŒ‡ä»¤è·å–å…¶çŠ¶æ€</span></p><ul><li><p><span>XX ï¼šå…·æœ‰æ—¶æ•ˆæ€§çš„æ•°æ®</span></p></li><li><p><span>-1 ï¼šæ°¸ä¹…æœ‰æ•ˆçš„æ•°æ®</span></p></li><li><p><span>-2 å·²ç»è¿‡æœŸçš„æ•°æ® æˆ– è¢«åˆ é™¤çš„æ•°æ® æˆ– æœªå®šä¹‰çš„æ•°æ®.</span></p></li></ul><h2 id='62-è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥'><span>6.2 è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥</span></h2><p><span>Redis ä½¿ç”¨çš„è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ã€Œ</span><strong><span>æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤</span></strong><span>ã€è¿™ä¸¤ç§ç­–ç•¥é…å’Œä½¿ç”¨ã€‚</span></p><ul><li><p><span>å…ˆè¯´ä¸€ä¸‹å¯¹ key è®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ã€‚ è®¾ç½® key è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ä¸€å…±æœ‰ 4 ä¸ªï¼š</span></p><ul><li><p><code>expire &lt;key&gt; &lt;n&gt;</code><span>ï¼šè®¾ç½® key åœ¨ n ç§’åè¿‡æœŸï¼Œæ¯”å¦‚ expire key 100 è¡¨ç¤ºè®¾ç½® key åœ¨ 100 ç§’åè¿‡æœŸï¼›</span></p></li><li><p><code>pexpire &lt;key&gt; &lt;n&gt;</code><span>ï¼šè®¾ç½® key åœ¨ n æ¯«ç§’åè¿‡æœŸï¼Œæ¯”å¦‚ pexpire key2 100000 è¡¨ç¤ºè®¾ç½® key2 åœ¨ 100000 æ¯«ç§’ï¼ˆ100 ç§’ï¼‰åè¿‡æœŸã€‚</span></p></li><li><p><code>expireat &lt;key&gt; &lt;n&gt;</code><span>ï¼šè®¾ç½® key åœ¨æŸä¸ªæ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ä¹‹åè¿‡æœŸï¼Œæ¯”å¦‚ expireat key3 1655654400 è¡¨ç¤º key3 åœ¨æ—¶é—´æˆ³ 1655654400 åè¿‡æœŸï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ï¼›</span></p></li><li><p><code>pexpireat &lt;key&gt; &lt;n&gt;</code><span>ï¼šè®¾ç½® key åœ¨æŸä¸ªæ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ä¹‹åè¿‡æœŸï¼Œæ¯”å¦‚ pexpireat key4 1655654400000 è¡¨ç¤º key4 åœ¨æ—¶é—´æˆ³ 1655654400000 åè¿‡æœŸï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰</span></p></li></ul></li><li><p><span>å½“ç„¶ï¼Œåœ¨è®¾ç½®å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿå¯ä»¥åŒæ—¶å¯¹ key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…±æœ‰ 3 ç§å‘½ä»¤ï¼š</span></p><ul><li><p><code>set &lt;key&gt; &lt;value&gt; ex &lt;n&gt;</code><span> ï¼šè®¾ç½®é”®å€¼å¯¹çš„æ—¶å€™ï¼ŒåŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ï¼›</span></p></li><li><p><code>set &lt;key&gt; &lt;value&gt; px &lt;n&gt;</code><span> ï¼šè®¾ç½®é”®å€¼å¯¹çš„æ—¶å€™ï¼ŒåŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ï¼›</span></p></li><li><p><code>setex &lt;key&gt; &lt;n&gt; &lt;valule&gt;</code><span> ï¼šè®¾ç½®é”®å€¼å¯¹çš„æ—¶å€™ï¼ŒåŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ã€‚</span></p></li></ul></li><li><p><span>æ¯å½“æˆ‘ä»¬å¯¹ä¸€ä¸ª key è®¾ç½®äº†è¿‡æœŸæ—¶é—´æ—¶ï¼ŒRedis ä¼šæŠŠè¯¥ key å¸¦ä¸Šè¿‡æœŸæ—¶é—´å­˜å‚¨åˆ°ä¸€ä¸ª</span><strong><span>è¿‡æœŸå­—å…¸</span></strong><span>ï¼ˆexpires dictï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ã€Œè¿‡æœŸå­—å…¸ã€ä¿å­˜äº†æ•°æ®åº“ä¸­æ‰€æœ‰ key çš„è¿‡æœŸæ—¶é—´ã€‚è¿‡æœŸå­—å…¸å­˜å‚¨åœ¨ redisDb ç»“æ„ä¸­ï¼Œå¦‚ä¸‹ï¼š</span></p><ul><li><p><span>è¿‡æœŸå­—å…¸çš„ key æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æŸä¸ªé”®å¯¹è±¡ï¼›</span></p></li><li><p><span>è¿‡æœŸå­—å…¸çš„ value æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key çš„è¿‡æœŸæ—¶é—´ï¼›</span></p></li><li><p><span>å­—å…¸å®é™…ä¸Šæ˜¯å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾ã€‚å½“æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ª key æ—¶ï¼ŒRedis é¦–å…ˆæ£€æŸ¥è¯¥ key æ˜¯å¦å­˜åœ¨äºè¿‡æœŸå­—å…¸ä¸­ï¼š</span></p><ul><li><p><span>å¦‚æœä¸åœ¨ï¼Œåˆ™æ­£å¸¸è¯»å–é”®å€¼ï¼›</span></p></li><li><p><span>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šè·å–è¯¥ key çš„è¿‡æœŸæ—¶é—´ï¼Œç„¶åä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ¯”ç³»ç»Ÿæ—¶é—´å¤§ï¼Œé‚£å°±æ²¡æœ‰è¿‡æœŸï¼Œå¦åˆ™åˆ¤å®šè¯¥ key å·²è¿‡æœŸã€‚</span></p></li></ul></li></ul><p><img src="assets/image-20240622145754165.png" referrerpolicy="no-referrer" alt="image-20240622145754165"></p></li></ul><h3 id='621-å®šæ—¶åˆ é™¤'><span>6.2.1 å®šæ—¶åˆ é™¤</span></h3><ul><li><p><span>åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“keyè®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡ç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œ</span></p></li><li><p><span>ä¼˜ç‚¹ï¼šèŠ‚çº¦å†…å­˜ï¼Œåˆ°æ—¶å°±åˆ é™¤ï¼Œå¿«é€Ÿé‡Šæ”¾æ‰ä¸å¿…è¦çš„å†…å­˜å ç”¨</span></p></li><li><p><span>ç¼ºç‚¹</span><strong><span>ï¼šCPUå‹åŠ›å¾ˆå¤§ï¼Œæ— è®ºCPUæ­¤æ—¶è´Ÿè½½é‡å¤šé«˜ï¼Œå‡å ç”¨CPUï¼Œä¼šå½±å“redisæœåŠ¡å™¨å“åº”æ—¶é—´å’ŒæŒ‡ä»¤ååé‡ã€‚</span></strong><span>åœ¨è¿‡æœŸ key æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸ key å¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ† CPU æ—¶é—´ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½† CPU æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°† CPU æ—¶é—´ç”¨äºåˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚æ‰€ä»¥ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯¹ CPU ä¸å‹å¥½ã€‚</span></p></li><li><p><span>æ€»ç»“ï¼šç”¨å¤„ç†å™¨æ€§èƒ½æ¢å–å­˜å‚¨ç©ºé—´ ï¼ˆæ‹¿æ—¶é—´æ¢ç©ºé—´ï¼‰</span></p></li></ul><h3 id='622-æƒ°æ€§åˆ é™¤'><span>6.2.2 æƒ°æ€§åˆ é™¤</span></h3><ul><li><p><span>æ•°æ®åˆ°è¾¾è¿‡æœŸæ—¶é—´ï¼Œä¸åšå¤„ç†ã€‚ç­‰ä¸‹æ¬¡è®¿é—®è¯¥æ•°æ®æ—¶ï¼š</span></p><ul><li><p><span>å¦‚æœæœªè¿‡æœŸï¼Œè¿”å›æ•°æ®</span></p></li><li><p><span>å‘ç°å·²è¿‡æœŸï¼Œåˆ é™¤ï¼Œè¿”å›ä¸å­˜åœ¨</span></p></li></ul></li><li><p><span>ä¼˜ç‚¹ï¼šèŠ‚çº¦CPUæ€§èƒ½ï¼Œå‘ç°å¿…é¡»åˆ é™¤çš„æ—¶å€™æ‰åˆ é™¤</span></p></li><li><p><span>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¾ˆå¤§ï¼Œå‡ºç°é•¿æœŸå ç”¨å†…å­˜çš„æ•°æ®</span></p></li><li><p><span>æ€»ç»“ï¼šç”¨å­˜å‚¨ç©ºé—´æ¢å–å¤„ç†å™¨æ€§èƒ½ ï¼ˆæ‹¿æ—¶é—´æ¢ç©ºé—´ï¼‰</span></p></li></ul><h3 id='623-å®šæœŸåˆ é™¤'><span>6.2.3 å®šæœŸåˆ é™¤</span></h3><p><img src="./images/å®šæœŸåˆ é™¤.png" referrerpolicy="no-referrer" alt="å®šæœŸåˆ é™¤.png"></p><ul><li><p><strong><span>å‘¨æœŸæ€§è½®è¯¢redisåº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨éšæœºæŠ½å–çš„ç­–ç•¥ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘åº¦</span></strong></p></li><li><p><span>åœ¨ Redis ä¸­ï¼Œé»˜è®¤æ¯ç§’è¿›è¡Œ 10 æ¬¡è¿‡æœŸæ£€æŸ¥ä¸€æ¬¡æ•°æ®åº“ï¼Œæ­¤é…ç½®å¯é€šè¿‡ Redis çš„é…ç½®æ–‡ä»¶ redis.conf è¿›è¡Œé…ç½®ï¼Œé…ç½®é”®ä¸º hz å®ƒçš„é»˜è®¤å€¼æ˜¯ hz 10ã€‚</span></p></li><li><p><span>å®šæœŸåˆ é™¤çš„å®ç°åœ¨ expire.c æ–‡ä»¶ä¸‹çš„ </span><code>activeExpireCycle</code><span> å‡½æ•°ä¸­ï¼Œå…¶ä¸­éšæœºæŠ½æŸ¥çš„æ•°é‡ç”± </span><code>ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP</code><span> å®šä¹‰çš„ï¼Œå®ƒæ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œæ•°å€¼æ˜¯ 20ã€‚</span></p></li><li><p><span>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è¯´è¯´ Redis çš„å®šæœŸåˆ é™¤çš„æµç¨‹ï¼š</span></p><ul><li><p><span>ä»è¿‡æœŸå­—å…¸ä¸­éšæœºæŠ½å– 20 ä¸ª keyï¼›</span></p></li><li><p><span>æ£€æŸ¥è¿™ 20 ä¸ª key æ˜¯å¦è¿‡æœŸï¼Œå¹¶åˆ é™¤å·²è¿‡æœŸçš„ keyï¼›</span></p></li><li><p><span>å¦‚æœæœ¬è½®æ£€æŸ¥çš„å·²è¿‡æœŸ key çš„æ•°é‡ï¼Œè¶…è¿‡ 5 ä¸ªï¼ˆ20/4ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€Œå·²è¿‡æœŸ key çš„æ•°é‡ã€å æ¯”ã€ŒéšæœºæŠ½å– key çš„æ•°é‡ã€å¤§äº 25%ï¼Œåˆ™ç»§ç»­é‡å¤æ­¥éª¤ 1ï¼›å¦‚æœå·²è¿‡æœŸçš„ key æ¯”ä¾‹å°äº 25%ï¼Œåˆ™åœæ­¢ç»§ç»­åˆ é™¤è¿‡æœŸ keyï¼Œç„¶åç­‰å¾…ä¸‹ä¸€è½®å†æ£€æŸ¥ã€‚</span></p></li></ul><p><span>å¯ä»¥çœ‹åˆ°ï¼Œå®šæœŸåˆ é™¤æ˜¯ä¸€ä¸ªå¾ªç¯çš„æµç¨‹ã€‚é‚£ Redis ä¸ºäº†ä¿è¯å®šæœŸåˆ é™¤ä¸ä¼šå‡ºç°å¾ªç¯è¿‡åº¦ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»ç°è±¡ï¼Œä¸ºæ­¤å¢åŠ äº†å®šæœŸåˆ é™¤å¾ªç¯æµç¨‹çš„æ—¶é—´ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡ 25msã€‚</span></p></li><li><p><span>ç‰¹ç‚¹1ï¼šCPUæ€§èƒ½å ç”¨è®¾ç½®æœ‰å³°å€¼ï¼Œæ£€æµ‹é¢‘åº¦å¯è‡ªå®šä¹‰è®¾ç½®</span></p></li><li><p><span>ç‰¹ç‚¹2ï¼šå†…å­˜å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œé•¿æœŸå ç”¨å†…å­˜çš„å†·æ•°æ®ä¼šè¢«æŒç»­æ¸…ç†</span></p></li><li><p><span>ä¼˜ç‚¹ï¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ï¼Œæ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿèƒ½åˆ é™¤ä¸€éƒ¨åˆ†è¿‡æœŸçš„æ•°æ®å‡å°‘äº†è¿‡æœŸé”®å¯¹ç©ºé—´çš„æ— æ•ˆå ç”¨ã€‚</span></p></li><li><p><span>ç¼ºç‚¹</span></p><ul><li><p><span>å†…å­˜æ¸…ç†æ–¹é¢æ²¡æœ‰å®šæ—¶åˆ é™¤æ•ˆæœå¥½ï¼ŒåŒæ—¶æ²¡æœ‰æƒ°æ€§åˆ é™¤ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå°‘ã€‚</span></p></li><li><p><span>éš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ã€‚å¦‚æœæ‰§è¡Œçš„å¤ªé¢‘ç¹ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥å˜å¾—å’Œå®šæ—¶åˆ é™¤ç­–ç•¥ä¸€æ ·ï¼Œå¯¹CPUä¸å‹å¥½ï¼›å¦‚æœæ‰§è¡Œçš„å¤ªå°‘ï¼Œé‚£åˆå’Œæƒ°æ€§åˆ é™¤ä¸€æ ·äº†ï¼Œè¿‡æœŸ key å ç”¨çš„å†…å­˜ä¸ä¼šåŠæ—¶å¾—åˆ°é‡Šæ”¾ã€‚</span></p></li></ul></li><li><p><span>æ€»ç»“ï¼šå‘¨æœŸæ€§æŠ½æŸ¥å­˜å‚¨ç©ºé—´ï¼ˆéšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ï¼‰</span></p></li></ul><h3 id='624-å¯¹æ¯”'><span>6.2.4 å¯¹æ¯”</span></h3><figure class='table-figure'><table><thead><tr><th><span>åˆ é™¤ç­–ç•¥</span></th><th><span>ä¼˜ç‚¹</span></th><th><span>ç¼ºç‚¹</span></th><th><span>æ€»ç»“</span></th></tr></thead><tbody><tr><td><span>å®šæ—¶åˆ é™¤</span></td><td><span>èŠ‚çº¦å†…å­˜</span></td><td><span>ä¸åˆ†æ—¶æ®µçš„å ç”¨cpuï¼Œé¢‘åº¦é«˜</span></td><td><span>ç”¨æ—¶é—´æ¢ç©ºé—´</span></td></tr><tr><td><span>æƒ°æ€§åˆ é™¤</span></td><td><span>å»¶æ—¶æ‰§è¡Œï¼ŒCPUåˆ©ç”¨ç‡é«˜</span></td><td><span>å ç”¨å†…å­˜</span></td><td><span>ç”¨ç©ºé—´æ¢æ—¶é—´</span></td></tr><tr><td><span>å®šæœŸåˆ é™¤</span></td><td><span>å†…å­˜å®šæœŸéšæœºæ¸…ç†ï¼Œæ¯ç§’èŠ±è´¹å›ºå®šçš„CPUèµ„æºç»´æŠ¤å†…å­˜</span></td><td>&nbsp;</td><td><span>éšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥</span></td></tr></tbody></table></figure><h2 id='63-å†…å­˜æ·˜æ±°ç­–ç•¥'><span>6.3 å†…å­˜æ·˜æ±°ç­–ç•¥</span></h2><p><strong><span>å½“æ–°æ•°æ®è¿›å…¥redisæ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ</span></strong></p><ul><li><p><span>Redisä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œåœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤å‰ï¼Œä¼šè°ƒç”¨freeMemoryIfNeeded()æ£€æµ‹å†…å­˜æ˜¯å¦å……è¶³ã€‚å¦‚æœå†…å­˜ä¸æ»¡è¶³æ–°åŠ å…¥æ•°æ®çš„æœ€ä½å­˜å‚¨è¦æ±‚ï¼Œredisè¦ä¸´æ—¶åˆ é™¤ä¸€äº›æ•°æ®ä¸ºå½“å‰æŒ‡ä»¤æ¸…ç†å­˜å‚¨ç©ºé—´ã€‚æ¸…ç†æ•°æ®çš„ç­–ç•¥ç§°ä¸ºå†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</span></p></li><li><p><span>æ³¨æ„ï¼šå†…å­˜æ·˜æ±°çš„è¿‡ç¨‹ä¸æ˜¯100%èƒ½å¤Ÿæ¸…ç†å‡ºè¶³å¤Ÿçš„å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœä¸æˆåŠŸåˆ™åå¤æ‰§è¡Œã€‚å½“å¯¹æ‰€æœ‰æ•°æ®å°è¯•å®Œæ¯•åï¼Œå¦‚æœä¸èƒ½è¾¾åˆ°å†…å­˜æ¸…ç†çš„è¦æ±‚ï¼Œå°†å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</span></p></li></ul><p><strong><span>å¯ä»¥ä½¿ç”¨ </span><code>config get maxmemory-policy</code><span> å‘½ä»¤ï¼Œæ¥æŸ¥çœ‹å½“å‰ Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥</span></strong><span>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127</span>.0.0.1:6379&gt; config <span class="cm-builtin">get</span> maxmemory-policy</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span>) <span class="cm-string">"maxmemory-policy"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span>) <span class="cm-string">"noeviction"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><strong><span>Redis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</span></strong></p><ul><li><p><span>åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ï¼š</span></p><ul><li><p><strong><span>volatile-lruï¼ˆleast recently usedï¼‰</span></strong><span>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</span></p></li><li><p><strong><span>volatile-lfuï¼ˆleast frequently usedï¼‰</span></strong><span>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</span></p></li><li><p><strong><span>volatile-ttl</span></strong><span>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</span></p></li><li><p><strong><span>volatile-random</span></strong><span>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</span></p></li></ul></li><li><p><span>æ£€æµ‹å…¨åº“æ•°æ®ï¼š</span></p><ul><li><p><strong><span>allkeys-lruï¼ˆleast recently usedï¼‰</span></strong><span>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰</span></p></li><li><p><strong><span>allkeys-random</span></strong><span>ï¼šä»æ•°æ®é›†(å…¨åº“æ•°æ®)ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼Œ</span></p></li><li><p><strong><span>allkeys-lfuï¼ˆleast frequently usedï¼‰</span></strong><span>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ keyã€‚</span></p></li></ul></li><li><p><em><span>ä¸è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥</span></em></p><ul><li><p><strong><span>no-eviction</span></strong><span>ï¼šå®ƒè¡¨ç¤ºå½“è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œä¼šæŠ¥é”™é€šçŸ¥ç¦æ­¢å†™å…¥ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæ²¡ç”¨æ•°æ®å†™å…¥çš„è¯ï¼Œåªæ˜¯å•çº¯çš„æŸ¥è¯¢æˆ–è€…åˆ é™¤æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</span></p></li></ul></li></ul><p><strong><span>è®¾ç½®å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä¸¤ç§æ–¹æ³•ï¼š</span></strong></p><ul><li><p><span>æ–¹å¼ä¸€ï¼šé€šè¿‡â€œ</span><code>config set maxmemory-policy &lt;ç­–ç•¥&gt;</code><span>â€å‘½ä»¤è®¾ç½®ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯è®¾ç½®ä¹‹åç«‹å³ç”Ÿæ•ˆï¼Œä¸éœ€è¦é‡å¯ Redis æœåŠ¡ï¼Œç¼ºç‚¹æ˜¯é‡å¯ Redis ä¹‹åï¼Œè®¾ç½®å°±ä¼šå¤±æ•ˆã€‚</span></p></li><li><p><span>æ–¹å¼äºŒï¼šé€šè¿‡ä¿®æ”¹ Redis é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼Œè®¾ç½®â€œ</span><code>maxmemory-policy &lt;ç­–ç•¥&gt;</code><span>â€ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯é‡å¯ Redis æœåŠ¡åé…ç½®ä¸ä¼šä¸¢å¤±ï¼Œç¼ºç‚¹æ˜¯å¿…é¡»é‡å¯ Redis æœåŠ¡ï¼Œè®¾ç½®æ‰èƒ½ç”Ÿæ•ˆ</span></p></li></ul><p><strong><span>redisæ˜¯å¦‚ä½•å®ç°LRUï¼Ÿ</span></strong></p><p><span>ä¼ ç»Ÿ LRU ç®—æ³•çš„å®ç°æ˜¯åŸºäºã€Œé“¾è¡¨ã€ç»“æ„ï¼Œé“¾è¡¨ä¸­çš„å…ƒç´ æŒ‰ç…§æ“ä½œé¡ºåºä»å‰å¾€åæ’åˆ—ï¼Œæœ€æ–°æ“ä½œçš„é”®ä¼šè¢«ç§»åŠ¨åˆ°è¡¨å¤´ï¼Œå½“éœ€è¦å†…å­˜æ·˜æ±°æ—¶ï¼Œåªéœ€è¦åˆ é™¤é“¾è¡¨å°¾éƒ¨çš„å…ƒç´ å³å¯ï¼Œå› ä¸ºé“¾è¡¨å°¾éƒ¨çš„å…ƒç´ å°±ä»£è¡¨æœ€ä¹…æœªè¢«ä½¿ç”¨çš„å…ƒç´ ã€‚</span></p><p><span>Redis å¹¶æ²¡æœ‰ä½¿ç”¨è¿™æ ·çš„æ–¹å¼å®ç° LRU ç®—æ³•ï¼Œå› ä¸ºä¼ ç»Ÿçš„ LRU ç®—æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</span></p><ul><li><p><span>éœ€è¦ç”¨é“¾è¡¨ç®¡ç†æ‰€æœ‰çš„ç¼“å­˜æ•°æ®ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„ç©ºé—´å¼€é”€ï¼›</span></p></li><li><p><span>å½“æœ‰æ•°æ®è¢«è®¿é—®æ—¶ï¼Œéœ€è¦åœ¨é“¾è¡¨ä¸ŠæŠŠè¯¥æ•°æ®ç§»åŠ¨åˆ°å¤´ç«¯ï¼Œå¦‚æœæœ‰å¤§é‡æ•°æ®è¢«è®¿é—®ï¼Œå°±ä¼šå¸¦æ¥å¾ˆå¤šé“¾è¡¨ç§»åŠ¨æ“ä½œï¼Œä¼šå¾ˆè€—æ—¶ï¼Œè¿›è€Œä¼šé™ä½ Redis ç¼“å­˜æ€§èƒ½ã€‚</span></p></li></ul><p><span>Redis å®ç°çš„æ˜¯ä¸€ç§</span><strong><span>è¿‘ä¼¼ LRU ç®—æ³•</span></strong><span>ï¼Œç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„èŠ‚çº¦å†…å­˜ï¼Œå®ƒçš„</span><strong><span>å®ç°æ–¹å¼æ˜¯åœ¨ Redis çš„å¯¹è±¡ç»“æ„ä½“ä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å­—æ®µï¼Œç”¨äºè®°å½•æ­¤æ•°æ®çš„æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</span></strong><span>ã€‚</span></p><p><span>å½“ Redis è¿›è¡Œå†…å­˜æ·˜æ±°æ—¶ï¼Œä¼šä½¿ç”¨</span><strong><span>éšæœºé‡‡æ ·çš„æ–¹å¼æ¥æ·˜æ±°æ•°æ®</span></strong><span>ï¼Œå®ƒæ˜¯éšæœºå– 5 ä¸ªå€¼ï¼ˆæ­¤å€¼å¯é…ç½®ï¼‰ï¼Œç„¶å</span><strong><span>æ·˜æ±°æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é‚£ä¸ª</span></strong><span>ã€‚</span></p><p><span>Redis å®ç°çš„ LRU ç®—æ³•çš„ä¼˜ç‚¹ï¼š</span></p><ul><li><p><span>ä¸ç”¨ä¸ºæ‰€æœ‰çš„æ•°æ®ç»´æŠ¤ä¸€ä¸ªå¤§é“¾è¡¨ï¼ŒèŠ‚çœäº†ç©ºé—´å ç”¨ï¼›</span></p></li><li><p><span>ä¸ç”¨åœ¨æ¯æ¬¡æ•°æ®è®¿é—®æ—¶éƒ½ç§»åŠ¨é“¾è¡¨é¡¹ï¼Œæå‡äº†ç¼“å­˜çš„æ€§èƒ½ï¼›</span></p></li></ul><p><span>ä½†æ˜¯ LRU ç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ</span><strong><span>æ— æ³•è§£å†³ç¼“å­˜æ±¡æŸ“é—®é¢˜</span></strong><span>ï¼Œæ¯”å¦‚åº”ç”¨ä¸€æ¬¡è¯»å–äº†å¤§é‡çš„æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®åªä¼šè¢«è¯»å–è¿™ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šç•™å­˜åœ¨ Redis ç¼“å­˜ä¸­å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé€ æˆç¼“å­˜æ±¡æŸ“ã€‚</span></p><p><strong><span>redisæ˜¯å¦‚ä½•å®ç°LFUï¼Ÿ</span></strong></p><p><span>LFU å…¨ç§°æ˜¯ Least Frequently Used ç¿»è¯‘ä¸º</span><strong><span>æœ€è¿‘æœ€ä¸å¸¸ç”¨</span></strong><span>ï¼ŒLFU ç®—æ³•æ˜¯æ ¹æ®æ•°æ®è®¿é—®æ¬¡æ•°æ¥æ·˜æ±°æ•°æ®çš„ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®è¿‡å»è¢«è®¿é—®å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„é¢‘ç‡ä¹Ÿæ›´é«˜â€ã€‚</span></p><p><span>æ‰€ä»¥ï¼Œ LFU ç®—æ³•ä¼šè®°å½•æ¯ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚å½“ä¸€ä¸ªæ•°æ®è¢«å†æ¬¡è®¿é—®æ—¶ï¼Œå°±ä¼šå¢åŠ è¯¥æ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚è¿™æ ·å°±è§£å†³äº†å¶å°”è¢«è®¿é—®ä¸€æ¬¡ä¹‹åï¼Œæ•°æ®ç•™å­˜åœ¨ç¼“å­˜ä¸­å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„é—®é¢˜ï¼Œç›¸æ¯”äº LRU ç®—æ³•ä¹Ÿæ›´åˆç†ä¸€äº›ã€‚</span></p><p><span>LFU ç®—æ³•ç›¸æ¯”äº LRU ç®—æ³•çš„å®ç°ï¼Œå¤šè®°å½•äº†ã€Œæ•°æ®çš„è®¿é—®é¢‘æ¬¡ã€çš„ä¿¡æ¯ã€‚</span></p><p><span>Redis å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µï¼Œåœ¨ LRU ç®—æ³•ä¸‹å’Œ LFU ç®—æ³•ä¸‹ä½¿ç”¨æ–¹å¼å¹¶ä¸ç›¸åŒã€‚</span></p><p><strong><span>åœ¨ LRU ç®—æ³•ä¸­</span></strong><span>ï¼ŒRedis å¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µæ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼Œå› æ­¤åœ¨ LRU æ¨¡å¼ä¸‹ï¼ŒRediså¯ä»¥æ ¹æ®å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µè®°å½•çš„å€¼ï¼Œæ¥æ¯”è¾ƒæœ€åä¸€æ¬¡ key çš„è®¿é—®æ—¶é—´é•¿ï¼Œä»è€Œæ·˜æ±°æœ€ä¹…æœªè¢«ä½¿ç”¨çš„ keyã€‚</span></p><p><strong><span>åœ¨ LFU ç®—æ³•ä¸­</span></strong><span>ï¼ŒRediså¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µè¢«åˆ†æˆä¸¤æ®µæ¥å­˜å‚¨ï¼Œé«˜ 16bit å­˜å‚¨ ldt(Last Decrement Time)ï¼Œä½ 8bit å­˜å‚¨ logc(Logistic Counter)ã€‚</span></p><ul><li><p><span>ldt æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼›</span></p></li><li><p><span>logc æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®é¢‘æ¬¡ï¼Œå®ƒçš„å€¼è¶Šå°è¡¨ç¤ºä½¿ç”¨é¢‘ç‡è¶Šä½ï¼Œè¶Šå®¹æ˜“æ·˜æ±°ï¼Œæ¯ä¸ªæ–°åŠ å…¥çš„ key çš„logc åˆå§‹å€¼ä¸º 5ã€‚</span></p></li></ul><p><span>æ³¨æ„ï¼Œlogc å¹¶ä¸æ˜¯å•çº¯çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ˜¯è®¿é—®é¢‘æ¬¡ï¼ˆè®¿é—®é¢‘ç‡ï¼‰ï¼Œå› ä¸º </span><strong><span>logc ä¼šéšæ—¶é—´æ¨ç§»è€Œè¡°å‡çš„</span></strong><span>ã€‚</span></p><p><span>åœ¨æ¯æ¬¡ key è¢«è®¿é—®æ—¶ï¼Œä¼šå…ˆå¯¹ logc åšä¸€ä¸ªè¡°å‡æ“ä½œï¼Œè¡°å‡çš„å€¼è·Ÿå‰åè®¿é—®æ—¶é—´çš„å·®è·æœ‰å…³ç³»ï¼Œå¦‚æœä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´ä¸è¿™ä¸€æ¬¡è®¿é—®çš„æ—¶é—´å·®è·å¾ˆå¤§ï¼Œé‚£ä¹ˆè¡°å‡çš„å€¼å°±è¶Šå¤§ï¼Œè¿™æ ·å®ç°çš„ LFU ç®—æ³•æ˜¯æ ¹æ®</span><strong><span>è®¿é—®é¢‘ç‡</span></strong><span>æ¥æ·˜æ±°æ•°æ®çš„ï¼Œè€Œä¸åªæ˜¯è®¿é—®æ¬¡æ•°ã€‚è®¿é—®é¢‘ç‡éœ€è¦è€ƒè™‘ key çš„è®¿é—®æ˜¯å¤šé•¿æ—¶é—´æ®µå†…å‘ç”Ÿçš„ã€‚key çš„å…ˆå‰è®¿é—®è·ç¦»å½“å‰æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ª key çš„è®¿é—®é¢‘ç‡ç›¸åº”åœ°ä¹Ÿå°±ä¼šé™ä½ï¼Œè¿™æ ·è¢«æ·˜æ±°çš„æ¦‚ç‡ä¹Ÿä¼šæ›´å¤§ã€‚</span></p><p><span>å¯¹ logc åšå®Œè¡°å‡æ“ä½œåï¼Œå°±å¼€å§‹å¯¹ logc è¿›è¡Œå¢åŠ æ“ä½œï¼Œå¢åŠ æ“ä½œå¹¶ä¸æ˜¯å•çº¯çš„ + 1ï¼Œè€Œæ˜¯æ ¹æ®æ¦‚ç‡å¢åŠ ï¼Œå¦‚æœ logc è¶Šå¤§çš„ keyï¼Œå®ƒçš„ logc å°±è¶Šéš¾å†å¢åŠ ã€‚</span></p><p><span>æ‰€ä»¥ï¼ŒRedis åœ¨è®¿é—® key æ—¶ï¼Œå¯¹äº logc æ˜¯è¿™æ ·å˜åŒ–çš„ï¼š</span></p><ol start='' ><li><p><span>å…ˆæŒ‰ç…§ä¸Šæ¬¡è®¿é—®è·ç¦»å½“å‰çš„æ—¶é•¿ï¼Œæ¥å¯¹ logc è¿›è¡Œè¡°å‡ï¼›</span></p></li><li><p><span>ç„¶åï¼Œå†æŒ‰ç…§ä¸€å®šæ¦‚ç‡å¢åŠ  logc çš„å€¼</span></p></li></ol><p><span>redis.conf æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼Œç”¨äºè°ƒæ•´ LFU ç®—æ³•ä»è€Œæ§åˆ¶ logc çš„å¢é•¿å’Œè¡°å‡ï¼š</span></p><ul><li><p><code>lfu-decay-time</code><span> ç”¨äºè°ƒæ•´ logc çš„è¡°å‡é€Ÿåº¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ•°å€¼ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œlfu-decay-time å€¼è¶Šå¤§ï¼Œè¡°å‡è¶Šæ…¢ï¼›</span></p></li><li><p><code>lfu-log-factor</code><span> ç”¨äºè°ƒæ•´ logc çš„å¢é•¿é€Ÿåº¦ï¼Œlfu-log-factor å€¼è¶Šå¤§ï¼Œlogc å¢é•¿è¶Šæ…¢ã€‚</span></p></li></ul><h2 id='64-redis-æŒä¹…åŒ–æ—¶å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„'><span>6.4 Redis æŒä¹…åŒ–æ—¶ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†çš„ï¼Ÿ</span></h2><p><span>Redis æŒä¹…åŒ–æ–‡ä»¶æœ‰ä¸¤ç§æ ¼å¼ï¼šRDBï¼ˆRedis Databaseï¼‰å’Œ AOFï¼ˆAppend Only Fileï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹è¿‡æœŸé”®åœ¨è¿™ä¸¤ç§æ ¼å¼ä¸­çš„å‘ˆç°çŠ¶æ€ã€‚</span></p><p><span>RDB æ–‡ä»¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒRDB æ–‡ä»¶ç”Ÿæˆé˜¶æ®µå’ŒåŠ è½½é˜¶æ®µã€‚</span></p><ul><li><p><strong><span>RDB æ–‡ä»¶ç”Ÿæˆé˜¶æ®µ</span></strong><span>ï¼šä»å†…å­˜çŠ¶æ€æŒä¹…åŒ–æˆ RDBï¼ˆæ–‡ä»¶ï¼‰çš„æ—¶å€™ï¼Œä¼šå¯¹ key è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œ</span><strong><span>è¿‡æœŸçš„é”®ã€Œä¸ä¼šã€è¢«ä¿å­˜åˆ°æ–°çš„ RDB æ–‡ä»¶ä¸­</span></strong><span>ï¼Œå› æ­¤ Redis ä¸­çš„è¿‡æœŸé”®ä¸ä¼šå¯¹ç”Ÿæˆæ–° RDB æ–‡ä»¶äº§ç”Ÿä»»ä½•å½±å“ã€‚</span></p></li><li><p><span>RDB åŠ è½½é˜¶æ®µ</span></p><p><span>ï¼šRDB åŠ è½½é˜¶æ®µæ—¶ï¼Œè¦çœ‹æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨è¿˜æ˜¯ä»æœåŠ¡å™¨ï¼Œåˆ†åˆ«å¯¹åº”ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</span></p><ul><li><p><strong><span>å¦‚æœ Redis æ˜¯ã€Œä¸»æœåŠ¡å™¨ã€è¿è¡Œæ¨¡å¼çš„è¯ï¼Œåœ¨è½½å…¥ RDB æ–‡ä»¶æ—¶ï¼Œç¨‹åºä¼šå¯¹æ–‡ä»¶ä¸­ä¿å­˜çš„é”®è¿›è¡Œæ£€æŸ¥ï¼Œè¿‡æœŸé”®ã€Œä¸ä¼šã€è¢«è½½å…¥åˆ°æ•°æ®åº“ä¸­</span></strong><span>ã€‚æ‰€ä»¥è¿‡æœŸé”®ä¸ä¼šå¯¹è½½å…¥ RDB æ–‡ä»¶çš„ä¸»æœåŠ¡å™¨é€ æˆå½±å“ï¼›</span></p></li><li><p><strong><span>å¦‚æœ Redis æ˜¯ã€Œä»æœåŠ¡å™¨ã€è¿è¡Œæ¨¡å¼çš„è¯ï¼Œåœ¨è½½å…¥ RDB æ–‡ä»¶æ—¶ï¼Œä¸è®ºé”®æ˜¯å¦è¿‡æœŸéƒ½ä¼šè¢«è½½å…¥åˆ°æ•°æ®åº“ä¸­</span></strong><span>ã€‚ä½†ç”±äºä¸»ä»æœåŠ¡å™¨åœ¨è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œä»æœåŠ¡å™¨çš„æ•°æ®ä¼šè¢«æ¸…ç©ºã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œè¿‡æœŸé”®å¯¹è½½å…¥ RDB æ–‡ä»¶çš„ä»æœåŠ¡å™¨ä¹Ÿä¸ä¼šé€ æˆå½±å“ã€‚</span></p></li></ul></li></ul><p><span>AOF æ–‡ä»¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒAOF æ–‡ä»¶å†™å…¥é˜¶æ®µå’Œ AOF é‡å†™é˜¶æ®µã€‚</span></p><ul><li><p><strong><span>AOF æ–‡ä»¶å†™å…¥é˜¶æ®µ</span></strong><span>ï¼šå½“ Redis ä»¥ AOF æ¨¡å¼æŒä¹…åŒ–æ—¶ï¼Œ</span><strong><span>å¦‚æœæ•°æ®åº“æŸä¸ªè¿‡æœŸé”®è¿˜æ²¡è¢«åˆ é™¤ï¼Œé‚£ä¹ˆ AOF æ–‡ä»¶ä¼šä¿ç•™æ­¤è¿‡æœŸé”®ï¼Œå½“æ­¤è¿‡æœŸé”®è¢«åˆ é™¤åï¼ŒRedis ä¼šå‘ AOF æ–‡ä»¶è¿½åŠ ä¸€æ¡ DEL å‘½ä»¤æ¥æ˜¾å¼åœ°åˆ é™¤è¯¥é”®å€¼</span></strong><span>ã€‚</span></p></li><li><p><strong><span>AOF é‡å†™é˜¶æ®µ</span></strong><span>ï¼šæ‰§è¡Œ AOF é‡å†™æ—¶ï¼Œä¼šå¯¹ Redis ä¸­çš„é”®å€¼å¯¹è¿›è¡Œæ£€æŸ¥ï¼Œ</span><strong><span>å·²è¿‡æœŸçš„é”®ä¸ä¼šè¢«ä¿å­˜åˆ°é‡å†™åçš„ AOF æ–‡ä»¶ä¸­</span></strong><span>ï¼Œå› æ­¤ä¸ä¼šå¯¹ AOF é‡å†™é€ æˆä»»ä½•å½±å“ã€‚</span></p></li></ul><h3 id='redis-ä¸»ä»æ¨¡å¼ä¸­å¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†'><span>Redis ä¸»ä»æ¨¡å¼ä¸­ï¼Œå¯¹è¿‡æœŸé”®ä¼šå¦‚ä½•å¤„ç†ï¼Ÿ</span></h3><p><span>å½“ Redis è¿è¡Œåœ¨ä¸»ä»æ¨¡å¼ä¸‹æ—¶ï¼Œ</span><strong><span>ä»åº“ä¸ä¼šè¿›è¡Œè¿‡æœŸæ‰«æï¼Œä»åº“å¯¹è¿‡æœŸçš„å¤„ç†æ˜¯è¢«åŠ¨çš„</span></strong><span>ã€‚ä¹Ÿå°±æ˜¯å³ä½¿ä»åº“ä¸­çš„ key è¿‡æœŸäº†ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è®¿é—®ä»åº“æ—¶ï¼Œä¾ç„¶å¯ä»¥å¾—åˆ° key å¯¹åº”çš„å€¼ï¼Œåƒæœªè¿‡æœŸçš„é”®å€¼å¯¹ä¸€æ ·è¿”å›ã€‚</span></p><p><span>ä»åº“çš„è¿‡æœŸé”®å¤„ç†ä¾é ä¸»æœåŠ¡å™¨æ§åˆ¶ï¼Œ</span><strong><span>ä¸»åº“åœ¨ key åˆ°æœŸæ—¶ï¼Œä¼šåœ¨ AOF æ–‡ä»¶é‡Œå¢åŠ ä¸€æ¡ del æŒ‡ä»¤ï¼ŒåŒæ­¥åˆ°æ‰€æœ‰çš„ä»åº“</span></strong><span>ï¼Œä»åº“é€šè¿‡æ‰§è¡Œè¿™æ¡ del æŒ‡ä»¤æ¥åˆ é™¤è¿‡æœŸçš„ keyã€‚</span></p><h1 id='ä¸ƒä¸»ä»å¤åˆ¶'><span>ä¸ƒã€ä¸»ä»å¤åˆ¶</span></h1><p><span>ä¸ºäº†é¿å…å•ç‚¹RedisæœåŠ¡å™¨æ•…éšœï¼Œå‡†å¤‡å¤šå°æœåŠ¡å™¨ï¼Œäº’ç›¸è¿é€šã€‚å°†æ•°æ®å¤åˆ¶å¤šä¸ªå‰¯æœ¬ä¿å­˜åœ¨ä¸åŒçš„æœ åŠ¡å™¨ä¸Šï¼Œè¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¿è¯æ•°æ®æ˜¯åŒæ­¥çš„ã€‚å³ä½¿æœ‰å…¶ä¸­ä¸€å°æœåŠ¡å™¨å®•æœºï¼Œå…¶ä»–æœåŠ¡å™¨ä¾ç„¶å¯ä»¥ç»§ç»­æä¾›æœåŠ¡ï¼Œå®ç°Redisçš„é«˜å¯ç”¨ï¼ŒåŒæ—¶å®ç°æ•°æ®å†—ä½™å¤‡ä»½ã€‚</span></p><ul><li><p><span>æœ‰å¤šå°æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨(master)æ˜¯æä¾›æ•°æ®æ–¹ï¼Œä¸»è¦è´Ÿè´£å†™æ“ä½œï¼Œä»æœåŠ¡å™¨(Slave)æ˜¯æ¥æ”¶æ•°æ®çš„ä¸€æ–¹ï¼Œåªè´Ÿè´£è¯»æ“ä½œï¼Œä¸»ä»å¤åˆ¶å°±æ˜¯å°†ä¸»æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥åˆ°ä»æœåŠ¡å™¨ã€‚</span></p></li></ul><h2 id='ä½œç”¨'><strong><span>ä½œç”¨</span></strong></h2><ul><li><p><span>è¯»å†™åˆ†ç¦»ï¼šmasterå†™ã€slaveè¯»ï¼Œæé«˜æœåŠ¡å™¨çš„è¯»å†™è´Ÿè½½èƒ½åŠ›</span></p></li><li><p><span>è´Ÿè½½å‡è¡¡ï¼šåŸºäºä¸»ä»ç»“æ„ï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œç”±slaveåˆ†æ‹…masterè´Ÿè½½ï¼Œå¹¶æ ¹æ®éœ€æ±‚çš„å˜åŒ–ï¼Œæ”¹å˜slaveçš„æ•°é‡ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–è´Ÿè½½ï¼Œå¤§å¤§æé«˜RedisæœåŠ¡å™¨å¹¶å‘é‡ä¸æ•°æ®ååé‡</span></p></li><li><p><span>æ•…éšœæ¢å¤ï¼šå½“masterå‡ºç°é—®é¢˜æ—¶ï¼Œç”±slaveæä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤</span></p></li><li><p><span>æ•°æ®å†—ä½™ï¼šå®ç°æ•°æ®çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</span></p></li><li><p><span>é«˜å¯ç”¨åŸºçŸ³ï¼šåŸºäºä¸»ä»å¤åˆ¶ï¼Œæ„å»ºå“¨å…µæ¨¡å¼ä¸é›†ç¾¤ï¼Œå®ç°Redisçš„é«˜å¯ç”¨æ–¹æ¡ˆ</span></p></li></ul><h2 id='æµç¨‹'><span>æµç¨‹</span></h2><p><strong><span>ç¬¬ä¸€æ¬¡åŒæ­¥</span></strong></p><p><span>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ </span><code>replicaof</code><span>ï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨çš„å…³ç³»ã€‚</span></p><p><span>æ¯”å¦‚ï¼Œç°åœ¨æœ‰æœåŠ¡å™¨ A å’Œ æœåŠ¡å™¨ Bï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ B ä¸Šæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta"># æœåŠ¡å™¨ B æ‰§è¡Œè¿™æ¡å‘½ä»¤</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">replicaof</span> <span class="cm-operator">&lt;</span><span class="cm-variable">æœåŠ¡å™¨</span> <span class="cm-variable">A</span> <span class="cm-variable">çš„</span> <span class="cm-variable">IP</span> <span class="cm-variable">åœ°å€</span><span class="cm-operator">&gt;</span> <span class="cm-operator">&lt;</span><span class="cm-variable">æœåŠ¡å™¨</span> <span class="cm-variable">A</span> <span class="cm-variable">çš„</span> <span class="cm-variable">Redis</span> <span class="cm-variable">ç«¯å£å·</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æ¥ç€ï¼ŒæœåŠ¡å™¨ B å°±ä¼šå˜æˆæœåŠ¡å™¨ A çš„ã€Œä»æœåŠ¡å™¨ã€ï¼Œç„¶åä¸ä¸»æœåŠ¡å™¨è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ã€‚</span></p><p><span>ä¸»ä»æœåŠ¡å™¨é—´çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</span></p><ul><li><p><span>ç¬¬ä¸€é˜¶æ®µæ˜¯å»ºç«‹é“¾æ¥ã€åå•†åŒæ­¥ï¼Œä¸ºäº†å…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚</span></p><ul><li><p><span>æ‰§è¡Œäº† replicaof å‘½ä»¤åï¼Œä»æœåŠ¡å™¨å°±ä¼šç»™ä¸»æœåŠ¡å™¨å‘é€ </span><code>psync</code><span> å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ã€‚psync å‘½ä»¤åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯</span><strong><span>ä¸»æœåŠ¡å™¨çš„ runID</span></strong><span> å’Œ</span><strong><span>å¤åˆ¶è¿›åº¦ offset</span></strong><span>ã€‚</span></p><ul><li><p><span>runIDï¼Œæ¯ä¸ª Redis æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿäº§ä¸€ä¸ªéšæœºçš„ ID æ¥å”¯ä¸€æ ‡è¯†è‡ªå·±ã€‚å½“ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»æœåŠ¡å™¨çš„ run IDï¼Œæ‰€ä»¥å°†å…¶è®¾ç½®ä¸º &quot;?&quot;ã€‚</span></p></li><li><p><span>offsetï¼Œè¡¨ç¤ºå¤åˆ¶çš„è¿›åº¦ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œå…¶å€¼ä¸º -1ã€‚</span></p></li></ul></li><li><p><span>ä¸»æœåŠ¡å™¨æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ </span><code>FULLRESYNC</code><span> ä½œä¸ºå“åº”å‘½ä»¤è¿”å›ç»™å¯¹æ–¹ã€‚å¹¶ä¸”è¿™ä¸ªå“åº”å‘½ä»¤ä¼šå¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»æœåŠ¡å™¨çš„ runID å’Œä¸»æœåŠ¡å™¨ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetã€‚ä»æœåŠ¡å™¨æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•è¿™ä¸¤ä¸ªå€¼ã€‚FULLRESYNC å“åº”å‘½ä»¤çš„æ„å›¾æ˜¯é‡‡ç”¨</span><strong><span>å…¨é‡å¤åˆ¶</span></strong><span>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸»æœåŠ¡å™¨ä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½åŒæ­¥ç»™ä»æœåŠ¡å™¨ã€‚</span></p></li></ul><p><span>æ‰€ä»¥ï¼Œç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œæ—¶ä¸ºäº†å…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚</span></p></li><li><p><span>ç¬¬äºŒé˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨ï¼›</span></p><ul><li><p><span>ä¸»æœåŠ¡å™¨ä¼šæ‰§è¡Œ bgsave å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ã€‚ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œå› ä¸º bgsave å‘½ä»¤æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªå­è¿›ç¨‹æ¥åšç”Ÿæˆ RDB æ–‡ä»¶çš„å·¥ä½œï¼Œæ˜¯å¼‚æ­¥å·¥ä½œçš„ï¼Œè¿™æ · Redis ä¾ç„¶å¯ä»¥æ­£å¸¸å¤„ç†å‘½ä»¤ã€‚ä½†æ˜¯ï¼Œ</span><strong><span>è¿™æœŸé—´çš„å†™æ“ä½œå‘½ä»¤å¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ï¼Œè¿™æ—¶ä¸»ä»æœåŠ¡å™¨é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</span></strong><span>é‚£ä¹ˆä¸ºäº†ä¿è¯ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ï¼Œ</span><strong><span>ä¸»æœåŠ¡å™¨åœ¨ä¸‹é¢è¿™ä¸‰ä¸ªæ—¶é—´é—´éš™ä¸­å°†æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œå†™å…¥åˆ° replication buffer ç¼“å†²åŒºé‡Œ</span></strong><span>ï¼š</span></p><ul><li><p><span>ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB æ–‡ä»¶æœŸé—´ï¼›</span></p></li><li><p><span>ä¸»æœåŠ¡å™¨å‘é€ RDB æ–‡ä»¶ç»™ä»æœåŠ¡å™¨æœŸé—´ï¼›</span></p></li><li><p><span>ã€Œä»æœåŠ¡å™¨ã€åŠ è½½ RDB æ–‡ä»¶æœŸé—´ï¼›</span></p></li></ul></li><li><p><span>ä»æœåŠ¡å™¨æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰çš„æ•°æ®ï¼Œç„¶åè½½å…¥ RDB æ–‡ä»¶ã€‚</span></p></li></ul></li><li><p><span>ç¬¬ä¸‰é˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨ã€‚</span></p><ul><li><p><span>åœ¨ä¸»æœåŠ¡å™¨ç”Ÿæˆçš„ RDB æ–‡ä»¶å‘é€å®Œï¼Œä»æœåŠ¡å™¨æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œå°† RDB æ•°æ®è½½å…¥åˆ°å†…å­˜ã€‚å®Œæˆ RDB çš„è½½å…¥åï¼Œä¼šå›å¤ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ç»™ä¸»æœåŠ¡å™¨ã€‚</span></p></li><li><p><span>æ¥ç€ï¼Œä¸»æœåŠ¡å™¨å°† replication buffer ç¼“å†²åŒºé‡Œæ‰€è®°å½•çš„å†™æ“ä½œå‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ replication buffer ç¼“å†²åŒºé‡Œå‘æ¥çš„å‘½ä»¤ï¼Œè¿™æ—¶ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®å°±ä¸€è‡´äº†ã€‚</span></p></li><li><p><span>è‡³æ­¤ï¼Œä¸»ä»æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„å·¥ä½œå°±å®Œæˆäº†ã€‚</span></p></li></ul></li></ul><p><strong><span>å‘½ä»¤ä¼ æ’­</span></strong></p><p><span>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥åï¼ŒåŒæ–¹ä¹‹é—´å°±ä¼šç»´æŠ¤ä¸€ä¸ª TCP è¿æ¥ã€‚</span></p><p><span>åç»­ä¸»æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥ç»§ç»­å°†å†™æ“ä½œå‘½ä»¤ä¼ æ’­ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½¿å¾—ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ç›¸åŒã€‚</span></p><p><span>è€Œä¸”è¿™ä¸ªè¿æ¥æ˜¯é•¿è¿æ¥çš„ï¼Œç›®çš„æ˜¯é¿å…é¢‘ç¹çš„ TCP è¿æ¥å’Œæ–­å¼€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</span></p><p><span>ä¸Šé¢çš„è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º</span><strong><span>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</span></strong><span>ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥ä¿è¯ç¬¬ä¸€æ¬¡åŒæ­¥åçš„ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</span></p><p>&nbsp;</p><p><span>ä¸»æœåŠ¡å™¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªä»æœåŠ¡å™¨çš„ï¼Œå¦‚æœä»æœåŠ¡å™¨æ•°é‡éå¸¸å¤šï¼Œè€Œä¸”éƒ½ä¸ä¸»æœåŠ¡å™¨è¿›è¡Œå…¨é‡åŒæ­¥çš„è¯ï¼Œå°±ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</span></p><ul><li><p><span>ç”±äºæ˜¯é€šè¿‡ bgsave å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°±ä¼šå¿™äºä½¿ç”¨ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœä¸»æœåŠ¡å™¨çš„å†…å­˜æ•°æ®éå¤§ï¼Œåœ¨æ‰§è¡Œ fork() å‡½æ•°æ—¶æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œä»è€Œä½¿å¾— Redis æ— æ³•æ­£å¸¸å¤„ç†è¯·æ±‚ï¼›</span></p></li><li><p><span>ä¼ è¾“ RDB æ–‡ä»¶ä¼šå ç”¨ä¸»æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ï¼Œä¼šå¯¹ä¸»æœåŠ¡å™¨å“åº”å‘½ä»¤è¯·æ±‚äº§ç”Ÿå½±å“ã€‚</span></p></li></ul><p><span>Redis ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä»æœåŠ¡å™¨å¯ä»¥æœ‰è‡ªå·±çš„ä»æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‹¥æœ‰ä»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨å½“ä½œç»ç†è§’è‰²ï¼Œå®ƒä¸ä»…å¯ä»¥æ¥æ”¶ä¸»æœåŠ¡å™¨çš„åŒæ­¥æ•°æ®ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥åŒæ—¶ä½œä¸ºä¸»æœåŠ¡å™¨çš„å½¢å¼å°†æ•°æ®åŒæ­¥ç»™ä»æœåŠ¡å™¨.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">replicaof</span> <span class="cm-operator">&lt;</span><span class="cm-variable">ç›®æ ‡æœåŠ¡å™¨çš„IP</span><span class="cm-operator">&gt;</span> <span class="cm-number">6379</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>å¢é‡å¤åˆ¶</span></strong></p><p><span>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥åï¼Œå°±ä¼šåŸºäºé•¿è¿æ¥è¿›è¡Œå‘½ä»¤ä¼ æ’­ã€‚å¦‚æœä¸»ä»æœåŠ¡å™¨é—´çš„ç½‘ç»œè¿æ¥æ–­å¼€äº†ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œå‘½ä»¤ä¼ æ’­äº†ï¼Œè¿™æ—¶ä»æœåŠ¡å™¨çš„æ•°æ®å°±æ²¡åŠæ³•å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´äº†ï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½ä»ã€Œä»æœåŠ¡å™¨ã€è¯»åˆ°æ—§çš„æ•°æ®ã€‚</span></p><p><span>åœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»æœåŠ¡å™¨åœ¨å‘½ä»¤åŒæ­¥æ—¶å‡ºç°äº†ç½‘ç»œæ–­å¼€åˆæ¢å¤çš„æƒ…å†µï¼Œä»æœåŠ¡å™¨å°±ä¼šå’Œä¸»æœåŠ¡å™¨é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¾ˆæ˜æ˜¾è¿™æ ·çš„å¼€é”€å¤ªå¤§äº†ï¼Œå¿…é¡»è¦æ”¹è¿›ä¸€æ³¢ã€‚</span></p><p><span>æ‰€ä»¥ï¼Œä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­å¼€åˆæ¢å¤åï¼Œä»ä¸»ä»æœåŠ¡å™¨ä¼šé‡‡ç”¨</span><strong><span>å¢é‡å¤åˆ¶</span></strong><span>çš„æ–¹å¼ç»§ç»­åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åªä¼šæŠŠç½‘ç»œæ–­å¼€æœŸé—´ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»æœåŠ¡å™¨ã€‚</span></p><p><strong><span>ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</span></strong></p><ul><li><p><span>ä»æœåŠ¡å™¨åœ¨æ¢å¤ç½‘ç»œåï¼Œä¼šå‘é€ psync å‘½ä»¤ç»™ä¸»æœåŠ¡å™¨ï¼Œæ­¤æ—¶çš„ psync å‘½ä»¤é‡Œçš„ offset å‚æ•°ä¸æ˜¯ -1ï¼›</span></p></li><li><p><span>ä¸»æœåŠ¡å™¨æ”¶åˆ°è¯¥å‘½ä»¤åï¼Œç„¶åç”¨ CONTINUE å“åº”å‘½ä»¤å‘Šè¯‰ä»æœåŠ¡å™¨æ¥ä¸‹æ¥é‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼åŒæ­¥æ•°æ®ï¼›</span></p></li><li><p><span>ç„¶åä¸»æœåŠ¡å°†ä¸»ä»æœåŠ¡å™¨æ–­çº¿æœŸé—´ï¼Œæ‰€æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚</span></p></li></ul><p><strong><span>ä¸»æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“è¦å°†å“ªäº›å¢é‡æ•°æ®å‘é€ç»™ä»æœåŠ¡å™¨å‘¢ï¼Ÿ</span></strong></p><ul><li><p><strong><span>repl_backlog_buffer</span></strong><span>ï¼Œæ˜¯ä¸€ä¸ªã€Œ</span><strong><span>ç¯å½¢</span></strong><span>ã€ç¼“å†²åŒºï¼Œç”¨äºä¸»ä»æœåŠ¡å™¨æ–­è¿åï¼Œä»ä¸­æ‰¾åˆ°å·®å¼‚çš„æ•°æ®ï¼›</span></p></li><li><p><strong><span>replication offset</span></strong><span>ï¼Œæ ‡è®°ä¸Šé¢é‚£ä¸ªç¼“å†²åŒºçš„åŒæ­¥è¿›åº¦ï¼Œä¸»ä»æœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„åç§»é‡ï¼Œä¸»æœåŠ¡å™¨ä½¿ç”¨ master_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ</span><em><span>å†™</span></em><span>ã€åˆ°çš„ä½ç½®ï¼Œä»æœåŠ¡å™¨ä½¿ç”¨ slave_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ</span><em><span>è¯»</span></em><span>ã€åˆ°çš„ä½ç½®ã€‚</span></p></li></ul><p><strong><span>é‚£ repl_backlog_buffer ç¼“å†²åŒºæ˜¯ä»€ä¹ˆæ—¶å€™å†™å…¥çš„å‘¢ï¼Ÿ</span></strong></p><p><span>åœ¨ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥åˆ° repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œå› æ­¤ è¿™ä¸ªç¼“å†²åŒºé‡Œä¼šä¿å­˜ç€æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ã€‚</span></p><p><span>ç½‘ç»œæ–­å¼€åï¼Œå½“ä»æœåŠ¡å™¨é‡æ–°è¿ä¸Šä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡ psync å‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡ slave_repl_offset å‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨æ ¹æ®è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®è·ï¼Œç„¶åæ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå“ªç§åŒæ­¥æ“ä½œï¼š</span></p><ul><li><p><span>å¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¿˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨</span><strong><span>å¢é‡åŒæ­¥</span></strong><span>çš„æ–¹å¼ï¼›</span></p></li><li><p><span>ç›¸åï¼Œå¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®å·²ç»ä¸å­˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨</span><strong><span>å…¨é‡åŒæ­¥</span></strong><span>çš„æ–¹å¼ã€‚</span></p></li></ul><p><span>repl_backlog_buffer ç¼“è¡Œç¼“å†²åŒºçš„é»˜è®¤å¤§å°æ˜¯ 1Mï¼Œå¹¶ä¸”ç”±äºå®ƒæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ‰€ä»¥å½“ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»æœåŠ¡å™¨ç»§ç»­å†™å…¥çš„è¯ï¼Œå°±ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚å› æ­¤ï¼Œå½“ä¸»æœåŠ¡å™¨çš„å†™å…¥é€Ÿåº¦è¿œè¶…äºä»æœåŠ¡å™¨çš„è¯»å–é€Ÿåº¦ï¼Œç¼“å†²åŒºçš„æ•°æ®ä¸€ä¸‹å°±ä¼šè¢«è¦†ç›–ã€‚</span></p><h2 id='æ€ä¹ˆåˆ¤æ–­-redis-æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ'><span>æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</span></h2><p><span>Redis åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡äº’ç›¸çš„ ping-pong å¿ƒæ€æ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å» ping ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰ pong å›åº”ï¼Œé›†ç¾¤å°±ä¼šè®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¼šæ–­å¼€ä¸è¿™ä¸ªèŠ‚ç‚¹çš„è¿æ¥ã€‚</span></p><p><span>Redis ä¸»ä»èŠ‚ç‚¹å‘é€çš„å¿ƒæ€é—´éš”æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸”ä½œç”¨ä¹Ÿæœ‰ä¸€ç‚¹åŒºåˆ«ï¼š</span></p><ul><li><p><span>Redis ä¸»èŠ‚ç‚¹é»˜è®¤æ¯éš” 10 ç§’å¯¹ä»èŠ‚ç‚¹å‘é€ ping å‘½ä»¤ï¼Œåˆ¤æ–­ä»èŠ‚ç‚¹çš„å­˜æ´»æ€§å’Œè¿æ¥çŠ¶æ€ï¼Œå¯é€šè¿‡å‚æ•°repl-ping-slave-periodæ§åˆ¶å‘é€é¢‘ç‡ã€‚</span></p></li><li><p><span>Redis ä»èŠ‚ç‚¹æ¯éš” 1 ç§’å‘é€ replconf ack{offset} å‘½ä»¤ï¼Œç»™ä¸»èŠ‚ç‚¹ä¸ŠæŠ¥è‡ªèº«å½“å‰çš„å¤åˆ¶åç§»é‡ï¼Œç›®çš„æ˜¯ä¸ºäº†ï¼š</span></p><ul><li><p><span>å®æ—¶ç›‘æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€ï¼›</span></p></li><li><p><span>ä¸ŠæŠ¥è‡ªèº«å¤åˆ¶åç§»é‡ï¼Œ æ£€æŸ¥å¤åˆ¶æ•°æ®æ˜¯å¦ä¸¢å¤±ï¼Œ å¦‚æœä»èŠ‚ç‚¹æ•°æ®ä¸¢å¤±ï¼Œ å†ä»ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºä¸­æ‹‰å–ä¸¢å¤±æ•°æ®ã€‚</span></p></li></ul></li></ul><h2 id='ä¸»ä»å¤åˆ¶æ¶æ„ä¸­è¿‡æœŸkeyå¦‚ä½•å¤„ç†'><span>ä¸»ä»å¤åˆ¶æ¶æ„ä¸­ï¼Œè¿‡æœŸkeyå¦‚ä½•å¤„ç†ï¼Ÿ</span></h2><p><span>ä¸»èŠ‚ç‚¹å¤„ç†äº†ä¸€ä¸ªkeyæˆ–è€…é€šè¿‡æ·˜æ±°ç®—æ³•æ·˜æ±°äº†ä¸€ä¸ªkeyï¼Œè¿™ä¸ªæ—¶é—´ä¸»èŠ‚ç‚¹æ¨¡æ‹Ÿä¸€æ¡delå‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ”¶åˆ°è¯¥å‘½ä»¤åï¼Œå°±è¿›è¡Œåˆ é™¤keyçš„æ“ä½œã€‚</span></p><h2 id='redis-æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶'><span>Redis æ˜¯åŒæ­¥å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Ÿ</span></h2><p><span>Redis ä¸»èŠ‚ç‚¹æ¯æ¬¡æ”¶åˆ°å†™å‘½ä»¤ä¹‹åï¼Œå…ˆå†™åˆ°å†…éƒ¨çš„ç¼“å†²åŒºï¼Œç„¶åå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</span></p><h2 id='ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª-bufferreplication-buffer-repl-backlog-bufferæœ‰ä»€ä¹ˆåŒºåˆ«'><span>ä¸»ä»å¤åˆ¶ä¸­ä¸¤ä¸ª Buffer(replication buffer ã€repl backlog buffer)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></h2><p><span>replication buffer ã€repl backlog buffer åŒºåˆ«å¦‚ä¸‹ï¼š</span></p><ul><li><p><span>å‡ºç°çš„é˜¶æ®µä¸ä¸€æ ·ï¼š</span></p><ul><li><p><span>repl backlog buffer æ˜¯åœ¨å¢é‡å¤åˆ¶é˜¶æ®µå‡ºç°ï¼Œ</span><strong><span>ä¸€ä¸ªä¸»èŠ‚ç‚¹åªåˆ†é…ä¸€ä¸ª repl backlog buffer</span></strong><span>ï¼›</span></p></li><li><p><span>replication buffer æ˜¯åœ¨å…¨é‡å¤åˆ¶é˜¶æ®µå’Œå¢é‡å¤åˆ¶é˜¶æ®µéƒ½ä¼šå‡ºç°ï¼Œ</span><strong><span>ä¸»èŠ‚ç‚¹ä¼šç»™æ¯ä¸ªæ–°è¿æ¥çš„ä»èŠ‚ç‚¹ï¼Œåˆ†é…ä¸€ä¸ª replication buffer</span></strong><span>ï¼›</span></p></li></ul></li><li><p><span>è¿™ä¸¤ä¸ª Buffer éƒ½æœ‰å¤§å°é™åˆ¶çš„ï¼Œå½“ç¼“å†²åŒºæ»¡äº†ä¹‹åï¼Œå‘ç”Ÿçš„äº‹æƒ…ä¸ä¸€æ ·ï¼š</span></p><ul><li><p><span>å½“ repl backlog buffer æ»¡äº†ï¼Œå› ä¸ºæ˜¯ç¯å½¢ç»“æ„ï¼Œä¼šç›´æ¥</span><strong><span>è¦†ç›–èµ·å§‹ä½ç½®æ•°æ®</span></strong><span>;</span></p></li><li><p><span>å½“ replication buffer æ»¡äº†ï¼Œä¼šå¯¼è‡´è¿æ¥æ–­å¼€ï¼Œåˆ é™¤ç¼“å­˜ï¼Œä»èŠ‚ç‚¹é‡æ–°è¿æ¥ï¼Œ</span><strong><span>é‡æ–°å¼€å§‹å…¨é‡å¤åˆ¶</span></strong><span>ã€‚</span></p></li></ul></li></ul><h2 id='å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´'><span>å¦‚ä½•åº”å¯¹ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Ÿ</span></h2><p><span>ä¹‹æ‰€ä»¥ä¼šå‡ºç°ä¸»ä»æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼Œæ˜¯</span><strong><span>å› ä¸ºä¸»ä»èŠ‚ç‚¹é—´çš„å‘½ä»¤å¤åˆ¶æ˜¯å¼‚æ­¥è¿›è¡Œçš„</span></strong><span>ï¼Œæ‰€ä»¥æ— æ³•å®ç°å¼ºä¸€è‡´æ€§ä¿è¯ï¼ˆä¸»ä»æ•°æ®æ—¶æ—¶åˆ»åˆ»ä¿æŒä¸€è‡´ï¼‰ã€‚</span></p><p><span>å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸»ä»èŠ‚ç‚¹å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹æ”¶åˆ°æ–°çš„å†™å‘½ä»¤åï¼Œä¼šå‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œä¸»èŠ‚ç‚¹å¹¶ä¸ä¼šç­‰åˆ°ä»èŠ‚ç‚¹å®é™…æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸»èŠ‚ç‚¹è‡ªå·±åœ¨æœ¬åœ°æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ç»“æœäº†ã€‚å¦‚æœä»èŠ‚ç‚¹è¿˜æ²¡æœ‰æ‰§è¡Œä¸»èŠ‚ç‚¹åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ï¼Œä¸»ä»èŠ‚ç‚¹é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</span></p><p><span>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œé¿å…ä¸»ä»èŠ‚ç‚¹åœ¨ä¸åŒçš„æœºæˆ¿ã€‚</span></p><p><span>ç¬¬äºŒç§æ–¹æ³•ï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªå¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦ã€‚å…·ä½“åšæ³•ï¼š</span></p><ul><li><p><span>Redis çš„ INFO replication å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»èŠ‚ç‚¹æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆmaster_repl_offsetï¼‰å’Œä»èŠ‚ç‚¹å¤åˆ¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆslave_repl_offsetï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å‘ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œå…ˆç”¨ INFO replication å‘½ä»¤æŸ¥åˆ°ä¸»ã€ä»èŠ‚ç‚¹çš„è¿›åº¦ï¼Œç„¶åï¼Œæˆ‘ä»¬ç”¨ master_repl_offset å‡å» slave_repl_offsetï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°ä»èŠ‚ç‚¹å’Œä¸»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦å·®å€¼äº†ã€‚</span></p></li><li><p><span>å¦‚æœæŸä¸ªä»èŠ‚ç‚¹çš„è¿›åº¦å·®å€¼å¤§äºæˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯ä¸å†å’Œè¿™ä¸ªä»èŠ‚ç‚¹è¿æ¥è¿›è¡Œæ•°æ®è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œä¸ºäº†é¿å…å‡ºç°å®¢æˆ·ç«¯å’Œæ‰€æœ‰ä»èŠ‚ç‚¹éƒ½ä¸èƒ½è¿æ¥çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤åˆ¶è¿›åº¦å·®å€¼çš„é˜ˆå€¼è®¾ç½®å¾—å¤§ä¸€äº›ã€‚</span></p></li></ul><h2 id='ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±'><span>ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</span></h2><p><span>ä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ•°æ®ä¸¢å¤±çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</span></p><ul><li><p><strong><span>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</span></strong></p><ul><li><p><span>å¯¹äº Redis ä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼Œæ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼Œå½“å®¢æˆ·ç«¯å‘é€å†™è¯·æ±‚ç»™ä¸»èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šè¿”å› okï¼Œæ¥ç€ä¸»èŠ‚ç‚¹å°†å†™è¯·æ±‚å¼‚æ­¥åŒæ­¥ç»™å„ä¸ªä»èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹è¿˜æ²¡æ¥å¾—åŠåŒæ­¥ç»™ä»èŠ‚ç‚¹æ—¶å‘ç”Ÿäº†æ–­ç”µï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚</span></p></li><li><p><span>Redis é…ç½®é‡Œæœ‰ä¸€ä¸ªå‚æ•° min-slaves-max-lagï¼Œè¡¨ç¤ºä¸€æ—¦æ‰€æœ‰çš„ä»èŠ‚ç‚¹æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿéƒ½è¶…è¿‡äº† min-slaves-max-lag å®šä¹‰çš„å€¼ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°±ä¼šæ‹’ç»æ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚å‡è®¾å°† min-slaves-max-lag é…ç½®ä¸º 10s åï¼Œæ ¹æ®ç›®å‰ master-&gt;slave çš„å¤åˆ¶é€Ÿåº¦ï¼Œå¦‚æœæ•°æ®åŒæ­¥å®Œæˆæ‰€éœ€è¦æ—¶é—´è¶…è¿‡10sï¼Œå°±ä¼šè®¤ä¸º master æœªæ¥å®•æœºåæŸå¤±çš„æ•°æ®ä¼šå¾ˆå¤šï¼Œmaster å°±æ‹’ç»å†™å…¥æ–°è¯·æ±‚ã€‚è¿™æ ·å°±èƒ½å°† master å’Œ slave æ•°æ®å·®æ§åˆ¶åœ¨10så†…ï¼Œå³ä½¿ master å®•æœºä¹Ÿåªæ˜¯è¿™æœªå¤åˆ¶çš„ 10s æ•°æ®ã€‚é‚£ä¹ˆå¯¹äºå®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯å‘ç° master ä¸å¯å†™åï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–é™çº§æªæ–½ï¼Œå°†æ•°æ®æš‚æ—¶å†™å…¥æœ¬åœ°ç¼“å­˜å’Œç£ç›˜ä¸­ï¼Œåœ¨ä¸€æ®µæ—¶é—´ï¼ˆç­‰ master æ¢å¤æ­£å¸¸ï¼‰åé‡æ–°å†™å…¥ master æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥ kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ master æ¢å¤æ­£å¸¸ï¼Œå†éš”ä¸€æ®µæ—¶é—´å»æ¶ˆè´¹ kafka ä¸­çš„æ•°æ®ï¼Œè®©å°†æ•°æ®é‡æ–°å†™å…¥ master ã€‚</span></p></li></ul></li><li><p><strong><span>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±</span></strong></p><ul><li><p><span>ç”±äºç½‘ç»œé—®é¢˜ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¤±å»è”ç³»ã€‚ä¸»ä»æ•°æ®ä¸åŒæ­¥ï¼›é‡æ–°å¹³è¡¡é€‰ä¸¾ï¼Œäº§ç”Ÿä¸¤ä¸ªä¸»æœåŠ¡ã€‚ç­‰ç½‘ç»œæ¢å¤ï¼Œæ—§ä¸»èŠ‚ç‚¹ä¼šé™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œå†ä¸æ–°ä¸»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„æ—¶å€™ï¼Œç”±äºä¼šä»èŠ‚ç‚¹ä¼šæ¸…ç©ºè‡ªå·±çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥å¯¼è‡´ä¹‹å‰å®¢æˆ·ç«¯å†™å…¥çš„æ•°æ®ä¸¢å¤±äº†ã€‚</span></p></li><li><p><span>å½“ä¸»èŠ‚ç‚¹å‘ç°ã€Œä»èŠ‚ç‚¹ä¸‹çº¿çš„æ•°é‡å¤ªå¤šã€ï¼Œæˆ–è€…ã€Œç½‘ç»œå»¶è¿Ÿå¤ªå¤§ã€çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ“ä½œï¼Œç›´æ¥æŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</span></p></li><li><p><span>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è®¾ç½®ï¼š</span></p><ul><li><p><span>min-slaves-to-write xï¼Œä¸»èŠ‚ç‚¹å¿…é¡»è¦æœ‰</span><strong><span>è‡³å°‘ x ä¸ªä»èŠ‚ç‚¹è¿æ¥</span></strong><span>ï¼Œå¦‚æœå°äºè¿™ä¸ªæ•°ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚</span></p></li><li><p><span>min-slaves-max-lag xï¼Œä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿ</span><strong><span>ä¸èƒ½è¶…è¿‡ x ç§’</span></strong><span>ï¼Œå¦‚æœä¸»ä»åŒæ­¥çš„å»¶è¿Ÿè¶…è¿‡ x ç§’ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚</span></p></li><li><p><span>æˆ‘ä»¬å¯ä»¥æŠŠ min-slaves-to-write å’Œ min-slaves-max-lag è¿™ä¸¤ä¸ªé…ç½®é¡¹æ­é…èµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€å®šçš„é˜ˆå€¼ï¼Œå‡è®¾ä¸º N å’Œ Tã€‚è¿™ä¸¤ä¸ªé…ç½®é¡¹ç»„åˆåçš„è¦æ±‚æ˜¯ï¼Œ</span><strong><span>ä¸»èŠ‚ç‚¹è¿æ¥çš„ä»èŠ‚ç‚¹ä¸­è‡³å°‘æœ‰ N ä¸ªä»èŠ‚ç‚¹ï¼Œã€Œå¹¶ä¸”ã€ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’</span></strong><span>ï¼Œå¦åˆ™ï¼Œä¸»èŠ‚ç‚¹å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™è¯·æ±‚äº†ã€‚</span></p></li></ul></li></ul></li></ul><p><span>æˆ‘ä»¬ä¸å¯èƒ½ä¿è¯æ•°æ®å®Œå…¨ä¸ä¸¢å¤±ï¼Œåªèƒ½åšåˆ°ä½¿å¾—å°½é‡å°‘çš„æ•°æ®ä¸¢å¤±ã€‚</span></p><h1 id='å…«å“¨å…µ'><span>å…«ã€å“¨å…µ</span></h1><p><span>å“¨å…µ(sentinel) æ˜¯ä¸€ä¸ª</span><strong><span>åˆ†å¸ƒå¼ç³»ç»Ÿ</span></strong><span>ï¼Œç”¨äºå¯¹ä¸»ä»ç»“æ„ä¸­çš„æ¯å°æœåŠ¡å™¨è¿›è¡Œ</span><strong><span>ç›‘æ§</span></strong><span>ï¼Œå½“å‡ºç°æ•…éšœæ—¶é€šè¿‡æŠ•ç¥¨æœºåˆ¶</span><strong><span>é€‰æ‹©</span></strong><span>æ–°çš„masterå¹¶å°†æ‰€æœ‰slaveè¿æ¥åˆ°æ–°çš„masterã€‚</span></p><p><span>ä½œç”¨ï¼š</span></p><ul><li><p><span>ç›‘æ§</span></p><ul><li><p><span>ä¸æ–­çš„æ£€æŸ¥masterå’Œslaveæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ masterå­˜æ´»æ£€æµ‹ã€masterä¸slaveè¿è¡Œæƒ…å†µæ£€æµ‹</span></p></li></ul></li><li><p><span>é€šçŸ¥ï¼ˆæé†’ï¼‰</span></p><ul><li><p><span>å½“è¢«ç›‘æ§çš„æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå‘å…¶ä»–ï¼ˆå“¨å…µé—´ï¼Œå®¢æˆ·ç«¯ï¼‰å‘é€é€šçŸ¥ã€‚</span></p></li></ul></li><li><p><span>è‡ªåŠ¨æ•…éšœè½¬ç§»</span></p><ul><li><p><span>æ–­å¼€masterä¸slaveè¿æ¥ï¼Œé€‰å–ä¸€ä¸ªslaveä½œä¸ºmasterï¼Œå°†å…¶ä»–slaveè¿æ¥åˆ°æ–°çš„masterï¼Œå¹¶å‘ŠçŸ¥å®¢æˆ·ç«¯æ–°çš„æœåŠ¡å™¨åœ°å€ã€‚</span></p></li></ul></li></ul><p><span>å“¨å…µä¹Ÿæ˜¯ä¸€å°</span><strong><span>redisæœåŠ¡å™¨</span></strong><span>ï¼Œåªæ˜¯ä¸æä¾›æ•°æ®æœåŠ¡ é€šå¸¸å“¨å…µé…ç½®æ•°é‡ä¸º</span><strong><span>å•æ•°</span></strong><span>ã€‚</span></p><p><span>å“¨å…µåœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ç»å†ä¸‰ä¸ªé˜¶æ®µï¼š</span></p><ul><li><p><span>ç›‘æ§</span></p></li><li><p><span>é€šçŸ¥</span></p></li><li><p><span>æ•…éšœè½¬ç§»</span></p></li></ul><h2 id='81-ç›‘æ§'><span>8.1 ç›‘æ§</span></h2><p><strong><span>ç”¨äºåŒæ­¥å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼š</span></strong></p><ul><li><p><span>å“¨å…µä¼šæ¯éš” 1 ç§’ç»™æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹å‘é€ PING å‘½ä»¤ï¼Œå½“ä¸»ä»èŠ‚ç‚¹æ”¶åˆ° PING å‘½ä»¤åï¼Œä¼šå‘é€ä¸€ä¸ªå“åº”å‘½ä»¤ç»™å“¨å…µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰</span></p></li><li><p><span>è·å–masterçš„çŠ¶æ€ï¼šInfoæŒ‡ä»¤,å¹¶å»ºç«‹cmdè¿æ¥</span></p><ul><li><p><span>è·å–masterçš„å±æ€§ï¼šrunidä»¥åŠä»–å½“å‰çš„è§’è‰²(master);</span></p></li><li><p><span>è·å–åˆ°è¿æ¥åˆ°masterçš„å„ä¸ªslaveçš„ä¿¡æ¯</span></p></li></ul></li><li><p><span>æ ¹æ®masterå¾—åˆ°slaveä¹‹åå°±å»è·å–slaveçš„ä¿¡æ¯(é€šè¿‡å‘é€infoæŒ‡ä»¤)</span></p><ul><li><p><span>è·å–slaveçš„å±æ€§ï¼šrunid,å½“å‰çš„è§’è‰²(slave), master_host, master_port,  offset.....</span></p></li></ul></li></ul><h2 id='82-é€šçŸ¥'><span>8.2 é€šçŸ¥</span></h2><ul><li><p><span>å„ä¸ªå“¨å…µå°†å¾—åˆ°çš„ä¿¡æ¯ç›¸äº’åŒæ­¥ï¼ˆä¿¡æ¯å¯¹ç§°ï¼‰</span></p></li><li><p><span>å“¨å…µå®æ—¶çš„é€šè¿‡cmdè¿æ¥å‘masterå’Œslaveå‘é€helloè·å–masterå’Œslaveçš„çŠ¶æ€ï¼Œå¹¶åŒæ­¥ç»™å…¶ä»–å“¨å…µã€‚</span></p></li></ul><p><img src="./images/å“¨å…µä¿¡æ¯åŒæ­¥.png" referrerpolicy="no-referrer" alt="å“¨å…µä¿¡æ¯åŒæ­¥.png"></p><h2 id='83-æ•…éšœè½¬ç§»'><span>8.3 æ•…éšœè½¬ç§»</span></h2><p><span>---------------------------------------------------------------ç¡®è®¤masterä¸‹çº¿------------------------------------------------------------------------------------------</span></p><ul><li><p><span>å“¨å…µä¼šæ¯éš” 1 ç§’ç»™æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹å‘é€ PING å‘½ä»¤ï¼Œå½“ä¸»ä»èŠ‚ç‚¹æ”¶åˆ° PING å‘½ä»¤åï¼Œä¼šå‘é€ä¸€ä¸ªå“åº”å‘½ä»¤ç»™å“¨å…µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰</span></p></li><li><p><span>å¦‚æœä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å®ƒä»¬æ ‡è®°ä¸ºã€Œ</span><strong><span>ä¸»è§‚ä¸‹çº¿</span></strong><span>ã€ã€‚è¿™ä¸ªã€Œè§„å®šçš„æ—¶é—´ã€æ˜¯é…ç½®é¡¹ </span><code>down-after-milliseconds</code><span> å‚æ•°è®¾å®šçš„ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</span></p></li><li><p><span>å½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</span></p></li><li><p><span>å“¨å…µåˆ¤æ–­å®Œä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œå“¨å…µå°±è¦å¼€å§‹åœ¨å¤šä¸ªã€Œä»èŠ‚ç‚¹ã€ä¸­ï¼Œé€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹æ¥åšæ–°ä¸»èŠ‚ç‚¹ã€‚</span></p></li></ul><p><span>------------------------------------------------------------------- æ¨é€‰å“¨å…µå¤„ç†---------------------------------------------------------------------------------------------</span></p><ul><li><p><span>åœ¨ç¡®è®¤masteræŒ‚æ‰ä»¥åï¼Œä¼šæ¨é€‰å‡ºä¸€ä¸ªå“¨å…µæ¥è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œï¼ˆç”±è¯¥å“¨å…µæ¥æŒ‡å®šå“ªä¸ªslaveæ¥åšæ–°çš„masterï¼‰ã€‚</span></p></li><li><p><span>ç­›é€‰æ–¹å¼æ˜¯å“¨å…µäº’ç›¸å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”å‚ä¸æŠ•ç¥¨ï¼Œç¥¨å¤šè€…å½“é€‰ã€‚</span></p><ul><li><p><span>å€™é€‰è€…ä¼šå‘å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›æˆä¸º Leader æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µå¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ã€‚æ¯ä¸ªå“¨å…µåªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼šï¼Œå¦‚æœç”¨å®Œåå°±ä¸èƒ½å‚ä¸æŠ•ç¥¨äº†ï¼Œå¯ä»¥æŠ•ç»™è‡ªå·±æˆ–æŠ•ç»™åˆ«äººï¼Œä½†æ˜¯åªæœ‰å€™é€‰è€…æ‰èƒ½æŠŠç¥¨æŠ•ç»™è‡ªå·±ã€‚</span></p></li><li><p><span>é‚£ä¹ˆåœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªã€Œå€™é€‰è€…ã€ï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</span></p></li><li><p><span>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</span></p></li><li><p><span>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</span></p></li></ul></li></ul><p><span>--------------------------------------------------------------------å…·ä½“å¤„ç†è¿‡ç¨‹-----------------------------------------------------------------------------------------------</span></p><ul><li><p><span>æœåŠ¡å™¨åˆ—è¡¨ä¸­æŒ‘é€‰å¤‡é€‰master</span></p><ul><li><p><span>å»æ‰ä¸åœ¨çº¿çš„</span></p></li><li><p><span>å»æ‰å“åº”æ…¢çš„</span></p></li><li><p><span>å»æ‰ä¸åŸmasteræ–­å¼€æ—¶é—´ä¹…çš„</span></p></li><li><p><span>ä¼˜å…ˆåŸåˆ™</span></p><ul><li><p><span>å…ˆæ¯”è¾ƒä¼˜å…ˆçº§: Redis æœ‰ä¸ªå« slave-priority é…ç½®é¡¹ï¼Œå¯ä»¥ç»™ä»èŠ‚ç‚¹è®¾ç½®ä¼˜å…ˆçº§ã€‚</span></p></li><li><p><span>å†çœ‹åç§»é‡ï¼Œåç§»é‡å¤§å°±è¯´æ˜åŒæ­¥çš„æ•°æ®æ¯”è¾ƒå¤šã€‚ä»èŠ‚ç‚¹ä¼šç”¨ slave_repl_offset è¿™ä¸ªå€¼è®°å½•å½“å‰çš„å¤åˆ¶è¿›åº¦ï¼ˆå¦‚ä¸‹å›¾ä¸­çš„ã€Œä»æœåŠ¡å™¨è¦è¯»çš„ä½ç½®ã€çš„ä½ç½®ï¼‰ã€‚</span></p></li><li><p><span>å¦‚æœä¼˜å…ˆçº§å’Œä¸‹æ ‡éƒ½ç›¸åŒï¼Œé€‰æ‹©runidå°çš„</span></p></li></ul></li></ul></li><li><p><span>å“¨å…µå‘é€æŒ‡ä»¤</span></p><ul><li><p><span>å‘æ–°çš„masterå‘é€</span><strong><span>slaveof no one</span></strong><span>(æ–­å¼€ä¸åŸmasterçš„è¿æ¥)</span></p></li><li><p><span>å‘å…¶ä»–slaveå‘é€slaveof æ–°masterIPç«¯å£ï¼ˆè®©å…¶ä»–slaveä¸æ–°çš„masterç›¸è¿ï¼‰</span></p></li></ul></li><li><p><span>é€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹å·²å˜åŒ–</span></p><ul><li><p><span>å®¢æˆ·ç«¯å’Œå“¨å…µå»ºç«‹è¿æ¥åï¼Œå®¢æˆ·ç«¯ä¼šè®¢é˜…å“¨å…µæä¾›çš„é¢‘é“ã€‚</span><strong><span>ä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œå“¨å…µå°±ä¼šå‘ </span><code>+switch-master</code><span> é¢‘é“å‘å¸ƒæ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯å°±å¯ä»¥æ”¶åˆ°è¿™æ¡ä¿¡æ¯ï¼Œç„¶åç”¨è¿™é‡Œé¢çš„æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£è¿›è¡Œé€šä¿¡äº†</span></strong><span>ã€‚</span></p></li><li><p><span>é€šè¿‡å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶æœºåˆ¶ï¼Œæœ‰äº†è¿™äº›äº‹ä»¶é€šçŸ¥ï¼Œå®¢æˆ·ç«¯ä¸ä»…å¯ä»¥åœ¨ä¸»ä»åˆ‡æ¢åå¾—åˆ°æ–°ä¸»èŠ‚ç‚¹çš„è¿æ¥ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç›‘æ§åˆ°ä¸»ä»èŠ‚ç‚¹åˆ‡æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å„ä¸ªé‡è¦äº‹ä»¶ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥çŸ¥é“ä¸»ä»åˆ‡æ¢è¿›è¡Œåˆ°å“ªä¸€æ­¥äº†ï¼Œæœ‰åŠ©äºäº†è§£åˆ‡æ¢è¿›åº¦ã€‚</span></p></li></ul></li><li><p><span>æ•…éšœè½¬ç§»æ“ä½œæœ€åè¦åšçš„æ˜¯ï¼Œç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“æ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå“¨å…µé›†ç¾¤å°±ä¼šå‘å®ƒå‘é€ </span><code>SLAVEOF</code><span> å‘½ä»¤ï¼Œè®©å®ƒæˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚</span></p></li></ul><h1 id='ä¹é›†ç¾¤'><span>ä¹ã€é›†ç¾¤</span></h1><p><span>ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ï¼Ÿ</span></p><ul><li><p><span>redisæä¾›çš„æœåŠ¡OPSå¯ä»¥è¾¾åˆ°10ä¸‡/ç§’ï¼Œå½“å‰ä¸šåŠ¡OPSå·²ç»è¾¾åˆ°10ä¸‡/ç§’ </span></p></li><li><p><span>å†…å­˜å•æœºå®¹é‡è¾¾åˆ°256Gï¼Œå½“å‰ä¸šåŠ¡éœ€æ±‚å†…å­˜å®¹é‡1T</span></p></li><li><p><span>ä½¿ç”¨å•ä¸ªæœåŠ¡å™¨æ— æ³•å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œéœ€è¦å°†æ•°æ®åˆ†æ•£åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚</span></p></li></ul><p><span>ä½œç”¨ï¼š</span></p><ul><li><p><span>åˆ†æ•£å•å°æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œå®ç°</span><strong><span>è´Ÿè½½å‡è¡¡</span></strong></p></li><li><p><span>åˆ†æ•£å•å°æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ï¼Œå®ç°</span><strong><span>å¯æ‰©å±•æ€§</span></strong></p></li><li><p><strong><span>é™ä½</span></strong><span>å•å°æœåŠ¡å™¨å®•æœºå¸¦æ¥çš„</span><strong><span>ä¸šåŠ¡ç¾éš¾</span></strong></p></li></ul><h3 id='91-redis-cluster'><span>9.1 </span><strong><span>Redis Cluster</span></strong></h3><h4 id='911-redis-é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜'><span>9.1.1 Redis é›†ç¾¤æ–¹æ¡ˆçš„æ¼”å˜</span></h4><p><span>å¤§è§„æ¨¡æ•°æ®å­˜å‚¨ç³»ç»Ÿéƒ½ä¼šé¢ä¸´çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•æ¨ªå‘æ‹“å±•ã€‚å½“ä½ çš„æ•°æ®é›†è¶Šæ¥è¶Šå¤§ï¼Œä¸€ä¸»å¤šä»çš„æ¨¡å¼å·²ç»æ— æ³•æ”¯æ’‘è¿™ä¹ˆå¤§é‡çš„æ•°æ®å­˜å‚¨ï¼Œäºæ˜¯ä½ é¦–å…ˆè€ƒè™‘å°†å¤šä¸ªä¸»ä»æ¨¡å¼ç»“åˆåœ¨ä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•å®ç°æ•°æ®åˆ†ç‰‡çš„é€»è¾‘å’Œåœ¨å“ªé‡Œå®ç°è¿™éƒ¨åˆ†é€»è¾‘ï¼Ÿä¸šç•Œå¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œ</span></p><p><span>ä¸€æ˜¯å¼•å…¥ </span><strong><span>Proxy</span></strong><span> å±‚æ¥å‘åº”ç”¨ç«¯å±è”½èº«åçš„é›†ç¾¤åˆ†å¸ƒï¼Œå®¢æˆ·ç«¯å¯ä»¥å€ŸåŠ© </span><strong><span>Proxy</span></strong><span> å±‚æ¥è¿›è¡Œè¯·æ±‚è½¬å‘å’Œ Key å€¼çš„æ•£åˆ—ä»è€Œè¿›è¡Œè¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼Œè¿™ç§æ–¹æ¡ˆä¼šæŸå¤±éƒ¨åˆ†æ€§èƒ½ä½†æ˜¯è¿ç§»å‡çº§ç­‰è¿ç»´æ“ä½œéƒ½å¾ˆæ–¹ä¾¿ï¼Œä¸šç•Œ  </span><strong><span>Proxy</span></strong><span>  æ–¹æ¡ˆçš„ä»£è¡¨æœ‰ Twitter çš„ </span><a href='https://github.com/twitter/twemproxy'><span>Twemproxy</span></a><span> å’Œè±Œè±†èšçš„ </span><a href='https://github.com/CodisLabs/codis'><span>Codis</span></a><span>ï¼›</span></p><p><span>äºŒæ˜¯ </span><strong><span>smart client</span></strong><span> æ–¹æ¡ˆï¼Œå³å°† </span><strong><span>Proxy</span></strong><span> çš„é€»è¾‘æ”¾åœ¨å®¢æˆ·ç«¯åšï¼Œå®¢æˆ·ç«¯æ ¹æ®ç»´æŠ¤çš„æ˜ å°„è§„åˆ™å’Œè·¯ç”±è¡¨ç›´æ¥è®¿é—®ç‰¹å®šçš„ Redis å®ä¾‹ï¼Œä½†æ˜¯å¢å‡ Redis å®ä¾‹éƒ½éœ€è¦é‡æ–°è°ƒæ•´åˆ†ç‰‡é€»è¾‘ã€‚</span></p><h4 id='912-redis-clusterç®€ä»‹'><span>9.1.2 Redis Clusterç®€ä»‹</span></h4><p><span>Redis 3.0 ç‰ˆæœ¬å¼€å§‹å®˜æ–¹æ­£å¼æ”¯æŒé›†ç¾¤æ¨¡å¼ï¼ŒRedis é›†ç¾¤æ¨¡å¼æä¾›äº†ä¸€ç§èƒ½å°†æ•°æ®åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œåˆ†åŒºå­˜å‚¨çš„æ–¹æ³•ï¼Œé‡‡å–äº†å’Œä¸Šè¿°ä¸¤è€…ä¸åŒçš„å®ç°æ–¹æ¡ˆâ€”â€”å»ä¸­å¿ƒåŒ–çš„é›†ç¾¤æ¨¡å¼ï¼Œé›†ç¾¤é€šè¿‡åˆ†ç‰‡è¿›è¡Œæ•°æ®å…±äº«ï¼Œåˆ†ç‰‡å†…é‡‡ç”¨ä¸€ä¸»å¤šä»çš„å½¢å¼è¿›è¡Œå‰¯æœ¬å¤åˆ¶ï¼Œå¹¶æä¾›å¤åˆ¶å’Œæ•…éšœæ¢å¤åŠŸèƒ½ã€‚åœ¨å®˜æ–¹æ–‡æ¡£ </span><a href='https://redis.io/topics/cluster-spec'><span>Redis Cluster Specification</span></a><span> ä¸­ï¼Œä½œè€…è¯¦ç»†ä»‹ç»äº†å®˜æ–¹é›†ç¾¤æ¨¡å¼çš„è®¾è®¡è€ƒé‡ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</span></p><figure class='table-figure'><table><thead><tr><th><strong><span>æ€§èƒ½</span></strong></th><th><span>Redis é›†ç¾¤æ¨¡å¼é‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„è®¾è®¡ï¼Œå³ P2P è€Œéä¹‹å‰ä¸šç•Œè¡ç”Ÿå‡ºçš„ Proxy æ–¹å¼</span></th></tr></thead><tbody><tr><td><strong><span>ä¸€è‡´æ€§</span></strong></td><td><strong><span>master</span></strong><span>ä¸ </span><strong><span>slave</span></strong><span> ä¹‹é—´é‡‡ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æ—¶é—´çª—å£ï¼Œä¿è¯é«˜æ€§èƒ½çš„åŒæ—¶ç‰ºç‰²äº†éƒ¨åˆ†ä¸€è‡´æ€§</span></td></tr><tr><td><strong><span>æ°´å¹³æ‰©å±•</span></strong></td><td><span>æ–‡ä¸­ç§°å¯ä»¥çº¿æ€§æ‰©å±•è‡³ 1000 ä¸ªèŠ‚ç‚¹</span></td></tr><tr><td><strong><span>å¯ç”¨æ€§</span></strong></td><td><span>åœ¨é›†ç¾¤æ¨¡å¼æ¨å‡ºä¹‹å‰ï¼Œä¸»ä»æ¨¡å¼çš„å¯ç”¨æ€§è¦é  </span><strong><span>Sentinel</span></strong><span> ä¿è¯ï¼Œé›†ç¾¤æ¨¡å¼å¼•å…¥äº†æ–°çš„æ•…éšœæ£€æµ‹æœºåˆ¶ï¼Œè€Œåœ¨æ•…éšœè½¬ç§»è¿™å—å¤ç”¨äº† </span><strong><span>Sentinel</span></strong><span> çš„ä»£ç é€»è¾‘ï¼Œä¸éœ€è¦å•ç‹¬å¯åŠ¨ä¸€ä¸ª Sentinel é›†ç¾¤ï¼ŒRedis Clusteræœ¬èº«å°±èƒ½è‡ªåŠ¨è¿›è¡Œ </span><strong><span>master</span></strong><span> é€‰ä¸¾å’Œ </span><strong><span>failover</span></strong></td></tr></tbody></table></figure><p><span>ä¸‹å›¾æ˜¯ä¸€ä¸ªä¸‰ä¸»ä¸‰ä»çš„ Redis Clusterï¼Œä¸‰æœºæˆ¿éƒ¨ç½²ï¼ˆå…¶ä¸­ä¸€ä¸»ä¸€ä»æ„æˆä¸€ä¸ªåˆ†ç‰‡ï¼Œä¹‹é—´é€šè¿‡å¼‚æ­¥å¤åˆ¶åŒæ­¥æ•°æ®ï¼Œä¸€æ—¦æŸä¸ªæœºæˆ¿æ‰çº¿ï¼Œåˆ™åˆ†ç‰‡ä¸Šä½äºå¦ä¸€ä¸ªæœºæˆ¿çš„ </span><strong><span>slave</span></strong><span> ä¼šè¢«æå‡ä¸º </span><strong><span>master</span></strong><span> ä»è€Œå¯ä»¥ç»§ç»­æä¾›æœåŠ¡ï¼‰ ï¼›æ¯ä¸ª </span><strong><span>master</span></strong><span> è´Ÿè´£ä¸€éƒ¨åˆ† </span><strong><span>slot</span></strong><span>ï¼Œæ•°ç›®å°½é‡å‡æ‘Šï¼›å®¢æˆ·ç«¯å¯¹äºæŸä¸ª </span><strong><span>Key</span></strong><span> æ“ä½œå…ˆé€šè¿‡å…¬å¼è®¡ç®—ï¼ˆè®¡ç®—æ–¹æ³•è§ä¸‹æ–‡ï¼‰å‡ºæ‰€æ˜ å°„åˆ°çš„ </span><strong><span>slot</span></strong><span>ï¼Œç„¶åç›´è¿æŸä¸ªåˆ†ç‰‡ï¼Œå†™è¯·æ±‚ä¸€å¾‹èµ° </span><strong><span>master</span></strong><span>ï¼Œè¯»è¯·æ±‚æ ¹æ®è·¯ç”±è§„åˆ™é€‰æ‹©è¿æ¥çš„åˆ†ç‰‡èŠ‚ç‚¹ã€‚</span></p><p>&nbsp;</p><p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/42819892/1716287155681-8b6d9baf-3e8f-4b68-9e94-3fca50f80fd2.jpeg" referrerpolicy="no-referrer" alt="img"></p><h4 id='913-ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹'><span>9.1.3. ä¸‰ç§é›†ç¾¤æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</span></h4><figure class='table-figure'><table><thead><tr><th><span>é›†ç¾¤æ¨¡å¼</span></th><th><span>ä¼˜ç‚¹</span></th><th><span>ç¼ºç‚¹</span></th></tr></thead><tbody><tr><td><span>å®¢æˆ·ç«¯åˆ†ç‰‡</span></td><td><span>ä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼Œå®ç°æ–¹æ³•å’Œä»£ç å¯ä»¥è‡ªå·±æŒæ§å¹¶ä¸”å¯éšæ—¶è°ƒæ•´ã€‚è¿™ç§åˆ†ç‰‡æ€§èƒ½æ¯”ä»£ç†å¼æ›´å¥½(å› ä¸ºå°‘äº†åˆ†å‘ç¯èŠ‚)ï¼Œåˆ†å‘å‹åŠ›åœ¨å®¢æˆ·ç«¯ï¼Œæ— æœåŠ¡ç«¯å‹åŠ›å¢åŠ </span></td><td><span>ä¸èƒ½å¹³æ»‘åœ°æ°´å¹³æ‰©å®¹ï¼Œæ‰©å®¹/ç¼©å®¹æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨è°ƒæ•´åˆ†ç‰‡ç¨‹åºï¼Œå‡ºç°æ•…éšœä¸èƒ½è‡ªåŠ¨è½¬ç§»ï¼Œéš¾ä»¥è¿ç»´</span></td></tr><tr><td><span>ä»£ç†å±‚åˆ†ç‰‡</span></td><td><span>è¿ç»´æˆæœ¬ä½ã€‚ä¸šåŠ¡æ–¹ä¸ç”¨å…³å¿ƒåç«¯ Redis å®ä¾‹ï¼Œè·Ÿæ“ä½œå•ç‚¹ Redis å®ä¾‹ä¸€æ ·ã€‚Proxy çš„é€»è¾‘å’Œå­˜å‚¨çš„é€»è¾‘æ˜¯éš”ç¦»çš„</span></td><td><span>ä»£ç†å±‚å¤šäº†ä¸€æ¬¡è½¬å‘ï¼Œæ€§èƒ½æœ‰æ‰€æŸè€—ï¼›è¿›è¡Œæ‰©å®¹/ç¼©å®¹æ—¶å€™ï¼Œéƒ¨åˆ†æ•°æ®å¯èƒ½ä¼šå¤±æ•ˆï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œè¿ç§»ï¼Œå¯¹è¿ç»´è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”éš¾ä»¥åšåˆ°å¹³æ»‘çš„æ‰©ç¼©å®¹ï¼›å‡ºç°æ•…éšœï¼Œä¸èƒ½è‡ªåŠ¨è½¬ç§»ï¼Œè¿ç»´æ€§å¾ˆå·®ã€‚Codis åšäº†è¯¸å¤šæ”¹è¿›ï¼Œç›¸æ¯”äº </span><a href='https://github.com/twitter/twemproxy'><span>Twemproxy</span></a><span> å¯ç”¨æ€§å’Œæ€§èƒ½éƒ½å¥½å¾—å¤š</span></td></tr><tr><td><span>Redis Cluster</span></td><td><span>æ— ä¸­å¿ƒèŠ‚ç‚¹ï¼Œæ•°æ®æŒ‰ç…§ slot å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ª Redis å®ä¾‹ä¸Šï¼Œå¹³æ»‘çš„è¿›è¡Œæ‰©å®¹/ç¼©å®¹èŠ‚ç‚¹ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ Gossip åè®®äº¤æ¢çŠ¶æ€ä¿¡æ¯,è¿›è¡ŒæŠ•ç¥¨æœºåˆ¶å®Œæˆ slave åˆ° master è§’è‰²çš„æå‡ï¼‰é™ä½è¿ç»´æˆæœ¬ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§</span></td><td><span>å¼€æºç‰ˆæœ¬ç¼ºä¹ç›‘æ§ç®¡ç†ï¼ŒåŸç”Ÿå®¢æˆ·ç«¯å¤ªè¿‡ç®€é™‹ï¼Œfailover èŠ‚ç‚¹çš„æ£€æµ‹è¿‡æ…¢ï¼Œç»´æŠ¤ Membership çš„ Gossipæ¶ˆæ¯åè®®å¼€é”€å¤§ï¼Œæ— æ³•æ ¹æ®ç»Ÿè®¡åŒºåˆ†å†·çƒ­æ•°æ®</span></td></tr></tbody></table></figure><h4 id='914-redis-cluster-æ˜¯å¦‚ä½•åˆ†ç‰‡çš„'><span>9.1.4 Redis Cluster æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿ</span></h4><p><span>Redis Cluster å¹¶æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Œé‡‡ç”¨çš„æ˜¯ å“ˆå¸Œæ§½åˆ†åŒº ï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹éƒ½å±äºä¸€ä¸ª hash slotï¼ˆå“ˆå¸Œæ§½ï¼‰ ã€‚</span></p><p><span>Redis Cluster é€šå¸¸æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ ï¼Œè¦è®¡ç®—ç»™å®š key åº”è¯¥åˆ†å¸ƒåˆ°å“ªä¸ªå“ˆå¸Œæ§½ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå¯¹æ¯ä¸ª key è®¡ç®— CRC-16ï¼ˆXMODEMï¼‰ æ ¡éªŒç ï¼Œç„¶åå†å¯¹è¿™ä¸ªæ ¡éªŒç å¯¹ 16384(å“ˆå¸Œæ§½çš„æ€»æ•°) å–æ¨¡ï¼Œå¾—åˆ°çš„å€¼å³æ˜¯ key å¯¹åº”çš„å“ˆå¸Œæ§½ã€‚</span></p><p><span>å“ˆå¸Œæ§½çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HASH_SLOT = CRC16(key) mod NUMER_OF_SLOTS</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>åˆ›å»ºå¹¶åˆå§‹åŒ– Redis Cluster çš„æ—¶å€™ï¼ŒRedis ä¼šè‡ªåŠ¨å¹³å‡åˆ†é…è¿™ 16384 ä¸ªå“ˆå¸Œæ§½åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ†é…ã€‚å¦‚æœä½ æƒ³è‡ªå·±æ‰‹åŠ¨è°ƒæ•´çš„è¯ï¼ŒRedis Cluster ä¹Ÿå†…ç½®äº†ç›¸å…³çš„å‘½ä»¤æ¯”å¦‚ ADDSLOTSã€ADDSLOTSRANGEï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»åˆ°é‡æ–°åˆ†é…å“ˆå¸Œæ§½ç›¸å…³çš„å‘½ä»¤ï¼‰ã€‚</span></p><p><span>å‡è®¾é›†ç¾¤æœ‰ 3 ä¸ª Redis èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå“ˆå¸Œæ§½å¯èƒ½æ˜¯è¿™æ ·åˆ†é…çš„ï¼ˆè¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œå®é™…æ•ˆæœå¯èƒ½ä¼šæœ‰å·®å¼‚ï¼‰ï¼š</span></p><ul><li><p><span>Node 1 ï¼š 0 - 5500 çš„ hash slots</span></p></li><li><p><span>Node 2 ï¼š 5501 - 11000 çš„ hash slots</span></p></li><li><p><span>Node 3 ï¼š 11001 - 16383 çš„ hash slots</span></p></li></ul><p><span>åœ¨ä»»æ„ä¸€ä¸ª master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ CLUSTER SLOTSå‘½ä»¤å³å¯è¿”å›å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">127.0.0.1:7000&gt;&gt; CLUSTER SLOTS</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># å“ˆå¸Œæ§½çš„èŒƒå›´</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1) 1) (integer) 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 2) (integer) 5500</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; # master çš„ ip å’Œç«¯å£å·</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 3) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 7002</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; # slave çš„ ip å’Œç«¯å£å·</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 4) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 8002</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2) 1) (integer) 11001</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 2) (integer) 16383</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 3) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 7000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 4) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 8000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3) 1) (integer) 5501</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 2) (integer) 11000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 3) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 7001</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 4) 1) "127.0.0.1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  2) (integer) 8001</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>å®¢æˆ·ç«¯è¿æ¥ Redis Cluster ä¸­ä»»æ„ä¸€ä¸ª master èŠ‚ç‚¹å³å¯è®¿é—® Redis Cluster çš„æ•°æ®ï¼Œå½“å®¢æˆ·ç«¯å‘é€å‘½ä»¤è¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ ¹æ® key é€šè¿‡ä¸Šé¢çš„è®¡ç®—å…¬ç¤ºæ‰¾åˆ°çš„å¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œç„¶åå†æŸ¥è¯¢å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œå³å¯æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</span></p><p><span>å¦‚æœå“ˆå¸Œæ§½ç¡®å®æ˜¯å½“å‰èŠ‚ç‚¹è´Ÿè´£ï¼Œé‚£å°±ç›´æ¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚è¿”å›ç»“æœï¼Œå¦‚æœä¸ç”±å½“å‰èŠ‚ç‚¹è´Ÿè´£ï¼Œå°±ä¼šè¿”å› -MOVED é‡å®šå‘é”™è¯¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯å½“å‰å“ˆå¸Œæ§½æ˜¯ç”±å“ªä¸ªèŠ‚ç‚¹è´Ÿè´£ï¼Œå®¢æˆ·ç«¯å‘ç›®æ ‡èŠ‚ç‚¹å‘é€è¯·æ±‚å¹¶æ›´æ–°ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ã€‚</span></p><p><strong><span>ä¸ºä»€ä¹ˆè¿˜ä¼šå­˜åœ¨æ‰¾é”™èŠ‚ç‚¹çš„æƒ…å†µå‘¢ï¼Ÿ</span></strong></p><p><span>è¿™æ˜¯å› ä¸º Redis Cluster å†…éƒ¨å¯èƒ½ä¼šé‡æ–°åˆ†é…å“ˆå¸Œæ§½æ¯”å¦‚æ‰©å®¹ç¼©å®¹çš„æ—¶å€™ï¼Œè¿™å°±å¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ä¼šæœ‰è¯¯ã€‚</span></p><p><strong><span>Redis Cluster å“ˆå¸Œæ§½åˆ†åŒºæœºåˆ¶çš„ä¼˜ç‚¹ï¼šè§£è€¦äº†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæå‡äº†é›†ç¾¤çš„æ¨ªå‘æ‰©å±•æ€§å’Œå®¹é”™æ€§ã€‚</span></strong></p><h4 id='915-ä¸ºä»€ä¹ˆ-redis-cluster-çš„å“ˆå¸Œæ§½æ˜¯-16384-ä¸ª'><span>9.1.5 ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½æ˜¯ 16384 ä¸ª?</span></h4><p><span>CRC16 ç®—æ³•äº§ç”Ÿçš„æ ¡éªŒç æœ‰ 16 ä½ï¼Œç†è®ºä¸Šå¯ä»¥äº§ç”Ÿ 65536ï¼ˆ2^16ï¼Œ0 ~ 65535ï¼‰ä¸ªå€¼ã€‚ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½ååé€‰æ‹©çš„æ˜¯ 16384ï¼ˆ2^14ï¼‰ä¸ªå‘¢ï¼Ÿ</span></p><ul><li><p><span>æ­£å¸¸çš„å¿ƒè·³åŒ…ä¼šæºå¸¦ä¸€ä¸ªèŠ‚ç‚¹çš„å®Œæ•´é…ç½®ï¼Œå®ƒä¼šä»¥å¹‚ç­‰çš„æ–¹å¼æ›´æ–°æ—§çš„é…ç½®ï¼Œè¿™æ„å‘³ç€å¿ƒè·³åŒ…ä¼šé™„å¸¦å½“å‰èŠ‚ç‚¹çš„è´Ÿè´£çš„å“ˆå¸Œæ§½çš„ä¿¡æ¯ã€‚å“ˆå¸Œæ§½å¤ªå¤§ä¼šå¯¼è‡´å¿ƒè·³åŒ…å¤ªå¤§ï¼Œæ¶ˆè€—å¤ªå¤šå¸¦å®½ï¼›</span></p></li><li><p><span>å“ˆå¸Œæ§½æ€»æ•°è¶Šå°‘ï¼Œå¯¹å­˜å‚¨å“ˆå¸Œæ§½ä¿¡æ¯çš„ bitmap å‹ç¼©æ•ˆæœè¶Šå¥½ï¼›</span></p></li><li><p><span>Redis Cluster çš„ä¸»èŠ‚ç‚¹é€šå¸¸ä¸ä¼šæ‰©å±•å¤ªå¤šï¼Œ16384 ä¸ªå“ˆå¸Œæ§½å·²ç»è¶³å¤Ÿç”¨äº†ã€‚</span></p></li></ul><h4 id='916-redis-cluster-å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½'><span>9.1.6 </span><strong><span>Redis Cluster å¦‚ä½•é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼Ÿ</span></strong></h4><p><span>å¦‚æœä½ æƒ³è‡ªå·±æ‰‹åŠ¨è°ƒæ•´çš„è¯ï¼ŒRedis Cluster ä¹Ÿå†…ç½®äº†ç›¸å…³çš„å‘½ä»¤ï¼š</span></p><ul><li><p><span>CLUSTER ADDSLOTS slot [slot ...] : æŠŠä¸€ç»„ hash slots åˆ†é…ç»™æ¥æ”¶å‘½ä»¤çš„èŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå…¶ä¸­ N æ˜¯ hash slot çš„æ€»æ•°ï¼›</span></p></li><li><p><span>CLUSTER ADDSLOTSRANGE start-slot end-slot [start-slot end-slot ...] ï¼ˆRedis 7.0 åæ–°åŠ çš„å‘½ä»¤ï¼‰ï¼š æŠŠæŒ‡å®šèŒƒå›´çš„ hash slots åˆ†é…ç»™æ¥æ”¶å‘½ä»¤çš„èŠ‚ç‚¹ï¼Œç±»ä¼¼äº ADDSLOTS å‘½ä»¤ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N) å…¶ä¸­ N æ˜¯èµ·å§‹ hash slot å’Œç»“æŸ hash slot ä¹‹é—´çš„ hash slot çš„æ€»æ•°ã€‚</span></p></li><li><p><span>CLUSTER DELSLOTS slot [slot ...] : ä»æ¥æ”¶å‘½ä»¤çš„èŠ‚ç‚¹ä¸­åˆ é™¤ä¸€ç»„ hash slotsï¼›</span></p></li><li><p><span>CLUSTER FLUSHSLOTS ï¼šç§»é™¤æ¥å—å‘½ä»¤çš„èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰ hash slotï¼›</span></p></li><li><p><span>CLUSTER SETSLOT slot MIGRATING node-idï¼š è¿ç§»æ¥å—å‘½ä»¤çš„èŠ‚ç‚¹çš„æŒ‡å®š hash slot åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼ˆnode_id æŒ‡å®šï¼‰ä¸­ï¼›</span></p></li><li><p><span>CLUSTER SETSLOT slot IMPORTING node-idï¼š å°†ç›®æ ‡èŠ‚ç‚¹ï¼ˆnode_id æŒ‡å®šï¼‰ä¸­çš„æŒ‡å®š hash slot è¿ç§»åˆ°æ¥å—å‘½ä»¤çš„èŠ‚ç‚¹ä¸­ï¼›</span></p></li></ul><h4 id='redis-cluster-æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—'><strong><span>Redis Cluster æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—ï¼Ÿ</span></strong></h4><p><span>Redis Cluster æ‰©å®¹å’Œç¼©å®¹æœ¬è´¨æ˜¯è¿›è¡Œé‡æ–°åˆ†ç‰‡ï¼ŒåŠ¨æ€è¿ç§»å“ˆå¸Œæ§½ã€‚</span></p><p><span>ä¸ºäº†ä¿è¯ Redis Cluster åœ¨æ‰©å®¹å’Œç¼©å®¹æœŸé—´ä¾ç„¶èƒ½å¤Ÿå¯¹å¤–æ­£å¸¸æä¾›æœåŠ¡ï¼ŒRedis Cluster æä¾›äº†é‡å®šå‘æœºåˆ¶ï¼Œä¸¤ç§ä¸åŒçš„ç±»å‹ï¼š</span></p><ul><li><p><span>ASK é‡å®šå‘ ï¼š</span><strong><span>å¯ä»¥çœ‹åšæ˜¯ä¸´æ—¶é‡å®šå‘ï¼Œåç»­æŸ¥è¯¢ä»ç„¶å‘é€åˆ°æ—§èŠ‚ç‚¹ã€‚</span></strong></p></li><li><p><span>MOVED é‡å®šå‘ </span><strong><span>ï¼šå¯ä»¥çœ‹åšæ˜¯æ°¸ä¹…é‡å®šå‘ï¼Œåç»­æŸ¥è¯¢å‘é€åˆ°æ–°èŠ‚ç‚¹ã€‚</span></strong></p></li></ul><p><span>å®¢æˆ·ç«¯å‘æŒ‡å®šèŠ‚ç‚¹å‘é€è¯·æ±‚å‘½ä»¤ï¼Œä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼ŒASK é‡å®šå‘æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</span></p><ul><li><p><span>å¦‚æœè¯·æ±‚çš„ key å¯¹åº”çš„å“ˆå¸Œæ§½è¿˜åœ¨å½“å‰èŠ‚ç‚¹çš„è¯ï¼Œå°±ç›´æ¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</span></p></li><li><p><span>å¦‚æœè¯·æ±‚çš„ key å¯¹åº”çš„å“ˆå¸Œæ§½åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œä½†æ˜¯è¯·æ±‚çš„ key è¿˜æœªè¿ç§»èµ°çš„è¯ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹ä»»ç„¶å¯ä»¥å¤„ç†å½“å‰è¯·æ±‚ï¼ŒåŒæ ·å¯ä»¥ç›´æ¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</span></p></li><li><p><span>å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„ key å¯¹åº”çš„å“ˆå¸Œæ§½å½“å‰æ­£åœ¨è¿ç§»è‡³æ–°çš„èŠ‚ç‚¹ä¸”è¯·æ±‚çš„ key  å·²ç»è¢«è¿ç§»èµ°çš„è¯ï¼Œå°±ä¼šè¿”å› -ASK é‡å®šå‘é”™è¯¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯è¦å°†è¯·æ±‚å‘é€åˆ°å“ˆå¸Œæ§½è¢«è¿ç§»åˆ°çš„ç›®æ ‡èŠ‚ç‚¹ã€‚ -ASK é‡å®šå‘é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«è¯·æ±‚ key è¿ç§»åˆ°çš„æ–°èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</span></p></li><li><p><span>å®¢æˆ·ç«¯æ”¶åˆ° -ASK é‡å®šå‘é”™è¯¯åï¼Œå°†ä¼šä¸´æ—¶ï¼ˆä¸€æ¬¡æ€§ï¼‰é‡å®šå‘ï¼Œè‡ªåŠ¨å‘æ–°èŠ‚ç‚¹å‘é€ä¸€æ¡ </span><a href='https://redis.io/commands/asking/'><span>ASKING</span></a><span> å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¥æ”¶åˆ° ASKING å‘½ä»¤çš„èŠ‚ç‚¹ä¼šå¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œä¸‹æ¬¡å†æ¥éœ€è¦é‡æ–°æå‰å‘é€ ASKING å‘½ä»¤ã€‚</span></p></li><li><p><span>æ–°èŠ‚ç‚¹åœ¨æ”¶åˆ° ASKING å‘½ä»¤åå¯èƒ½ä¼šè¿”å›é‡è¯•é”™è¯¯ï¼ˆTRYAGAINï¼‰ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å½“å‰è¯·æ±‚çš„ key è¿˜åœ¨å¯¼å…¥ä¸­ä½†æœªå¯¼å…¥å®Œæˆçš„æƒ…å†µ</span></p></li><li><p><span>å®¢æˆ·ç«¯å‘é€çœŸæ­£éœ€è¦è¯·æ±‚çš„å‘½ä»¤ã€‚</span></p></li><li><p><span>ASK é‡å®šå‘å¹¶ä¸ä¼šåŒæ­¥æ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å¯¹æ­£åœ¨è¿ç§»çš„ç›¸åŒå“ˆå¸Œæ§½çš„è¯·æ±‚ä¾ç„¶ä¼šå‘é€åˆ°æ—§èŠ‚ç‚¹è€Œä¸æ˜¯æ–°èŠ‚ç‚¹ã€‚</span></p></li></ul><p><span>å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„ key å¯¹åº”çš„å“ˆå¸Œæ§½å·²ç»è¿ç§»å®Œæˆçš„è¯ï¼Œå°±ä¼šè¿”å› -MOVED é‡å®šå‘é”™è¯¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯å½“å‰å“ˆå¸Œæ§½æ˜¯ç”±å“ªä¸ªèŠ‚ç‚¹è´Ÿè´£ï¼Œå®¢æˆ·ç«¯å‘æ–°èŠ‚ç‚¹å‘é€è¯·æ±‚å¹¶æ›´æ–°ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ï¼Œåç»­æŸ¥è¯¢å°†è¢«å‘é€åˆ°æ–°èŠ‚ç‚¹ã€‚</span></p><h4 id='redis-cluster-ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„'><strong><span>Redis Cluster ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Ÿ</span></strong></h4><p><span>Redis Cluster æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å„ä¸ªèŠ‚ç‚¹éœ€è¦äº’ç›¸é€šä¿¡ã€‚æ—¢ç„¶è¦ç›¸äº’é€šä¿¡å°±è¦éµå¾ªä¸€è‡´çš„é€šä¿¡åè®®ï¼ŒRedis Cluster ä¸­çš„å„ä¸ªèŠ‚ç‚¹åŸºäº Gossip åè®® æ¥è¿›è¡Œé€šä¿¡å…±äº«ä¿¡æ¯ï¼Œæ¯ä¸ª Redis èŠ‚ç‚¹éƒ½ç»´æŠ¤äº†ä¸€ä»½é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯ã€‚</span></p><p><span>Redis Cluster çš„èŠ‚ç‚¹ä¹‹é—´ä¼šç›¸äº’å‘é€å¤šç§ Gossip æ¶ˆæ¯ï¼š</span></p><ul><li><p><span>MEET ï¼šåœ¨ Redis Cluster ä¸­çš„æŸä¸ª Redis èŠ‚ç‚¹ä¸Šæ‰§è¡Œ CLUSTER MEET ip port å‘½ä»¤ï¼Œå¯ä»¥å‘æŒ‡å®šçš„ Redis èŠ‚ç‚¹å‘é€ä¸€æ¡ MEET ä¿¡æ¯ï¼Œç”¨äºå°†å…¶æ·»åŠ è¿› Redis Cluster æˆä¸ºæ–°çš„ Redis èŠ‚ç‚¹ã€‚</span></p></li><li><p><span>PING/PONG ï¼šRedis Cluster ä¸­çš„èŠ‚ç‚¹éƒ½ä¼šå®šæ—¶åœ°å‘å…¶ä»–èŠ‚ç‚¹å‘é€ PING æ¶ˆæ¯ï¼Œæ¥äº¤æ¢å„ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼Œæ£€æŸ¥å„ä¸ªèŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬åœ¨çº¿çŠ¶æ€ã€ç–‘ä¼¼ä¸‹çº¿çŠ¶æ€ PFAIL å’Œå·²ä¸‹çº¿çŠ¶æ€ FAILã€‚</span></p></li><li><p><span>FAIL ï¼šRedis Cluster ä¸­çš„èŠ‚ç‚¹ A å‘ç° B èŠ‚ç‚¹ PFAIL ï¼Œå¹¶ä¸”åœ¨ä¸‹çº¿æŠ¥å‘Šçš„æœ‰æ•ˆæœŸé™å†…é›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹å°† B èŠ‚ç‚¹æ ‡è®°ä¸º PFAILï¼ŒèŠ‚ç‚¹ A å°±ä¼šå‘é›†ç¾¤å¹¿æ’­ä¸€æ¡ FAIL æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹å°†æ•…éšœèŠ‚ç‚¹ B æ ‡è®°ä¸º FAIL ã€‚</span></p></li></ul><p><span>æœ‰äº† Redis Cluster ä¹‹åï¼Œä¸éœ€è¦ä¸“é—¨éƒ¨ç½² Sentinel é›†ç¾¤æœåŠ¡äº†ã€‚Redis Cluster ç›¸å½“äºæ˜¯å†…ç½®äº† Sentinel æœºåˆ¶ï¼ŒRedis Cluster å†…éƒ¨çš„å„ä¸ª Redis èŠ‚ç‚¹é€šè¿‡ Gossip åè®®äº’ç›¸æ¢æµ‹å¥åº·çŠ¶æ€ï¼Œåœ¨æ•…éšœæ—¶å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ã€‚</span></p><h1 id='åç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©'><span>åã€ç¼“å­˜ç©¿é€ä¸ç¼“å­˜é›ªå´©</span></h1><h2 id='101-ç¼“å­˜ç©¿é€'><span>10.1 ç¼“å­˜ç©¿é€</span></h2><p><span>ç¼“å­˜ç©¿é€è¯´ç®€å•ç‚¹å°±æ˜¯</span><strong><span>å¤§é‡è¯·æ±‚çš„ key æ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­</span></strong><span>ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ æˆ‘ä»¬ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ã€‚</span></p><p><strong><span>è§£å†³æ–¹æ³•</span></strong></p><p><span>æœ€åŸºæœ¬çš„å°±æ˜¯é¦–å…ˆåšå¥½å‚æ•°æ ¡éªŒï¼Œä¸€äº›ä¸åˆæ³•çš„å‚æ•°è¯·æ±‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ¯”å¦‚æŸ¥è¯¢çš„æ•°æ®åº“ id ä¸èƒ½å°äº 0ã€ä¼ å…¥çš„é‚®ç®±æ ¼å¼ä¸å¯¹çš„æ—¶å€™ç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ç­‰ç­‰ã€‚</span></p><p><strong><span>1ï¼‰ç¼“å­˜æ— æ•ˆ key</span></strong></p><p><strong><span>å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š </span><code>SET key value EX 10086</code><span> ã€‚è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œ</span></strong><span>å¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿã€‚</span></p><p><strong><span>2) å¸ƒéš†è¿‡æ»¤å™¨</span></strong></p><p><span>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œé€šè¿‡å®ƒå¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ¤æ–­ä¸€ä¸ªç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨äºæµ·é‡æ•°æ®ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œ</span><strong><span>æŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šç»§ç»­ä¸‹é¢çš„æµç¨‹ã€‚</span></strong></p><p><span>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š </span><strong><span>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚</span></strong></p><p><img src="./images/åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨åçš„ç¼“å­˜å¤„ç†æµç¨‹.png" referrerpolicy="no-referrer" alt="åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨åçš„ç¼“å­˜å¤„ç†æµç¨‹.png"></p><h3 id='å¸ƒéš†è¿‡æ»¤å™¨'><span>å¸ƒéš†è¿‡æ»¤å™¨</span></h3><p><strong><span>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</span></strong></p><ul><li><p><span>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰</span></p></li><li><p><span>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</span></p></li></ul><p><strong><span>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</span></strong></p><ul><li><p><span>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—</span></p></li><li><p><span>åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</span></p></li></ul><p><span>ä¼˜ç‚¹ï¼š</span></p><ul><li><p><span>ç”±ä¸€ä¸²äºŒè¿›åˆ¶æ•°ç»„æˆï¼Œå ç”¨ç©ºé—´éå¸¸å°</span></p></li><li><p><span>æ’å…¥å’ŒæŸ¥è¯¢çš„é€Ÿåº¦éå¸¸å¿«ã€‚æ—¶é—´å¤æ‚åº¦O(K)</span></p></li><li><p><span>å­˜å‚¨çš„æ˜¯äºŒè¿›åˆ¶æ•°ï¼Œä¿å¯†æ€§å¥½ã€‚</span></p></li></ul><p><span>ç¼ºç‚¹ï¼š</span></p><ul><li><p><span>æ— æ³•è¿›è¡Œåˆ é™¤æ“ä½œï¼Œæ¯”å¦‚helloç»è¿‡hashè¿ç®—è®¡ç®—ä¸º7ï¼Œåˆ™æ•°ç»„çš„ä¸‹æ ‡ä¸º7çš„ä½ç½®ä¸º1ï¼Œä½†æ˜¯å¦‚æœâ€œä½ å¥½â€ç»è¿‡hashè¿ç®—ç»“æœä¹Ÿä¸º7,å¦‚æœæŠŠä¸‹æ ‡ä¸º7çš„ä½ç½®çš„1æ”¹ä¸º0,å°±ä¼šåˆ é™¤æ‰helloå’Œä½ å¥½ä¸¤ä¸ªæ•°æ®ã€‚</span></p></li><li><p><span>ä¼šæœ‰è¯¯åˆ¤ç‡ï¼Œhashå‡½æ•°è¶Šå¤šä»¥åŠä½æ•°ç»„é•¿åº¦è¶Šå¤§ï¼Œè¯¯åˆ¤ç‡éƒ½ä¼šå‡å°ï¼Œä½†æ˜¯è®¡ç®—å°±æƒ³å¯¹æ¯”è¾ƒæ…¢ã€‚O(k)çš„æ—¶é—´å¤æ‚åº¦ï¼Œkä½hashå‡½æ•°çš„ä¸ªæ•°ã€‚</span></p></li></ul><p><img src="./images/å¸ƒéš†è¿‡æ»¤å™¨.png" referrerpolicy="no-referrer" alt="å¸ƒéš†è¿‡æ»¤å™¨.png"></p><h2 id='102-ç¼“å­˜é›ªå´©'><span>10.2 ç¼“å­˜é›ªå´©</span></h2><ul><li><p><span>RedisæŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚</span></p></li><li><p><span>å¯¹ç¼“å­˜æ•°æ®è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´æŸæ®µæ—¶é—´å†…ç¼“å­˜å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚</span></p></li></ul><p><span>è§£å†³æ–¹æ³•ï¼š</span></p><ul><li><p><span>å¯¹äºâ€œå¯¹ç¼“å­˜æ•°æ®è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´æŸæ®µæ—¶é—´å†…ç¼“å­˜å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚â€è¿™ç§æƒ…å†µï¼Œéå¸¸å¥½è§£å†³ï¼š</span></p><ul><li><p><strong><span>å‡åŒ€è®¾ç½®è¿‡æœŸæ—¶é—´</span></strong><span>ï¼šåœ¨ç¼“å­˜çš„æ—¶å€™ç»™è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ª</span><strong><span>éšæœºå€¼</span></strong><span>ï¼Œè¿™æ ·å°±ä¼šå¤§å¹…åº¦çš„</span><strong><span>å‡å°‘ç¼“å­˜åœ¨åŒä¸€æ—¶é—´è¿‡æœŸ</span></strong><span>ã€‚</span></p></li><li><p><strong><span>äº’æ–¥é”</span></strong><span>ï¼šå½“ä¸šåŠ¡çº¿ç¨‹åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œ</span><strong><span>å¦‚æœå‘ç°è®¿é—®çš„æ•°æ®ä¸åœ¨ Redis é‡Œï¼Œå°±åŠ ä¸ªäº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªè¯·æ±‚æ¥æ„å»ºç¼“å­˜</span></strong><span>ï¼ˆä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†å°†æ•°æ®æ›´æ–°åˆ° Redis é‡Œï¼‰ï¼Œå½“ç¼“å­˜æ„å»ºå®Œæˆåï¼Œå†é‡Šæ”¾é”ã€‚æœªèƒ½è·å–äº’æ–¥é”çš„è¯·æ±‚ï¼Œè¦ä¹ˆç­‰å¾…é”é‡Šæ”¾åé‡æ–°è¯»å–ç¼“å­˜ï¼Œè¦ä¹ˆå°±è¿”å›ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ã€‚å®ç°äº’æ–¥é”çš„æ—¶å€™ï¼Œæœ€å¥½è®¾ç½®</span><strong><span>è¶…æ—¶æ—¶é—´</span></strong><span>ï¼Œä¸ç„¶ç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¿åˆ°äº†é”ï¼Œç„¶åè¿™ä¸ªè¯·æ±‚å‘ç”Ÿäº†æŸç§æ„å¤–è€Œä¸€ç›´é˜»å¡ï¼Œä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œè¿™æ—¶å…¶ä»–è¯·æ±‚ä¹Ÿä¸€ç›´æ‹¿ä¸åˆ°é”ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šå‡ºç°æ— å“åº”çš„ç°è±¡ã€‚</span></p></li><li><p><strong><span>åå°æ›´æ–°ç¼“å­˜</span></strong><span>ï¼šä¸šåŠ¡çº¿ç¨‹ä¸å†è´Ÿè´£æ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜ä¹Ÿä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œè€Œæ˜¯</span><strong><span>è®©ç¼“å­˜â€œæ°¸ä¹…æœ‰æ•ˆâ€ï¼Œå¹¶å°†æ›´æ–°ç¼“å­˜çš„å·¥ä½œäº¤ç”±åå°çº¿ç¨‹å®šæ—¶æ›´æ–°</span></strong><span>ã€‚äº‹å®ä¸Šï¼Œç¼“å­˜æ•°æ®ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€æ•°æ®ä¸€ç›´èƒ½åœ¨å†…å­˜é‡Œï¼Œå› ä¸º</span><strong><span>å½“ç³»ç»Ÿå†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œæœ‰äº›ç¼“å­˜æ•°æ®ä¼šè¢«â€œæ·˜æ±°â€</span></strong><span>ï¼Œè€Œåœ¨ç¼“å­˜è¢«â€œæ·˜æ±°â€åˆ°ä¸‹ä¸€æ¬¡åå°å®šæ—¶æ›´æ–°ç¼“å­˜çš„è¿™æ®µæ—¶é—´å†…ï¼Œä¸šåŠ¡çº¿ç¨‹è¯»å–ç¼“å­˜å¤±è´¥å°±è¿”å›ç©ºå€¼ï¼Œä¸šåŠ¡çš„è§†è§’å°±ä»¥ä¸ºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚</span></p></li></ul></li><li><p><span>å¯¹äºâ€œRedisæŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“â€è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹çš„æ€è·¯ï¼š</span></p><ul><li><p><span>äº‹å‘å‰ï¼šå®ç°Redisçš„</span><strong><span>é«˜å¯ç”¨</span></strong><span>(ä¸»ä»æ¶æ„+Sentinel æˆ–è€…Redis Cluster)ï¼Œå°½é‡é¿å…RedisæŒ‚æ‰è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</span></p></li><li><p><span>äº‹å‘ä¸­ï¼šä¸‡ä¸€RedisçœŸçš„æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®</span><strong><span>æœ¬åœ°ç¼“å­˜(ehcache)+é™æµ(hystrix)</span></strong><span>ï¼Œå°½é‡é¿å…æˆ‘ä»¬çš„æ•°æ®åº“è¢«å¹²æ‰(èµ·ç èƒ½ä¿è¯æˆ‘ä»¬çš„æœåŠ¡è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„)</span></p></li><li><p><span>äº‹å‘åï¼šredisæŒä¹…åŒ–ï¼Œé‡å¯åè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œ</span><strong><span>å¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®</span></strong><span>ã€‚</span></p></li></ul></li></ul><h2 id='103-ç¼“å­˜å‡»ç©¿'><span>10.3 ç¼“å­˜å‡»ç©¿</span></h2><p><span>å¯¹äºæŸä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œç¼“å­˜ä¸­çš„keyè¿‡æœŸï¼Œå¯¼è‡´æ•°æ®åº“ä¸­çš„keyå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š</span><strong><span>ç¼“å­˜è¢«â€œå‡»ç©¿â€çš„é—®é¢˜ï¼Œè¿™ä¸ªå’Œç¼“å­˜é›ªå´©çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹æŸä¸€keyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯å¾ˆå¤škeyã€‚</span></strong></p><p><span>è§£å†³æ–¹æ³•ï¼š</span></p><ul><li><p><span>é¢„å…ˆè®¾å®š</span></p><ul><li><p><span>ä»¥ç”µå•†ä¸ºä¾‹ï¼Œæ¯ä¸ªå•†å®¶æ ¹æ®åº—é“ºç­‰çº§ï¼ŒæŒ‡å®šè‹¥å¹²æ¬¾ä¸»æ‰“å•†å“ï¼Œåœ¨è´­ç‰©èŠ‚æœŸé—´ï¼ŒåŠ å¤§æ­¤ç±»ä¿¡æ¯keyçš„è¿‡æœŸæ—¶é•¿ æ³¨æ„ï¼šè´­ç‰©èŠ‚ä¸ä»…ä»…æŒ‡å½“å¤©ï¼Œä»¥åŠåç»­è‹¥å¹²å¤©ï¼Œè®¿é—®å³°å€¼å‘ˆç°é€æ¸é™ä½çš„è¶‹åŠ¿</span></p></li></ul></li><li><p><span>ç°åœºè°ƒæ•´</span></p><ul><li><p><span>ç›‘æ§è®¿é—®é‡ï¼Œå¯¹è‡ªç„¶æµé‡æ¿€å¢çš„æ•°æ®å»¶é•¿è¿‡æœŸæ—¶é—´æˆ–è®¾ç½®ä¸ºæ°¸ä¹…æ€§key</span></p></li></ul></li><li><p><span>åå°åˆ·æ–°æ•°æ®</span></p><ul><li><p><span>å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé«˜å³°æœŸæ¥ä¸´ä¹‹å‰ï¼Œåˆ·æ–°æ•°æ®æœ‰æ•ˆæœŸï¼Œç¡®ä¿ä¸ä¸¢å¤±</span></p></li></ul></li><li><p><span>äºŒçº§ç¼“å­˜</span></p><ul><li><p><span>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œä¿éšœä¸ä¼šåœ¨rediså’ŒäºŒçº§ç¼“å­˜åŒæ—¶æ·˜æ±°å°±è¡Œ</span></p></li></ul></li><li><p><span>åŠ é”</span></p><ul><li><p><span>åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¢«å‡»ç©¿ï¼Œä½†æ˜¯è¦æ³¨æ„ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œæ…é‡ï¼</span></p></li></ul></li></ul><h1 id='åä¸€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§'><span>åä¸€ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§</span></h1><h2 id='cache-aside-patternæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰'><span>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</span></h2><ul><li><p><span>ç­–ç•¥ï¼š</span></p><ul><li><p><strong><span>å†™</span></strong><span>ï¼šå…ˆæ›´æ–° dbï¼Œç„¶åç›´æ¥åˆ é™¤ cache ã€‚</span></p></li><li><p><strong><span>è¯»</span></strong><span> : ï¼ˆ1ï¼‰ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›ï¼›ï¼ˆ2ï¼‰cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å›ï¼Œï¼ˆ3ï¼‰å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚</span></p></li><li><p><span>ç†è®ºä¸Šæ¥è¯´å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸è¿‡æ¦‚ç‡éå¸¸å°ï¼Œå› ä¸ºç¼“å­˜çš„å†™å…¥é€Ÿåº¦æ˜¯æ¯”æ•°æ®åº“çš„å†™å…¥é€Ÿåº¦å¿«å¾ˆå¤šã€‚</span></p></li></ul></li><li><p><strong><span>åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° db ä¹ˆï¼Ÿ</span></strong></p><ul><li><p><span>ä¸å¯ä»¥ï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šé€ æˆ </span><strong><span>æ•°æ®åº“ï¼ˆdbï¼‰å’Œç¼“å­˜ï¼ˆCacheï¼‰æ•°æ®ä¸ä¸€è‡´</span></strong><span>çš„é—®é¢˜ã€‚è¯·æ±‚ 1 å…ˆæŠŠ cache ä¸­çš„ A æ•°æ®åˆ é™¤ -&gt; è¯·æ±‚ 2 ä» db ä¸­è¯»å–æ•°æ®-&gt; è¯·æ±‚ 1 å†æŠŠ db ä¸­çš„ A æ•°æ®æ›´æ–°</span></p></li></ul></li><li><p><strong><span>ç¼ºé™· 1ï¼šé¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜</span></strong><span>ï¼Œè§£å†³åŠæ³•ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ cache ä¸­ã€‚</span></p></li><li><p><strong><span>ç¼ºé™· 2ï¼šå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¯å¯¼è‡´ cache ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹è¢«åˆ é™¤ï¼Œè¿™æ ·ä¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡ ã€‚</span></strong></p><ul><li><p><span>æ•°æ®åº“å’Œç¼“å­˜æ•°æ®å¼ºä¸€è‡´åœºæ™¯ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé”/åˆ†å¸ƒå¼é”æ¥ä¿è¯æ›´æ–° cache çš„æ—¶å€™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</span></p></li><li><p><span>å¯ä»¥çŸ­æš‚åœ°å…è®¸æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä½†æ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®ä¸ä¸€è‡´çš„è¯å½±å“ä¹Ÿæ¯”è¾ƒå°ã€‚</span></p></li></ul></li></ul><h2 id='readwrite-through-patternè¯»å†™ç©¿é€ï¼‰'><span>Read/Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰</span></h2><p><span>Read/Write Through Pattern ä¸­æœåŠ¡ç«¯æŠŠ cache è§†ä¸ºä¸»è¦æ•°æ®å­˜å‚¨ï¼Œä»ä¸­è¯»å–æ•°æ®å¹¶å°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚cache æœåŠ¡è´Ÿè´£å°†æ­¤æ•°æ®è¯»å–å’Œå†™å…¥ dbï¼Œä»è€Œå‡è½»äº†åº”ç”¨ç¨‹åºçš„èŒè´£ã€‚</span></p><p><span>è¿™ç§ç¼“å­˜è¯»å†™ç­–ç•¥å°ä¼™ä¼´ä»¬åº”è¯¥ä¹Ÿå‘ç°äº†åœ¨å¹³æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­éå¸¸å°‘è§ã€‚æŠ›å»æ€§èƒ½æ–¹é¢çš„å½±å“ï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜ Redis å¹¶æ²¡æœ‰æä¾› cache å°†æ•°æ®å†™å…¥ db çš„åŠŸèƒ½ã€‚</span></p><ul><li><p><strong><span>ç­–ç•¥ï¼š</span></strong></p><ul><li><p><strong><span>å†™ï¼ˆWrite Throughï¼‰ï¼š</span></strong></p><ul><li><p><span>å…ˆæŸ¥ cacheï¼Œcache ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° dbã€‚</span></p></li><li><p><span>cache ä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–° cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° dbï¼ˆ</span><strong><span>åŒæ­¥æ›´æ–° cache å’Œ db</span></strong><span>ï¼‰ã€‚</span></p></li></ul></li><li><p><strong><span>è¯»(Read Through)ï¼š</span></strong></p><ul><li><p><span>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚</span></p></li><li><p><span>è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚</span></p></li></ul></li></ul></li><li><p><span>å’Œ Cache Aside Pattern ä¸€æ ·ï¼Œ Read-Through Pattern ä¹Ÿæœ‰é¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸å† cache çš„é—®é¢˜ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ç¼“å­˜ä¸­ã€‚</span></p></li></ul><h2 id='write-behind-patternå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰'><span>Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</span></h2><p><strong><span>Read/Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œè€Œ Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° dbã€‚</span></strong></p><p><span>å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹å¼å¯¹æ•°æ®ä¸€è‡´æ€§å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ï¼Œæ¯”å¦‚ cache æ•°æ®å¯èƒ½è¿˜æ²¡å¼‚æ­¥æ›´æ–° db çš„è¯ï¼Œcache æœåŠ¡å¯èƒ½å°±å°±æŒ‚æ‰äº†ã€‚</span></p><p><span>è¿™ç§ç­–ç•¥åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿéå¸¸éå¸¸å°‘è§ï¼Œä½†æ˜¯ä¸ä»£è¡¨å®ƒçš„åº”ç”¨åœºæ™¯å°‘ï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„å¼‚æ­¥å†™å…¥ç£ç›˜ã€MySQL çš„ Innodb Buffer Pool æœºåˆ¶éƒ½ç”¨åˆ°äº†è¿™ç§ç­–ç•¥ã€‚</span></p><p><span>Write Behind Pattern ä¸‹ db çš„å†™æ€§èƒ½éå¸¸é«˜ï¼Œéå¸¸é€‚åˆä¸€äº›æ•°æ®ç»å¸¸å˜åŒ–åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æµè§ˆé‡ã€ç‚¹èµé‡ã€‚</span></p><h1 id='åäºŒredis-å®æˆ˜'><span>åäºŒã€Redis å®æˆ˜</span></h1><h2 id='redis-å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—'><span>Redis å¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ</span></h2><p><span>å»¶è¿Ÿé˜Ÿåˆ—æ˜¯æŒ‡æŠŠå½“å‰è¦åšçš„äº‹æƒ…ï¼Œå¾€åæ¨è¿Ÿä¸€æ®µæ—¶é—´å†åšã€‚å»¶è¿Ÿé˜Ÿåˆ—çš„å¸¸è§ä½¿ç”¨åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span></p><ul><li><p><span>åœ¨æ·˜å®ã€äº¬ä¸œç­‰è´­ç‰©å¹³å°ä¸Šä¸‹å•ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´æœªä»˜æ¬¾ï¼Œè®¢å•ä¼šè‡ªåŠ¨å–æ¶ˆï¼›</span></p></li><li><p><span>æ‰“è½¦çš„æ—¶å€™ï¼Œåœ¨è§„å®šæ—¶é—´æ²¡æœ‰è½¦ä¸»æ¥å•ï¼Œå¹³å°ä¼šå–æ¶ˆä½ çš„å•å¹¶æé†’ä½ æš‚æ—¶æ²¡æœ‰è½¦ä¸»æ¥å•ï¼›</span></p></li><li><p><span>ç‚¹å¤–å–çš„æ—¶å€™ï¼Œå¦‚æœå•†å®¶åœ¨10åˆ†é’Ÿè¿˜æ²¡æ¥å•ï¼Œå°±ä¼šè‡ªåŠ¨å–æ¶ˆè®¢å•ï¼›</span></p></li></ul><p><span>åœ¨ Redis å¯ä»¥ä½¿ç”¨æœ‰åºé›†åˆï¼ˆZSetï¼‰çš„æ–¹å¼æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„ï¼ŒZSet æœ‰ä¸€ä¸ª Score å±æ€§å¯ä»¥ç”¨æ¥å­˜å‚¨å»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´ã€‚</span></p><p><strong><span>ä½¿ç”¨ zadd score1 value1 å‘½ä»¤å°±å¯ä»¥ä¸€ç›´å¾€å†…å­˜ä¸­ç”Ÿäº§æ¶ˆæ¯ã€‚å†åˆ©ç”¨ zrangebysocre æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œ é€šè¿‡å¾ªç¯æ‰§è¡Œé˜Ÿåˆ—ä»»åŠ¡å³å¯ã€‚</span></strong></p><h2 id='redis-ç®¡é“æœ‰ä»€ä¹ˆç”¨'><span>Redis ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></h2><p><span>ç®¡é“æŠ€æœ¯ï¼ˆPipelineï¼‰æ˜¯å®¢æˆ·ç«¯æä¾›çš„ä¸€ç§æ‰¹å¤„ç†æŠ€æœ¯ï¼Œç”¨äºä¸€æ¬¡å¤„ç†å¤šä¸ª Redis å‘½ä»¤ï¼Œä»è€Œæé«˜æ•´ä¸ªäº¤äº’çš„æ€§èƒ½ã€‚</span></p><p><span>ä½¿ç”¨</span><strong><span>ç®¡é“æŠ€æœ¯å¯ä»¥è§£å†³å¤šä¸ªå‘½ä»¤æ‰§è¡Œæ—¶çš„ç½‘ç»œç­‰å¾…</span></strong><span>ï¼Œå®ƒæ˜¯æŠŠå¤šä¸ªå‘½ä»¤æ•´åˆåˆ°ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ç«¯å¤„ç†ä¹‹åç»Ÿä¸€è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±å…å»äº†æ¯æ¡å‘½ä»¤æ‰§è¡Œåéƒ½è¦ç­‰å¾…çš„æƒ…å†µï¼Œä»è€Œæœ‰æ•ˆåœ°æé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</span></p><p><span>ä½†ä½¿ç”¨ç®¡é“æŠ€æœ¯ä¹Ÿè¦æ³¨æ„é¿å…å‘é€çš„å‘½ä»¤è¿‡å¤§ï¼Œæˆ–ç®¡é“å†…çš„æ•°æ®å¤ªå¤šè€Œå¯¼è‡´çš„ç½‘ç»œé˜»å¡ã€‚</span></p><p><span>è¦æ³¨æ„çš„æ˜¯ï¼Œç®¡é“æŠ€æœ¯æœ¬è´¨ä¸Šæ˜¯å®¢æˆ·ç«¯æä¾›çš„åŠŸèƒ½ï¼Œè€Œé Redis æœåŠ¡å™¨ç«¯çš„åŠŸèƒ½ã€‚</span></p><p><span>æ™®é€šå‘½ä»¤æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="assets/image-20240622154255229.png" referrerpolicy="no-referrer" alt="image-20240622154255229"></p><p><span>ç®¡é“æ¨¡å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="assets/image-20240622154306795.png" referrerpolicy="no-referrer" alt="image-20240622154306795"></p><h2 id='redis-äº‹åŠ¡æ”¯æŒå›æ»šå—'><span>Redis äº‹åŠ¡æ”¯æŒå›æ»šå—ï¼Ÿ</span></h2><p><span>MySQL åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¼šæä¾›å›æ»šæœºåˆ¶ï¼Œå½“äº‹åŠ¡æ‰§è¡Œå‘ç”Ÿé”™è¯¯æ—¶ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šæ’¤é”€ï¼Œå·²ç»ä¿®æ”¹çš„æ•°æ®ä¹Ÿä¼šè¢«æ¢å¤åˆ°äº‹åŠ¡æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚</span></p><p><strong><span>Redis ä¸­å¹¶æ²¡æœ‰æä¾›å›æ»šæœºåˆ¶</span></strong><span>ï¼Œè™½ç„¶ Redis æä¾›äº† DISCARD å‘½ä»¤ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤åªèƒ½ç”¨æ¥ä¸»åŠ¨æ”¾å¼ƒäº‹åŠ¡æ‰§è¡Œï¼ŒæŠŠæš‚å­˜çš„å‘½ä»¤é˜Ÿåˆ—æ¸…ç©ºï¼Œèµ·ä¸åˆ°å›æ»šçš„æ•ˆæœã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#è¯»å– count çš„å€¼4</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">GET</span> <span class="cm-variable">count</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å¼€å¯äº‹åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">MULTI</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">OK</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å‘é€äº‹åŠ¡çš„ç¬¬ä¸€ä¸ªæ“ä½œï¼Œå¯¹countå‡1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">DECR</span> <span class="cm-variable">count</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QUEUED</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#æ‰§è¡ŒDISCARDå‘½ä»¤ï¼Œä¸»åŠ¨æ”¾å¼ƒäº‹åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">DISCARD</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">OK</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å†æ¬¡è¯»å–a:stockçš„å€¼ï¼Œå€¼æ²¡æœ‰è¢«ä¿®æ”¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">GET</span> <span class="cm-variable">count</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"1"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 345px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><p>&nbsp;</p><p><span>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘½ä»¤å…¥é˜Ÿæ—¶æ²¡æŠ¥é”™ï¼Œè€Œäº‹åŠ¡æäº¤åï¼Œå®é™…æ‰§è¡Œæ—¶æŠ¥é”™äº†ï¼Œæ­£ç¡®çš„å‘½ä»¤ä¾ç„¶å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥è¿™å¯ä»¥çœ‹å‡º </span><strong><span>Redis å¹¶ä¸ä¸€å®šä¿è¯åŸå­æ€§</span></strong><span>ï¼ˆåŸå­æ€§ï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¸å…¨éƒ¨æˆåŠŸï¼Œè¦ä¸å…¨éƒ¨å¤±è´¥ï¼‰ã€‚</span></p><p><span>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#è·å–nameåŸæœ¬çš„å€¼</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">GET</span> <span class="cm-variable">name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"xiaolin"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å¼€å¯äº‹åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">MULTI</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">OK</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#è®¾ç½®æ–°å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span>(<span class="cm-variable">TX</span>)<span class="cm-operator">&gt;</span> <span class="cm-variable">SET</span> <span class="cm-variable">name</span> <span class="cm-variable">xialincoding</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QUEUED</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#æ³¨æ„ï¼Œè¿™æ¡å‘½ä»¤æ˜¯é”™è¯¯çš„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta"># expire è¿‡æœŸæ—¶é—´æ­£ç¡®æ¥è¯´æ˜¯æ•°å­—ï¼Œå¹¶ä¸æ˜¯â€˜10sâ€™å­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿˜æ˜¯å…¥é˜ŸæˆåŠŸäº†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span>(<span class="cm-variable">TX</span>)<span class="cm-operator">&gt;</span> <span class="cm-variable">EXPIRE</span> <span class="cm-variable">name</span> <span class="cm-number">10</span><span class="cm-variable">s</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QUEUED</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#æäº¤äº‹åŠ¡ï¼Œæ‰§è¡ŒæŠ¥é”™</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å¯ä»¥çœ‹åˆ° set æ‰§è¡ŒæˆåŠŸï¼Œè€Œ expire æ‰§è¡Œé”™è¯¯ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span>(<span class="cm-variable">TX</span>)<span class="cm-operator">&gt;</span> <span class="cm-variable">EXEC</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span>) <span class="cm-variable">OK</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span>) (<span class="cm-variable">error</span>) <span class="cm-variable">ERR</span> <span class="cm-variable">value</span> <span class="cm-variable">is</span> <span class="cm-variable">not</span> <span class="cm-variable">an</span> <span class="cm-variable">integer</span> <span class="cm-variable">or</span> <span class="cm-variable">out</span> <span class="cm-variable">of</span> <span class="cm-variable">range</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#å¯ä»¥çœ‹åˆ°ï¼Œname è¿˜æ˜¯è¢«è®¾ç½®ä¸ºæ–°å€¼äº†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">127.0</span>.<span class="cm-number">0.1</span>:<span class="cm-number">6379</span><span class="cm-operator">&gt;</span> <span class="cm-variable">GET</span> <span class="cm-variable">name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"xialincoding"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>ä¸ºä»€ä¹ˆRedis ä¸æ”¯æŒäº‹åŠ¡å›æ»šï¼Ÿ</span></p><p><span>ä½œè€…ä¸æ”¯æŒäº‹åŠ¡å›æ»šçš„åŸå› æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</span></p><ul><li><p><span>ä»–è®¤ä¸º Redis äº‹åŠ¡çš„æ‰§è¡Œæ—¶ï¼Œé”™è¯¯é€šå¸¸éƒ½æ˜¯ç¼–ç¨‹é”™è¯¯é€ æˆçš„ï¼Œè¿™ç§é”™è¯¯é€šå¸¸åªä¼šå‡ºç°åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œè€Œå¾ˆå°‘ä¼šåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°ï¼Œæ‰€ä»¥ä»–è®¤ä¸ºæ²¡æœ‰å¿…è¦ä¸º Redis å¼€å‘äº‹åŠ¡å›æ»šåŠŸèƒ½ï¼›</span></p></li><li><p><span>ä¸æ”¯æŒäº‹åŠ¡å›æ»šæ˜¯å› ä¸ºè¿™ç§å¤æ‚çš„åŠŸèƒ½å’Œ Redis è¿½æ±‚çš„ç®€å•é«˜æ•ˆçš„è®¾è®¡ä¸»æ—¨ä¸ç¬¦åˆã€‚</span></p></li></ul><p><span>è¿™é‡Œä¸æ”¯æŒäº‹åŠ¡å›æ»šï¼ŒæŒ‡çš„æ˜¯</span><strong><span>ä¸æ”¯æŒäº‹åŠ¡è¿è¡Œæ—¶é”™è¯¯çš„äº‹åŠ¡å›æ»šã€‚</span></strong></p><h2 id='å¦‚ä½•ç”¨-redis-å®ç°åˆ†å¸ƒå¼é”çš„'><span>å¦‚ä½•ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”çš„ï¼Ÿ</span></h2><p><span>åˆ†å¸ƒå¼é”æ˜¯ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¹¶å‘æ§åˆ¶çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶æŸä¸ªèµ„æºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªåº”ç”¨æ‰€ä½¿ç”¨ã€‚</span></p><p><span>Redis æœ¬èº«å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«è®¿é—®ï¼Œæ­£å¥½å°±æ˜¯ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜åˆ†å¸ƒå¼é”ï¼Œè€Œä¸” Redis çš„è¯»å†™æ€§èƒ½é«˜ï¼Œå¯ä»¥åº”å¯¹é«˜å¹¶å‘çš„é”æ“ä½œåœºæ™¯ã€‚</span></p><p><span>Redis çš„ SET å‘½ä»¤æœ‰ä¸ª NX å‚æ•°å¯ä»¥å®ç°ã€Œkeyä¸å­˜åœ¨æ‰æ’å…¥ã€ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</span></p><ul><li><p><span>å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ’å…¥æˆåŠŸï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”æˆåŠŸï¼›</span></p></li><li><p><span>å¦‚æœ key å­˜åœ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’å…¥å¤±è´¥ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</span></p></li></ul><p><span>åŸºäº Redis èŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œå¯¹äºåŠ é”æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚</span></p><ul><li><p><span>åŠ é”åŒ…æ‹¬äº†è¯»å–é”å˜é‡ã€æ£€æŸ¥é”å˜é‡å€¼å’Œè®¾ç½®é”å˜é‡å€¼ä¸‰ä¸ªæ“ä½œï¼Œä½†éœ€è¦ä»¥åŸå­æ“ä½œçš„æ–¹å¼å®Œæˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ SET å‘½ä»¤å¸¦ä¸Š NX é€‰é¡¹æ¥å®ç°åŠ é”ï¼›</span></p></li><li><p><span>é”å˜é‡éœ€è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä»¥å…å®¢æˆ·ç«¯æ‹¿åˆ°é”åå‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´é”ä¸€ç›´æ— æ³•é‡Šæ”¾ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ SET å‘½ä»¤æ‰§è¡Œæ—¶åŠ ä¸Š EX/PX é€‰é¡¹ï¼Œè®¾ç½®å…¶è¿‡æœŸæ—¶é—´ï¼›</span></p></li><li><p><span>é”å˜é‡çš„å€¼éœ€è¦èƒ½åŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„åŠ é”æ“ä½œï¼Œä»¥å…åœ¨é‡Šæ”¾é”æ—¶ï¼Œå‡ºç°è¯¯é‡Šæ”¾æ“ä½œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ SET å‘½ä»¤è®¾ç½®é”å˜é‡å€¼æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„å€¼æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œç”¨äºæ ‡è¯†å®¢æˆ·ç«¯ï¼›</span></p></li></ul><p><span>æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶çš„åˆ†å¸ƒå¼å‘½ä»¤å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SET</span> lock_key unique_value NX PX <span class="cm-number">10000</span> </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>lock_key å°±æ˜¯ key é”®ï¼›</span></p></li><li><p><span>unique_value æ˜¯å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„é”æ“ä½œï¼›</span></p></li><li><p><span>NX ä»£è¡¨åªåœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹ lock_key è¿›è¡Œè®¾ç½®æ“ä½œï¼›</span></p></li><li><p><span>PX 10000 è¡¨ç¤ºè®¾ç½® lock_key çš„è¿‡æœŸæ—¶é—´ä¸º 10sï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸è€Œæ— æ³•é‡Šæ”¾é”ã€‚</span></p></li></ul><p><span>è€Œè§£é”çš„è¿‡ç¨‹å°±æ˜¯å°† lock_key é”®åˆ é™¤ï¼ˆdel lock_keyï¼‰ï¼Œä½†ä¸èƒ½ä¹±åˆ ï¼Œè¦ä¿è¯æ‰§è¡Œæ“ä½œçš„å®¢æˆ·ç«¯å°±æ˜¯åŠ é”çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œè§£é”çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­é”çš„ unique_value æ˜¯å¦ä¸ºåŠ é”å®¢æˆ·ç«¯ï¼Œæ˜¯çš„è¯ï¼Œæ‰å°† lock_key é”®åˆ é™¤ã€‚</span></p><p><span>å¯ä»¥çœ‹åˆ°ï¼Œè§£é”æ˜¯æœ‰ä¸¤ä¸ªæ“ä½œï¼Œè¿™æ—¶å°±éœ€è¦ Lua è„šæœ¬æ¥ä¿è¯è§£é”çš„åŸå­æ€§ï¼Œå› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚</span></p><p><span>åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„</span><strong><span>ä¼˜ç‚¹</span></strong><span>ï¼š</span></p><ol start='' ><li><p><span>æ€§èƒ½é«˜æ•ˆï¼ˆè¿™æ˜¯é€‰æ‹©ç¼“å­˜å®ç°åˆ†å¸ƒå¼é”æœ€æ ¸å¿ƒçš„å‡ºå‘ç‚¹ï¼‰ã€‚</span></p></li><li><p><span>å®ç°æ–¹ä¾¿ã€‚å¾ˆå¤šç ”å‘å·¥ç¨‹å¸ˆé€‰æ‹©ä½¿ç”¨ Redis æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œå¾ˆå¤§æˆåˆ†ä¸Šæ˜¯å› ä¸º Redis æä¾›äº† setnx æ–¹æ³•ï¼Œå®ç°åˆ†å¸ƒå¼é”å¾ˆæ–¹ä¾¿ã€‚</span></p></li><li><p><span>é¿å…å•ç‚¹æ•…éšœï¼ˆå› ä¸º Redis æ˜¯è·¨é›†ç¾¤éƒ¨ç½²çš„ï¼Œè‡ªç„¶å°±é¿å…äº†å•ç‚¹æ•…éšœï¼‰ã€‚</span></p></li></ol><p><span>åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„</span><strong><span>ç¼ºç‚¹</span></strong><span>ï¼š</span></p><ul><li><p><span>è¶…æ—¶æ—¶é—´ä¸å¥½è®¾ç½®</span></p><p><span>ã€‚å¦‚æœé”çš„è¶…æ—¶æ—¶é—´è®¾ç½®è¿‡é•¿ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œå¦‚æœè®¾ç½®çš„è¶…æ—¶æ—¶é—´è¿‡çŸ­ä¼šä¿æŠ¤ä¸åˆ°å…±äº«èµ„æºã€‚æ¯”å¦‚åœ¨æœ‰äº›åœºæ™¯ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹ A è·å–åˆ°äº†é”ä¹‹åï¼Œç”±äºä¸šåŠ¡ä»£ç æ‰§è¡Œæ—¶é—´å¯èƒ½æ¯”è¾ƒé•¿ï¼Œå¯¼è‡´è¶…è¿‡äº†é”çš„è¶…æ—¶æ—¶é—´ï¼Œè‡ªåŠ¨å¤±æ•ˆï¼Œæ³¨æ„ A çº¿ç¨‹æ²¡æ‰§è¡Œå®Œï¼Œåç»­çº¿ç¨‹ B åˆæ„å¤–çš„æŒæœ‰äº†é”ï¼Œæ„å‘³ç€å¯ä»¥æ“ä½œå…±äº«èµ„æºï¼Œé‚£ä¹ˆä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«èµ„æºå°±æ²¡åŠæ³•è¿›è¡Œä¿æŠ¤äº†ã€‚</span></p><ul><li><p><strong><span>é‚£ä¹ˆå¦‚ä½•åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´å‘¢ï¼Ÿ</span></strong><span> æˆ‘ä»¬å¯ä»¥åŸºäºç»­çº¦çš„æ–¹å¼è®¾ç½®è¶…æ—¶æ—¶é—´ï¼šå…ˆç»™é”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè®©å®ˆæŠ¤çº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´åï¼Œé‡æ–°è®¾ç½®è¿™ä¸ªé”çš„è¶…æ—¶æ—¶é—´ã€‚å®ç°æ–¹å¼å°±æ˜¯ï¼šå†™ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œç„¶åå»åˆ¤æ–­é”çš„æƒ…å†µï¼Œå½“é”å¿«å¤±æ•ˆçš„æ—¶å€™ï¼Œå†æ¬¡è¿›è¡Œç»­çº¦åŠ é”ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œé”€æ¯ç»­çº¦é”å³å¯ï¼Œä¸è¿‡è¿™ç§æ–¹å¼å®ç°èµ·æ¥ç›¸å¯¹å¤æ‚ã€‚</span></p></li></ul></li><li><p><strong><span>Redis ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸­çš„æ•°æ®æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼Œè¿™æ ·å¯¼è‡´åˆ†å¸ƒå¼é”çš„ä¸å¯é æ€§</span></strong><span>ã€‚å¦‚æœåœ¨ Redis ä¸»èŠ‚ç‚¹è·å–åˆ°é”åï¼Œåœ¨æ²¡æœ‰åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹æ—¶ï¼ŒRedis ä¸»èŠ‚ç‚¹å®•æœºäº†ï¼Œæ­¤æ—¶æ–°çš„ Redis ä¸»èŠ‚ç‚¹ä¾ç„¶å¯ä»¥è·å–é”ï¼Œæ‰€ä»¥å¤šä¸ªåº”ç”¨æœåŠ¡å°±å¯ä»¥åŒæ—¶è·å–åˆ°é”ã€‚</span></p></li><li><p><span>ä¸ºäº†ä¿è¯é›†ç¾¤ç¯å¢ƒä¸‹åˆ†å¸ƒå¼é”çš„å¯é æ€§ï¼ŒRedis å®˜æ–¹å·²ç»è®¾è®¡äº†ä¸€ä¸ªåˆ†å¸ƒå¼é”ç®—æ³• Redlockï¼ˆçº¢é”ï¼‰ã€‚</span></p><p><span>å®ƒæ˜¯åŸºäº</span><strong><span>å¤šä¸ª Redis èŠ‚ç‚¹</span></strong><span>çš„åˆ†å¸ƒå¼é”ï¼Œå³ä½¿æœ‰èŠ‚ç‚¹å‘ç”Ÿäº†æ•…éšœï¼Œé”å˜é‡ä»ç„¶æ˜¯å­˜åœ¨çš„ï¼Œå®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥å®Œæˆé”æ“ä½œã€‚å®˜æ–¹æ¨èæ˜¯è‡³å°‘éƒ¨ç½² 5 ä¸ª Redis èŠ‚ç‚¹ï¼Œè€Œä¸”éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéƒ½æ˜¯ä¸€ä¸ªä¸ªå­¤ç«‹çš„èŠ‚ç‚¹ã€‚</span></p><p><span>Redlock ç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼Œ</span><strong><span>æ˜¯è®©å®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ä¾æ¬¡è¯·æ±‚ç”³è¯·åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°è·å¾—åˆ†å¸ƒå¼é”ï¼Œå¦åˆ™åŠ é”å¤±è´¥</span></strong><span>ã€‚</span></p><p><strong><span>è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æœ‰æŸä¸ª Redis èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå› ä¸ºé”çš„æ•°æ®åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šä¹Ÿæœ‰ä¿å­˜ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æ­£å¸¸åœ°è¿›è¡Œé”æ“ä½œï¼Œé”çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</span></strong></p><p><span>Redlock ç®—æ³•åŠ é”ä¸‰ä¸ªè¿‡ç¨‹ï¼š</span></p><ul><li><p><span>ç¬¬ä¸€æ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´ï¼ˆt1ï¼‰ã€‚</span></p></li><li><p><span>ç¬¬äºŒæ­¥æ˜¯ï¼Œå®¢æˆ·ç«¯æŒ‰é¡ºåºä¾æ¬¡å‘ N ä¸ª Redis èŠ‚ç‚¹æ‰§è¡ŒåŠ é”æ“ä½œï¼š</span></p><ul><li><p><span>åŠ é”æ“ä½œä½¿ç”¨ SET å‘½ä»¤ï¼Œå¸¦ä¸Š NXï¼ŒEX/PX é€‰é¡¹ï¼Œä»¥åŠå¸¦ä¸Šå®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ã€‚</span></p></li><li><p><span>å¦‚æœæŸä¸ª Redis èŠ‚ç‚¹å‘ç”Ÿæ•…éšœäº†ï¼Œä¸ºäº†ä¿è¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRedlock ç®—æ³•èƒ½å¤Ÿç»§ç»­è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦ç»™ã€ŒåŠ é”æ“ä½œã€è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼ˆä¸æ˜¯å¯¹ã€Œé”ã€è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè€Œæ˜¯å¯¹ã€ŒåŠ é”æ“ä½œã€è®¾ç½®è¶…æ—¶æ—¶é—´ï¼‰ï¼ŒåŠ é”æ“ä½œçš„è¶…æ—¶æ—¶é—´éœ€è¦è¿œè¿œåœ°å°äºé”çš„è¿‡æœŸæ—¶é—´ï¼Œä¸€èˆ¬ä¹Ÿå°±æ˜¯è®¾ç½®ä¸ºå‡ åæ¯«ç§’ã€‚</span></p></li></ul></li><li><p><span>ç¬¬ä¸‰æ­¥æ˜¯ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ä»è¶…è¿‡åŠæ•°ï¼ˆå¤§äºç­‰äº N/2+1ï¼‰çš„ Redis èŠ‚ç‚¹ä¸ŠæˆåŠŸè·å–åˆ°äº†é”ï¼Œå°±å†æ¬¡è·å–å½“å‰æ—¶é—´ï¼ˆt2ï¼‰ï¼Œç„¶åè®¡ç®—è®¡ç®—æ•´ä¸ªåŠ é”è¿‡ç¨‹çš„æ€»è€—æ—¶ï¼ˆt2-t1ï¼‰ã€‚å¦‚æœ t2-t1 &lt; é”çš„è¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶ï¼Œè®¤ä¸ºå®¢æˆ·ç«¯åŠ é”æˆåŠŸï¼Œå¦åˆ™è®¤ä¸ºåŠ é”å¤±è´¥ã€‚</span></p></li></ul><p><span>å¯ä»¥çœ‹åˆ°ï¼ŒåŠ é”æˆåŠŸè¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼ˆ</span><em><span>ç®€è¿°ï¼šå¦‚æœæœ‰è¶…è¿‡åŠæ•°çš„ Redis èŠ‚ç‚¹æˆåŠŸçš„è·å–åˆ°äº†é”ï¼Œå¹¶ä¸”æ€»è€—æ—¶æ²¡æœ‰è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´ï¼Œé‚£ä¹ˆå°±æ˜¯åŠ é”æˆåŠŸ</span></em><span>ï¼‰ï¼š</span></p><ul><li><p><span>æ¡ä»¶ä¸€ï¼šå®¢æˆ·ç«¯ä»è¶…è¿‡åŠæ•°ï¼ˆå¤§äºç­‰äº N/2+1ï¼‰çš„ Redis èŠ‚ç‚¹ä¸ŠæˆåŠŸè·å–åˆ°äº†é”ï¼›</span></p></li><li><p><span>æ¡ä»¶äºŒï¼šå®¢æˆ·ç«¯ä»å¤§å¤šæ•°èŠ‚ç‚¹è·å–é”çš„æ€»è€—æ—¶ï¼ˆt2-t1ï¼‰å°äºé”è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚</span></p></li></ul><p><span>åŠ é”æˆåŠŸåï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°è®¡ç®—è¿™æŠŠé”çš„æœ‰æ•ˆæ—¶é—´ï¼Œè®¡ç®—çš„ç»“æœæ˜¯ã€Œé”æœ€åˆè®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€å‡å»ã€Œå®¢æˆ·ç«¯ä»å¤§å¤šæ•°èŠ‚ç‚¹è·å–é”çš„æ€»è€—æ—¶ï¼ˆt2-t1ï¼‰ã€ã€‚å¦‚æœè®¡ç®—çš„ç»“æœå·²ç»æ¥ä¸åŠå®Œæˆå…±äº«æ•°æ®çš„æ“ä½œäº†ï¼Œæˆ‘ä»¬å¯ä»¥é‡Šæ”¾é”ï¼Œä»¥å…å‡ºç°è¿˜æ²¡å®Œæˆæ•°æ®æ“ä½œï¼Œé”å°±è¿‡æœŸäº†çš„æƒ…å†µã€‚</span></p><p><span>åŠ é”å¤±è´¥åï¼Œå®¢æˆ·ç«¯å‘</span><strong><span>æ‰€æœ‰ Redis èŠ‚ç‚¹å‘èµ·é‡Šæ”¾é”çš„æ“ä½œ</span></strong><span>ï¼Œé‡Šæ”¾é”çš„æ“ä½œå’Œåœ¨å•èŠ‚ç‚¹ä¸Šé‡Šæ”¾é”çš„æ“ä½œä¸€æ ·ï¼Œåªè¦æ‰§è¡Œé‡Šæ”¾é”çš„ Lua è„šæœ¬å°±å¯ä»¥äº†ã€‚</span></p></li></ul></div></div>

<script>(function(){var e=document.body.parentElement,t=[],n=null,i=document.body.classList.contains("typora-export-collapse-outline"),r=function(e,t,n){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var i=e.target;i&&i!=this;i=i.parentNode)if(i.matches(t)){!1===n.call(i,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)};function o(){return e.scrollTop}r("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),d(),!1}),r("click",".outline-item",function(e){var t=this.querySelector(".outline-label");if(location.hash="#"+t.getAttribute("href"),i){var n=this.closest(".outline-item-wrapper").classList;n.contains("outline-item-open")||n.add("outline-item-open"),c(),n.add("outline-item-active")}});var a,s,l=function(){var e=o();n=null;for(var i=0;i<t.length&&t[i][1]-e<60;i++)n=t[i]},c=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},d=function(){if(n){c();var e=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(n[0]):n[0])+'"]');if(e)if(i){var t=e.closest(".outline-item-open>ul>.outline-item-wrapper");if(t)t.classList.add("outline-item-active");else{for(var r=(e=e.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");r;)r=(e=r).parentElement.closest(".outline-item-wrapper");e.classList.add("outline-item-active")}}else e.closest(".outline-item-wrapper").classList.add("outline-item-active")}};window.addEventListener("scroll",function(e){a&&clearTimeout(a),a=setTimeout(function(){l(),d()},300)});var u=function(){s=setTimeout(function(){!function(){t=[];var e=o();document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(n=>{var i=n.getAttribute("id");t.push([i,e+n.getBoundingClientRect().y])})}(),l(),d()},300)};window.addEventListener("resize",function(e){s&&clearTimeout(s),u()}),u()})();</script></body>
</html>