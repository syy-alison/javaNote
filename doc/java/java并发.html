<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-variant-emoji: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>javaå¹¶å‘</title>
</head>
<body class='typora-export typora-export-show-outline typora-export-no-collapse-outline'><div class='typora-export-content'>
<div class="typora-export-sidebar"><div class="outline-content"><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#"><strong>ğŸ </strong></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸€çº¿ç¨‹æ¦‚å¿µ">ä¸€ã€çº¿ç¨‹æ¦‚å¿µ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#è¿›ç¨‹">è¿›ç¨‹ </a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹">çº¿ç¨‹ </a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#è¿›ç¨‹vsçº¿ç¨‹">è¿›ç¨‹VSçº¿ç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#java-çº¿ç¨‹vsæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹">Java çº¿ç¨‹VSæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹è¿è¡Œçš„åŸç†">çº¿ç¨‹è¿è¡Œçš„åŸç†</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹">çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#start-ä¸-run">start() ä¸ run()</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#sleepä¸wait">sleep()ä¸wait()</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#yield-è®©å‡ºå½“å‰çº¿ç¨‹ï¼‰">yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#join">join()</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å®ˆæŠ¤çº¿ç¨‹daemon">å®ˆæŠ¤çº¿ç¨‹Daemon</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•">ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#park--unpark">Park &amp; Unpark</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#äºŒå¤šçº¿ç¨‹">äºŒã€å¤šçº¿ç¨‹</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«">å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜">ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨">å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹æ­»é”">çº¿ç¨‹æ­»é”</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶">çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•é¿å…æ­»é”">å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•æ£€æµ‹æ­»é”">å¦‚ä½•æ£€æµ‹æ­»é”ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ ">çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ </a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸‰å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹">ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å…±äº«é—®é¢˜">å…±äº«é—®é¢˜</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#synchronized-å…³é”®å­—åŸå­æ€§å¯è§æ€§ï¼‰">synchronized å…³é”®å­—ï¼ˆåŸå­æ€§+å¯è§æ€§ï¼‰</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ€ä¹ˆä½¿ç”¨">æ€ä¹ˆä½¿ç”¨ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åº•å±‚åŸç†">åº•å±‚åŸç†</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å®ç°é‡å…¥">å®ç°é‡å…¥</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é”å‡çº§è¿‡ç¨‹">é”å‡çº§è¿‡ç¨‹</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å››locké”">å››ã€locké”</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ˜¯ä»€ä¹ˆ-2">æ˜¯ä»€ä¹ˆï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#reentrantlock">ReentrantLock</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ç®€ä»‹">ç®€ä»‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä½¿ç”¨">ä½¿ç”¨</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä½¿ç”¨-trylock-è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜">ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#33-readwritelocké”">3.3 ReadWriteLocké”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#34-synchronized-vs-reentrantlock">3.4 synchronized VS ReentrantLock</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#äº”volatileå…³é”®å­—å¯è§æ€§æœ‰åºæ€§ï¼‰">äº”ã€volatileå…³é”®å­—ï¼ˆå¯è§æ€§&amp;æœ‰åºæ€§ï¼‰</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#41-è¦ç‚¹">4.1 è¦ç‚¹ </a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#42-javaå†…å­˜æ¨¡å‹">4.2 Javaå†…å­˜æ¨¡å‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#43-synchronize-vs-volatile">4.3 synchronize VS volatile</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#44-volatileåŸç†">4.4 volatileåŸç†</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æœ‰åºæ€§">æœ‰åºæ€§</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å…­threadlocal">å…­ã€ThreadLocal</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalä¸sychronizedçš„å¯¹æ¯”">ThreadLocalä¸sychronizedçš„å¯¹æ¯”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalçš„keyçš„å¼±å¼•ç”¨ä¸å†…å­˜æ³„æ¼"><code>ThreadLocal</code>çš„keyçš„<strong>å¼±å¼•ç”¨</strong>ä¸å†…å­˜æ³„æ¼</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalçš„å®ç°è¿‡ç¨‹">ThreadLocalçš„å®ç°è¿‡ç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalå¸¸ç”¨æ–¹æ³•">ThreadLocalå¸¸ç”¨æ–¹æ³•</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#541-setvalueæ–¹æ³•">5.4.1 set(value)æ–¹æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#542-getæ–¹æ³•">5.4.2 get()æ–¹æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#543-removeæ–¹æ³•">5.4.3 remove()æ–¹æ³•</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmap">ThreadLocalMap</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmap-hashç®—æ³•">ThreadLocalMap Hashç®—æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmap-hashå†²çª">ThreadLocalMap Hashå†²çª</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmapsetæ–¹æ³•">ThreadLocalMap.set()æ–¹æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmapæ‰©å®¹æœºåˆ¶">ThreadLocalMapæ‰©å®¹æœºåˆ¶</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmapgetæ–¹æ³•">ThreadLocalMap.get()æ–¹æ³•</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹">ThreadLocalMapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#threadlocalmapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹">ThreadLocalMapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#inheritablethreadlocal">InheritableThreadLocal</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸ƒçº¿ç¨‹æ± ">ä¸ƒã€çº¿ç¨‹æ± </a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ">ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ">ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± ">ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#executoræ¡†æ¶ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰">Executoræ¡†æ¶ï¼ˆç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1ï¼‰ä»»åŠ¡runnablecallableï¼‰">1ï¼‰ä»»åŠ¡ï¼ˆRunnable/Callableï¼‰</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-ä»»åŠ¡çš„æ‰§è¡Œexecutor">2) ä»»åŠ¡çš„æ‰§è¡Œ(<code>Executor</code>)</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹æ± çš„å‚æ•°">çº¿ç¨‹æ± çš„å‚æ•°</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#çº¿ç¨‹æ± åŸç†åˆ†æ">çº¿ç¨‹æ± åŸç†åˆ†æ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± ">ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± </a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#fixedthreadpool">FixedThreadPool</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#singlethreadpool">SingleThreadPool</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#cachedtreadpool">CachedTreadPool</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å‡ ç§å¸¸è§çš„å¯¹æ¯”">å‡ ç§å¸¸è§çš„å¯¹æ¯”</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-runnableå’Œcallable">1. Runnableå’ŒCallable</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-executeå’Œsubmit">2. execute()å’Œsubmit()</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#shutdownå’Œshutdownnow"><code>shutdown()</code>å’Œ<code>shutdownNow()</code></a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#isterminated-å’Œ-isshutdown"><code>isTerminated()</code> å’Œ <code>isShutdown()</code></a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å…«future">å…«ã€Future</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#future-ç±»æœ‰ä»€ä¹ˆç”¨">Future ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#callable-å’Œ-future-æœ‰ä»€ä¹ˆå…³ç³»">Callable å’Œ Future æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#completablefuture-ç±»æœ‰ä»€ä¹ˆç”¨">CompletableFuture ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ä¹casä¸åŸå­ç±»">ä¹ã€CASä¸åŸå­ç±»</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#cas">CAS</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸå­ç±»">åŸå­ç±»</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸå­æ•´æ•°">åŸå­æ•´æ•°</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸå­æ•°ç»„">åŸå­æ•°ç»„</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸå­å¼•ç”¨">åŸå­å¼•ç”¨</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸå­æ›´æ–°å™¨">åŸå­æ›´æ–°å™¨</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åaqs">åã€AQS</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#aqsåŸç†">AQSåŸç†</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#aqså¯¹èµ„æºçš„å…±äº«æ–¹å¼">AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#semaphore">Semaphore</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#countdownlatch-å€’è®¡æ—¶å™¨ï¼‰">CountDownLatch ï¼ˆå€’è®¡æ—¶å™¨ï¼‰</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#cyclicbarrierå¾ªç¯æ …æ ">CyclicBarrier(å¾ªç¯æ …æ )</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#cyclicbarrier-å’Œ-countdownlatch-çš„åŒºåˆ«">CyclicBarrier å’Œ CountDownLatch çš„åŒºåˆ«</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åä¸€åœºæ™¯é¢˜">åä¸€ã€åœºæ™¯é¢˜</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å“²å­¦å®¶å°±é¤é—®é¢˜">å“²å­¦å®¶å°±é¤é—®é¢˜</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶">åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#äº¤æ›¿è¾“å‡º">äº¤æ›¿è¾“å‡º</a></div><ul class="outline-children"></ul></li></ul></li></div></div><div id='write'  class=''><p><span> </span></p><p>&nbsp;</p><h1><a href='../../README.html'><strong>ğŸ </strong></a></h1><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1238"><a class="md-toc-inner" href="#"><strong>ğŸ </strong></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1241"><a class="md-toc-inner" href="#ä¸€çº¿ç¨‹æ¦‚å¿µ">ä¸€ã€çº¿ç¨‹æ¦‚å¿µ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1242"><a class="md-toc-inner" href="#è¿›ç¨‹">è¿›ç¨‹ </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1250"><a class="md-toc-inner" href="#çº¿ç¨‹">çº¿ç¨‹ </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1260"><a class="md-toc-inner" href="#è¿›ç¨‹vsçº¿ç¨‹">è¿›ç¨‹VSçº¿ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1277"><a class="md-toc-inner" href="#java-çº¿ç¨‹vsæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹">Java çº¿ç¨‹VSæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1295"><a class="md-toc-inner" href="#çº¿ç¨‹è¿è¡Œçš„åŸç†">çº¿ç¨‹è¿è¡Œçš„åŸç†</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1303"><a class="md-toc-inner" href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1323"><a class="md-toc-inner" href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1363"><a class="md-toc-inner" href="#çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹">çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1377"><a class="md-toc-inner" href="#å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1379"><a class="md-toc-inner" href="#start-ä¸-run">start() ä¸ run()</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1387"><a class="md-toc-inner" href="#sleepä¸wait">sleep()ä¸wait()</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1402"><a class="md-toc-inner" href="#yield-è®©å‡ºå½“å‰çº¿ç¨‹ï¼‰">yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1404"><a class="md-toc-inner" href="#join">join()</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1408"><a class="md-toc-inner" href="#å®ˆæŠ¤çº¿ç¨‹daemon">å®ˆæŠ¤çº¿ç¨‹Daemon</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1446"><a class="md-toc-inner" href="#ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•">ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1459"><a class="md-toc-inner" href="#park--unpark">Park &amp; Unpark</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1526"><a class="md-toc-inner" href="#äºŒå¤šçº¿ç¨‹">äºŒã€å¤šçº¿ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1527"><a class="md-toc-inner" href="#å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«">å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1533"><a class="md-toc-inner" href="#ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜">ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1554"><a class="md-toc-inner" href="#å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨">å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1561"><a class="md-toc-inner" href="#çº¿ç¨‹æ­»é”">çº¿ç¨‹æ­»é”</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1562"><a class="md-toc-inner" href="#çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶">çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1574"><a class="md-toc-inner" href="#å¦‚ä½•é¿å…æ­»é”">å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1584"><a class="md-toc-inner" href="#å¦‚ä½•æ£€æµ‹æ­»é”">å¦‚ä½•æ£€æµ‹æ­»é”ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1587"><a class="md-toc-inner" href="#çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ ">çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ </a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1595"><a class="md-toc-inner" href="#ä¸‰å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹">ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1596"><a class="md-toc-inner" href="#å…±äº«é—®é¢˜">å…±äº«é—®é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1617"><a class="md-toc-inner" href="#synchronized-å…³é”®å­—åŸå­æ€§å¯è§æ€§ï¼‰">synchronized å…³é”®å­—ï¼ˆåŸå­æ€§+å¯è§æ€§ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1618"><a class="md-toc-inner" href="#æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1625"><a class="md-toc-inner" href="#æ€ä¹ˆä½¿ç”¨">æ€ä¹ˆä½¿ç”¨ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1654"><a class="md-toc-inner" href="#åº•å±‚åŸç†">åº•å±‚åŸç†</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1691"><a class="md-toc-inner" href="#å®ç°é‡å…¥">å®ç°é‡å…¥</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1693"><a class="md-toc-inner" href="#é”å‡çº§è¿‡ç¨‹">é”å‡çº§è¿‡ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1804"><a class="md-toc-inner" href="#å››locké”">å››ã€locké”</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1805"><a class="md-toc-inner" href="#æ˜¯ä»€ä¹ˆ-2">æ˜¯ä»€ä¹ˆï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1814"><a class="md-toc-inner" href="#reentrantlock">ReentrantLock</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1816"><a class="md-toc-inner" href="#ç®€ä»‹">ç®€ä»‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1840"><a class="md-toc-inner" href="#ä½¿ç”¨">ä½¿ç”¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1842"><a class="md-toc-inner" href="#ä½¿ç”¨-trylock-è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜">ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1845"><a class="md-toc-inner" href="#33-readwritelocké”">3.3 ReadWriteLocké”</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1851"><a class="md-toc-inner" href="#34-synchronized-vs-reentrantlock">3.4 synchronized VS ReentrantLock</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1863"><a class="md-toc-inner" href="#äº”volatileå…³é”®å­—å¯è§æ€§æœ‰åºæ€§ï¼‰">äº”ã€volatileå…³é”®å­—ï¼ˆå¯è§æ€§&amp;æœ‰åºæ€§ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1865"><a class="md-toc-inner" href="#41-è¦ç‚¹">4.1 è¦ç‚¹ </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1885"><a class="md-toc-inner" href="#42-javaå†…å­˜æ¨¡å‹">4.2 Javaå†…å­˜æ¨¡å‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1899"><a class="md-toc-inner" href="#43-synchronize-vs-volatile">4.3 synchronize VS volatile</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1915"><a class="md-toc-inner" href="#44-volatileåŸç†">4.4 volatileåŸç†</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1916"><a class="md-toc-inner" href="#æœ‰åºæ€§">æœ‰åºæ€§</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1957"><a class="md-toc-inner" href="#å…­threadlocal">å…­ã€ThreadLocal</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1963"><a class="md-toc-inner" href="#threadlocalä¸sychronizedçš„å¯¹æ¯”">ThreadLocalä¸sychronizedçš„å¯¹æ¯”</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1977"><a class="md-toc-inner" href="#æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1990"><a class="md-toc-inner" href="#threadlocalçš„keyçš„å¼±å¼•ç”¨ä¸å†…å­˜æ³„æ¼"><code>ThreadLocal</code>çš„keyçš„<strong>å¼±å¼•ç”¨</strong>ä¸å†…å­˜æ³„æ¼</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2020"><a class="md-toc-inner" href="#threadlocalçš„å®ç°è¿‡ç¨‹">ThreadLocalçš„å®ç°è¿‡ç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2037"><a class="md-toc-inner" href="#threadlocalå¸¸ç”¨æ–¹æ³•">ThreadLocalå¸¸ç”¨æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2055"><a class="md-toc-inner" href="#541-setvalueæ–¹æ³•">5.4.1 set(value)æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2064"><a class="md-toc-inner" href="#542-getæ–¹æ³•">5.4.2 get()æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2074"><a class="md-toc-inner" href="#543-removeæ–¹æ³•">5.4.3 remove()æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2080"><a class="md-toc-inner" href="#threadlocalmap">ThreadLocalMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2081"><a class="md-toc-inner" href="#threadlocalmap-hashç®—æ³•">ThreadLocalMap Hashç®—æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2089"><a class="md-toc-inner" href="#threadlocalmap-hashå†²çª">ThreadLocalMap Hashå†²çª</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2092"><a class="md-toc-inner" href="#threadlocalmapsetæ–¹æ³•">ThreadLocalMap.set()æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2122"><a class="md-toc-inner" href="#threadlocalmapæ‰©å®¹æœºåˆ¶">ThreadLocalMapæ‰©å®¹æœºåˆ¶</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2128"><a class="md-toc-inner" href="#threadlocalmapgetæ–¹æ³•">ThreadLocalMap.get()æ–¹æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2134"><a class="md-toc-inner" href="#threadlocalmapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹">ThreadLocalMapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2136"><a class="md-toc-inner" href="#threadlocalmapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹">ThreadLocalMapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2138"><a class="md-toc-inner" href="#inheritablethreadlocal">InheritableThreadLocal</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2141"><a class="md-toc-inner" href="#ä¸ƒçº¿ç¨‹æ± ">ä¸ƒã€çº¿ç¨‹æ± </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2142"><a class="md-toc-inner" href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ">ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2144"><a class="md-toc-inner" href="#ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ">ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2154"><a class="md-toc-inner" href="#ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± ">ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2156"><a class="md-toc-inner" href="#executoræ¡†æ¶ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰">Executoræ¡†æ¶ï¼ˆç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2158"><a class="md-toc-inner" href="#1ï¼‰ä»»åŠ¡runnablecallableï¼‰">1ï¼‰ä»»åŠ¡ï¼ˆRunnable/Callableï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2160"><a class="md-toc-inner" href="#2-ä»»åŠ¡çš„æ‰§è¡Œexecutor">2) ä»»åŠ¡çš„æ‰§è¡Œ(<code>Executor</code>)</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2161"><a class="md-toc-inner" href="#çº¿ç¨‹æ± çš„å‚æ•°">çº¿ç¨‹æ± çš„å‚æ•°</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2191"><a class="md-toc-inner" href="#çº¿ç¨‹æ± åŸç†åˆ†æ">çº¿ç¨‹æ± åŸç†åˆ†æ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2212"><a class="md-toc-inner" href="#ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± ">ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2213"><a class="md-toc-inner" href="#fixedthreadpool">FixedThreadPool</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2233"><a class="md-toc-inner" href="#singlethreadpool">SingleThreadPool</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2253"><a class="md-toc-inner" href="#cachedtreadpool">CachedTreadPool</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2269"><a class="md-toc-inner" href="#å‡ ç§å¸¸è§çš„å¯¹æ¯”">å‡ ç§å¸¸è§çš„å¯¹æ¯”</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n2270"><a class="md-toc-inner" href="#1-runnableå’Œcallable">1. Runnableå’ŒCallable</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n2272"><a class="md-toc-inner" href="#2-executeå’Œsubmit">2. execute()å’Œsubmit()</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n2278"><a class="md-toc-inner" href="#shutdownå’Œshutdownnow"><code>shutdown()</code>å’Œ<code>shutdownNow()</code></a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n2284"><a class="md-toc-inner" href="#isterminated-å’Œ-isshutdown"><code>isTerminated()</code> å’Œ <code>isShutdown()</code></a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2290"><a class="md-toc-inner" href="#å…«future">å…«ã€Future</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2291"><a class="md-toc-inner" href="#future-ç±»æœ‰ä»€ä¹ˆç”¨">Future ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2306"><a class="md-toc-inner" href="#callable-å’Œ-future-æœ‰ä»€ä¹ˆå…³ç³»">Callable å’Œ Future æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2313"><a class="md-toc-inner" href="#completablefuture-ç±»æœ‰ä»€ä¹ˆç”¨">CompletableFuture ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2317"><a class="md-toc-inner" href="#ä¹casä¸åŸå­ç±»">ä¹ã€CASä¸åŸå­ç±»</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2318"><a class="md-toc-inner" href="#cas">CAS</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2329"><a class="md-toc-inner" href="#åŸå­ç±»">åŸå­ç±»</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2331"><a class="md-toc-inner" href="#åŸå­æ•´æ•°">åŸå­æ•´æ•°</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2343"><a class="md-toc-inner" href="#åŸå­æ•°ç»„">åŸå­æ•°ç»„</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2353"><a class="md-toc-inner" href="#åŸå­å¼•ç”¨">åŸå­å¼•ç”¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2364"><a class="md-toc-inner" href="#åŸå­æ›´æ–°å™¨">åŸå­æ›´æ–°å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2375"><a class="md-toc-inner" href="#åaqs">åã€AQS</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2377"><a class="md-toc-inner" href="#aqsåŸç†">AQSåŸç†</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2388"><a class="md-toc-inner" href="#aqså¯¹èµ„æºçš„å…±äº«æ–¹å¼">AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2407"><a class="md-toc-inner" href="#semaphore">Semaphore</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2410"><a class="md-toc-inner" href="#countdownlatch-å€’è®¡æ—¶å™¨ï¼‰">CountDownLatch ï¼ˆå€’è®¡æ—¶å™¨ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2422"><a class="md-toc-inner" href="#cyclicbarrierå¾ªç¯æ …æ ">CyclicBarrier(å¾ªç¯æ …æ )</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2431"><a class="md-toc-inner" href="#cyclicbarrier-å’Œ-countdownlatch-çš„åŒºåˆ«">CyclicBarrier å’Œ CountDownLatch çš„åŒºåˆ«</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2434"><a class="md-toc-inner" href="#åä¸€åœºæ™¯é¢˜">åä¸€ã€åœºæ™¯é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2435"><a class="md-toc-inner" href="#å“²å­¦å®¶å°±é¤é—®é¢˜">å“²å­¦å®¶å°±é¤é—®é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2447"><a class="md-toc-inner" href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2462"><a class="md-toc-inner" href="#åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶">åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2465"><a class="md-toc-inner" href="#äº¤æ›¿è¾“å‡º">äº¤æ›¿è¾“å‡º</a></span></p></div><p>&nbsp;</p><h1 id='ä¸€çº¿ç¨‹æ¦‚å¿µ'><span>ä¸€ã€çº¿ç¨‹æ¦‚å¿µ</span></h1><h2 id='è¿›ç¨‹'><span>è¿›ç¨‹ </span></h2><ul><li><p><span>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰ </span></p></li><li><p><span>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ ã€‚</span></p></li><li><p><span>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚ </span></p></li></ul><h2 id='çº¿ç¨‹'><span>çº¿ç¨‹ </span></h2><ul><li><p><span>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚ </span></p></li><li><p><span>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ </span></p></li><li><p><strong><span>Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºæœ€å°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨</span></strong></p></li><li><p><span>å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„</span><strong><span>å †</span></strong><span>å’Œ</span><strong><span>æ–¹æ³•åŒº</span></strong><span>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„</span><strong><span>ç¨‹åºè®¡æ•°å™¨</span></strong><span>ã€</span><strong><span>è™šæ‹Ÿæœºæ ˆ</span></strong><span>å’Œ</span><strong><span>æœ¬åœ°æ–¹æ³•æ ˆ</span></strong><span>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åšåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</span></p></li></ul><h2 id='è¿›ç¨‹vsçº¿ç¨‹'><span>è¿›ç¨‹VSçº¿ç¨‹</span></h2><ul><li><p><span>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›† </span></p></li><li><p><span>è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº« </span></p></li><li><p><span>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ </span></p><ul><li><p><span>åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPCï¼ˆInter-process communicationï¼‰ </span></p></li><li><p><span>ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTP </span></p></li></ul></li><li><p><span>çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ </span></p></li><li><p><span>çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½</span></p></li></ul><h2 id='java-çº¿ç¨‹vsæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹'><span>Java çº¿ç¨‹VSæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</span></h2><p><strong><span>JDK 1.2 ä¹‹å‰ï¼ŒJava çº¿ç¨‹æ˜¯åŸºäºç»¿è‰²çº¿ç¨‹ï¼ˆGreen Threadsï¼‰å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ç§ç”¨æˆ·çº§çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œ</span></strong><span>ä¹Ÿå°±æ˜¯è¯´ JVM è‡ªå·±æ¨¡æ‹Ÿäº†å¤šçº¿ç¨‹çš„è¿è¡Œï¼Œè€Œä¸ä¾èµ–äºæ“ä½œç³»ç»Ÿã€‚</span><strong><span>ç”±äºç»¿è‰²çº¿ç¨‹å’ŒåŸç”Ÿçº¿ç¨‹æ¯”èµ·æ¥åœ¨ä½¿ç”¨æ—¶æœ‰ä¸€äº›é™åˆ¶ï¼ˆæ¯”å¦‚ç»¿è‰²çº¿ç¨‹ä¸èƒ½ç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„åŠŸèƒ½å¦‚å¼‚æ­¥ I/Oã€åªèƒ½åœ¨ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ä¸Šè¿è¡Œæ— æ³•åˆ©ç”¨å¤šæ ¸ï¼‰</span></strong><span>ï¼Œåœ¨ JDK 1.2 åŠä»¥åï¼ŒJava çº¿ç¨‹æ”¹ä¸ºåŸºäºåŸç”Ÿçº¿ç¨‹ï¼ˆNative Threadsï¼‰å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ JVM ç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿçš„å†…æ ¸çº§çº¿ç¨‹ï¼ˆå†…æ ¸çº¿ç¨‹ï¼‰æ¥å®ç° Java çº¿ç¨‹ï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œçº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ã€‚</span></p><p><span>æˆ‘ä»¬ä¸Šé¢æåˆ°äº†ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ï¼Œè€ƒè™‘åˆ°å¾ˆå¤šè¯»è€…ä¸å¤ªäº†è§£äºŒè€…çš„åŒºåˆ«ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</span></p><ul><li><p><span>ç”¨æˆ·çº¿ç¨‹ï¼šç”±ç”¨æˆ·ç©ºé—´ç¨‹åºç®¡ç†å’Œè°ƒåº¦çš„çº¿ç¨‹ï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼ˆä¸“é—¨ç»™åº”ç”¨ç¨‹åºä½¿ç”¨ï¼‰ã€‚</span></p></li><li><p><span>å†…æ ¸çº¿ç¨‹ï¼šç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†å’Œè°ƒåº¦çš„çº¿ç¨‹ï¼Œè¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼ˆåªæœ‰å†…æ ¸ç¨‹åºå¯ä»¥è®¿é—®ï¼‰ã€‚</span></p></li></ul><p><span>é¡ºä¾¿ç®€å•æ€»ç»“ä¸€ä¸‹ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„åŒºåˆ«å’Œç‰¹ç‚¹ï¼šç”¨æˆ·çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢æˆæœ¬ä½ï¼Œä½†ä¸å¯ä»¥åˆ©ç”¨å¤šæ ¸ã€‚å†…æ ¸æ€çº¿ç¨‹ï¼Œåˆ›å»ºå’Œåˆ‡æ¢æˆæœ¬é«˜ï¼Œå¯ä»¥åˆ©ç”¨å¤šæ ¸ã€‚</span></p><p><span>ä¸€å¥è¯æ¦‚æ‹¬ Java çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹çš„å…³ç³»ï¼š</span><strong><span>ç°åœ¨çš„ Java çº¿ç¨‹çš„æœ¬è´¨å…¶å®å°±æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</span></strong><span>ã€‚</span></p><p><span>çº¿ç¨‹æ¨¡å‹æ˜¯ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ä¹‹é—´çš„å…³è”æ–¹å¼ï¼Œå¸¸è§çš„çº¿ç¨‹æ¨¡å‹æœ‰è¿™ä¸‰ç§ï¼š</span></p><ol start='' ><li><p><span>ä¸€å¯¹ä¸€ï¼ˆä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼‰</span></p></li><li><p><span>å¤šå¯¹ä¸€ï¼ˆå¤šä¸ªç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼‰</span></p></li><li><p><span>å¤šå¯¹å¤šï¼ˆå¤šä¸ªç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼‰</span></p></li></ol><h2 id='çº¿ç¨‹è¿è¡Œçš„åŸç†'><span>çº¿ç¨‹è¿è¡Œçš„åŸç†</span></h2><p><span>æˆ‘ä»¬éƒ½çŸ¥é“ JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿ æœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—æ ˆå†…å­˜ã€‚ </span></p><ul><li><p><span>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ </span></p></li><li><p><span>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³• </span></p></li></ul><p><img src="assets/image-20240617144108850.png" referrerpolicy="no-referrer" alt="image-20240617144108850.png"></p><h2 id='çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢'><span>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</span></h2><p><span>å› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç  </span></p><ul><li><p><span>çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ </span></p></li><li><p><span>åƒåœ¾å›æ”¶ </span></p></li><li><p><span>æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ </span></p></li><li><p><span>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³• </span></p></li></ul><p>&nbsp;</p><p><span>å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µå°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ </span></p><ul><li><p><span>çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰ </span></p></li><li><p><span>ä¸Šä¸‹æ–‡ é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½</span></p></li></ul><p><img src="assets/image-20240617144212928.png" referrerpolicy="no-referrer" alt="image-20240617144212928.png"></p><p><span>ä»mainçº¿ç¨‹åˆ‡æ¢åˆ°T1çº¿ç¨‹ï¼Œä¼šä¿å­˜mainçº¿ç¨‹çš„çŠ¶æ€</span></p><h2 id='çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ'><span>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</span></h2><p><strong><span>ä»æ“ä½œç³»ç»Ÿå±‚é¢æ¥æè¿°ï¼š</span></strong></p><ul><li><p><span>ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼ˆä¾‹å¦‚çº¿ç¨‹è°ƒç”¨äº†startæ–¹æ³•ï¼‰</span></p></li><li><p><span>ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ</span></p></li><li><p><span>ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€</span></p><ul><li><p><span>å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</span></p></li></ul></li><li><p><span>ã€é˜»å¡çŠ¶æ€ã€‘</span></p><ul><li><p><span>å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ ã€é˜»å¡çŠ¶æ€ã€‘</span></p></li><li><p><span>ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘</span></p></li><li><p><span>ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬</span></p></li></ul></li><li><p><span>ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€</span></p></li></ul><p><strong><span>ä» Java API å±‚é¢æ¥æè¿°:</span></strong></p><ul><li><p><strong><span>NEW</span></strong><span> çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•</span></p></li><li><p><strong><span>RUNNABLE</span></strong><span> å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº†</span><strong><span>æ“ä½œç³»ç»Ÿå±‚é¢</span></strong><span>çš„ ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äº BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸º æ˜¯å¯è¿è¡Œï¼‰</span></p></li><li><p><strong><span>BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING</span></strong><span> éƒ½æ˜¯ </span><strong><span>Java API å±‚é¢</span></strong><span>å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ†ï¼Œå¦‚sleepå¤„äºTIMED_WAITINGï¼Œ joinä¸ºWAITINGçŠ¶æ€ï¼ŒåŠ é”å¯¹åº”äº</span><strong><span>BLOCKED</span></strong><span>ã€‚</span></p><ul><li><p><strong><span>BLOCKED</span></strong><span>ï¼šå½“çº¿ç¨‹è¿›å…¥ </span><code>synchronized</code><span> æ–¹æ³•/å—æˆ–è€…è°ƒç”¨ </span><code>wait</code><span> åï¼ˆè¢« </span><code>notify</code><span>ï¼‰é‡æ–°è¿›å…¥ </span><code>synchronized</code><span> æ–¹æ³•/å—ï¼Œä½†æ˜¯é”è¢«å…¶å®ƒçº¿ç¨‹å æœ‰ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹å°±ä¼šè¿›å…¥ </span><strong><span>BLOCKEDï¼ˆé˜»å¡ï¼‰</span></strong><span> çŠ¶æ€ã€‚</span></p></li><li><p><strong><span>WAITING</span></strong><span>ï¼šå½“çº¿ç¨‹æ‰§è¡Œ </span><code>wait()</code><span>æ–¹æ³•ä¹‹åï¼Œç­‰å¾…çŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰ã€‚</span></p></li><li><p><strong><span>TIME_WAITING</span></strong><span>ï¼šçŠ¶æ€ç›¸å½“äºåœ¨ç­‰å¾…çŠ¶æ€çš„åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œæ¯”å¦‚é€šè¿‡ </span><code>sleepï¼ˆlong millisï¼‰</code><span>æ–¹æ³•æˆ– </span><code>waitï¼ˆlong millisï¼‰</code><span>æ–¹æ³•å¯ä»¥å°†çº¿ç¨‹ç½®äº TIMED_WAITING çŠ¶æ€ã€‚å½“è¶…æ—¶æ—¶é—´ç»“æŸåï¼Œçº¿ç¨‹å°†ä¼šè¿”å›åˆ° RUNNABLE çŠ¶æ€ã€‚</span></p></li></ul></li><li><p><strong><span>terminated</span></strong><span> çº¿ç¨‹åœ¨æ‰§è¡Œå®Œäº† </span><code>run()</code><span>æ–¹æ³•ä¹‹åå°†ä¼šè¿›å…¥åˆ° </span><strong><span>TERMINATEDï¼ˆç»ˆæ­¢ï¼‰</span></strong><span> çŠ¶æ€ã€‚</span></p></li></ul><h2 id='çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹'><span>çº¿ç¨‹çš„ä½¿ç”¨ç¤ºä¾‹</span></h2><p><span>Java å°±åªæœ‰ä¸€ç§æ–¹å¼å¯ä»¥åˆ›å»ºçº¿ç¨‹ï¼Œé‚£å°±æ˜¯é€šè¿‡</span><code>new Thread().start()</code><span>åˆ›å»ºã€‚ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¾èµ–äº</span><code>new Thread().start()</code><span>ã€‚</span></p><ul><li><p><span>å®ç° </span><code>Runnable</code><span> æ¥å£ã€‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyRunnable</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Runnable</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyRunnable</span> <span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">MyRunnable</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">thread</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-variable">instance</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">thread</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><ul><li><p><span>å®ç° </span><code>Callable</code><span> æ¥å£ã€‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyCallable</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Callable</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Integer</span> <span class="cm-variable">call</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">123</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ExecutionException</span>, <span class="cm-variable">InterruptedException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyCallable</span> <span class="cm-variable">mc</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">MyCallable</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">FutureTask</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">ft</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FutureTask</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">mc</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">thread</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-variable">ft</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">thread</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">ft</span>.<span class="cm-variable">get</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><ul><li><p><span>ç»§æ‰¿ </span><code>Thread</code><span> ç±»ã€‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyThread</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyThread</span> <span class="cm-variable">mt</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">MyThread</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mt</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//æˆ–è€…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Thread</span> <span class="cm-variable">t1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-string">"t1"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// run æ–¹æ³•å†…å®ç°äº†è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"hello"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t1</span>.<span class="cm-variable">start</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 437px;"></div><div class="CodeMirror-gutters" style="display: none; height: 437px;"></div></div></div></pre><h2 id='å¸¸ç”¨æ–¹æ³•'><span>å¸¸ç”¨æ–¹æ³•</span></h2><p><img src="assets/image-20240617144308911.png" referrerpolicy="no-referrer" alt="image-20240617144308911.png"></p><h3 id='start-ä¸-run'><span>start() ä¸ run()</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-string">"t1"</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">FileReader</span>.<span class="cm-variable">read</span>(<span class="cm-variable">Constants</span>.<span class="cm-variable">MP4_FULL_PATH</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  };</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">//t1.run();</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">t1</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"do other things ..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><span>new ä¸€ä¸ª </span><code>Thread</code><span>ï¼Œçº¿ç¨‹è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚è°ƒç”¨ </span><code>start()</code><span>æ–¹æ³•ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¹¶ä½¿çº¿ç¨‹è¿›å…¥äº†å°±ç»ªçŠ¶æ€ï¼Œå½“åˆ†é…åˆ°æ—¶é—´ç‰‡åå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ã€‚ </span><code>start()</code><span> ä¼šæ‰§è¡Œçº¿ç¨‹çš„ç›¸åº”å‡†å¤‡å·¥ä½œï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œ </span><code>run()</code><span> æ–¹æ³•çš„å†…å®¹ï¼Œè¿™æ˜¯çœŸæ­£çš„å¤šçº¿ç¨‹å·¥ä½œã€‚ ä½†æ˜¯ï¼Œç›´æ¥æ‰§è¡Œ </span><code>run()</code><span> æ–¹æ³•ï¼Œä¼šæŠŠ </span><code>run()</code><span> æ–¹æ³•å½“æˆä¸€ä¸ª main çº¿ç¨‹ä¸‹çš„æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚</span></p><ul><li><p><strong><span>ç›´æ¥è°ƒç”¨ run æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œäº† runï¼Œæ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹</span></strong><span> </span></p></li><li><p><strong><span>ä½¿ç”¨ start æ˜¯å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹é—´æ¥æ‰§è¡Œ run ä¸­çš„ä»£ç </span></strong></p></li></ul><h3 id='sleepä¸wait'><span>sleep()ä¸wait()</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//sleep</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span>(<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//wait</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">synchronized</span>(<span class="cm-variable">é”å¯¹è±¡</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span>(<span class="cm-variable">æ¡ä»¶ä¸æ»¡è¶³</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">é”å¯¹è±¡</span>.<span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span>(<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// do sth...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 437px;"></div><div class="CodeMirror-gutters" style="display: none; height: 437px;"></div></div></div></pre><ul><li><p><span>äºŒè€…éƒ½å¯ä»¥æš‚åœçº¿ç¨‹çš„æ‰§è¡Œ</span></p></li><li><p><code>sleep()</code><span>é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œï¼Œä¸ä¼šé‡Šæ”¾é”ã€‚</span><code>wait()</code><span>æ–¹æ³•é€šå¸¸ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œä¼šé‡Šæ”¾é”ã€‚</span></p></li><li><p><code>wait()</code><span> æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šè‡ªåŠ¨è‹é†’ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šçš„ </span><code>notify()</code><span> æˆ–è€… </span><code>notifyAll()</code><span> æ–¹æ³•ã€‚</span><code>sleep()</code><span> æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ã€‚æˆ–è€…å¯ä»¥ä½¿ç”¨ </span><code>wait(long timeout)</code><span>è¶…æ—¶åçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ã€‚</span></p></li><li><p><span>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨</span><code>interrupt</code><span> æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º </span><code>InterruptedException</code><span> </span></p></li><li><p><code>wait()</code><span> æ˜¯è®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”ã€‚æ¯ä¸ªå¯¹è±¡ï¼ˆ</span><code>Object</code><span>ï¼‰éƒ½æ‹¥æœ‰å¯¹è±¡é”ï¼Œæ—¢ç„¶è¦é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”å¹¶è®©å…¶è¿›å…¥ WAITING çŠ¶æ€ï¼Œè‡ªç„¶æ˜¯è¦æ“ä½œå¯¹åº”çš„å¯¹è±¡ï¼ˆ</span><code>Object</code><span>ï¼‰è€Œéå½“å‰çš„çº¿ç¨‹ï¼ˆ</span><code>Thread</code><span>ï¼‰ã€‚</span></p></li><li><p><code>sleep()</code><span> æ˜¯è®©å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œä¸æ¶‰åŠåˆ°å¯¹è±¡ç±»ï¼Œä¹Ÿä¸éœ€è¦è·å¾—å¯¹è±¡é”ã€‚</span></p></li></ul><h3 id='yield-è®©å‡ºå½“å‰çº¿ç¨‹ï¼‰'><span>yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</span></h3><p><span>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» </span><strong><span>Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€</span></strong><span>ï¼ˆä»ç„¶æœ‰å¯èƒ½è¢«æ‰§è¡Œï¼‰ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ã€‚</span></p><h3 id='join'><span>join()</span></h3><p><strong><span>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚</span></strong></p><p><span>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œè™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡ºã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">JoinExample</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">class</span> <span class="cm-def">A</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">class</span> <span class="cm-def">B</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">A</span> <span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B</span>(<span class="cm-variable">A</span> <span class="cm-variable">a</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">a</span>.<span class="cm-variable">join</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"B"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">test</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">A</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">A</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">B</span> <span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">B</span>(<span class="cm-variable">a</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">b</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">a</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">JoinExample</span> <span class="cm-variable">example</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">JoinExample</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">example</span>.<span class="cm-variable">test</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 851px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre><h3 id='å®ˆæŠ¤çº¿ç¨‹daemon'><span>å®ˆæŠ¤çº¿ç¨‹Daemon</span></h3><ol start='' ><li><p><strong><span>åå°è¿è¡Œ</span></strong><span>ï¼šå®ˆæŠ¤çº¿ç¨‹é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›åå°ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯¹JVMçš„è¿è¡Œä¸æ˜¯å¿…éœ€çš„ã€‚</span></p></li><li><p><strong><span>ç”Ÿå‘½å‘¨æœŸ</span></strong><span>ï¼šå½“JVMä¸­åªå‰©ä¸‹å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºã€‚è¿™æ„å‘³ç€å®ˆæŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¾èµ–äºJVMçš„ç”Ÿå‘½å‘¨æœŸã€‚</span></p></li><li><p><strong><span>åˆ›å»ºæ–¹å¼</span></strong><span>ï¼šå¯ä»¥é€šè¿‡è°ƒç”¨</span><code>Thread</code><span>ç±»çš„</span><code>setDaemon(true)</code><span>æ–¹æ³•å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</span></p></li></ol><p><span>main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚</span></p><p><span>åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰ä½¿ç”¨ setDaemon() æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</span></p><p><span>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»çº¿ç¨‹ä¼šåœ¨5ç§’åé€€å‡ºï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹ä¼šç»§ç»­è¿è¡Œï¼Œç›´åˆ°JVMé€€å‡ºã€‚å¦‚æœä¸»çº¿ç¨‹æ˜¯å”¯ä¸€çš„éå®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£ä¹ˆJVMä¼šåœ¨ä¸»çº¿ç¨‹é€€å‡ºåç«‹å³é€€å‡ºï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšä¹‹åœæ­¢ã€‚</span></p><p><span>å®ˆæŠ¤çº¿ç¨‹çš„ä¸€ä¸ªå…³é”®ç‰¹ç‚¹æ˜¯å®ƒä»¬ä¸ä¼šé˜»æ­¢JVMçš„é€€å‡ºã€‚å¦‚æœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹éƒ½å·²ç»ˆæ­¢ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼ŒJVMä¹Ÿä¼šè‡ªåŠ¨å…³é—­ã€‚è¿™ä½¿å¾—å®ˆæŠ¤çº¿ç¨‹éå¸¸é€‚åˆæ‰§è¡Œé‚£äº›å³ä½¿åœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ä¹Ÿå¯ä»¥è¢«ä¸­æ–­çš„ä»»åŠ¡ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">DaemonThreadExample</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">daemonThread</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Daemon thread is running"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">daemonThread</span>.<span class="cm-variable">setDaemon</span>(<span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">daemonThread</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ä¸»çº¿ç¨‹æ‰§è¡Œä¸€äº›æ“ä½œåé€€å‡º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">5000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Main thread is exiting"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 575px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><ul><li><p><span>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ </span></p></li><li><p><span>Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æ¥æ”¶åˆ° shutdown å‘½ä»¤åï¼Œä¸ä¼šç­‰å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚ </span></p></li></ul><blockquote><p><span>å®ˆæŠ¤çº¿ç¨‹åœ¨Javaä¸­æœ‰å‡ ä¸ªä¸»è¦çš„ç”¨é€”ï¼Œå®ƒä»¬é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›å¯¹ç”¨æˆ·ä¸ç›´æ¥å¯è§çš„åå°ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®ˆæŠ¤çº¿ç¨‹çš„å¸¸è§ç”¨é€”ï¼š</span></p><ol start='' ><li><p><strong><span>åƒåœ¾å›æ”¶</span></strong><span>ï¼šJVMçš„åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚å®ƒä»¬è´Ÿè´£åœ¨åå°ç›‘æ§å¯¹è±¡çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œä»¥é‡Šæ”¾å†…å­˜ã€‚</span></p></li><li><p><strong><span>ç³»ç»Ÿç›‘æ§</span></strong><span>ï¼šå®ˆæŠ¤çº¿ç¨‹å¯ä»¥ç”¨æ¥ç›‘æ§ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œä¾‹å¦‚å†…å­˜ä½¿ç”¨é‡ã€CPUä½¿ç”¨ç‡ç­‰ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯æŠ¥å‘Šç»™ç³»ç»Ÿç®¡ç†å‘˜æˆ–ç”¨äºè‡ªåŠ¨è°ƒæ•´ç³»ç»Ÿé…ç½®ã€‚</span></p></li><li><p><strong><span>ç¼“å­˜ç®¡ç†</span></strong><span>ï¼šåœ¨ä¸€äº›åº”ç”¨ç¨‹åºä¸­ï¼Œå®ˆæŠ¤çº¿ç¨‹å¯èƒ½ç”¨äºç®¡ç†ç¼“å­˜ï¼Œæ¯”å¦‚æ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ¡ç›®ï¼Œæˆ–è€…åœ¨ä½è´Ÿè½½æ—¶é¢„å…ˆåŠ è½½æ•°æ®ã€‚</span></p></li><li><p><strong><span>æ—¥å¿—è®°å½•</span></strong><span>ï¼šå®ˆæŠ¤çº¿ç¨‹å¯ä»¥ç”¨äºå¤„ç†æ—¥å¿—è®°å½•ä»»åŠ¡ï¼Œå°†åº”ç”¨ç¨‹åºçš„è¿è¡Œä¿¡æ¯è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè€Œä¸å½±å“ä¸»çº¿ç¨‹çš„æ€§èƒ½ã€‚</span></p></li><li><p><strong><span>å®šæ—¶ä»»åŠ¡</span></strong><span>ï¼šå®ˆæŠ¤çº¿ç¨‹å¯ä»¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…æ‰§è¡Œä¸€äº›å‘¨æœŸæ€§çš„ç»´æŠ¤æ“ä½œã€‚</span></p></li><li><p><strong><span>èµ„æºæ¸…ç†</span></strong><span>ï¼šåœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ã€‚</span></p></li><li><p><strong><span>å¼‚æ­¥å¤„ç†</span></strong><span>ï¼šå®ˆæŠ¤çº¿ç¨‹å¯ä»¥ç”¨äºæ‰§è¡Œä¸€äº›ä¸éœ€è¦ç«‹å³è¿”å›ç»“æœçš„å¼‚æ­¥ä»»åŠ¡ï¼Œä»è€Œä¸é˜»å¡ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚</span></p></li><li><p><strong><span>ç³»ç»ŸæœåŠ¡</span></strong><span>ï¼šåœ¨ä¸€äº›æœåŠ¡å‹åº”ç”¨ç¨‹åºä¸­ï¼Œå®ˆæŠ¤çº¿ç¨‹å¯ä»¥ç”¨äºæä¾›ä¸€äº›åå°æœåŠ¡ï¼Œæ¯”å¦‚å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œç­‰ã€‚</span></p></li></ol><p><span>å®ˆæŠ¤çº¿ç¨‹çš„ä¸€ä¸ªå…³é”®ç‰¹ç‚¹æ˜¯å®ƒä»¬ä¸ä¼šé˜»æ­¢JVMçš„é€€å‡ºã€‚å¦‚æœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹éƒ½å·²ç»ˆæ­¢ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼ŒJVMä¹Ÿä¼šè‡ªåŠ¨å…³é—­ã€‚è¿™ä½¿å¾—å®ˆæŠ¤çº¿ç¨‹éå¸¸é€‚åˆæ‰§è¡Œé‚£äº›å³ä½¿åœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ä¹Ÿå¯ä»¥è¢«ä¸­æ–­çš„ä»»åŠ¡ã€‚</span></p></blockquote><h2 id='ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•'><span>ä¸‰ç§è®©çº¿ç¨‹ç­‰å¾…å’Œå”¤é†’çš„æ–¹æ³•</span></h2><ul><li><p><span>ä½¿ç”¨</span><code>Object</code><span>ä¸­çš„</span><code>wait()</code><span>æ–¹æ³•è®©çº¿ç¨‹1ç­‰å¾…ï¼Œçº¿ç¨‹2ä½¿ç”¨</span><code>Object</code><span>çš„</span><code>notify()</code><span>æ–¹æ³•å”¤é†’çº¿ç¨‹ï¼Œç»“åˆ</span><code>ynchronized</code><span>ï¼›</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ObjectWait</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span> <span class="cm-variable">o</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«o.wait()é˜»å¡å‰"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span>(<span class="cm-variable">o</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o</span>.<span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«çº¿ç¨‹B o.notify()å”¤é†’"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">100</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Bå”¤é†’çº¿ç¨‹A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">o</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">o</span>.<span class="cm-variable">notify</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"B"</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 943px;"></div><div class="CodeMirror-gutters" style="display: none; height: 943px;"></div></div></div></pre><ul><li><p><span>çº¿ç¨‹1ä½¿ç”¨JUCåŒ…ä¸­çš„</span><code>Condition</code><span>çš„</span><code>await()</code><span>æ–¹æ³•è®©çº¿ç¨‹ç­‰å¾…ï¼Œçº¿ç¨‹2ä½¿ç”¨</span><code>signalï¼ˆï¼‰</code><span>æ–¹æ³•å”¤é†’çº¿ç¨‹ï¼›</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ConditionAwait</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Lock</span> <span class="cm-variable">lock</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReentrantLock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Condition</span> <span class="cm-variable">condition</span> <span class="cm-operator">=</span> <span class="cm-variable">lock</span>.<span class="cm-variable">newCondition</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«condition.await()é˜»å¡å‰"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">condition</span>.<span class="cm-variable">await</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }<span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«çº¿ç¨‹B condition.signl()å”¤é†’"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }, <span class="cm-string">"A"</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Bä¸­ä½¿ç”¨condition.signal()å”¤é†’çº¿ç¨‹A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">condition</span>.<span class="cm-variable">signal</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }<span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }<span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }, <span class="cm-string">"B"</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ç»“æœï¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Aè¢«condition</span>.<span class="cm-variable">await</span>()<span class="cm-variable">é˜»å¡å‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Bä¸­ä½¿ç”¨condition</span>.<span class="cm-variable">signal</span>()<span class="cm-variable">å”¤é†’çº¿ç¨‹A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Aè¢«çº¿ç¨‹B</span> <span class="cm-variable">condition</span>.<span class="cm-variable">signl</span>()<span class="cm-variable">å”¤é†’</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1104px;"></div></div></div></pre><ul><li><p><code>LockSupport</code><span>ç±»å¯ä»¥é˜»å¡å½“å‰çº¿ç¨‹ä»¥åŠå”¤é†’æŒ‡å®šè¢«é˜»å¡çš„çº¿ç¨‹ï¼›</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">LockSupportDemo</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«LockSupport.park()é˜»å¡"</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">LockSupport</span>.<span class="cm-variable">park</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Aè¢«çº¿ç¨‹B LockSupport.unpark()å”¤é†’"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"çº¿ç¨‹Bå”¤é†’çº¿ç¨‹A"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å”¤é†’æŒ‡å®šçº¿ç¨‹tï¼Œä¹Ÿå°±æ˜¯A</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">LockSupport</span>.<span class="cm-variable">unpark</span>(<span class="cm-variable">t</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"B"</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ç»“æœï¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Aè¢«LockSupport</span>.<span class="cm-variable">park</span>()<span class="cm-variable">é˜»å¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Bå”¤é†’çº¿ç¨‹A</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">çº¿ç¨‹Aè¢«çº¿ç¨‹B</span> <span class="cm-variable">LockSupport</span>.<span class="cm-variable">unpark</span>()<span class="cm-variable">å”¤é†’</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 782px;"></div><div class="CodeMirror-gutters" style="display: none; height: 782px;"></div></div></div></pre><h2 id='park--unpark'><span>Park &amp; Unpark</span></h2><ol start='' ><li><p><span>ä¸ Object çš„ wait &amp; notify ç›¸æ¯” </span></p></li></ol><ul><li><p><span>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ Object Monitor ä¸€èµ·ä½¿ç”¨ï¼Œè€Œ parkï¼Œunpark ä¸å¿…</span></p></li><li><p><span>park &amp; unpark æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥ã€é˜»å¡ã€‘å’Œã€å”¤é†’ã€‘çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAllæ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆã€ç²¾ç¡®ã€‘ </span></p></li><li><p><span>park &amp; unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify </span></p></li></ul><ol start='2' ><li><p><span>åŸç†</span></p></li></ol><p><span>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª(Cä»£ç å®ç°çš„) Parker å¯¹è±¡ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ </span><code>_counter</code><span> ï¼Œ </span><code>_cond</code><span> å’Œ</span><code>_mutex</code><span> </span></p><p><span>æ‰“ä¸ªæ¯”å–» </span></p><ul><li><p><span>çº¿ç¨‹å°±åƒä¸€ä¸ªæ—…äººï¼ŒParker å°±åƒä»–éšèº«æºå¸¦çš„èƒŒåŒ…ï¼Œæ¡ä»¶å˜é‡å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¸ç¯·ã€‚_counter å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¤‡ç”¨å¹²ç²®ï¼ˆ0 ä¸ºè€—å°½ï¼Œ1 ä¸ºå……è¶³ï¼‰ </span></p></li><li><p><span>è°ƒç”¨ park å°±æ˜¯è¦çœ‹éœ€ä¸éœ€è¦åœä¸‹æ¥æ­‡æ¯ </span></p><ul><li><p><span>å¦‚æœå¤‡ç”¨å¹²ç²®è€—å°½ï¼Œé‚£ä¹ˆé’»è¿›å¸ç¯·æ­‡æ¯ </span></p></li><li><p><span>å¦‚æœå¤‡ç”¨å¹²ç²®å……è¶³ï¼Œé‚£ä¹ˆä¸éœ€åœç•™ï¼Œç»§ç»­å‰è¿› </span></p></li></ul></li><li><p><span>è°ƒç”¨ unparkï¼Œå°±å¥½æ¯”ä»¤å¹²ç²®å……è¶³ </span></p><ul><li><p><span>å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨å¸ç¯·ï¼Œå°±å”¤é†’è®©ä»–ç»§ç»­å‰è¿› </span></p></li><li><p><span>å¦‚æœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆä¸‹æ¬¡ä»–è°ƒç”¨ park æ—¶ï¼Œä»…æ˜¯æ¶ˆè€—æ‰å¤‡ç”¨å¹²ç²®ï¼Œä¸éœ€åœç•™,ç»§ç»­å‰è¿› </span></p></li></ul></li><li><p><span>å› ä¸ºèƒŒåŒ…ç©ºé—´æœ‰é™ï¼Œå¤šæ¬¡è°ƒç”¨ unpark ä»…ä¼šè¡¥å……ä¸€ä»½å¤‡ç”¨å¹²ç²®,ä¹Ÿå°±æ˜¯å¤šæ¬¡unparkååªä¼šè®©ç´§è·Ÿç€çš„ä¸€æ¬¡parkå¤±æ•ˆ</span></p></li><li><p><strong><span>å…ˆè°ƒç”¨park å†è°ƒç”¨unpark</span></strong></p><ul><li><p><span>å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³• </span></p><ul><li><p><span>æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 0ï¼Œè¿™æ—¶ï¼Œè·å¾— _mutex äº’æ–¥é” </span></p></li><li><p><span>çº¿ç¨‹è¿›å…¥ _cond æ¡ä»¶å˜é‡é˜»å¡ </span></p></li><li><p><span>è®¾ç½® _counter = 0</span></p></li></ul></li><li><p><span>è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1 </span></p><ul><li><p><span>å”¤é†’ _cond æ¡ä»¶å˜é‡ä¸­çš„ Thread_0 </span></p></li><li><p><span>Thread_0 æ¢å¤è¿è¡Œ </span></p></li><li><p><span>è®¾ç½® _counter ä¸º 0</span></p></li></ul></li></ul></li><li><p><strong><span>å…ˆè°ƒç”¨unpark å†è°ƒç”¨park</span></strong></p><ul><li><p><span>.è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1 </span></p></li><li><p><span>å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³• </span></p></li><li><p><span>æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 1ï¼Œè¿™æ—¶çº¿ç¨‹æ— éœ€é˜»å¡ï¼Œç»§ç»­è¿è¡Œ </span></p></li><li><p><span>è®¾ç½® _counter ä¸º 0 </span></p></li></ul></li></ul><h1 id='äºŒå¤šçº¿ç¨‹'><span>äºŒã€å¤šçº¿ç¨‹</span></h1><h2 id='å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«'><span>å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«</span></h2><ul><li><p><span>å¹¶å‘ï¼šåŒä¸€æ—¶é—´æ®µï¼Œå¤šä¸ªä»»åŠ¡éƒ½åœ¨æ‰§è¡Œ(å•ä½æ—¶é—´å†…ä¸ä¸€å®šåŒæ—¶æ‰§è¡Œ)ï¼Œå¦‚å•æ ¸çš„cpuä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚</span></p></li><li><p><span>å¹¶è¡Œï¼šå•ä½æ—¶é—´å†…ï¼Œå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæ¯”å¦‚å¤šæ ¸CPUï¼Œå¤šä¸ªcpuåŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚</span></p></li></ul><h2 id='ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜'><span>ä½¿ç”¨å¤šçº¿ç¨‹çš„æ„ä¹‰å’Œå¸¦æ¥çš„é—®é¢˜</span></h2><ul><li><p><span>å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘èƒ½åŠ›ä»¥åŠæ€§èƒ½ã€‚</span></p></li><li><p><span>æé«˜CPUçš„åˆ©ç”¨ç‡ã€‚</span></p></li><li><p><span>å¸¦æ¥å†…å­˜æ³„æ¼ï¼Œæ­»é”ï¼Œçº¿ç¨‹ä¸å®‰å…¨ç­‰é—®é¢˜ã€‚</span></p></li></ul><blockquote><ul><li><p><span>å•æ ¸ cpu ä¸‹ï¼Œå¤šçº¿ç¨‹ä¸èƒ½å®é™…æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´åˆ‡æ¢ï¼Œä¸åŒçº¿ç¨‹è½®æµä½¿ç”¨ cpu ï¼Œä¸è‡³äºä¸€ä¸ªçº¿ç¨‹æ€»å ç”¨ cpuï¼Œåˆ«çš„çº¿ç¨‹æ²¡æ³•å¹²æ´» </span></p></li><li><p><span>å¤šæ ¸ cpu å¯ä»¥å¹¶è¡Œè·‘å¤šä¸ªçº¿ç¨‹ï¼Œä½†èƒ½å¦æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„ </span></p></li><li><p><span>æœ‰äº›ä»»åŠ¡ï¼Œç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå°†ä»»åŠ¡æ‹†åˆ†ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ä½†ä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»» åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼ˆå‚è€ƒåæ–‡çš„ã€é˜¿å§†è¾¾å°”å®šå¾‹ã€‘ï¼‰ </span></p></li><li><p><span>ä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ‹†åˆ†ï¼Œä»»åŠ¡çš„ç›®çš„å¦‚æœä¸åŒï¼Œè°ˆæ‹†åˆ†å’Œæ•ˆç‡æ²¡å•¥æ„ä¹‰ </span></p></li><li><p><span>IO æ“ä½œä¸å ç”¨ cpuï¼Œåªæ˜¯æˆ‘ä»¬ä¸€èˆ¬æ‹·è´æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ã€é˜»å¡ IOã€‘ï¼Œè¿™æ—¶ç›¸å½“äºçº¿ç¨‹è™½ç„¶ä¸ç”¨ cpuï¼Œ</span></p></li></ul><p><span>      ä½†éœ€è¦ä¸€ ç›´ç­‰å¾… IO ç»“æŸï¼Œæ²¡èƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹ã€‚æ‰€ä»¥æ‰æœ‰åé¢çš„ã€éé˜»å¡ IOã€‘å’Œã€å¼‚æ­¥ IOã€‘ä¼˜åŒ–</span></p></blockquote><h2 id='å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨'><span>å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨ï¼Ÿ</span></h2><p><span>çº¿ç¨‹å®‰å…¨å’Œä¸å®‰å…¨æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹äºåŒä¸€ä»½æ•°æ®çš„è®¿é—®æ˜¯å¦èƒ½å¤Ÿä¿è¯å…¶æ­£ç¡®æ€§å’Œä¸€è‡´æ€§çš„æè¿°ã€‚</span></p><ul><li><p><span>çº¿ç¨‹å®‰å…¨æŒ‡çš„æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹äºåŒä¸€ä»½æ•°æ®ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œéƒ½èƒ½ä¿è¯è¿™ä»½æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</span></p></li><li><p><span>çº¿ç¨‹ä¸å®‰å…¨åˆ™è¡¨ç¤ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹äºåŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶å¯èƒ½ä¼šå¯¼è‡´æ•°æ®æ··ä¹±ã€é”™è¯¯æˆ–è€…ä¸¢å¤±ã€‚</span></p></li></ul><h2 id='çº¿ç¨‹æ­»é”'><span>çº¿ç¨‹æ­»é”</span></h2><h3 id='çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶'><span>çº¿ç¨‹æ­»é”çš„å››ä¸ªæ¡ä»¶</span></h3><blockquote><p><span>å¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œä»–ä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ï¼Œç”±äºçº¿ç¨‹æ— é™æœŸçš„é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚</span></p></blockquote><ul><li><p><strong><span>äº’æ–¥æ¡ä»¶</span></strong><span>ï¼šäº’æ–¥æ¡ä»¶æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶ä½¿â½¤åŒâ¼€ä¸ªèµ„æºã€‚</span></p></li><li><p><strong><span>æŒæœ‰å¹¶ç­‰å¾…æ¡ä»¶</span></strong><span>ï¼šæŒæœ‰å¹¶ç­‰å¾…æ¡ä»¶æ˜¯æŒ‡ï¼Œå½“çº¿ç¨‹ A å·²ç»æŒæœ‰äº†èµ„æº 1ï¼Œâ¼œæƒ³ç”³è¯·èµ„æº 2ï¼Œâ½½èµ„æº 2 å·²ç»è¢«çº¿ç¨‹ C æŒæœ‰äº†ï¼Œæ‰€ ä»¥çº¿ç¨‹ A å°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œä½†æ˜¯çº¿ç¨‹ A åœ¨ç­‰å¾…èµ„æº 2 çš„åŒæ—¶å¹¶ä¸ä¼šé‡Šæ”¾â¾ƒâ¼°å·²ç»æŒæœ‰çš„èµ„æº 1ã€‚</span></p></li><li><p><strong><span>ä¸å¯å‰¥å¤ºæ¡ä»¶</span></strong><span>ï¼šä¸å¯å‰¥å¤ºæ¡ä»¶æ˜¯æŒ‡ï¼Œå½“çº¿ç¨‹å·²ç»æŒæœ‰äº†èµ„æº ï¼Œåœ¨â¾ƒâ¼°ä½¿â½¤å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œçº¿ç¨‹ B å¦‚æœä¹Ÿæƒ³ä½¿ â½¤æ­¤èµ„æºï¼Œåˆ™åªèƒ½åœ¨çº¿ç¨‹ A ä½¿â½¤å®Œå¹¶é‡Šæ”¾åæ‰èƒ½è·å–ã€‚</span></p></li><li><p><strong><span>ç¯è·¯ç­‰å¾…æ¡ä»¶</span></strong><span>ï¼šç¯è·¯ç­‰å¾…æ¡ä»¶æŒ‡éƒ½æ˜¯ï¼Œåœ¨æ­»é”å‘â½£çš„æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹è·å–èµ„æºçš„é¡ºåºæ„æˆäº†ç¯å½¢é“¾ã€‚â½å¦‚ï¼Œçº¿ç¨‹ A å·²ç»æŒæœ‰èµ„æº 2ï¼Œâ½½æƒ³è¯·æ±‚èµ„æº 1ï¼Œ çº¿ç¨‹ B å·²ç»è·å–äº†èµ„æº 1ï¼Œâ½½æƒ³è¯·æ±‚èµ„æº 2ï¼Œè¿™å°±å½¢æˆ èµ„æºè¯·æ±‚ç­‰å¾…çš„ç¯å½¢å›¾ã€‚</span></p></li></ul><h3 id='å¦‚ä½•é¿å…æ­»é”'><span>å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</span></h3><ul><li><p><strong><span>ç ´åäº’æ–¥æ¡ä»¶</span></strong><span>ï¼šè¿™ä¸ªæ²¡æœ‰åŠæ³•å®ç°ï¼›</span></p></li><li><p><strong><span>ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶</span></strong><span>ï¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æºï¼›</span></p></li><li><p><strong><span>ç ´åä¸å‰¥å¤ºæ¡ä»¶</span></strong><span>ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚</span></p></li><li><p><strong><span>ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</span></strong><span>ï¼šæŒ‰åºç”³è¯·èµ„æº,é‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚</span></p></li></ul><h3 id='å¦‚ä½•æ£€æµ‹æ­»é”'><span>å¦‚ä½•æ£€æµ‹æ­»é”ï¼Ÿ</span></h3><p><span>ä½¿ç”¨</span><code>jmap</code><span>ã€</span><code>jstack</code><span>ç­‰å‘½ä»¤æŸ¥çœ‹ JVM çº¿ç¨‹æ ˆå’Œå †å†…å­˜çš„æƒ…å†µã€‚å¦‚æœæœ‰æ­»é”ï¼Œ</span><code>jstack</code><span> çš„è¾“å‡ºä¸­é€šå¸¸ä¼šæœ‰ </span><code>Found one Java-level deadlock:</code><span>çš„å­—æ ·ï¼Œåé¢ä¼šè·Ÿç€æ­»é”ç›¸å…³çš„çº¿ç¨‹ä¿¡æ¯ã€‚å¦å¤–ï¼Œå®é™…é¡¹ç›®ä¸­è¿˜å¯ä»¥æ­é…ä½¿ç”¨</span><code>top</code><span>ã€</span><code>df</code><span>ã€</span><code>free</code><span>ç­‰å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æƒ…å†µï¼Œå‡ºç°æ­»é”å¯èƒ½ä¼šå¯¼è‡´ CPUã€å†…å­˜ç­‰èµ„æºæ¶ˆè€—è¿‡é«˜ã€‚</span></p><p><span>é‡‡ç”¨ VisualVMã€JConsole ç­‰å·¥å…·è¿›è¡Œæ’æŸ¥ã€‚</span></p><h2 id='çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ '><span>çº¿ç¨‹å®‰å…¨çš„ä¸‰è¦ç´ </span></h2><ol start='' ><li><p><strong><span>åŸå­æ€§ï¼š</span></strong><span> ä¸€ä¸ªçš„æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½å¾—åˆ°æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</span></p></li><li><p><strong><span>å¯è§æ€§:</span></strong><span>  å½“ä¸€ä¸ªå˜é‡å¯¹å…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹éƒ½æ˜¯ç«‹å³å¯ä»¥çœ‹åˆ°ä¿®æ”¹åçš„æœ€æ–°å€¼ã€‚</span></p></li><li><p><strong><span>æœ‰åºæ€§:</span></strong><span> ä»£ç æ‰§è¡Œçš„é¡ºåºæ˜¯ç¼–å†™ä»£ç çš„é¡ºåºã€‚</span></p></li></ol><h1 id='ä¸‰å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹'><span>ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</span></h1><h2 id='å…±äº«é—®é¢˜'><span>å…±äº«é—®é¢˜</span></h2><p><strong><span>ä¸´ç•ŒåŒº Critical Section</span></strong><span> </span></p><ul><li><p><span>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ </span></p></li><li><p><span>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®</span><strong><span>å…±äº«èµ„æº</span></strong><span> </span></p></li><li><p><span>å¤šä¸ªçº¿ç¨‹è¯»</span><strong><span>å…±äº«èµ„æº</span></strong><span>å…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜ </span></p></li><li><p><span>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹</span><strong><span>å…±äº«èµ„æº</span></strong><span>è¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ </span></p></li><li><p><span>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹</span><strong><span>å…±äº«èµ„æº</span></strong><span>çš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º</span><strong><span>ä¸´ç•ŒåŒº</span></strong><span> </span></p></li></ul><p><strong><span>ç«æ€æ¡ä»¶ Race Condition</span></strong><span> </span></p><p><span>å¤šä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„</span><strong><span>æ‰§è¡Œåºåˆ—ä¸åŒ</span></strong><span>è€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†</span><strong><span>ç«æ€æ¡ä»¶</span></strong></p><p><span>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚ </span></p><ul><li><p><span>é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock </span></p></li><li><p><span>éé˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡ </span></p></li></ul><h2 id='synchronized-å…³é”®å­—åŸå­æ€§å¯è§æ€§ï¼‰'><span>synchronized å…³é”®å­—ï¼ˆåŸå­æ€§+å¯è§æ€§ï¼‰</span></h2><h3 id='æ˜¯ä»€ä¹ˆ'><span>æ˜¯ä»€ä¹ˆï¼Ÿ</span></h3><ul><li><p><span>ç”¨äºè§£å†³å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„ä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</span></p></li><li><p><span>åœ¨JDKçš„æ—©æœŸç‰ˆæœ¬ï¼Œsymchronizedæ˜¯é‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</span></p></li></ul><blockquote><p><strong><span>ä¸ºä»€ä¹ˆæ•ˆç‡ä½ä¸‹ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</span></strong></p><ul><li><p><code>synchronized</code><span>é”çš„å®ç°ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„</span><code>Mutex Lock</code><span>å®ç°çš„ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å¾—ä¸€ä¸ªå·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¯¥çº¿ç¨‹ç½®äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚è¿™ç§é˜»å¡å’Œå”¤é†’çº¿ç¨‹çš„æ“ä½œé€šå¸¸æ¶‰åŠæ˜‚è´µçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</span></p></li><li><p><span>ç”±äº</span><code>synchronized</code><span>é”æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿå±‚é¢çš„æ“ä½œï¼Œå› æ­¤åœ¨è·å¾—å’Œé‡Šæ”¾é”æ—¶ä¼šæœ‰è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ã€‚è¿™ç§å¼€é”€åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å°¤ä¸ºæ˜æ˜¾ã€‚</span></p></li><li><p><span>ä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œåœ¨JDK6 ä¹‹åå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œæ‰€ä»¥æ€»å…±æœ‰4ç§é”çŠ¶æ€ï¼Œçº§åˆ«ç”±ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ã€‚è¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚</span></p></li></ul></blockquote><h3 id='æ€ä¹ˆä½¿ç”¨'><span>æ€ä¹ˆä½¿ç”¨ï¼Ÿ</span></h3><ol start='' ><li><p><span>ä¿®é¥°å®ä¾‹æ–¹æ³•:ä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é”.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Test</span>{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">synchronized</span> <span class="cm-variable-3">void</span> <span class="cm-variable">test</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ç­‰ä»·äº</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Test</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">test</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span>(<span class="cm-keyword">this</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><ol start='' ><li><p><span>ä¿®é¥°é™æ€æ–¹æ³•ï¼šä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰classçš„é”ã€‚</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">synchronized</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">method</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//ä¸šåŠ¡ä»£ç </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><ol start='' ><li><p><span>ä¿®é¥°ä»£ç å—ï¼šæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡/åŠ é”ã€‚</span></p></li></ol><ul><li><p><code>synchronized(object)</code><span> è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾— </span><strong><span>ç»™å®šå¯¹è±¡çš„é”</span></strong><span>ã€‚</span></p></li><li><p><code>synchronized(ç±».class)</code><span> è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— </span><strong><span>ç»™å®š Class çš„é”</span></strong></p></li></ul><blockquote><p><span>æ„é€ æ–¹æ³•ä¸èƒ½ä½¿ç”¨ synchronized å…³é”®å­—ä¿®é¥°ã€‚ä¸è¿‡ï¼Œå¯ä»¥åœ¨æ„é€ æ–¹æ³•å†…éƒ¨ä½¿ç”¨ synchronized ä»£ç å—ã€‚</span></p><p><span>å¦å¤–ï¼Œæ„é€ æ–¹æ³•æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­æ¶‰åŠåˆ°å…±äº«èµ„æºçš„æ“ä½œï¼Œå°±éœ€è¦é‡‡å–é€‚å½“çš„åŒæ­¥æªæ–½æ¥ä¿è¯æ•´ä¸ªæ„é€ è¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨ã€‚</span></p><p><span>å°½é‡ä¸è¦ä½¿ç”¨ </span><code>synchronized(String a)</code><span> å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ã€‚</span></p></blockquote><h3 id='åº•å±‚åŸç†'><span>åº•å±‚åŸç†</span></h3><p><strong><span>åŸç†ä¹‹Monitor</span></strong></p><p><span>æ¯ä¸ªjavaå¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„monitorå¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨sychronizedç»™å¯¹è±¡ä¸Šé”(é‡é‡çº§)ä¹‹åï¼Œè¯¥å¯¹è±¡å¤´çš„mark wordä¸­å°±è¢«è®¾ç½®æŒ‡å‘monitorå¯¹è±¡çš„æŒ‡é’ˆã€‚</span></p><p><img src="./images/Monitor.png" referrerpolicy="no-referrer" alt="Monitor.png"></p><ul><li><p><span>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedï¼Œä¼šå…ˆæŸ¥è¯¢synchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)</span><strong><span>æ˜¯å¦ç»‘å®šäº†Monitor</span></strong><span>ã€‚</span></p><ul><li><p><span>å¦‚æœ</span><strong><span>æ²¡æœ‰ç»‘å®š</span></strong><span>ï¼Œåˆ™ä¼šå…ˆå»ä¸Monitorç»‘å®šï¼Œä¹Ÿå°±æ˜¯å°†å¯¹è±¡å¤´ä¸­çš„</span><strong><span>Mark Word</span></strong><span>ç½®ä¸ºMonitoræŒ‡é’ˆï¼Œå¹¶ä¸”å°†Ownerè®¾ä¸ºå½“å‰çº¿ç¨‹ã€‚</span></p></li><li><p><span>å¦‚æœ</span><strong><span>å·²ç»ç»‘å®š</span></strong><span>ï¼Œåˆ™ä¼šå»æŸ¥è¯¢è¯¥Monitoræ˜¯å¦å·²ç»æœ‰äº†Owner.</span></p><ul><li><p><span>å¦‚æœæ²¡æœ‰ï¼Œåˆ™Ownerä¸å°†å½“å‰çº¿ç¨‹ç»‘å®š</span></p></li><li><p><span>å¦‚æœæœ‰ï¼Œåˆ™æ”¾å…¥EntryListï¼Œè¿›å…¥é˜»å¡çŠ¶æ€(blocked)</span></p></li></ul></li></ul></li><li><p><span>å½“Monitorçš„Ownerå°†ä¸´ç•ŒåŒºä¸­ä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒOwnerä¾¿ä¼šè¢«æ¸…ç©ºï¼Œæ­¤æ—¶EntryListä¸­å¤„äº</span><strong><span>é˜»å¡</span></strong><span>çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«</span><strong><span>å«é†’å¹¶ç«äº‰</span></strong><span>ï¼Œæ­¤æ—¶çš„ç«äº‰æ˜¯</span><strong><span>éå…¬å¹³çš„</span></strong><span>.</span></p></li></ul><blockquote><ul><li><p><span>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»‘å®šä¸€ä¸ª</span><strong><span>å”¯ä¸€çš„Monitor</span></strong><span>ï¼Œå¦‚æœsynchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)</span><strong><span>ä¸åŒ</span></strong><span>ï¼Œåˆ™ä¼šç»‘å®š</span><strong><span>ä¸åŒ</span></strong><span>çš„Monitor</span></p></li></ul></blockquote><p><strong><span>åŒæ­¥ä»£ç å—</span></strong></p><ul><li><p><strong><code>Synchronzed</code><span>åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯</span></strong><code>monitorenter</code><strong><span>å’Œ</span></strong><code>monitorexit</code><strong><span>æŒ‡ä»¤ï¼Œå…¶ä¸­</span><code>monitorenter</code><span>æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—å¼€å§‹ä½ç½®ï¼Œ</span><code>monitorexit</code><span>æŒ‡ä»¤æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚</span></strong></p></li><li><p><span>å½“æ‰§è¡Œ</span><code>monitorenter</code><span>æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å–å¯¹è±¡ç›‘è§†å™¨</span><code>monitor</code><span>çš„æŒæœ‰æƒã€‚</span></p></li><li><p><span>åœ¨æ‰§è¡Œ</span><code>monitorenter</code><span>æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡çš„é”ï¼Œå¦‚æœé”çš„è®¡æ•°å™¨ä¸º0è¡¨ç¤ºé”å¯ä»¥è¢«è·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º1ä¹Ÿå°±æ˜¯åŠ 1.</span></p></li><li><p><span>åœ¨æ‰§è¡Œ</span><code>monitorexit</code><span>æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º0ï¼Œè¡¨ç¤ºé”è¢«é‡Šæ”¾ï¼Œå¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚</span></p></li></ul><p><strong><span>ä¿®é¥°æ–¹æ³•</span></strong></p><p><code>synchronized</code><span>ä¿®é¥°æ–¹æ³•å¹¶æ²¡æœ‰ç”¨</span><code>monitorenter</code><span>å’Œ</span><code>monitorexit</code><span>æŒ‡ä»¤ï¼Œ</span><strong><span>å–è€Œä»£ä¹‹çš„æ˜¯</span><code>ACC_SYNCHRONIZED</code><span>æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚</span></strong><span>JVMé€šè¿‡è¯¥</span><code>ACC_SYNCHRONIZED</code><span>è®¿é—®æ ‡è¯†æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„è°ƒç”¨ã€‚</span></p><p><strong><span>æ€»ç»“</span></strong></p><p><span>äºŒè€…æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯äºŒè€…çš„æœ¬è´¨éƒ½æ˜¯å¯¹å¯¹è±¡ç›‘è§†å™¨</span><code>monitor</code><span>çš„è·å–ã€‚</span></p><h3 id='å®ç°é‡å…¥'><span>å®ç°é‡å…¥</span></h3><p><span>æ¯ä¸ªé”å…³è”ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è€…å’Œä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è®¡æ•°å™¨ä¸º0 æ—¶è¡¨ç¤ºè¯¥é”æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è·å¾—è¯¥é”è€Œè°ƒç”¨ç›¸åº”æ–¹æ³•ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚æˆåŠŸåï¼ŒJVMä¼šå‡ ä¸‹æŒæœ‰é”çš„çº¿ç¨‹ï¼Œå¹¶å°†è®¡æ•°å™¨è®¡ä¸º1ã€‚æ­¤æ—¶å…¶ä»–çº¿ç¨‹è¯·æ±‚è¯¥é”ï¼Œåˆ™å¿…é¡»ç­‰å¾…ï¼Œè€ŒæŒæœ‰è¯¥æ‰€çš„çº¿ç¨‹å¦‚æœå†æ¬¡è¯·æ±‚è¿™ä¸ªé”ï¼Œå°±å¯ä»¥å†æ¬¡æ‹¿åˆ°è¿™ä¸ªé”ï¼ŒåŒæ—¶è®¡æ•°å™¨ä¼šé€’å¢ã€‚å½“çº¿ç¨‹é€€å‡ºä¸€ä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œè®¡æ•°å™¨ä¼šé€’å‡ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º0åˆ™é‡Šæ”¾è¯¥é”ã€‚</span></p><h3 id='é”å‡çº§è¿‡ç¨‹'><span>é”å‡çº§è¿‡ç¨‹</span></h3><p><span>æ— é”â€”â€”&gt;åå‘é”â€”â€”&gt;è½»é‡çº§é”â€”â€”&gt;é‡é‡çº§é”</span></p><p><strong><span>javaå¯¹è±¡çš„å¸ƒå±€</span></strong></p><p><img src="./images/å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€.png" referrerpolicy="no-referrer" alt="å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€.png"></p><ul><li><p><span>å¯¹è±¡å¤´ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è®¿é—®sychronziedä¿®é¥°çš„ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆè¦è·å¾—é”ï¼Œè¿™ä¸ªé”æ—¶å­˜åœ¨é”çš„å¯¹è±¡å¤´ä¸­ã€‚</span></p></li><li><p><span>å®ä¾‹æ•°æ®ï¼šç±»ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡ã€‚</span></p></li><li><p><span>å¯¹é½å¡«å……ï¼šä¸æ˜¯å¿…é¡»çš„ï¼Œä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨ã€‚</span></p></li></ul><p><span>64ä½è™šæ‹Ÿæœºçš„mark word:</span></p><p><img src="./images/å¯¹è±¡å¤´-é”.png" referrerpolicy="no-referrer" alt="å¯¹è±¡å¤´-é”.png"></p><p><strong><span>åå‘é”</span></strong></p><blockquote><p><span>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—å’Œé‡Šæ”¾ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å–é”çš„ä»£ä»·æ›´ä½ï¼Œå¼•è¿›åå‘é”ã€‚</span></p></blockquote><ul><li><p><span>è¿™ä¸ªé”ä¼šåå‘äºç¬¬ä¸€ä¸ªè·å¾—å®ƒçš„çº¿ç¨‹ï¼Œä¼šåœ¨å¯¹è±¡å¤´å­˜å‚¨é”åå‘çš„çº¿ç¨‹ID,ä»¥åçº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶åªéœ€è¦æ£€æŸ¥æ˜¯å¦ä¸ºåå‘é”ï¼Œé”æ ‡å¿—ä½ä»¥åŠThreadIDå³å¯ã€‚</span></p></li><li><p><span>ä¸€æ—¦å‡ºç°å¤šä¸ªçº¿ç¨‹ç«äº‰æ—¶å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥æ’¤é”€åå‘é”çš„æ€§èƒ½å¿…é¡»å°äºä¹‹å‰èŠ‚çœä¸‹æ¥çš„CASåŸå­æ“ä½œçš„æ€§èƒ½æ¶ˆè€—ï¼Œä¸ç„¶å°±å¾—ä¸å¿å¤±äº†ã€‚</span></p></li></ul><p><strong><span>åŸç†</span></strong></p><p><span>å½“çº¿ç¨‹ç¬¬ä¸€æ¬¡è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œåå‘é”å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</span></p><ul><li><p><span>è™šæ‹Ÿæœºä¼šæŠŠå¯¹è±¡å¤´ä¸­çš„æ ‡å¿—ä½è®¾ç½®ä¸ºâ€™01â€˜ï¼›</span></p></li><li><p><span>åŒæ—¶ä½¿ç”¨CASæ“ä½œæŠŠè·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹IDè®°å½•åˆ°å¯¹è±¡çš„Mark Wordä¸­ï¼Œå¦‚æœCASæ“ä½œæˆåŠŸï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ä¸å†è¿›è¡Œä»»ä½•æ“ä½œï¼Œåå‘é”çš„æ•ˆç‡é«˜ã€‚</span></p></li><li><p><span>ç¬¬äºŒä¸ªçº¿ç¨‹å°è¯•è¿›å…¥åŒä¸€ä¸ªåŒæ­¥å—æ—¶ï¼ŒJVMä¼šæ£€æµ‹åˆ°å¯¹è±¡å¤´ä¸­çš„çº¿ç¨‹IDä¸æ˜¯å½“å‰çº¿ç¨‹çš„IDï¼Œè¿™æ„å‘³ç€å­˜åœ¨ç«äº‰ã€‚</span></p><ul><li><p><span>JVMä¼šæ£€æŸ¥å½“å‰æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦è¿˜å­˜æ´»ã€‚å¦‚æœè¯¥çº¿ç¨‹å·²ç»ç»ˆæ­¢ï¼ŒJVMå¯ä»¥ç›´æ¥æ’¤é”€åå‘çŠ¶æ€ã€‚</span></p></li><li><p><span>å¦‚æœè¯¥çº¿ç¨‹ä»ç„¶å­˜æ´»ï¼ŒJVMä¼šå°è¯•å°†é”å‡çº§åˆ°è½»é‡çº§é”çŠ¶æ€ã€‚è¿™æ¶‰åŠåˆ°å°†é”å¯¹è±¡çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘è½»é‡çº§é”è®°å½•çš„æŒ‡é’ˆã€‚</span></p></li></ul></li></ul><p><strong><span>åå‘é”çš„æ’¤é”€</span></strong></p><ol start='' ><li><p><span>æ’¤é”€åŠ¨ä½œå¿…é¡»ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šåœä¸‹æ¥)ã€‚</span></p></li><li><p><span>æš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚</span></p></li><li><p><span>æ’¤é”€åå‘é”ï¼Œæ¢å¤åˆ°æ— é”(æ ‡å¿—ä½ä¸º01)æˆ–è€…è½»é‡çº§é”(æ ‡å¿—ä½ä¸º00)çš„çŠ¶æ€ã€‚</span></p></li></ol><p><strong><span>åå‘é”çš„å¥½å¤„</span></strong></p><ul><li><p><strong><span>åå‘é”æ—¶åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶è¿›ä¸€æ­¥æé«˜æ€§èƒ½</span></strong><span>ï¼Œé€‚åˆç”¨äºä¸€ä¸ªçº¿ç¨‹åå¤è·å¾—åŒä¸€ä¸ªé”çš„æƒ…å†µï¼Œåå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥ä½†æ˜¯æ— ç«äº‰çš„ç¨‹åºæ€§èƒ½ã€‚</span></p></li><li><p><span>ä½†æ˜¯å®ƒä¸ä¸€å®šæ˜¯å¯¹ç¨‹åºè¿è¡Œæœ‰åˆ©ï¼Œ</span><strong><span>å¦‚æœç¨‹åºä¸­çš„å¤§å¤šæ•°é”æ€»æ˜¯è¢«å¤šä¸ªä¸åŒçš„çº¿ç¨‹è®¿é—®ï¼Œæ¯”å¦‚çº¿ç¨‹æ± ï¼Œé‚£åå‘é”æ¨¡å¼æ˜¯å¤šä½™çš„ã€‚</span></strong></p></li></ul><p><strong><span>è½»é‡çº§é”</span></strong></p><blockquote><p><span>å¼•å…¥è½»é‡çº§é”çš„ç›®çš„ï¼šåœ¨</span><strong><span>å¤šçº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—</span></strong><span>çš„æƒ…å†µä¸‹ï¼Œå°½é‡é¿å…é‡é‡çº§é”å¼•èµ·çš„æ€§èƒ½çš„æ¶ˆè€—ï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»è¿›å…¥ä¸´ç•ŒåŒºï¼Œä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€å‡çº§ä¸ºé‡é‡çº§é”ï¼Œæ‰€ä»¥è½»é‡çº§é”çš„å‡ºç°å¹¶ä¸æ˜¯ä¸ºäº†æ›¿ä»£é‡é‡çº§é”ã€‚</span></p></blockquote><p><strong><span>åŸç†</span></strong></p><blockquote><p><span>å°†å¯¹è±¡çš„Mark Wordå¤åˆ¶åˆ°æ ˆå¸§ä¸­çš„Lock Recordä¸­ï¼ŒMark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆã€‚</span></p><p><span>è½»é‡çº§é”æ˜¯åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œå°è¯•æ‹·è´é”å¯¹è±¡å¤´çš„Markwordåˆ°æ ˆå¸§çš„Lock Recordï¼Œè‹¥æ‹·è´æˆåŠŸï¼ŒJVMå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡å¤´çš„Markwordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡å¤´çš„Markwordã€‚è‹¥æ‹·è´å¤±è´¥,è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™å¯é€šè¿‡è‡ªæ—‹ç»§ç»­å°è¯•ï¼Œ å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªçº¿ç¨‹æ¥è®¿é—®æ—¶ï¼Œè½»é‡çº§é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</span></p></blockquote><p><span>å½“å…³é—­åå‘é”åŠŸèƒ½æˆ–è€…å¤šä¸ªçº¿ç¨‹ç«äº‰åå‘é”å¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œåˆ™ä¼šå°è¯•è·å–è½»é‡çº§é”ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</span></p><ul><li><p><span>åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦å¤„äºæ— é”çŠ¶æ€(hashcode,0,01)ï¼Œå¦‚æœæ˜¯ï¼Œåˆ›å»º</span><strong><span>é”è®°å½•</span></strong><span>ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•å¯¹è±¡ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„mark wordï¼ˆä¸å†ä¸€å¼€å§‹å°±ä½¿ç”¨Monitorï¼‰ã€‚</span></p></li></ul><p><img src="./images/è½»é‡çº§é”.png" referrerpolicy="no-referrer" alt="è½»é‡çº§é”.png"></p><ul><li><p><span>è®©é”è®°å½•ä¸­çš„Object referenceæŒ‡å‘é”å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå¹¶å°è¯•ç”¨caså»æ›¿æ¢Objectä¸­çš„mark wordï¼Œå°†æ­¤mark wordæ”¾å…¥lock recordä¸­ä¿å­˜.</span></p></li></ul><p><img src="./images/è½»é‡çº§é”1.png" referrerpolicy="no-referrer" alt="è½»é‡çº§é”1.png"></p><ul><li><p><span>å¦‚æœcasæ›¿æ¢æˆåŠŸï¼Œåˆ™å°†Objectçš„å¯¹è±¡å¤´æ›¿æ¢ä¸º</span><strong><span>é”è®°å½•çš„åœ°å€</span></strong><span>å’Œ</span><strong><span>çŠ¶æ€ 00ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</span></strong><span>ï¼Œå¹¶ç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”.</span></p></li></ul><p><img src="./images/è½»é‡çº§é”2.png" referrerpolicy="no-referrer" alt="è½»é‡çº§é”2.png"></p><ul><li><p><span>å¦‚æœå¤±è´¥åˆ™åˆ¤æ–­å½“å‰å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§.</span></p><ul><li><p><span>å¦‚æœæ˜¯åˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æŒæœ‰å½“å‰å¯¹è±¡çš„é”ï¼Œåˆ™è¿›å…¥sychronizedé”é‡å…¥ï¼Œå†åŠ ä¸€æ¡Lock Recordä½œä¸ºé‡å…¥çš„è®¡æ•°ï¼Œä½†æ˜¯æ­¤åˆ»é”è®°å½•æ˜¯null. </span></p></li><li><p><span>å¦‚æœä¸æ˜¯åªèƒ½è¯´æ˜è¯¥é”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ï¼Œè¿™æ—¶å€™è½»é‡çº§é”éœ€è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—ä½å˜ä¸º10ï¼Œåé¢ç­‰å¾…çš„çº¿ç¨‹å°†ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</span></p></li></ul></li><li><p><span>å½“é€€å‡ºsychronizedæ—¶ï¼Œåˆ¤æ–­é”è®°å½•æ˜¯å¦ä¸ºnull:</span></p><ul><li><p><span>å¦‚æœé”è®°å½•ä¸ºnullï¼Œè¿™æ—¶é‡ç½®é”è®°å½•ï¼Œè¡¨ç¤ºé‡å…¥è®¡æ•°å‡ä¸€ã€‚</span></p></li><li><p><span>å¦‚æœä¸ä¸ºnull,ä½¿ç”¨CASå°†mark wordæ¢å¤ç»™å¯¹è±¡å¤´ã€‚</span></p><ul><li><p><span>å¦‚æœCASå¤±è´¥ï¼Œè¿™æ—¶ä¼šè¿›å…¥é‡é‡çº§é”æµç¨‹ï¼Œå³æŒ‰ç…§monitoråœ°å€æ‰¾åˆ°monitorå¯¹è±¡ï¼Œè®¾ç½®Ownerä¸ºnullï¼Œå”¤é†’EntryListä¸­é¢çº¿ç¨‹ã€‚</span></p></li></ul></li></ul></li></ul><p><strong><span>è½»é‡çº§é”çš„å¥½å¤„</span></strong></p><ul><li><p><span>åœ¨å¤šçº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é¿å…é‡é‡çº§é”å¼•èµ·çš„æ€§èƒ½çš„æ¶ˆè€—ã€‚</span></p></li><li><p><span>å¯¹äºè½»é‡çº§é”ï¼Œå…¶æ€§èƒ½æå‡çš„ä¾æ®æ˜¯â€å¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¼šå­˜åœ¨ç«äº‰çš„â€œï¼Œå¦‚æœæ‰“ç ´è¿™ä¸ªä¾æ®åˆ™å‡ºæ¥äº’æ–¥çš„å¼€é”€å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„CASæ“ä½œï¼Œå› æ­¤åœ¨æœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè½»é‡çº§é”æ¯”é‡é‡çº§é”æ›´æ…¢ã€‚</span></p></li></ul><p><strong><span>é‡é‡çº§é”</span></strong></p><p><span>å¦‚æœå°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­CASå¤±è´¥ï¼Œå°±éœ€è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</span></p><p><span>monitorå®ç°é”çš„æ—¶å€™ï¼Œä¼šé˜»å¡å’Œå”¤é†’çº¿ç¨‹ï¼Œçº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’éœ€è¦CPUä»ç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼Œé¢‘ç¹çš„é˜»å¡å’Œå”¤é†’CPUæ¥è¯´æ˜¯ä¸€ä»¶è´Ÿæ‹…å¾ˆé‡çš„å·¥ä½œï¼Œè¿™äº›æ“ä½œç»™æ“ä½œç³»ç»Ÿçš„å¹¶å‘å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚</span></p><p><strong><span>è‡ªæ—‹é”</span></strong></p><p><strong><span>è‡ªæ—‹é”åŠ é”å¤±è´¥åï¼Œä¼šä¸€ç›´å¿™ç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°é”ã€‚</span></strong><span> åœ¨ã€Œç”¨æˆ·æ€ã€å®ŒæˆåŠ é”å’Œè§£é”æ“ä½œï¼Œä¸ä¼šä¸»åŠ¨äº§ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥ç›¸æ¯”äº’æ–¥é”æ¥è¯´ï¼Œä¼šå¿«ä¸€äº›ï¼Œå¼€é”€ä¹Ÿå°ä¸€äº›ã€‚</span><strong><span>é€‚åˆç”¨äºè¢«é”ä½çš„ä»£ç è¿è¡Œæ—¶é—´å¾ˆçŸ­çš„åœºæ™¯ã€‚</span></strong></p><p><strong><span>é€‚åº”æ€§è‡ªæ—‹é”</span></strong></p><p><span>JDK6ä¸­å¼•å…¥ï¼Œè‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çŠ¶æ€æ¥å†³å®šã€‚</span></p><p><strong><span>é”æ¶ˆé™¤</span></strong></p><p><span>é”æ¶ˆé™¤çš„ä¸»è¦åˆ¤æ–­ä¾æ®æ˜¯æ¥æºäºé€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒï¼Œå¦‚æœåˆ¤æ–­ä¸€æ®µä»£ç ä¸­ï¼Œå †ä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½ä¸ä¼šé€ƒé€¸å‡ºå»è€Œè¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠå®ƒä»¬å½“ä½œæ ˆä¸Šçš„æ•°æ®å¯¹å¾…ï¼Œè®¤ä¸ºå®ƒä»¬æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼ŒåŒæ­¥åŠ é”å°±æ— éœ€è¿›è¡Œã€‚</span></p><p><strong><span>é”ç²—åŒ–</span></strong></p><p><span>JVMä¼šæ¢æµ‹åˆ°ä¸€è¿ä¸²ç»†å°çš„æ“ä½œéƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†åŒæ­¥ä»£ç å—çš„èŒƒå›´æ”¾å¤§ï¼Œæ”¾åˆ°è¿™ä¸²æ“ä½œçš„å¤–é¢ï¼Œè¿™æ ·åªéœ€è¦åŠ ä¸€æ¬¡é”å°±å¯ä»¥äº†ã€‚(å¦‚forå¾ªç¯é‡Œçš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œè¿™æ—¶å€™åªè¦åœ¨forå¾ªç¯å¤–é¢åŠ ä¸€æ¬¡é”å°±å¯ä»¥äº†)</span></p><ul><li><p><code>obj.wait()</code><span> è®©è¿›å…¥ object ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° waitSet ç­‰å¾… </span></p></li><li><p><code>obj.notify()</code><span> åœ¨ object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ </span></p></li><li><p><code>obj.notifyAll()</code><span> è®© object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’</span></p></li></ul><h1 id='å››locké”'><span>å››ã€locké”</span></h1><h2 id='æ˜¯ä»€ä¹ˆ-2'><span>æ˜¯ä»€ä¹ˆï¼Ÿ</span></h2><ul><li><p><span>locké”æ˜¯ä¸€ä¸ªæ¥å£, JDKçº§åˆ«çš„é”</span></p></li><li><p><span>åªå¯ä»¥é”ä»£ç å—</span></p></li><li><p><span>è½»é‡çº§é”ï¼Œæ€§èƒ½é«˜ï¼Œå°¤å…¶ä½¿ç«äº‰èµ„æºéå¸¸æ¿€çƒˆæ—¶ã€‚</span></p></li><li><p><span>éœ€è¦ä¸»åŠ¨é‡Šæ”¾é”</span></p></li></ul><h2 id='reentrantlock'><span>ReentrantLock</span></h2><h3 id='ç®€ä»‹'><span>ç®€ä»‹</span></h3><p><code>ReentrantLock</code><span> å®ç°äº† </span><code>Lock</code><span> æ¥å£ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼çš„é”ï¼Œå’Œ </span><code>synchronized</code><span> å…³é”®å­—ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œ</span><code>ReentrantLock</code><span> æ›´çµæ´»ã€æ›´å¼ºå¤§ï¼Œå¢åŠ äº†è½®è¯¢ã€è¶…æ—¶ã€ä¸­æ–­ã€å…¬å¹³é”å’Œéå…¬å¹³é”ç­‰é«˜çº§åŠŸèƒ½ã€‚</span></p><p><code>ReentrantLock</code><span> é‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±» </span><code>Sync</code><span>ï¼Œ</span><code>Sync</code><span> ç»§æ‰¿ AQSï¼ˆ</span><code>AbstractQueuedSynchronizer</code><span>ï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨ </span><code>Sync</code><span> ä¸­å®ç°çš„ã€‚</span><code>Sync</code><span> æœ‰å…¬å¹³é” </span><code>FairSync</code><span> å’Œéå…¬å¹³é” </span><code>NonfairSync</code><span> ä¸¤ä¸ªå­ç±»ã€‚</span></p><ul><li><p><span>å¯é‡å…¥é”ï¼Œå¯ä»¥è¢«å•ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–ã€‚</span></p><ul><li><p><span>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”</span></p></li><li><p><span>å¦‚æœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½ã€‚</span></p></li></ul></li><li><p><span>åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼šåœ¨å…¬å¹³é”æœºåˆ¶ä¸‹ï¼Œçº¿ç¨‹ä¾æ¬¡æ’é˜Ÿï¼Œè€Œéå…¬å¹³é”åœ¨é”æ˜¯å¯è·å–çŠ¶æ€æ—¶ï¼Œä¸ç®¡è‡ªå·±æ˜¯ä¸æ˜¯åœ¨é˜Ÿåˆ—çš„å¼€å¤´éƒ½ä¼šè·å–é”ã€‚ </span></p></li><li><p><span>ç‹¬å é”</span></p></li><li><p><span>é”è¶…æ—¶</span></p><ul><li><p><span>ä½¿ç”¨</span><strong><span>lock.tryLock</span></strong><span>æ–¹æ³•ä¼šè¿”å›è·å–é”æ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œåä¹‹åˆ™è¿”å›falseã€‚</span></p></li><li><p><span>å¹¶ä¸”tryLockæ–¹æ³•å¯ä»¥</span><strong><span>æŒ‡å®šç­‰å¾…æ—¶é—´</span></strong><span>ï¼Œå‚æ•°ä¸ºï¼štryLock(long timeout, TimeUnit unit), å…¶ä¸­timeoutä¸ºæœ€é•¿ç­‰å¾…æ—¶é—´ï¼ŒTimeUnitä¸ºæ—¶é—´å•ä½ã€‚</span></p></li></ul></li><li><p><span>ç”¨äºè§£å†³æ­»é”é—®é¢˜</span></p></li></ul><h3 id='ä½¿ç”¨'><span>ä½¿ç”¨</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ReentrantLock</span> <span class="cm-variable">lock</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReentrantLock</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Thread</span> <span class="cm-variable">t1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"å¯åŠ¨..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">lock</span>.<span class="cm-variable">tryLock</span>(<span class="cm-number">1</span>, <span class="cm-variable">TimeUnit</span>.<span class="cm-variable">SECONDS</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"è·å–ç­‰å¾… 1s åå¤±è´¥ï¼Œè¿”å›"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"è·å¾—äº†é”"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}, <span class="cm-string">"t1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lock</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"è·å¾—äº†é”"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t1</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sleep</span>(<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 667px;"></div><div class="CodeMirror-gutters" style="display: none; height: 667px;"></div></div></div></pre><h3 id='ä½¿ç”¨-trylock-è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜'><span>ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Chopstick</span> <span class="cm-keyword">extends</span> <span class="cm-variable">ReentrantLock</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Chopstick</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-variable">toString</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-string">"ç­·å­{"</span> <span class="cm-operator">+</span> <span class="cm-variable">name</span> <span class="cm-operator">+</span> <span class="cm-string">'}'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Philosopher</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Chopstick</span> <span class="cm-variable">left</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Chopstick</span> <span class="cm-variable">right</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Philosopher</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable">Chopstick</span> <span class="cm-variable">left</span>, <span class="cm-variable">Chopstick</span> <span class="cm-variable">right</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>(<span class="cm-variable">name</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">left</span> <span class="cm-operator">=</span> <span class="cm-variable">left</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">right</span> <span class="cm-operator">=</span> <span class="cm-variable">right</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°è¯•è·å¾—å·¦æ‰‹ç­·å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">left</span>.<span class="cm-variable">tryLock</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°è¯•è·å¾—å³æ‰‹ç­·å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">right</span>.<span class="cm-variable">tryLock</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eat</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">right</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">left</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">void</span> <span class="cm-variable">eat</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"eating..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Sleeper</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><h2 id='33-readwritelocké”'><span>3.3 ReadWriteLocké”</span></h2><ul><li><p><code>ReadWriteLock</code><span>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ</span><code>ReentrantReadWriteLock</code><span>æ˜¯å®ƒçš„å®ç°ç±»;</span></p></li><li><p><code>WriteLock</code><span>(å†™é”)ç‹¬å é”,</span><code>ReadLock</code><span>(è¯»é”)å…±äº«é”ã€‚</span></p></li></ul><h2 id='34-synchronized-vs-reentrantlock'><span>3.4 synchronized VS ReentrantLock</span></h2><ol start='' ><li><p><span>ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”ã€‚</span></p></li><li><p><code>synhronized</code><span>ä¾èµ–äº</span><code>JVM</code><span>,è€Œ</span><code>ReentrantLock</code><span>ä¾èµ–äº</span><code>API</code><span>ï¼ŒAQSã€‚</span></p></li><li><p><span>ç­‰å¾…å¯ä¸­æ–­ï¼š</span><code>ReentrantLock</code><span>æä¾›äº†ä¸€ä¸ªèƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚</span></p></li><li><p><span>å¯å®ç°å…¬å¹³é”ï¼š</span><code>ReentrantLock</code><span>å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œè€Œ</span><code>synchronized</code><span>åªèƒ½æ˜¯éå…¬å¹³é”ã€‚</span></p></li><li><p><span>å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼š</span><code>synchronized</code><span>å…³é”®å­—ä¸</span><code>wait()</code><span>å’Œ</span><code>notify()/notifyAll()</code><span>æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚</span><code>ReentrantLock</code><span>ç±»å€ŸåŠ©</span><code>Condition</code><span>æ¥å£ä¸</span><code>newCondition()</code><span>æ–¹æ³•æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ã€‚</span></p></li></ol><h1 id='äº”volatileå…³é”®å­—å¯è§æ€§æœ‰åºæ€§ï¼‰'><span>äº”ã€volatileå…³é”®å­—ï¼ˆå¯è§æ€§&amp;æœ‰åºæ€§ï¼‰</span></h1><blockquote><ul><li><p><span>åœ¨å½“å‰çš„ Java å†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜æœ¬åœ°å†…å­˜ï¼ˆæ¯”å¦‚æœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å†™ã€‚è¿™å°±å¯èƒ½é€ æˆä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆæ•°æ®çš„ä¸ä¸€è‡´ã€‚</span>
<span>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æŠŠå˜é‡å£°æ˜ä¸º</span><strong><span>volatile</span></strong><span>ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚</span></p></li><li><p><span>ä¸ºäº†æå‡æ‰§è¡Œé€Ÿåº¦/æ€§èƒ½ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºä»£ç çš„æ—¶å€™ï¼Œä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚</span></p></li><li><p><strong><span>ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’</span></strong><span>ï¼šç¼–è¯‘å™¨ï¼ˆåŒ…æ‹¬ JVMã€JIT ç¼–è¯‘å™¨ç­‰ï¼‰åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œé‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</span></p><p><strong><span>æŒ‡ä»¤å¹¶è¡Œé‡æ’</span></strong><span>ï¼šç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯(Instruction-Level Parallelismï¼ŒILP)æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</span></p></li><li><p><span>Java æºä»£ç ä¼šç»å† </span><strong><span>ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’ â€”&gt; æŒ‡ä»¤å¹¶è¡Œé‡æ’ â€”&gt; å†…å­˜ç³»ç»Ÿé‡æ’</span></strong><span> çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆæ‰å˜æˆæ“ä½œç³»ç»Ÿå¯æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ã€‚</span></p></li><li><p><strong><span>æŒ‡ä»¤é‡æ’åºå¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´</span></strong><span> ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚</span></p></li></ul></blockquote><h2 id='41-è¦ç‚¹'><span>4.1 è¦ç‚¹ </span></h2><ul><li><p><span>ä½¿ç”¨volatileä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥ä¿è¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„</span><strong><span>å¯è§æ€§</span></strong><span>ï¼Œå¹¶ä¸”</span><strong><span>é¿å…æŒ‡ä»¤é‡æ’ã€‚</span></strong></p></li><li><p><strong><span>ç”¨æ¥ç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ç¨‹ã€‚</span></strong></p></li><li><p><strong><span>volatile+CASå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚</span></strong></p></li></ul><h2 id='42-javaå†…å­˜æ¨¡å‹'><span>4.2 Javaå†…å­˜æ¨¡å‹</span></h2><blockquote><p><span>Javaå†…å­˜æ¨¡å‹å³Java Memory Modelï¼Œç®€ç§°JMMã€‚JMMå®šä¹‰äº†ä¸€å¥—å¤šçº¿ç¨‹åœ¨è¯»å†™å…±äº«æ•°æ®æ—¶(æˆå‘˜å˜é‡ï¼Œæ•°ç»„),å¯¹æ•°æ®çš„å¯è§æ€§ï¼Œæœ‰åºæ€§å’ŒåŸå­æ€§çš„è§„åˆ™å’Œä¿éšœã€‚JVMæ˜¯æ•´ä¸ªè®¡ç®—æœºè™šæ‹Ÿæ¨¡å‹ï¼Œæ‰€ä»¥JMMæ˜¯éš¶å±äºJVMçš„ã€‚</span><a href='https://blog.csdn.net/suifeng3051/article/details/52611310' target='_blank' class='url'>https://blog.csdn.net/suifeng3051/article/details/52611310</a></p></blockquote><p><img src="./images/JMM.png" referrerpolicy="no-referrer"></p><ul><li><p><strong><span>Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</span></strong><span> æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Œå°±æ¯”å¦‚è¯´çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å¿…é¡»å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</span></p></li><li><p><strong><span>ä»€ä¹ˆæ˜¯ä¸»å†…å­˜ï¼Ÿä»€ä¹ˆæ˜¯æœ¬åœ°å†…å­˜ï¼Ÿ</span></strong></p><ul><li><p><strong><span>ä¸»å†…å­˜</span></strong><span>ï¼šæ‰€æœ‰çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œä¸ç®¡è¯¥å®ä¾‹å¯¹è±¡æ˜¯æˆå‘˜å˜é‡ï¼Œè¿˜æ˜¯å±€éƒ¨å˜é‡ï¼Œç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡éƒ½æ˜¯æ”¾åœ¨ä¸»å†…å­˜ä¸­ã€‚ä¸ºäº†è·å–æ›´å¥½çš„è¿è¡Œé€Ÿåº¦ï¼Œè™šæ‹ŸæœºåŠç¡¬ä»¶ç³»ç»Ÿå¯èƒ½ä¼šè®©å·¥ä½œå†…å­˜ä¼˜å…ˆå­˜å‚¨äºå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜ä¸­ã€‚</span></p></li><li><p><strong><span>æœ¬åœ°å†…å­˜</span></strong><span>ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯» / å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±æœ¬åœ°å†…å­˜ä¸­çš„å˜é‡ï¼Œæ— æ³•ç›´æ¥è®¿é—®å…¶ä»–çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ã€‚å¦‚æœçº¿ç¨‹é—´éœ€è¦é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥è¿›è¡Œã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</span></p></li></ul></li></ul><h2 id='43-synchronize-vs-volatile'><span>4.3 synchronize VS volatile</span></h2><ul><li><p><span>volatile å…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ€§èƒ½æ¯”synchronizedå…³é”®å­—è¦å¥½ã€‚</span></p></li><li><p><span>volatile å…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œ synchronizedå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—ã€‚</span></p></li><li><p><span>volatileå…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ã€‚</span></p></li><li><p><span>volatile å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚synchronized å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</span></p><ul><li><p><span>å½“çº¿ç¨‹è¿›å…¥ä¸€ä¸ª</span><code>synchronized</code><span>å—æ—¶ï¼Œå®ƒä¼šé¦–å…ˆä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ã€‚</span></p></li><li><p><span>å½“çº¿ç¨‹æ‰§è¡Œå®Œ</span><code>synchronized</code><span>å—å¹¶é€€å‡ºæ—¶ï¼Œå®ƒä¼šå°†è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚</span></p></li></ul></li></ul><h2 id='44-volatileåŸç†'><span>4.4 volatileåŸç†</span></h2><h3 id='æœ‰åºæ€§'><span>æœ‰åºæ€§</span></h3><p><span>JVMä¼šå†ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥æ‰§è¡Œçš„é¡ºåºã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-variable">i</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-variable">j</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//åœ¨æŸä¸ªçº¿ç¨‹å†…æ‰§è¡Œå¦‚ä¸‹èµ‹å€¼æ“ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span><span class="cm-operator">=</span>...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">j</span><span class="cm-operator">=</span>...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºå…ˆæ‰§è¡Œiè¿˜æ˜¯å…ˆæ‰§è¡Œjï¼Œå¯¹æœ€ç»ˆçš„ç»“æœéƒ½ä¸ä¼šé€ æˆå½±å“ã€‚è¿™ç§ç‰¹æ€§ç§°ä¸ºæŒ‡ä»¤é‡æ’ï¼Œå¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’ä¼šå½±å“æ­£ç¡®æ€§ã€‚</span></p><p><strong><span>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</span></strong></p><ul><li><p><span>äº‹å®ä¸Šï¼Œç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š </span><strong><span>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</span></strong><span> è¿™5 ä¸ªé˜¶æ®µ</span></p></li></ul><p><img src="./images/æŒ‡ä»¤é‡æ’ä¼˜åŒ–.png" referrerpolicy="no-referrer" alt="æŒ‡ä»¤é‡æ’ä¼˜åŒ–.png"></p><ul><li><p><span>åœ¨ä¸æ”¹å˜ç¨‹åºç»“æœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡</span><strong><span>é‡æ’åº</span></strong><span>å’Œ</span><strong><span>ç»„åˆ</span></strong><span>æ¥å®ç°</span><strong><span>æŒ‡ä»¤çº§å¹¶è¡Œ</span></strong></p></li><li><p><span>æŒ‡ä»¤é‡æ’çš„å‰ææ˜¯ï¼Œé‡æ’æŒ‡ä»¤</span><strong><span>ä¸èƒ½å½±å“ç»“æœ</span></strong><span>ï¼Œä¾‹å¦‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å¯ä»¥é‡æ’çš„ä¾‹å­ </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>( <span class="cm-variable">a</span> <span class="cm-operator">+</span> <span class="cm-variable">b</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// ä¸èƒ½é‡æ’çš„ä¾‹å­ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-variable">a</span> <span class="cm-operator">-</span> <span class="cm-number">5</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><strong><span>æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨</span></strong></p><p><span>ç°ä»£ CPU æ”¯æŒå¤šçº§</span><strong><span>æŒ‡ä»¤æµæ°´çº¿</span></strong><span>ï¼Œä¾‹å¦‚æ”¯æŒ</span><strong><span>åŒæ—¶</span></strong><span>æ‰§è¡Œ </span><strong><span>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</span></strong><span> çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€ æ¡æ‰§è¡Œæ—¶é—´é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°</span><strong><span>ååç‡</span></strong><span>ã€‚</span></p><p><img src="./images/æµæ°´çº¿å¤„ç†å™¨.png" referrerpolicy="no-referrer" alt="æµæ°´çº¿å¤„ç†å™¨.png"></p><p><strong><span>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å‡ºç°æ„æ–™ä¹‹å¤–çš„ç»“æœ</span></strong></p><p><strong><span>è§£å†³åŠæ³•</span></strong></p><p><strong><span>volatile</span></strong><span> ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥</span><strong><span>ç¦ç”¨</span></strong><span>æŒ‡ä»¤é‡æ’</span></p><ul><li><p><span>ç¦æ­¢çš„æ˜¯åŠ volatileå…³é”®å­—å˜é‡ä¹‹å‰çš„ä»£ç è¢«é‡æ’åº</span></p></li></ul><p><strong><span>å†…å­˜å±éšœ</span></strong></p><ul><li><p><span>å¯è§æ€§</span></p><ul><li><p><span>å†™å±éšœï¼š</span><strong><span>volatile</span></strong><span> ä¿®é¥°çš„å˜é‡åé¢ä¼šæœ‰ä¸€ä¸ªå†™å±éšœï¼Œä¿è¯åœ¨å†™å±éšœä¹‹å‰ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­ã€‚</span></p></li><li><p><span>è¯»å±éšœï¼š</span><strong><span>volatile</span></strong><span> ä¿®é¥°çš„å˜é‡å‰é¢ä¼šæœ‰ä¸€ä¸ªè¯»å±éšœï¼Œä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®ã€‚</span></p></li></ul></li><li><p><span>æœ‰åºæ€§</span></p><ul><li><p><span>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹åã€‚</span></p></li><li><p><span>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰ã€‚</span></p></li></ul></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">actor2</span>(<span class="cm-variable">I_Result</span> <span class="cm-variable">r</span>){</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">num</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ready</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;<span class="cm-comment">//readyæ˜¯volatileèµ‹å€¼å¸¦å†™å±éšœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//å†™å±éšœï¼šready numéƒ½ä¼šåŒæ­¥åˆ°ä¸»å­˜ä¸­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">actor1</span>(<span class="cm-variable">I_Result</span> <span class="cm-variable">r</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//è¯»å±éšœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//readyæ˜¯volatileè¯»å–å€¼å¸¦å±éšœï¼šåœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">ready</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span>.<span class="cm-variable">r1</span> <span class="cm-operator">=</span> <span class="cm-variable">num</span> <span class="cm-operator">+</span> <span class="cm-variable">num</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }<span class="cm-keyword">else</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span>.<span class="cm-variable">r1</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 414px;"></div><div class="CodeMirror-gutters" style="display: none; height: 414px;"></div></div></div></pre><h1 id='å…­threadlocal'><span>å…­ã€ThreadLocal</span></h1><ul><li><p><span>ThreadLocalç±»ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„ç§æœ‰æ•°æ®ã€‚</span></p></li><li><p><span>å¦‚æœåˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œå½“å¤šçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡æ—¶ï¼Œå®é™…æ“ä½œçš„æ˜¯è‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ã€‚</span></p></li></ul><h2 id='threadlocalä¸sychronizedçš„å¯¹æ¯”'><span>ThreadLocalä¸sychronizedçš„å¯¹æ¯”</span></h2><figure class='table-figure'><table><thead><tr><th>&nbsp;</th><th><span>sychronized</span></th><th><span>ThreadLocal</span></th></tr></thead><tbody><tr><td><span>åŸç†</span></td><td><span>åŒæ­¥æœºåˆ¶é‡‡ç”¨ä»¥æ—¶é—´æ¢ç©ºé—´çš„æ–¹å¼ï¼Œåªæä¾›ä¸€ä»½å˜é‡è®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®</span></td><td><span>é‡‡ç”¨ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼Œä»è€Œå®ç°åŒæ­¥è®¿é—®è€Œä¸ç›¸äº’å¹²æ‰°</span></td></tr><tr><td><span>ä¾§é‡ç‚¹</span></td><td><span>å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥</span></td><td><span>å¤šä¸ªçº¿ç¨‹è®©æ¯ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ç›¸äº’éš”ç¦»</span></td></tr></tbody></table></figure><h2 id='æ•°æ®ç»“æ„'><span>æ•°æ®ç»“æ„</span></h2><p><img src=".\images\threadLocalçš„æ•°æ®ç»“æ„.png" referrerpolicy="no-referrer" alt=".\images\threadLocalçš„æ•°æ®ç»“æ„.png"></p><ul><li><p><span>Threadç±»æœ‰ä¸€ä¸ªç±»å‹ä¸ºThreadLocal.ThreadLocalMapçš„å®ä¾‹å˜é‡threadLocalsï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ThreadLocalMapã€‚</span></p></li><li><p><span>ThreadLocalæœ‰è‡ªå·±ç‹¬ç«‹çš„å®ç°ï¼Œå…¶ä¸­keyä¸ºThreadLocalçš„ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œvalueä¸ºå˜é‡å€¼ã€‚</span></p></li><li><p><span>æ¯ä¸ªçº¿ç¨‹åœ¨å¾€</span><code>ThreadLocal</code><span>é‡Œæ”¾å€¼çš„æ—¶å€™ï¼Œéƒ½ä¼šå¾€è‡ªå·±çš„</span><code>ThreadLocalMap</code><span>é‡Œå­˜ï¼Œè¯»ä¹Ÿæ˜¯ä»¥</span><code>ThreadLocal</code><span>ä½œä¸ºå¼•ç”¨ï¼Œåœ¨è‡ªå·±çš„</span><code>map</code><span>é‡Œæ‰¾å¯¹åº”çš„</span><code>key</code><span>ï¼Œä»è€Œå®ç°äº†</span><strong><span>çº¿ç¨‹éš”ç¦»</span></strong><span>ã€‚</span></p></li><li><p><code>ThreadLocalMap</code><span>æœ‰ç‚¹ç±»ä¼¼</span><code>HashMap</code><span>çš„ç»“æ„ï¼Œåªæ˜¯</span><code>HashMap</code><span>æ˜¯ç”±</span><strong><span>æ•°ç»„+é“¾è¡¨</span></strong><span>å®ç°çš„ï¼Œè€Œ</span><code>ThreadLocalMap</code><span>ä¸­å¹¶æ²¡æœ‰</span><strong><span>é“¾è¡¨</span></strong><span>ç»“æ„ã€‚</span></p></li><li><p><span>æˆ‘ä»¬è¿˜è¦æ³¨æ„</span><code>Entry</code><span>ï¼Œ å®ƒçš„</span><code>key</code><span>æ˜¯</span><code>ThreadLocal&lt;?&gt; k</code><span> ï¼Œç»§æ‰¿è‡ª</span><code>WeakReference</code><span>ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¼±å¼•ç”¨ç±»å‹ã€‚</span></p></li></ul><h2 id='threadlocalçš„keyçš„å¼±å¼•ç”¨ä¸å†…å­˜æ³„æ¼'><code>ThreadLocal</code><span>çš„keyçš„</span><strong><span>å¼±å¼•ç”¨</span></strong><span>ä¸å†…å­˜æ³„æ¼</span></h2><p><img src=".\images\ThreadLocalå¼±å¼•ç”¨.png" referrerpolicy="no-referrer"></p><ul><li><p><span>å¼±å¼•ç”¨å¯èƒ½é€ æˆå†…å­˜æ³„æ¼</span></p><ul><li><p><span>å‡è®¾ä½¿ç”¨å®ŒthreadLocalï¼ŒthreadLocal refè¢«å›æ”¶äº†</span></p></li><li><p><span>ç”±äºthredLocalMapåªæŒæœ‰ThreadLocalçš„å¼±å¼•ç”¨ï¼Œæ‰€ä»¥threadLocalå°±å¯ä»¥è¢«gcå›æ”¶äº†ï¼Œæ­¤æ—¶entryä¸­çš„key=null</span></p></li><li><p><span>ç”±äºæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤entryæ•°ç»„ä»¥åŠcurrentThreadä¾ç„¶è¿è¡Œï¼Œè¿™æ ·è¿˜å­˜åœ¨å¼ºå¼•ç”¨é“¾currenthread ref-----&gt;tthread---&gt;threadLocalMap----&gt;entry---&gt;valueï¼Œvalueä¸ä¼šè¢«å›æ”¶ï¼Œè€Œè¿™å—valueå°±æ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°å°±å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚</span></p></li></ul></li><li><p><span>å°±ç®—æ˜¯å¼ºå¼•ç”¨ä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼çš„ï¼Œæ‰€ä»¥å¼±å¼•ç”¨ä¸æ˜¯é€ æˆå†…å­˜æ³„æ¼çš„æ ¹æœ¬åŸå› ã€‚</span></p><ul><li><p><span>æ ¹æœ¬åŸå› æ˜¯threadLocalMapçš„ç”Ÿå‘½å‘¨æœŸå’Œthreadä¸€æ ·é•¿ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”çš„keyå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</span></p></li></ul></li><li><p><span>ä¸ºä»€ä¹ˆè¦å¼±å¼•ç”¨</span></p><ul><li><p><span>ThreadlocalMapæ˜¯å’Œçº¿ç¨‹ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œå¦‚æœè¿™æ ·çº¿ç¨‹æ²¡æœ‰è¢«é”€æ¯ï¼Œè€Œæˆ‘ä»¬åˆå·²ç»ä¸ä¼šå†æŸä¸ªthreadlocalå¼•ç”¨ï¼Œé‚£ä¹ˆkey-valueçš„é”®å€¼å¯¹å°±ä¼šä¸€ç›´åœ¨mapä¸­å­˜åœ¨ï¼Œè¿™å¯¹äºç¨‹åºæ¥è¯´ï¼Œå°±å‡ºç°äº†</span><strong><span>å†…å­˜æ³„æ¼</span></strong><span>ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåªè¦å°†keyè®¾ç½®ä¸ºå¼±å¼•ç”¨ï¼Œé‚£ä¹ˆå½“å‘ç”ŸGCçš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨å°†å¼±å¼•ç”¨ç»™æ¸…ç†æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå‡å¦‚æŸä¸ªç”¨æˆ·Aæ‰§è¡Œæ–¹æ³•æ—¶äº§ç”Ÿäº†ä¸€ä»½threadlocalAï¼Œç„¶ååœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ç”¨ä¸åˆ°threadlocalAæ—¶ï¼Œä½œä¸ºå¼±å¼•ç”¨ï¼Œå®ƒä¼šåœ¨ä¸‹æ¬¡</span><a href='https://so.csdn.net/so/search?q=åƒåœ¾å›æ”¶&amp;spm=1001.2101.3001.7020'><span>åƒåœ¾å›æ”¶</span></a><span>æ—¶è¢«æ¸…ç†æ‰ã€‚</span></p></li><li><p><span>è€Œä¸”ThreadLocalMapåœ¨å†…éƒ¨çš„</span><strong><span>setï¼Œgetå’Œæ‰©å®¹æ—¶éƒ½ä¼šæ¸…ç†æ‰æ³„æ¼çš„Entry</span></strong><span>ï¼Œ</span><a href='https://so.csdn.net/so/search?q=å†…å­˜æ³„æ¼&amp;spm=1001.2101.3001.7020'><span>å†…å­˜æ³„æ¼</span></a><span>å®Œå…¨æ²¡å¿…è¦è¿‡äºæ‹…å¿ƒã€‚</span></p></li></ul></li><li><p><span>valueä¸ºä»€ä¹ˆä¸è®¾ç½®æˆå¼±å¼•ç”¨ï¼Ÿ</span></p><ul><li><p><span>valueæœ¬èº«æ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¦‚æœè®¾ç½®æˆå¼±å¼•ç”¨å°±ä¼šè¢«åƒåœ¾å›æ”¶æ‰ã€‚</span></p></li></ul></li></ul><h2 id='threadlocalçš„å®ç°è¿‡ç¨‹'><span>ThreadLocalçš„å®ç°è¿‡ç¨‹</span></h2><ul><li><p><strong><span>æ¯ä¸ªthreadçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªThreadLocalMap</span></strong></p></li><li><p><strong><span>mapé‡Œé¢å­˜å‚¨ThreadLocalå¯¹è±¡ï¼ˆkeyï¼‰å’Œçº¿ç¨‹çš„å˜é‡å‰¯æœ¬(value)</span></strong></p></li><li><p><strong><span>Threadå†…éƒ¨çš„Mapæ˜¯ç”±ThreadLocalç»´æŠ¤çš„ï¼Œç”±ThreadLocalè´Ÿè´£å‘mapè·å–å’Œè®¾ç½®çº¿ç¨‹çš„å˜é‡å€¼ã€‚</span></strong></p></li><li><p><strong><span>å¯¹äºä¸åŒçš„çº¿ç¨‹ï¼Œæ¯æ¬¡è·å–å‰¯æœ¬å€¼æ—¶ï¼Œåˆ«çš„çº¿ç¨‹å¹¶ä¸èƒ½è·å–åˆ°å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å€¼ï¼Œå½¢æˆäº†å‰¯æœ¬éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚</span></strong></p></li></ul><blockquote><p><span>è¿™æ ·è®¾ç½®çš„å¥½å¤„</span></p><ul><li><p><span>å½“Threadé”€æ¯çš„æ—¶å€™ï¼ŒThreadLocalMapä¹Ÿéšä¹‹é”€æ¯ï¼Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</span></p></li><li><p><span>æ¯ä¸ªmapå­˜å‚¨çš„entryåªä¸threadLocalæ•°é‡æœ‰å…³ï¼Œä¸€èˆ¬å°äºçº¿ç¨‹æ•°ã€‚</span></p></li></ul></blockquote><h2 id='threadlocalå¸¸ç”¨æ–¹æ³•'><span>ThreadLocalå¸¸ç”¨æ–¹æ³•</span></h2><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">text</span>.<span class="cm-variable">SimpleDateFormat</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Random</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ThreadLocalExample</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Runnable</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">// SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½è¦æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable">ThreadLocal</span><span class="cm-operator">&lt;</span><span class="cm-variable">SimpleDateFormat</span><span class="cm-operator">&gt;</span> <span class="cm-variable">formatter</span> <span class="cm-operator">=</span> <span class="cm-variable">ThreadLocal</span>.<span class="cm-variable">withInitial</span>(() <span class="cm-operator">-&gt;</span> <span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>(<span class="cm-string">"yyyyMMdd HHmm"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ThreadLocalExample</span> <span class="cm-variable">obj</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ThreadLocalExample</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span> ; <span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">10</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-variable">obj</span>, <span class="cm-string">""</span><span class="cm-operator">+</span><span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Random</span>().<span class="cm-variable">nextInt</span>(<span class="cm-number">1000</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Thread Name= "</span><span class="cm-operator">+</span><span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">" default Formatter = "</span><span class="cm-operator">+</span><span class="cm-variable">formatter</span>.<span class="cm-variable">get</span>().<span class="cm-variable">toPattern</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Random</span>().<span class="cm-variable">nextInt</span>(<span class="cm-number">1000</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//formatter pattern is changed here by thread, but it won't reflect to other threads</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">formatter</span>.<span class="cm-variable">set</span>(<span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Thread Name= "</span><span class="cm-operator">+</span><span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">" formatter = "</span><span class="cm-operator">+</span><span class="cm-variable">formatter</span>.<span class="cm-variable">get</span>().<span class="cm-variable">toPattern</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 851px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre><figure class='table-figure'><table><thead><tr><th><span>æ–¹æ³•å£°æ˜</span></th><th><span>æè¿°</span></th></tr></thead><tbody><tr><td><span>ThreadLocal()</span></td><td><span>åˆ›å»ºThreadLocalå¯¹è±¡</span></td></tr><tr><td><span>public void set(T value)</span></td><td><span>è®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</span></td></tr><tr><td><span>public T get()</span></td><td><span>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</span></td></tr><tr><td><span>public void remove()</span></td><td><span>ç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</span></td></tr></tbody></table></figure><h3 id='541-setvalueæ–¹æ³•'><span>5.4.1 set(value)æ–¹æ³•</span></h3><p><img src=".\images\threadLocal_set.png" referrerpolicy="no-referrer" alt=".\images\threadLocal_set.png"></p><ul><li><p><span>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªmap</span></p></li><li><p><span>å¦‚æœè·å–çš„mapä¸ä¸ºç©ºï¼Œåˆ™å°†å‚æ•°è®¾ç½®åˆ°mapä¸­(å½“å‰ThreadLocalçš„ä¸€ä¸ªå¼±å¼•ç”¨å¼•ç”¨ä½œä¸ºkey)</span></p></li><li><p><span>å¦‚æœmapä¸ºç©ºï¼Œåˆ™ç»™è¯¥çº¿ç¨‹åˆ›å»ºmap,å¹¶è®¾ç½®åˆå§‹å€¼ã€‚</span></p></li></ul><h3 id='542-getæ–¹æ³•'><span>5.4.2 get()æ–¹æ³•</span></h3><ul><li><p><span>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œæ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªmap</span></p></li><li><p><span>å¦‚æœè·å–çš„mapä¸ä¸ºç©ºï¼Œåˆ™åœ¨mapä¸­ä»¥ThreadLocalçš„å¼•ç”¨ä½œä¸ºkeyæ¥åœ¨mapä¸­è·å–å¯¹åº”çš„Entry e,å¦‚æœä¸ºç©ºè½¬åˆ°æœ€åä¸€æ­¥ï¼›</span></p></li><li><p><span>å¦‚æœeä¸ä¸ºnullï¼Œåˆ™è¿”å›e.value,å¦åˆ™è½¬åˆ°æœ€åä¸€æ­¥</span></p></li><li><p><span>mapä¸ºç©ºæˆ–è€…eä¸ºç©ºï¼Œåˆ™é€šè¿‡initialValueå‡½æ•°è·å–åˆå§‹å€¼valueï¼Œç„¶åç”¨threadlocalçš„å¼•ç”¨å’Œvalueä½œä¸ºfirstKeyå’ŒfirstValueåˆ›å»ºä¸€ä¸ªæ–°çš„map.</span></p></li></ul><h3 id='543-removeæ–¹æ³•'><span>5.4.3 remove()æ–¹æ³•</span></h3><ul><li><p><span>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªmap</span></p></li><li><p><span>å¦‚æœè·å–çš„mapä¸ä¸ºç©ºï¼Œåˆ™ç§»é™¤å½“å‰threadlocalå¯¹è±¡å¯¹åº”çš„entry</span></p></li></ul><h2 id='threadlocalmap'><span>ThreadLocalMap</span></h2><h3 id='threadlocalmap-hashç®—æ³•'><span>ThreadLocalMap Hashç®—æ³•</span></h3><ul><li><p><code>ThreadLocalMap</code><span>ä¸­</span><code>hash</code><span>ç®—æ³•å¾ˆç®€å•ï¼Œè¿™é‡Œ</span><code>i</code><span>å°±æ˜¯å½“å‰keyåœ¨æ•£åˆ—è¡¨ä¸­å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ä½ç½®ã€‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-variable">key</span>.<span class="cm-variable">threadLocalHashCode</span> <span class="cm-operator">&amp;</span> (<span class="cm-variable">len</span><span class="cm-operator">-</span><span class="cm-number">1</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>è¿™é‡Œæœ€å…³é”®çš„å°±æ˜¯</span><code>threadLocalHashCode</code><span>å€¼çš„è®¡ç®—ï¼Œ</span><code>ThreadLocal</code><span>ä¸­æœ‰ä¸€ä¸ªå±æ€§ä¸º</span><code>HASH_INCREMENT = 0x61c88647</code><span>,æ¯å½“åˆ›å»ºä¸€ä¸ª</span><code>ThreadLocal</code><span>å¯¹è±¡ï¼Œè¿™ä¸ª</span><code>ThreadLocal.nextHashCode</code><span> è¿™ä¸ªå€¼å°±ä¼šå¢é•¿ </span><code>0x61c88647</code><span> ã€‚è¿™ä¸ªå€¼å¾ˆç‰¹æ®Šï¼Œå®ƒæ˜¯</span><strong><span>æ–æ³¢é‚£å¥‘æ•°</span></strong><span> ä¹Ÿå« </span><strong><span>é»„é‡‘åˆ†å‰²æ•°</span></strong><span>ã€‚</span><code>hash</code><span>å¢é‡ä¸º è¿™ä¸ªæ•°å­—ï¼Œå¸¦æ¥çš„å¥½å¤„å°±æ˜¯ </span><code>hash</code><span> </span><strong><span>åˆ†å¸ƒéå¸¸å‡åŒ€</span></strong><span>ã€‚</span></p></li></ul><h3 id='threadlocalmap-hashå†²çª'><span>ThreadLocalMap Hashå†²çª</span></h3><p><code>HashMap</code><span>ä¸­è§£å†³å†²çªçš„æ–¹æ³•æ˜¯åœ¨æ•°ç»„ä¸Šæ„é€ ä¸€ä¸ª</span><strong><span>é“¾è¡¨</span></strong><span>ç»“æ„ï¼Œå†²çªçš„æ•°æ®æŒ‚è½½åˆ°é“¾è¡¨ä¸Šï¼Œå¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šæ•°é‡åˆ™ä¼šè½¬åŒ–æˆ</span><strong><span>çº¢é»‘æ ‘</span></strong><span>ã€‚</span></p><p><span>è€Œ</span><code>ThreadLocalMap</code><span>ä¸­å¹¶æ²¡æœ‰é“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½é€‚ç”¨</span><code>HashMap</code><span>è§£å†³å†²çªçš„æ–¹å¼äº†ã€‚</span></p><h3 id='threadlocalmapsetæ–¹æ³•'><span>ThreadLocalMap.set()æ–¹æ³•</span></h3><ul><li><p><strong><span>ç¬¬ä¸€ç§æƒ…å†µ</span></strong><span>ï¼š </span><strong><span>é€šè¿‡</span><code>hash</code><span>è®¡ç®—åçš„æ§½ä½å¯¹åº”çš„</span><code>Entry</code><span>æ•°æ®ä¸ºç©ºï¼Œè¿™é‡Œç›´æ¥å°†æ•°æ®æ”¾åˆ°è¯¥æ§½ä½å³å¯ï¼Œç„¶åè¿”å›ã€‚</span></strong></p></li><li><p><strong><span>ç¬¬äºŒç§æƒ…å†µï¼š</span></strong><span> </span><strong><span>æ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œ</span><code>key</code><span>å€¼ä¸å½“å‰</span><code>ThreadLocal</code><span>é€šè¿‡</span><code>hash</code><span>è®¡ç®—è·å–çš„</span><code>key</code><span>å€¼ä¸€è‡´ï¼Œè¿™é‡Œç›´æ¥æ›´æ–°è¯¥æ§½ä½çš„æ•°æ®ï¼Œç„¶åè¿”å›ã€‚</span></strong></p></li><li><p><strong><span>ç¬¬ä¸‰ç§æƒ…å†µï¼š</span></strong><span> æ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œå¾€åéå†è¿‡ç¨‹ä¸­ï¼Œåœ¨æ‰¾åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ§½ä½ä¹‹å‰ï¼Œé‡åˆ°</span><code>key</code><span>è¿‡æœŸçš„</span><code>Entry</code><span>ï¼Œæ‰§è¡Œ</span><code>replaceStaleEntry()</code><span>æ–¹æ³•(æ ¸å¿ƒæ–¹æ³•)ï¼Œç„¶åè¿”å›ã€‚</span><code>replaceStaleEntry()</code><span>æ–¹æ³•å¦‚ä¸‹ï¼š</span></p><ul><li><p><span>ä»¥å½“å‰çš„</span><code>key</code><span>è¿‡æœŸçš„ä¸‹æ ‡</span><code>staleSlot</code><span>å¼€å§‹ï¼Œå‘å‰è¿­ä»£æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸçš„æ•°æ®ï¼Œ</span><code>for</code><span>å¾ªç¯ä¸€ç›´ç¢°åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>æ‰ä¼šç»“æŸã€‚å¦‚æœå‘å‰æ‰¾åˆ°äº†è¿‡æœŸæ•°æ®ï¼Œæ›´æ–°æ¢æµ‹æ¸…ç†è¿‡æœŸæ•°æ®çš„å¼€å§‹ä¸‹æ ‡ä¸ºiï¼Œå³</span><code>slotToExpunge=i.</code></p></li><li><p><span>æ¥ç€å¼€å§‹ä»</span><code>staleSlot</code><span>å‘åæŸ¥æ‰¾ï¼Œä¹Ÿæ˜¯ç¢°åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ¡¶ç»“æŸã€‚ å¦‚æœè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œ</span><strong><span>ç¢°åˆ°k == key</span></strong><span>ï¼Œè¿™è¯´æ˜è¿™é‡Œæ˜¯æ›¿æ¢é€»è¾‘ï¼Œæ›¿æ¢æ–°æ•°æ®å¹¶ä¸”äº¤æ¢å½“å‰</span><code>staleSlot</code><span>ä½ç½®ã€‚å¦‚æœ</span><code>slotToExpunge == staleSlot</code><span>ï¼Œè¿™è¯´æ˜</span><code>replaceStaleEntry()</code><span>ä¸€å¼€å§‹å‘å‰æŸ¥æ‰¾è¿‡æœŸæ•°æ®æ—¶å¹¶æœªæ‰¾åˆ°è¿‡æœŸçš„</span><code>Entry</code><span>æ•°æ®ï¼Œæ¥ç€å‘åæŸ¥æ‰¾è¿‡ç¨‹ä¸­ä¹Ÿæœªå‘ç°è¿‡æœŸæ•°æ®ï¼Œä¿®æ”¹å¼€å§‹æ¢æµ‹å¼æ¸…ç†è¿‡æœŸæ•°æ®çš„ä¸‹æ ‡ä¸ºå½“å‰å¾ªç¯çš„indexï¼Œå³</span><code>slotToExpunge = i</code><span>ã€‚æœ€åè°ƒç”¨</span><code>cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);</code><span>è¿›è¡Œå¯å‘å¼è¿‡æœŸæ•°æ®æ¸…ç†ï¼Œä¹‹åè¿”å›ã€‚</span></p></li><li><p><strong><span>å¦‚æœk != key</span></strong><span>åˆ™ä¼šæ¥ç€å¾€ä¸‹èµ°ï¼Œ</span><code>k == null</code><span>è¯´æ˜å½“å‰éå†çš„</span><code>Entry</code><span>æ˜¯ä¸€ä¸ªè¿‡æœŸæ•°æ®ï¼Œ</span><code>slotToExpunge == staleSlot</code><span>è¯´æ˜ï¼Œä¸€å¼€å§‹çš„å‘å‰æŸ¥æ‰¾æ•°æ®å¹¶æœªæ‰¾åˆ°è¿‡æœŸçš„</span><code>Entry</code><span>ã€‚å¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™æ›´æ–°</span><code>slotToExpunge</code><span> ä¸ºå½“å‰ä½ç½®ï¼Œè¿™ä¸ªå‰ææ˜¯å‰é©±èŠ‚ç‚¹æ‰«ææ—¶æœªå‘ç°è¿‡æœŸæ•°æ®ã€‚</span></p></li><li><p><span>å¾€åè¿­ä»£çš„è¿‡ç¨‹ä¸­å¦‚æœæ²¡æœ‰æ‰¾åˆ°</span><code>k == key</code><span>çš„æ•°æ®ï¼Œä¸”ç¢°åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ•°æ®ï¼Œåˆ™ç»“æŸå½“å‰çš„è¿­ä»£æ“ä½œã€‚æ­¤æ—¶è¯´æ˜è¿™é‡Œæ˜¯ä¸€ä¸ªæ·»åŠ çš„é€»è¾‘ï¼Œå°†æ–°çš„æ•°æ®æ·»åŠ åˆ°</span><code>table[staleSlot]</code><span> å¯¹åº”çš„</span><code>slot</code><span>ä¸­ã€‚</span></p></li><li><p><span>æœ€ååˆ¤æ–­é™¤äº†</span><code>staleSlot</code><span>ä»¥å¤–ï¼Œè¿˜å‘ç°äº†å…¶ä»–è¿‡æœŸçš„</span><code>slot</code><span>æ•°æ®ï¼Œå°±è¦å¼€å¯æ¸…ç†æ•°æ®ã€‚</span></p></li></ul></li><li><p><strong><span>ç¬¬å››ç§æƒ…å†µï¼š</span></strong><span>å¦‚æœä»¥ä¸Šä¸‰ç§æƒ…å†µéƒ½æ²¡æœ‰æ‰§è¡Œï¼Œåˆ™è¯´æ˜æ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œå¾€åéå†è¿‡ç¨‹ä¸­ï¼Œåœ¨æ‰¾åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ§½ä½ä¹‹å‰ï¼Œæ²¡æœ‰é‡åˆ°</span><code>key</code><span>è¿‡æœŸçš„</span><code>Entry</code><span>ã€‚</span></p><ul><li><p><span>éå†æ•£åˆ—æ•°ç»„ï¼Œçº¿æ€§å¾€åæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ§½ä½ï¼Œåˆ™åœ¨</span><code>Entry</code><span>ä¸º</span><code>null</code><span>çš„æ¡¶ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„</span><code>Entry</code><span>å¯¹è±¡ï¼Œ ä¹‹åæ‰§è¡Œ</span><code>++size</code><span>æ“ä½œã€‚æˆ–è€…å¾€åéå†è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†</span><strong><span>keyå€¼ç›¸ç­‰</span></strong><span>çš„æ•°æ®ï¼Œç›´æ¥æ›´æ–°å³å¯ã€‚</span></p></li><li><p><span>è°ƒç”¨</span><code>cleanSomeSlots()</code><span>åšä¸€æ¬¡å¯å‘å¼æ¸…ç†å·¥ä½œï¼Œæ¸…ç†æ•£åˆ—æ•°ç»„ä¸­</span><code>Entry</code><span>çš„</span><code>key</code><span>è¿‡æœŸçš„æ•°æ®ã€‚</span></p></li><li><p><span>å¦‚æœæ¸…ç†å·¥ä½œå®Œæˆåï¼Œæœªæ¸…ç†åˆ°ä»»ä½•æ•°æ®ï¼Œä¸”</span><code>size</code><span>è¶…è¿‡äº†é˜ˆå€¼(æ•°ç»„é•¿åº¦çš„2/3)ï¼Œè¿›è¡Œ</span><code>rehash()</code><span>æ“ä½œã€‚</span></p></li><li><p><code>rehash()</code><span>ä¸­ä¼šå…ˆè¿›è¡Œä¸€è½®æ¢æµ‹å¼æ¸…ç†ï¼Œæ¸…ç†è¿‡æœŸ</span><code>key</code><span>ï¼Œæ¸…ç†å®Œæˆåå¦‚æœ</span><strong><span>size &gt;= threshold - threshold / 4</span></strong><span>ï¼Œå°±ä¼šæ‰§è¡ŒçœŸæ­£çš„æ‰©å®¹é€»è¾‘(æ‰©å®¹é€»è¾‘å¾€åçœ‹)</span></p></li></ul></li></ul><h3 id='threadlocalmapæ‰©å®¹æœºåˆ¶'><span>ThreadLocalMapæ‰©å®¹æœºåˆ¶</span></h3><ul><li><p><span>é¦–å…ˆè¿›è¡Œæ¢æµ‹å¼æ¸…ç†å·¥ä½œï¼Œä»</span><code>table</code><span>çš„èµ·å§‹ä½ç½®å¾€åæ¸…ç†ã€‚æ¸…ç†å®Œæˆä¹‹åï¼Œ</span><code>table</code><span>ä¸­å¯èƒ½æœ‰ä¸€äº›</span><code>key</code><span>ä¸º</span><code>null</code><span>çš„</span><code>Entry</code><span>æ•°æ®è¢«æ¸…ç†æ‰ï¼Œæ‰€ä»¥æ­¤æ—¶é€šè¿‡åˆ¤æ–­</span><code>size &gt;= threshold - threshold / 4</code><span> ä¹Ÿå°±æ˜¯</span><code>size &gt;= threshold* 3/4</code><span> æ¥å†³å®šæ˜¯å¦æ‰©å®¹ã€‚</span></p></li><li><p><span>æ‰©å®¹åçš„</span><code>tab</code><span>çš„å¤§å°ä¸º</span><code>oldLen * 2</code><span>ï¼Œç„¶åéå†è€çš„æ•£åˆ—è¡¨ï¼Œé‡æ–°è®¡ç®—</span><code>hash</code><span>ä½ç½®ï¼Œç„¶åæ”¾åˆ°æ–°çš„</span><code>tab</code><span>æ•°ç»„ä¸­ï¼Œå¦‚æœå‡ºç°</span><code>hash</code><span>å†²çªåˆ™å¾€åå¯»æ‰¾æœ€è¿‘çš„</span><code>entry</code><span>ä¸º</span><code>null</code><span>çš„æ§½ä½ï¼Œéå†å®Œæˆä¹‹åï¼Œ</span><code>oldTab</code><span>ä¸­æ‰€æœ‰çš„</span><code>entry</code><span>æ•°æ®éƒ½å·²ç»æ”¾å…¥åˆ°æ–°çš„</span><code>tab</code><span>ä¸­äº†ã€‚é‡æ–°è®¡ç®—</span><code>tab</code><span>ä¸‹æ¬¡æ‰©å®¹çš„</span><strong><span>é˜ˆå€¼</span></strong><span>ã€‚</span></p></li></ul><h3 id='threadlocalmapgetæ–¹æ³•'><span>ThreadLocalMap.get()æ–¹æ³•</span></h3><ul><li><p><strong><span>ç¬¬ä¸€ç§æƒ…å†µï¼š</span></strong><span> é€šè¿‡æŸ¥æ‰¾</span><code>key</code><span>å€¼è®¡ç®—å‡ºæ•£åˆ—è¡¨ä¸­</span><code>slot</code><span>ä½ç½®ï¼Œç„¶åè¯¥</span><code>slot</code><span>ä½ç½®ä¸­çš„</span><code>Entry.key</code><span>å’ŒæŸ¥æ‰¾çš„</span><code>key</code><span>ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›.</span></p></li><li><p><strong><span>ç¬¬äºŒç§æƒ…å†µï¼š</span></strong><span> </span><code>slot</code><span>ä½ç½®ä¸­çš„</span><code>Entry.key</code><span>å’Œè¦æŸ¥æ‰¾çš„</span><code>key</code><span>ä¸ä¸€è‡´,è¿™æ—¶å€™éœ€è¦ç»§ç»­å¾€åè¿›è¡Œè¿­ä»£æŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥æ‰¾è¿‡ç¨‹ä¸­é‡åˆ°keyçš„nullçš„æƒ…å†µï¼Œä¼šè§¦å‘ä¸€æ¬¡æ¢æµ‹å¼æ•°æ®å›æ”¶æ“ä½œï¼Œæ­¤æ—¶ç»§ç»­å¾€åè¿­ä»£ï¼Œç›´åˆ°æ‰¾åˆ°keyç›¸ç­‰çš„valueå€¼.</span></p></li></ul><h3 id='threadlocalmapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹'><span>ThreadLocalMapè¿‡æœŸkeyçš„æ¢æµ‹å¼æ¸…ç†æµç¨‹</span></h3><p><span>ä¹Ÿå°±æ˜¯</span><code>expungeStaleEntry</code><span>æ–¹æ³•ï¼Œéå†æ•£åˆ—æ•°ç»„ï¼Œä»å¼€å§‹ä½ç½®å‘åæ¢æµ‹æ¸…ç†è¿‡æœŸæ•°æ®ï¼Œå°†è¿‡æœŸæ•°æ®çš„</span><code>Entry</code><span>è®¾ç½®ä¸º</span><code>null</code><span>ï¼Œæ²¿é€”ä¸­ç¢°åˆ°æœªè¿‡æœŸçš„æ•°æ®åˆ™å°†æ­¤æ•°æ®</span><code>rehash</code><span>åé‡æ–°åœ¨</span><code>table</code><span>æ•°ç»„ä¸­å®šä½ï¼Œå¦‚æœå®šä½çš„ä½ç½®å·²ç»æœ‰äº†æ•°æ®ï¼Œåˆ™ä¼šå°†æœªè¿‡æœŸçš„æ•°æ®æ”¾åˆ°æœ€é è¿‘æ­¤ä½ç½®çš„</span><code>Entry=null</code><span>çš„æ¡¶ä¸­ï¼Œä½¿</span><code>rehash</code><span>åçš„</span><code>Entry</code><span>æ•°æ®è·ç¦»æ­£ç¡®çš„æ¡¶çš„ä½ç½®æ›´è¿‘ä¸€äº›ã€‚</span></p><h3 id='threadlocalmapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹'><span>ThreadLocalMapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">boolean</span> <span class="cm-def">cleanSomeSlots</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">n</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">removed</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Entry</span>[] <span class="cm-variable">tab</span> <span class="cm-operator">=</span> <span class="cm-variable">table</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-variable">tab</span>.<span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">do</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-variable">nextIndex</span>(<span class="cm-variable">i</span>, <span class="cm-variable">len</span>);<span class="cm-comment">//iå¾€åéå†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Entry</span> <span class="cm-variable">e</span> <span class="cm-operator">=</span> <span class="cm-variable">tab</span>[<span class="cm-variable">i</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">e</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">e</span>.<span class="cm-variable">get</span>() <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {<span class="cm-comment">//å¦‚æœå½“å‰entryä¸ä¸ºç©ºä½†æ˜¯keyä¸ºç©º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-variable">len</span>;<span class="cm-comment">//é‡æ–°è®¾ç½®n</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">removed</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-variable">expungeStaleEntry</span>(<span class="cm-variable">i</span>);<span class="cm-comment">//ä»¥å½“å‰ä½ç½®å¼€å¯æ¢æµ‹å¼æ¸…ç†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">while</span> ( (<span class="cm-variable">n</span> <span class="cm-operator">&gt;&gt;&gt;=</span> <span class="cm-number">1</span>) <span class="cm-operator">!=</span> <span class="cm-number">0</span>);<span class="cm-comment">//næ¯æ¬¡é™¤ä»¥2,å½“ä¸º0çš„æ—¶å€™å°±é€€å‡ºå¾ªç¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">removed</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 368px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><h2 id='inheritablethreadlocal'><span>InheritableThreadLocal</span></h2><p><span>æˆ‘ä»¬ä½¿ç”¨</span><code>ThreadLocal</code><span>çš„æ—¶å€™ï¼Œåœ¨å¼‚æ­¥åœºæ™¯ä¸‹æ˜¯æ— æ³•ç»™å­çº¿ç¨‹å…±äº«çˆ¶çº¿ç¨‹ä¸­åˆ›å»ºçš„çº¿ç¨‹å‰¯æœ¬æ•°æ®çš„ã€‚</span></p><p><span>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJDKä¸­è¿˜æœ‰ä¸€ä¸ª</span><code>InheritableThreadLocal</code><span>ç±»ï¼Œå®ç°åŸç†æ˜¯å­çº¿ç¨‹æ˜¯é€šè¿‡åœ¨çˆ¶çº¿ç¨‹ä¸­é€šè¿‡è°ƒç”¨</span><code>new Thread()</code><span>æ–¹æ³•æ¥åˆ›å»ºå­çº¿ç¨‹ï¼Œ</span><code>Thread#init</code><span>æ–¹æ³•åœ¨</span><code>Thread</code><span>çš„æ„é€ æ–¹æ³•ä¸­è¢«è°ƒç”¨ã€‚åœ¨</span><code>init</code><span>æ–¹æ³•ä¸­æ‹·è´çˆ¶çº¿ç¨‹æ•°æ®åˆ°å­çº¿ç¨‹ä¸­.</span></p><h1 id='ä¸ƒçº¿ç¨‹æ± '><span>ä¸ƒã€çº¿ç¨‹æ± </span></h1><h2 id='ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± '><span>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </span></h2><p><span>é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹æ± å°±æ˜¯ç®¡ç†ä¸€ç³»åˆ—çº¿ç¨‹çš„èµ„æºæ± ã€‚å½“æœ‰ä»»åŠ¡è¦å¤„ç†æ—¶ï¼Œç›´æ¥ä»çº¿ç¨‹æ± ä¸­è·å–çº¿ç¨‹æ¥å¤„ç†ï¼Œå¤„ç†å®Œä¹‹åçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³è¢«é”€æ¯ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</span></p><h2 id='ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± '><span>ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </span></h2><blockquote><p><span>JVMåœ¨hotSpotçš„çº¿ç¨‹æ¨¡å‹ä¸‹ï¼Œjavaçº¿ç¨‹ä¼šä¸€å¯¹ä¸€æ˜ å°„ä¸ºå†…æ ¸çº¿ç¨‹ï¼Œè¿™æ„å‘³ç€ï¼Œåœ¨javaæ¯æ¬¡åˆ›å»ºä»¥åŠå›æ”¶çº¿ç¨‹éƒ½ä¼šå»å†…æ ¸åˆ›å»ºä»¥åŠå›æ”¶ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´ï¼šåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹é”èŠ±è´¹çš„æ—¶é—´å’Œèµ„æºå¯èƒ½å¤„ç†çš„ä»»åŠ¡èŠ±è´¹çš„æ—¶é—´å’Œèµ„æºè¦æ›´å¤šï¼Œçº¿ç¨‹æ± çš„å‡ºç°å°±æ˜¯ä¸ºäº†ï¼š</span></p></blockquote><ul><li><p><strong><span>é™ä½èµ„æºæ¶ˆè€—</span></strong><span>ï¼šé€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ï¼›</span></p></li><li><p><strong><span>æé«˜å“åº”é€Ÿåº¦</span></strong><span>ï¼šå½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</span></p></li><li><p><strong><span>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</span></strong><span>ã€‚ çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</span></p></li></ul><h2 id='ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± '><span>ä»€ä¹ˆæ—¶å€™ç”¨çº¿ç¨‹æ± ï¼Ÿ</span></h2><p><span>å•ä¸ªä»»åŠ¡å¤„ç†çš„æ—¶é—´å¾ˆçŸ­è€Œè¯·æ±‚çš„æ•°ç›®å´æ˜¯å·¨å¤§çš„ã€‚</span></p><h2 id='executoræ¡†æ¶ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰'><span>Executoræ¡†æ¶ï¼ˆç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼‰</span></h2><p><span>Executor æ¡†æ¶æ˜¯ Java5 ä¹‹åå¼•è¿›çš„ï¼Œåœ¨ Java 5 ä¹‹åï¼Œé€šè¿‡ Executor æ¥å¯åŠ¨çº¿ç¨‹æ¯”ä½¿ç”¨ Thread çš„ start æ–¹æ³•æ›´å¥½ï¼Œé™¤äº†æ›´æ˜“ç®¡ç†ï¼Œæ•ˆç‡æ›´å¥½ï¼ˆç”¨çº¿ç¨‹æ± å®ç°ï¼ŒèŠ‚çº¦å¼€é”€ï¼‰å¤–ï¼Œè¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… this é€ƒé€¸é—®é¢˜ã€‚</span></p><h3 id='1ï¼‰ä»»åŠ¡runnablecallableï¼‰'><span>1ï¼‰ä»»åŠ¡ï¼ˆRunnable/Callableï¼‰</span></h3><p><span>æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ </span><strong><code>Runnable</code><span> æ¥å£</span></strong><span> æˆ– </span><strong><code>Callable</code><span>æ¥å£</span></strong><span>ã€‚</span><strong><code>Runnable</code><span> æ¥å£</span></strong><span>æˆ–  </span><strong><code>Callable</code><span> æ¥å£</span></strong><span> å®ç°ç±»éƒ½å¯ä»¥è¢«</span><strong><code>ThreadPoolExecutor</code></strong><span> æˆ– </span><strong><code>ScheduledThreadPoolExecutor</code></strong><span> æ‰§è¡Œã€‚</span></p><h3 id='2-ä»»åŠ¡çš„æ‰§è¡Œexecutor'><span>2) ä»»åŠ¡çš„æ‰§è¡Œ(</span><code>Executor</code><span>)</span></h3><h2 id='çº¿ç¨‹æ± çš„å‚æ•°'><span>çº¿ç¨‹æ± çš„å‚æ•°</span></h2><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Date</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* @author shuang.kou</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MyRunnable</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Runnable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">command</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">MyRunnable</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">s</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">command</span> <span class="cm-operator">=</span> <span class="cm-variable">s</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" Start. Time = "</span> <span class="cm-operator">+</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">processCommand</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">" End. Time = "</span> <span class="cm-operator">+</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">void</span> <span class="cm-variable">processCommand</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">5000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-variable">toString</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">this</span>.<span class="cm-variable">command</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 782px;"></div><div class="CodeMirror-gutters" style="display: none; height: 782px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">concurrent</span>.<span class="cm-variable">ArrayBlockingQueue</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">concurrent</span>.<span class="cm-variable">ThreadPoolExecutor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">concurrent</span>.<span class="cm-variable">TimeUnit</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">ThreadPoolExecutorDemo</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">CORE_POOL_SIZE</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">MAX_POOL_SIZE</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">QUEUE_CAPACITY</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">Long</span> <span class="cm-variable">KEEP_ALIVE_TIME</span> <span class="cm-operator">=</span> <span class="cm-number">1L</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ThreadPoolExecutor</span> <span class="cm-variable">executor</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ThreadPoolExecutor</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">CORE_POOL_SIZE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MAX_POOL_SIZE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">KEEP_ALIVE_TIME</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TimeUnit</span>.<span class="cm-variable">SECONDS</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">ArrayBlockingQueue</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">QUEUE_CAPACITY</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">ThreadPoolExecutor</span>.<span class="cm-variable">CallerRunsPolicy</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//åˆ›å»ºWorkerThreadå¯¹è±¡ï¼ˆWorkerThreadç±»å®ç°äº†Runnable æ¥å£ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Runnable</span> <span class="cm-variable">worker</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">MyRunnable</span>(<span class="cm-string">""</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æ‰§è¡ŒRunnable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">execute</span>(<span class="cm-variable">worker</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//ç»ˆæ­¢çº¿ç¨‹æ± </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executor</span>.<span class="cm-variable">shutdown</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-operator">!</span><span class="cm-variable">executor</span>.<span class="cm-variable">isTerminated</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Finished all threads"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 805px;"></div><div class="CodeMirror-gutters" style="display: none; height: 805px;"></div></div></div></pre><p>&nbsp;</p><p><span>ä½¿ç”¨ThreadPoolExecutorå»åˆ›å»ºçº¿ç¨‹æ± ï¼Œæœ€ä¸»è¦çš„ç›®çš„æ˜¯ï¼Œä½¿ç”¨ThreadPoolExecutoråˆ›å»ºçš„çº¿ç¨‹å¯ä»¥æ›´èƒ½äº†è§£çº¿ç¨‹è¿è¡Œçš„è§„åˆ™ï¼Œé¿å…èµ„æºè€—å°½çš„é£é™©ã€‚</span></p><ul><li><p><strong><code>corePoolSize</code><span> :</span></strong><span> æ ¸å¿ƒçº¿ç¨‹æ•°çº¿ç¨‹æ•°å®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</span></p></li><li><p><strong><code>maximumPoolSize</code><span> :</span></strong><span> å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</span></p></li><li><p><strong><code>workQueue</code><span>:</span></strong><span> å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚</span></p><ul><li><p><span>å®¹é‡ä¸º </span><code>Integer.MAX_VALUE</code><span> çš„ </span><code>LinkedBlockingQueue</code><span>ï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰ï¼š</span><code>FixedThreadPool</code><span> å’Œ </span><code>SingleThreadExector</code><span> ã€‚</span><code>FixedThreadPool</code><span>æœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸ç­‰ï¼‰ï¼Œ</span><code>SingleThreadExector</code><span>åªèƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯ 1ï¼‰ï¼ŒäºŒè€…çš„ä»»åŠ¡é˜Ÿåˆ—æ°¸è¿œä¸ä¼šè¢«æ”¾æ»¡ã€‚</span></p></li><li><p><code>SynchronousQueue</code><span>ï¼ˆåŒæ­¥é˜Ÿåˆ—ï¼‰ï¼š</span><code>CachedThreadPool</code><span> ã€‚</span><code>SynchronousQueue</code><span> æ²¡æœ‰å®¹é‡ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œç›®çš„æ˜¯ä¿è¯å¯¹äºæäº¤çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼›å¦åˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ</span><code>CachedThreadPool</code><span> çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ </span><code>Integer.MAX_VALUE</code><span> ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ•°æ˜¯å¯ä»¥æ— é™æ‰©å±•çš„ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</span></p></li><li><p><code>DelayedWorkQueue</code><span>ï¼ˆå»¶è¿Ÿé˜»å¡é˜Ÿåˆ—ï¼‰ï¼š</span><code>ScheduledThreadPool</code><span> å’Œ </span><code>SingleThreadScheduledExecutor</code><span> </span></p></li><li><p><code>DelayedWorkQueue</code><span> çš„å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œå†…éƒ¨é‡‡ç”¨çš„æ˜¯â€œå †â€çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ã€‚</span><code>DelayedWorkQueue</code><span> æ·»åŠ å…ƒç´ æ»¡äº†ä¹‹åä¼šè‡ªåŠ¨æ‰©å®¹åŸæ¥å®¹é‡çš„ 1/2ï¼Œå³æ°¸è¿œä¸ä¼šé˜»å¡ï¼Œæœ€å¤§æ‰©å®¹å¯è¾¾ </span><code>Integer.MAX_VALUE</code><span>ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹</span></p></li></ul></li><li><p><strong><code>keepAliveTime</code></strong><span>:å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº </span><code>corePoolSize</code><span> çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† </span><code>keepAliveTime</code><span>æ‰ä¼šè¢«å›æ”¶é”€æ¯ï¼›</span></p></li><li><p><strong><code>unit</code></strong><span> : </span><code>keepAliveTime</code><span> å‚æ•°çš„æ—¶é—´å•ä½ã€‚</span></p></li><li><p><strong><code>threadFactory</code></strong><span> :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</span></p></li><li><p><strong><code>handler</code></strong><span> :é¥±å’Œç­–ç•¥ã€‚å…³äºé¥±å’Œç­–ç•¥ä¸‹é¢å•ç‹¬ä»‹ç»ä¸€ä¸‹ã€‚</span></p></li></ul><h2 id='çº¿ç¨‹æ± åŸç†åˆ†æ'><span>çº¿ç¨‹æ± åŸç†åˆ†æ</span></h2><ul><li><p><span>æäº¤ä»»åŠ¡åï¼Œå…ˆåˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ± æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ²¡æœ‰æ»¡å°±åˆ›å»ºçº¿ç¨‹ã€‚</span></p></li><li><p><span>å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ± æ»¡äº†ï¼Œå°±åˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ï¼Œå¦‚æœæ²¡æœ‰æ»¡å°±åŠ å…¥é˜Ÿåˆ—ã€‚</span></p></li><li><p><span>å¦‚æœç­‰å¾…é˜Ÿåˆ—æ»¡äº†ï¼Œå°±åˆ¤æ–­æœ€å¤§çº¿ç¨‹æ± æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ²¡æ»¡å°±åˆ›å»ºä¸´æ—¶çº¿ç¨‹ã€‚</span></p></li><li><p><span>å¦‚æœä¸´æ—¶çº¿ç¨‹ä¹Ÿæ»¡äº†ï¼Œå°±æŒ‰ç…§ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚</span></p></li><li><p><span>æ‹’ç»ç­–ç•¥æœ‰å››ç§</span></p><ul><li><p><strong><code>ThreadPoolExecutor.AbortPolicy</code></strong><span>ï¼šæŠ›å‡º </span><code>RejectedExecutionException</code><span>æ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚(é»˜è®¤çš„ç­–ç•¥)</span></p></li><li><p><strong><code>ThreadPoolExecutor.DiscardPolicy</code><span>ï¼š</span></strong><span> ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚</span></p></li><li><p><strong><code>ThreadPoolExecutor.DiscardOldestPolicy</code><span>ï¼š</span></strong><span> æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚</span></p></li><li><p><strong><code>ThreadPoolExecutor.CallerRunsPolicy</code></strong><span>ï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨</span><code>execute</code><span>æ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(</span><code>run</code><span>)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</span></p></li></ul></li></ul><h2 id='ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± '><span>ä¸‰ç§å¸¸è§çš„çº¿ç¨‹æ± </span></h2><h3 id='fixedthreadpool'><span>FixedThreadPool</span></h3><ul><li><p><span>å¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚</span></p></li><li><p><span>æ‰§è¡Œæµç¨‹ï¼š</span></p><ul><li><p><span>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äºcorePoolSizeæ—¶ï¼Œå¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œï¼Œå°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</span></p></li><li><p><span>å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äºcorePoolSizeåï¼Œå¦‚æœå†æ¥æ–°çš„ä»»åŠ¡ï¼Œä¼šå°†ä»»åŠ¡åŠ å…¥</span><code>LinkedBlockingQueue</code><span>é˜Ÿåˆ—ä¸­ï¼›</span></p></li><li><p><span>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œæ‰‹å¤´çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä»</span><code>LinkedBlockingQueue</code><span> ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼›</span></p></li></ul></li><li><p><span>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ï¼Ÿ</span></p><ul><li><p><strong><code>FixedThreadPool</code><span> ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— </span><code>LinkedBlockingQueue</code><span>ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸º Intger.MAX_VALUEï¼‰ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—</span></strong></p></li><li><p><span>è¿è¡Œä¸­çš„ </span><code>FixedThreadPool</code><span>ï¼ˆæœªæ‰§è¡Œ </span><code>shutdown()</code><span>æˆ– </span><code>shutdownNow()</code><span>ï¼‰ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šå¯¼è‡´ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚</span></p></li></ul></li></ul><h3 id='singlethreadpool'><span>SingleThreadPool</span></h3><ul><li><p><span>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span></p></li><li><p><span>æ‰§è¡Œæµç¨‹ï¼š</span></p><ul><li><p><span>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº corePoolSizeï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</span></p></li><li><p><span>å½“å‰çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹åï¼Œå°†ä»»åŠ¡åŠ å…¥LinkedBlockingQueueé˜Ÿåˆ—ä¸­ã€‚</span></p></li><li><p><span>çº¿ç¨‹æ‰§è¡Œå®Œå½“å‰çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä»</span><code>LinkedBlockingQueue</code><span> ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼›</span></p></li></ul></li><li><p><span>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ï¼Ÿ</span></p><ul><li><p><code>SingleThreadExecutor</code><span> ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— </span><code>LinkedBlockingQueue</code><span> ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸º Intger.MAX_VALUEï¼‰ã€‚</span></p></li><li><p><span>è¿è¡Œä¸­çš„ SingleThreadPoolä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šå¯¼è‡´ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚</span></p></li></ul></li></ul><h3 id='cachedtreadpool'><span>CachedTreadPool</span></h3><ul><li><p><span>æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± </span></p></li><li><p><span>æ‰§è¡Œæµç¨‹ï¼š</span></p><ul><li><p><strong><span>æœ‰ç©ºé—²çº¿ç¨‹å°±äº¤ç»™ç©ºé—²çº¿ç¨‹å¤„ç†ï¼š</span></strong><span>é¦–å…ˆæ‰§è¡Œ </span><code>SynchronousQueue.offer(Runnable task)</code><span> æäº¤ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰ </span><code>maximumPool</code><span> ä¸­æœ‰é—²çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ </span><code>SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)</code><span>ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹æ‰§è¡Œ offer æ“ä½œä¸ç©ºé—²çº¿ç¨‹æ‰§è¡Œçš„ </span><code>poll</code><span> æ“ä½œé…å¯¹æˆåŠŸï¼Œä¸»çº¿ç¨‹æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œï¼Œ</span><code>execute()</code><span>æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå¦åˆ™æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ 2ï¼›</span></p></li><li><p><strong><span>æ²¡æœ‰ç©ºé—²çº¿ç¨‹å°±åˆ›å»ºæ–°çº¿ç¨‹ï¼š</span></strong><span>å½“åˆå§‹ </span><code>maximumPool</code><span> ä¸ºç©ºï¼Œæˆ–è€… </span><code>maximumPool</code><span> ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå°†æ²¡æœ‰çº¿ç¨‹æ‰§è¡Œ </span><code>SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)</code><span>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥éª¤ 1 å°†å¤±è´¥ï¼Œæ­¤æ—¶ </span><code>CachedThreadPool</code><span> ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œexecute æ–¹æ³•æ‰§è¡Œå®Œæˆï¼›</span></p></li></ul></li><li><p><span>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ï¼Ÿ</span></p><ul><li><p><code>CachedThreadPool</code><span>å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</span></p></li></ul></li></ul><h2 id='å‡ ç§å¸¸è§çš„å¯¹æ¯”'><span>å‡ ç§å¸¸è§çš„å¯¹æ¯”</span></h2><h5 id='1-runnableå’Œcallable'><span>1. Runnableå’ŒCallable</span></h5><p><code>Runnable</code><span> æ¥å£</span><strong><span>ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œä½†æ˜¯</span></strong><code>Callable</code><span> æ¥å£</span><strong><span>å¯ä»¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡ä¸éœ€è¦è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸æ¨èä½¿ç”¨ </span><code>Runnable</code><span> æ¥å£</span></strong><span>ï¼Œè¿™æ ·ä»£ç çœ‹èµ·æ¥ä¼šæ›´åŠ ç®€æ´ã€‚</span></p><h5 id='2-executeå’Œsubmit'><span>2. execute()å’Œsubmit()</span></h5><ul><li><p><strong><code>execute()</code><span>æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦ï¼›</span></strong></p></li><li><p><strong><code>submit()</code><span>æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ª </span><code>Future</code><span> ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª </span><code>Future</code><span> å¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</span></strong><span> ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ </span><code>Future</code><span> çš„ </span><code>get()</code><span>æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œ</span><code>get()</code><span>æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨ </span><code>getï¼ˆlong timeoutï¼ŒTimeUnit unitï¼‰</code><span>æ–¹æ³•åˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ï¼Œè¿™æ—¶å€™æœ‰å¯èƒ½ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œã€‚</span></p></li></ul><h5 id='shutdownå’Œshutdownnow'><code>shutdown()</code><span>å’Œ</span><code>shutdownNow()</code></h5><ul><li><p><strong><code>shutdownï¼ˆï¼‰</code></strong><span> :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸º </span><code>SHUTDOWN</code><span>ã€‚çº¿ç¨‹æ± ä¸å†æ¥å—æ–°ä»»åŠ¡äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¾—æ‰§è¡Œå®Œæ¯•ã€‚</span></p></li><li><p><strong><code>shutdownNowï¼ˆï¼‰</code></strong><span> :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹çš„çŠ¶æ€å˜ä¸º </span><code>STOP</code><span>ã€‚çº¿ç¨‹æ± ä¼šç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åœæ­¢å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡å¹¶è¿”å›æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ Listã€‚</span></p></li></ul><h5 id='isterminated-å’Œ-isshutdown'><code>isTerminated()</code><span> å’Œ </span><code>isShutdown()</code></h5><ul><li><p><strong><code>isShutDown</code></strong><span> å½“è°ƒç”¨ </span><code>shutdown()</code><span> æ–¹æ³•åè¿”å›ä¸º trueã€‚</span></p></li><li><p><strong><code>isTerminated</code></strong><span> å½“è°ƒç”¨ </span><code>shutdown()</code><span> æ–¹æ³•åï¼Œå¹¶ä¸”æ‰€æœ‰æäº¤çš„ä»»åŠ¡å®Œæˆåè¿”å›ä¸º trueã€‚\</span></p></li></ul><h1 id='å…«future'><span>å…«ã€Future</span></h1><h3 id='future-ç±»æœ‰ä»€ä¹ˆç”¨'><span>Future ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></h3><p><code>Future</code><span> ç±»æ˜¯å¼‚æ­¥æ€æƒ³çš„å…¸å‹è¿ç”¨ï¼Œä¸»è¦ç”¨åœ¨ä¸€äº›éœ€è¦æ‰§è¡Œè€—æ—¶ä»»åŠ¡çš„åœºæ™¯ï¼Œé¿å…ç¨‹åºä¸€ç›´åŸåœ°ç­‰å¾…è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œæ•ˆç‡å¤ªä½ã€‚å…·ä½“æ¥è¯´æ˜¯è¿™æ ·çš„ï¼šå½“æˆ‘ä»¬æ‰§è¡ŒæŸä¸€è€—æ—¶çš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥å°†è¿™ä¸ªè€—æ—¶ä»»åŠ¡äº¤ç»™ä¸€ä¸ªå­çº¿ç¨‹å»å¼‚æ­¥æ‰§è¡Œï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥å¹²ç‚¹å…¶ä»–äº‹æƒ…ï¼Œä¸ç”¨å‚»å‚»ç­‰å¾…è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ç­‰æˆ‘ä»¬çš„äº‹æƒ…å¹²å®Œåï¼Œæˆ‘ä»¬å†é€šè¿‡ </span><code>Future</code><span> ç±»è·å–åˆ°è€—æ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºçš„æ‰§è¡Œæ•ˆç‡å°±æ˜æ˜¾æé«˜äº†ã€‚</span></p><p><span>è¿™å…¶å®å°±æ˜¯å¤šçº¿ç¨‹ä¸­ç»å…¸çš„ </span><strong><span>Future æ¨¡å¼</span></strong><span>ï¼Œä½ å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œä¸»è¦ç”¨åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼Œå¹¶é Java è¯­è¨€ç‹¬æœ‰ã€‚</span></p><p><span>åœ¨ Java ä¸­ï¼Œ</span><code>Future</code><span> ç±»åªæ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œä½äº </span><code>java.util.concurrent</code><span> åŒ…ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† 5 ä¸ªæ–¹æ³•ï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢è¿™ 4 ä¸ªåŠŸèƒ½ï¼š</span></p><ul><li><p><span>å–æ¶ˆä»»åŠ¡ï¼›</span></p></li><li><p><span>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ;</span></p></li><li><p><span>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ;</span></p></li><li><p><span>è·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// V ä»£è¡¨äº†Futureæ‰§è¡Œçš„ä»»åŠ¡è¿”å›å€¼çš„ç±»å‹</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">Future</span><span class="cm-operator">&lt;</span><span class="cm-variable">V</span><span class="cm-operator">&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å–æ¶ˆä»»åŠ¡æ‰§è¡Œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æˆåŠŸå–æ¶ˆè¿”å› trueï¼Œå¦åˆ™è¿”å› false</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">cancel</span>(<span class="cm-variable-3">boolean</span> <span class="cm-variable">mayInterruptIfRunning</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">isCancelled</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">boolean</span> <span class="cm-variable">isDone</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V</span> <span class="cm-variable">get</span>() <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span>, <span class="cm-variable">ExecutionException</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¿”å›è®¡ç®—ç»“æœå°±æŠ›å‡º TimeOutException å¼‚å¸¸</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V</span> <span class="cm-variable">get</span>(<span class="cm-variable-3">long</span> <span class="cm-variable">timeout</span>, <span class="cm-variable">TimeUnit</span> <span class="cm-variable">unit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span>, <span class="cm-variable">ExecutionException</span>, <span class="cm-variable">TimeoutExceptio</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 414px;"></div><div class="CodeMirror-gutters" style="display: none; height: 414px;"></div></div></div></pre><p><span>ç®€å•ç†è§£å°±æ˜¯ï¼šæˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œæäº¤ç»™äº† </span><code>Future</code><span> æ¥å¤„ç†ã€‚ä»»åŠ¡æ‰§è¡ŒæœŸé—´æˆ‘è‡ªå·±å¯ä»¥å»åšä»»ä½•æƒ³åšçš„äº‹æƒ…ã€‚å¹¶ä¸”ï¼Œåœ¨è¿™æœŸé—´æˆ‘è¿˜å¯ä»¥å–æ¶ˆä»»åŠ¡ä»¥åŠè·å–ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘å°±å¯ä»¥ </span><code>Future</code><span> é‚£é‡Œç›´æ¥å–å‡ºä»»åŠ¡æ‰§è¡Œç»“æœã€‚</span></p><h3 id='callable-å’Œ-future-æœ‰ä»€ä¹ˆå…³ç³»'><span>Callable å’Œ Future æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</span></h3><p><code>FutureTask</code><span> æä¾›äº† </span><code>Future</code><span> æ¥å£çš„åŸºæœ¬å®ç°ï¼Œå¸¸ç”¨æ¥å°è£… </span><code>Callable</code><span> å’Œ </span><code>Runnable</code><span>ï¼Œå…·æœ‰å–æ¶ˆä»»åŠ¡ã€æŸ¥çœ‹ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆä»¥åŠè·å–ä»»åŠ¡æ‰§è¡Œç»“æœçš„æ–¹æ³•ã€‚</span><code>ExecutorService.submit()</code><span> æ–¹æ³•è¿”å›çš„å…¶å®å°±æ˜¯ </span><code>Future</code><span> çš„å®ç°ç±» </span><code>FutureTask</code><span> ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">Future</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-def">submit</span>(<span class="cm-variable">Callable</span><span class="cm-operator">&lt;</span><span class="cm-variable">T</span><span class="cm-operator">&gt;</span> <span class="cm-variable">task</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Future</span><span class="cm-operator">&lt;?&gt;</span> <span class="cm-def">submit</span>(<span class="cm-variable">Runnable</span> <span class="cm-variable">task</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><code>FutureTask</code><span> ä¸å…‰å®ç°äº† </span><code>Future</code><span>æ¥å£ï¼Œè¿˜å®ç°äº†</span><code>Runnable</code><span> æ¥å£ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºä»»åŠ¡ç›´æ¥è¢«çº¿ç¨‹æ‰§è¡Œã€‚</span></p><p><code>FutureTask</code><span> æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä¼ å…¥ </span><code>Callable</code><span> æˆ–è€… </span><code>Runnable</code><span> å¯¹è±¡ã€‚å®é™…ä¸Šï¼Œä¼ å…¥ </span><code>Runnable</code><span> å¯¹è±¡ä¹Ÿä¼šåœ¨æ–¹æ³•å†…éƒ¨è½¬æ¢ä¸º</span><code>Callable</code><span>  å¯¹è±¡ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">FutureTask</span>(<span class="cm-variable">Callable</span><span class="cm-operator">&lt;</span><span class="cm-variable">V</span><span class="cm-operator">&gt;</span> <span class="cm-variable">callable</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">callable</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">NullPointerException</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">callable</span> <span class="cm-operator">=</span> <span class="cm-variable">callable</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">NEW</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">FutureTask</span>(<span class="cm-variable">Runnable</span> <span class="cm-variable">runnable</span>, <span class="cm-variable">V</span> <span class="cm-variable">result</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// é€šè¿‡é€‚é…å™¨RunnableAdapteræ¥å°†Runnableå¯¹è±¡runnableè½¬æ¢æˆCallableå¯¹è±¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">callable</span> <span class="cm-operator">=</span> <span class="cm-variable">Executors</span>.<span class="cm-variable">callable</span>(<span class="cm-variable">runnable</span>, <span class="cm-variable">result</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">NEW</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><code>FutureTask</code><span>ç›¸å½“äºå¯¹</span><code>Callable</code><span> è¿›è¡Œäº†å°è£…ï¼Œç®¡ç†ç€ä»»åŠ¡æ‰§è¡Œçš„æƒ…å†µï¼Œå­˜å‚¨äº† </span><code>Callable</code><span> çš„ </span><code>call</code><span> æ–¹æ³•çš„ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</span></p><h3 id='completablefuture-ç±»æœ‰ä»€ä¹ˆç”¨'><span>CompletableFuture ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span></h3><p><code>Future</code><span> åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å­˜åœ¨ä¸€äº›å±€é™æ€§æ¯”å¦‚ä¸æ”¯æŒå¼‚æ­¥ä»»åŠ¡çš„ç¼–æ’ç»„åˆã€è·å–è®¡ç®—ç»“æœçš„ </span><code>get()</code><span> æ–¹æ³•ä¸ºé˜»å¡è°ƒç”¨ã€‚</span></p><p><span>Java 8 æ‰è¢«å¼•å…¥</span><code>CompletableFuture</code><span> ç±»å¯ä»¥è§£å†³</span><code>Future</code><span> çš„è¿™äº›ç¼ºé™·ã€‚</span><code>CompletableFuture</code><span> é™¤äº†æä¾›äº†æ›´ä¸ºå¥½ç”¨å’Œå¼ºå¤§çš„ </span><code>Future</code><span> ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹ã€å¼‚æ­¥ä»»åŠ¡ç¼–æ’ç»„åˆï¼ˆå¯ä»¥å°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ä¸²è”èµ·æ¥ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„é“¾å¼è°ƒç”¨ï¼‰ç­‰èƒ½åŠ›ã€‚</span></p><p>&nbsp;</p><h1 id='ä¹casä¸åŸå­ç±»'><span>ä¹ã€CASä¸åŸå­ç±»</span></h1><h2 id='cas'><span>CAS</span></h2><p><span>CASå³Compare and Swapï¼Œå®ƒä½“ç°çš„æ˜¯ä¸€ä¸ªä¹è§‚é”çš„æ€æƒ³ï¼Œæ¯”å¦‚è¯´å¤šä¸ªçº¿ç¨‹è¦å¯¹ä¸€ä¸ªå…±äº«å‹çš„æ•´å½¢å˜é‡æ‰§è¡Œ+1æ“ä½œ;</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//éœ€è¦ä¸æ–­å°è¯•</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span>(<span class="cm-atom">true</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">æ—§å€¼</span><span class="cm-operator">=</span><span class="cm-variable">å…±äº«å˜é‡ï¼›</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">ç»“æœ</span><span class="cm-operator">=</span><span class="cm-variable">æ—§å€¼</span><span class="cm-operator">+</span><span class="cm-number">1</span><span class="cm-variable">ï¼›</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">CompareandSwap</span>(<span class="cm-variable">æ—§å€¼ï¼Œç»“æœ</span>)){<span class="cm-comment">//å°†è‡ªå·±æ‹¿åˆ°çš„æ—§å€¼å’Œç›®å‰çš„å…±äº«å˜é‡è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//æˆåŠŸï¼Œé€€å‡ºå¾ªç¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><ul><li><p><span>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„å¯è§æ€§ï¼Œéœ€è¦ä½¿ç”¨volatileä¿®é¥°ï¼Œç»“åˆCASå’Œvolatileå¯ä»¥å®ç°æ— é”å¹¶å‘ï¼Œé€‚åˆäºç«äº‰ä¸æ¿€çƒˆï¼Œå¤šæ ¸CPUçš„åœºæ™¯ä¸‹ã€‚</span></p><ul><li><p><span>å› ä¸ºæ²¡æœ‰ä½¿ç”¨sychronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æé«˜çš„å› ç´ ä¹‹ä¸€</span></p></li><li><p><span>ä½†æ˜¯å¦‚æœç«äº‰æ¿€çƒˆï¼Œé‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—åˆ°å½±å“ã€‚</span></p></li></ul></li></ul><h2 id='åŸå­ç±»'><span>åŸå­ç±»</span></h2><p><span>æ ¹æ®æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†JUCåŒ…ä¸­çš„åŸå­ç±»åˆ†ä¸º4ç±»ã€‚</span></p><h3 id='åŸå­æ•´æ•°'><span>åŸå­æ•´æ•°</span></h3><ul><li><p><span>AtomicIntegerï¼šæ•´å‹åŸå­ç±»</span></p></li><li><p><span>AtomicLongï¼šé•¿æ•´å‹åŸå­ç±»</span></p></li><li><p><span>AtomicBoolean ï¼šå¸ƒå°”å‹åŸå­ç±»</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">get</span>() <span class="cm-comment">//è·å–å½“å‰çš„å€¼</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndSet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">newValue</span>)<span class="cm-comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndIncrement</span>()<span class="cm-comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndDecrement</span>() <span class="cm-comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndAdd</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">delta</span>) <span class="cm-comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">boolean</span> <span class="cm-def">compareAndSet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">expect</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">update</span>) <span class="cm-comment">//å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">void</span> <span class="cm-def">lazySet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">newValue</span>)<span class="cm-comment">//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><span>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ CAS (compare and swap) + volatile å’Œ native æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</span></p><p><span>å¸¸ç”¨æ–¹æ³•</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">AtomicInteger</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">AtomicInteger</span>(<span class="cm-number">0</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">getAndIncrement</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">incrementAndGet</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">decrementAndGet</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">getAndDecrement</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">getAndAdd</span>(<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">addAndGet</span>(<span class="cm-operator">-</span><span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">getAndUpdate</span>(<span class="cm-variable">p</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">p</span> <span class="cm-operator">-</span> <span class="cm-number">2</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">updateAndGet</span>(<span class="cm-variable">p</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">p</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ // getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">final</span> <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">getAndAccumulate</span>(<span class="cm-number">10</span>, (<span class="cm-variable">p</span>, <span class="cm-variable">x</span>) <span class="cm-operator">-&gt;</span> <span class="cm-variable">p</span> <span class="cm-operator">+</span> <span class="cm-variable">x</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">accumulateAndGet</span>(<span class="cm-operator">-</span><span class="cm-number">10</span>, (<span class="cm-variable">p</span>, <span class="cm-variable">x</span>) <span class="cm-operator">-&gt;</span> <span class="cm-variable">p</span> <span class="cm-operator">+</span> <span class="cm-variable">x</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 851px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre><h3 id='åŸå­æ•°ç»„'><span>åŸå­æ•°ç»„</span></h3><ul><li><p><span>AtomicIntegerArray</span></p></li><li><p><span>AtomicLongArray</span></p></li><li><p><span>AtomicReferenceArray</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">get</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>) <span class="cm-comment">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndSet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">newValue</span>)<span class="cm-comment">//è¿”å› index=i ä½ç½®çš„å½“å‰çš„å€¼ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ–°å€¼ï¼šnewValue</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndIncrement</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>)<span class="cm-comment">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå¢</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndDecrement</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>) <span class="cm-comment">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getAndAdd</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">delta</span>) <span class="cm-comment">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">boolean</span> <span class="cm-def">compareAndSet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">expect</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">update</span>) <span class="cm-comment">//å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°† index=i ä½ç½®çš„å…ƒç´ å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">void</span> <span class="cm-def">lazySet</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">newValue</span>)<span class="cm-comment">//æœ€ç»ˆ å°†index=i ä½ç½®çš„å…ƒç´ è®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">concurrent</span>.<span class="cm-variable">atomic</span>.<span class="cm-variable">AtomicIntegerArray</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">AtomicIntegerArrayTest</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// TODO Auto-generated method stub</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">temvalue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span>[] <span class="cm-variable">nums</span> <span class="cm-operator">=</span> { <span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>, <span class="cm-number">5</span>, <span class="cm-number">6</span> };</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">AtomicIntegerArray</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">AtomicIntegerArray</span>(<span class="cm-variable">nums</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">j</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">nums</span>.<span class="cm-variable">length</span>; <span class="cm-variable">j</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">i</span>.<span class="cm-variable">get</span>(<span class="cm-variable">j</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">temvalue</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>.<span class="cm-variable">getAndSet</span>(<span class="cm-number">0</span>, <span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"temvalue:"</span> <span class="cm-operator">+</span> <span class="cm-variable">temvalue</span> <span class="cm-operator">+</span> <span class="cm-string">";  i:"</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">temvalue</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>.<span class="cm-variable">getAndIncrement</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"temvalue:"</span> <span class="cm-operator">+</span> <span class="cm-variable">temvalue</span> <span class="cm-operator">+</span> <span class="cm-string">";  i:"</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">temvalue</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>.<span class="cm-variable">getAndAdd</span>(<span class="cm-number">0</span>, <span class="cm-number">5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"temvalue:"</span> <span class="cm-operator">+</span> <span class="cm-variable">temvalue</span> <span class="cm-operator">+</span> <span class="cm-string">";  i:"</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 483px;"></div><div class="CodeMirror-gutters" style="display: none; height: 483px;"></div></div></div></pre><h3 id='åŸå­å¼•ç”¨'><span>åŸå­å¼•ç”¨</span></h3><p><span>è¦ä¿æŠ¤çš„ä¸ä¸€å®šæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥ä½¿ç”¨åŸå­å¼•ç”¨å¯ä»¥ä¿æŠ¤ä¸€äº›éåŸºæœ¬æ•°æ®ç±»å‹ã€‚</span></p><ul><li><p><span>AtomicReferenceï¼šå¼•ç”¨ç±»å‹åŸå­ç±»</span></p></li><li><p><span>AtomicStampedReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚</span></p></li><li><p><span>AtomicMarkableReference ï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°† boolean æ ‡è®°ä¸å¼•ç”¨å…³è”èµ·æ¥ã€‚å¹¶ä¸å…³å¿ƒå˜é‡æ”¹äº†å‡ æ¬¡ï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“å˜é‡æœ‰æ²¡æœ‰æ”¹ã€‚</span></p></li></ul><blockquote><p><span>ABAé—®é¢˜ï¼Œå½“Thread1çº¿ç¨‹æ‹¿åˆ°Aæ•°æ®å»ä¿®æ”¹,è¿™æ—¶Thread2çº¿ç¨‹æŠŠAæ•°æ®ä¿®æ”¹ä¸ºB,ä¹‹åThread3æŠŠBæ•°æ®ä¿®æ”¹ä¸ºAï¼Œå½“çº¿ç¨‹1ä¿®æ”¹å®Œåï¼Œåªçœ‹åˆ°Açš„æ•°æ®ä¸€æ ·ï¼Œä½†æ˜¯å…¶å®ä¸­é—´å·²ç»è¢«ä¿®æ”¹è¿‡äº†ã€‚</span></p></blockquote><h3 id='åŸå­æ›´æ–°å™¨'><span>åŸå­æ›´æ–°å™¨</span></h3><p><span>å¦‚æœéœ€è¦åŸå­æ›´æ–°æŸä¸ªç±»é‡Œçš„æŸä¸ªå±æ€§æ—¶ï¼Œéœ€è¦ç”¨åˆ°å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»ã€‚</span></p><ul><li><p><span>AtomicIntegerFieldUpdater:åŸå­æ›´æ–°æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</span></p></li><li><p><span>AtomicLongFieldUpdaterï¼šåŸå­æ›´æ–°é•¿æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</span></p></li><li><p><span>AtomicReferenceFieldUpdater ï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µçš„æ›´æ–°å™¨</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">concurrent</span>.<span class="cm-variable">atomic</span>.<span class="cm-variable">AtomicIntegerFieldUpdater</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">AtomicIntegerFieldUpdaterTest</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">AtomicIntegerFieldUpdater</span><span class="cm-operator">&lt;</span><span class="cm-variable">User</span><span class="cm-operator">&gt;</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-variable">AtomicIntegerFieldUpdater</span>.<span class="cm-variable">newUpdater</span>(<span class="cm-variable">User</span>.<span class="cm-keyword">class</span>, <span class="cm-string">"age"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å¯¹userç±»ä¸­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">User</span> <span class="cm-variable">user</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"Java"</span>, <span class="cm-number">22</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">a</span>.<span class="cm-variable">getAndIncrement</span>(<span class="cm-variable">user</span>));<span class="cm-comment">// 22</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">a</span>.<span class="cm-variable">get</span>(<span class="cm-variable">user</span>));<span class="cm-comment">// 23</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">User</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">volatile</span> <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">User</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">age</span> <span class="cm-operator">=</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-variable">getName</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">setName</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">int</span> <span class="cm-variable">getAge</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">setAge</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">age</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">age</span> <span class="cm-operator">=</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 897px;"></div><div class="CodeMirror-gutters" style="display: none; height: 897px;"></div></div></div></pre><p>&nbsp;</p><h1 id='åaqs'><span>åã€AQS</span></h1><p><span>AQS æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä½¿ç”¨ AQS èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ </span><code>ReentrantLock</code><span>ï¼Œ</span><code>Semaphore</code><span>ï¼Œå…¶ä»–çš„è¯¸å¦‚ </span><code>ReentrantReadWriteLock</code><span>ï¼Œ</span><code>SynchronousQueue</code><span>ï¼Œ</span><code>FutureTask</code><span>(jdk1.7) ç­‰ç­‰çš†æ˜¯åŸºäº AQS çš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿèƒ½åˆ©ç”¨ AQS éå¸¸è½»æ¾å®¹æ˜“åœ°æ„é€ å‡ºç¬¦åˆæˆ‘ä»¬è‡ªå·±éœ€æ±‚çš„åŒæ­¥å™¨ã€‚</span></p><h2 id='aqsåŸç†'><span>AQSåŸç†</span></h2><p><a href='https://blog.csdn.net/u010445301/article/details/125590758' target='_blank' class='url'>https://blog.csdn.net/u010445301/article/details/125590758</a></p><p><strong><span>AQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ CLH é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</span></strong><span>CLHï¼šCraigã€Landin and Hagerstené˜Ÿåˆ—ï¼Œæ˜¯å•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ï¼ŒAQSæ˜¯é€šè¿‡å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ã€‚æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹å°†è¢«åŠ å…¥åˆ°è¯¥é˜Ÿåˆ—ä¸­ã€‚AQS å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH é˜Ÿåˆ—é”çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚åœ¨ CLH é˜Ÿåˆ—é”ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¿å­˜ç€çº¿ç¨‹çš„å¼•ç”¨ï¼ˆthreadï¼‰ã€ å½“å‰èŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„çŠ¶æ€ï¼ˆwaitStatusï¼‰ã€å‰é©±èŠ‚ç‚¹ï¼ˆprevï¼‰ã€åç»§èŠ‚ç‚¹ï¼ˆnextï¼‰ã€‚</span></p><p><span>ç­‰å¾…å”¤é†’æ˜¯é€šè¿‡parkå’Œunparkå®ç°çš„</span></p><p><img src="assets/image-20240617173250683.png" referrerpolicy="no-referrer" alt="image-20240617173250683.png"></p><p><span>AQS ä½¿ç”¨ä¸€ä¸ª int æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„ FIFO é˜Ÿåˆ—æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚AQS ä½¿ç”¨ CAS å¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">volatile</span> <span class="cm-variable-3">int</span> <span class="cm-variable">state</span>;<span class="cm-comment">//å…±äº«å˜é‡ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>çŠ¶æ€ä¿¡æ¯é€šè¿‡ protected ç±»å‹çš„</span><code>getState</code><span>ï¼Œ</span><code>setState</code><span>ï¼Œ</span><code>compareAndSetState</code><span>è¿›è¡Œæ“ä½œ</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//è¿”å›åŒæ­¥çŠ¶æ€çš„å½“å‰å€¼</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">getState</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">state</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">// è®¾ç½®åŒæ­¥çŠ¶æ€çš„å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">void</span> <span class="cm-def">setState</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">newState</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">newState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//åŸå­åœ°ï¼ˆCASæ“ä½œï¼‰å°†åŒæ­¥çŠ¶æ€å€¼è®¾ç½®ä¸ºç»™å®šå€¼updateå¦‚æœå½“å‰åŒæ­¥çŠ¶æ€çš„å€¼ç­‰äºexpectï¼ˆæœŸæœ›å€¼ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">boolean</span> <span class="cm-def">compareAndSetState</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">expect</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">update</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">unsafe</span>.<span class="cm-variable">compareAndSwapInt</span>(<span class="cm-keyword">this</span>, <span class="cm-variable">stateOffset</span>, <span class="cm-variable">expect</span>, <span class="cm-variable">update</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><span>ä»¥å¯é‡å…¥çš„äº’æ–¥é” </span><code>ReentrantLock</code><span> ä¸ºä¾‹ï¼Œå®ƒçš„å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª </span><code>state</code><span> å˜é‡ï¼Œç”¨æ¥è¡¨ç¤ºé”çš„å ç”¨çŠ¶æ€ã€‚</span><code>state</code><span> çš„åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºé”å¤„äºæœªé”å®šçŠ¶æ€ã€‚å½“çº¿ç¨‹ A è°ƒç”¨ </span><code>lock()</code><span> æ–¹æ³•æ—¶ï¼Œä¼šå°è¯•é€šè¿‡ </span><code>tryAcquire()</code><span> æ–¹æ³•ç‹¬å è¯¥é”ï¼Œå¹¶è®© </span><code>state</code><span> çš„å€¼åŠ  1ã€‚å¦‚æœæˆåŠŸäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹ A å°±è·å–åˆ°äº†é”ã€‚å¦‚æœå¤±è´¥äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹ A å°±ä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆCLH é˜Ÿåˆ—ï¼‰ä¸­ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯¥é”ã€‚å‡è®¾çº¿ç¨‹ A è·å–é”æˆåŠŸäº†ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆ</span><code>state</code><span> ä¼šç´¯åŠ ï¼‰ã€‚è¿™å°±æ˜¯å¯é‡å…¥æ€§çš„ä½“ç°ï¼šä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”è€Œä¸ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸€ä¸ªçº¿ç¨‹å¿…é¡»é‡Šæ”¾ä¸è·å–çš„æ¬¡æ•°ç›¸åŒçš„é”ï¼Œæ‰èƒ½è®© </span><code>state</code><span> çš„å€¼å›åˆ° 0ï¼Œä¹Ÿå°±æ˜¯è®©é”æ¢å¤åˆ°æœªé”å®šçŠ¶æ€ã€‚åªæœ‰è¿™æ ·ï¼Œå…¶ä»–ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½æœ‰æœºä¼šè·å–è¯¥é”ã€‚</span></p><h3 id='aqså¯¹èµ„æºçš„å…±äº«æ–¹å¼'><span>AQSå¯¹èµ„æºçš„å…±äº«æ–¹å¼</span></h3><p><strong><span>1)Exclusive</span></strong><span>ï¼ˆç‹¬å ï¼‰</span></p><p><span>åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ </span><code>ReentrantLock</code><span>ã€‚åˆå¯åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œ</span><code>ReentrantLock</code><span> åŒæ—¶æ”¯æŒä¸¤ç§é”,ä¸‹é¢ä»¥ </span><code>ReentrantLock</code><span> å¯¹è¿™ä¸¤ç§é”çš„å®šä¹‰åšä»‹ç»ï¼š</span></p><ul><li><p><span>å…¬å¹³é”ï¼šæŒ‰ç…§çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ’é˜Ÿé¡ºåºï¼Œå…ˆåˆ°è€…å…ˆæ‹¿åˆ°é”</span></p></li><li><p><span>éå…¬å¹³é”ï¼šå½“çº¿ç¨‹è¦è·å–é”æ—¶ï¼Œå…ˆé€šè¿‡ä¸¤æ¬¡ CAS æ“ä½œå»æŠ¢é”ï¼Œå¦‚æœæ²¡æŠ¢åˆ°ï¼Œå½“å‰çº¿ç¨‹å†åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…å”¤é†’ã€‚</span></p></li></ul><p><span>æ€»ç»“ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”åªæœ‰ä¸¤å¤„ä¸åŒï¼š</span></p><ol start='' ><li><p><span>éå…¬å¹³é”åœ¨è°ƒç”¨ lock åï¼Œé¦–å…ˆå°±ä¼šè°ƒç”¨ CAS è¿›è¡Œä¸€æ¬¡æŠ¢é”ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æ°å·§é”æ²¡æœ‰è¢«å ç”¨ï¼Œé‚£ä¹ˆç›´æ¥å°±è·å–åˆ°é”è¿”å›äº†ã€‚</span></p></li><li><p><span>éå…¬å¹³é”åœ¨ CAS å¤±è´¥åï¼Œå’Œå…¬å¹³é”ä¸€æ ·éƒ½ä¼šè¿›å…¥åˆ° </span><code>tryAcquire</code><span> æ–¹æ³•ï¼Œåœ¨ </span><code>tryAcquire</code><span> æ–¹æ³•ä¸­ï¼Œå¦‚æœå‘ç°é”è¿™ä¸ªæ—¶å€™è¢«é‡Šæ”¾äº†ï¼ˆstate == 0ï¼‰ï¼Œéå…¬å¹³é”ä¼šç›´æ¥ CAS æŠ¢é”ï¼Œä½†æ˜¯å…¬å¹³é”ä¼šåˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœæœ‰åˆ™ä¸å»æŠ¢é”ï¼Œä¹–ä¹–æ’åˆ°åé¢ã€‚</span></p></li></ol><p><span>å…¬å¹³é”å’Œéå…¬å¹³é”å°±è¿™ä¸¤ç‚¹åŒºåˆ«ï¼Œå¦‚æœè¿™ä¸¤æ¬¡ CAS éƒ½ä¸æˆåŠŸï¼Œé‚£ä¹ˆåé¢éå…¬å¹³é”å’Œå…¬å¹³é”æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è¦è¿›å…¥åˆ°é˜»å¡é˜Ÿåˆ—ç­‰å¾…å”¤é†’ã€‚</span></p><p><span>ç›¸å¯¹æ¥è¯´ï¼Œéå…¬å¹³é”ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒçš„ååé‡æ¯”è¾ƒå¤§ã€‚å½“ç„¶ï¼Œéå…¬å¹³é”è®©è·å–é”çš„æ—¶é—´å˜å¾—æ›´åŠ ä¸ç¡®å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹é•¿æœŸå¤„äºé¥¥é¥¿çŠ¶æ€ã€‚</span></p><p><strong><span>2)Share</span></strong><span>ï¼ˆå…±äº«ï¼‰</span></p><p><span>å¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚ </span><code>Semaphore/CountDownLatch</code><span>ã€‚</span><code>Semaphore</code><span>ã€</span><code>CountDownLatCh</code><span>ã€ </span><code>CyclicBarrier</code><span>ã€</span><code>ReadWriteLock</code><span> æˆ‘ä»¬éƒ½ä¼šåœ¨åé¢è®²åˆ°ã€‚</span></p><p><code>ReentrantReadWriteLock</code><span> å¯ä»¥çœ‹æˆæ˜¯ç»„åˆå¼ï¼Œå› ä¸º </span><code>ReentrantReadWriteLock</code><span> ä¹Ÿå°±æ˜¯è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æŸä¸€èµ„æºè¿›è¡Œè¯»ã€‚</span></p><h2 id='semaphore'><span>Semaphore</span></h2><p><strong><code>Semaphore</code><span>(ä¿¡å·é‡)å¯ä»¥æŒ‡å®šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªèµ„æºã€‚</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SemaphoreExample</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">clientCount</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">totalRequestCount</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Semaphore</span> <span class="cm-variable">semaphore</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Semaphore</span>(<span class="cm-variable">clientCount</span>);<span class="cm-comment">//ä¸€æ¬¡åŒæ—¶æ‰§è¡Œä¸‰ä¸ªçº¿ç¨‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ExecutorService</span> <span class="cm-variable">executorService</span> <span class="cm-operator">=</span> <span class="cm-variable">Executors</span>.<span class="cm-variable">newCachedThreadPool</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">totalRequestCount</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executorService</span>.<span class="cm-variable">execute</span>(()<span class="cm-operator">-&gt;</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">semaphore</span>.<span class="cm-variable">acquire</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">print</span>(<span class="cm-variable">semaphore</span>.<span class="cm-variable">availablePermits</span>() <span class="cm-operator">+</span> <span class="cm-string">" "</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">semaphore</span>.<span class="cm-variable">release</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executorService</span>.<span class="cm-variable">shutdown</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><h2 id='countdownlatch-å€’è®¡æ—¶å™¨ï¼‰'><span>CountDownLatch ï¼ˆå€’è®¡æ—¶å™¨ï¼‰</span></h2><p><code>CountDownLatch</code><span> å…è®¸ </span><code>count</code><span> ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ã€‚</span></p><p><code>CountDownLatch</code><span> æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°,å®ƒé»˜è®¤æ„é€  AQS çš„ </span><code>state</code><span> å€¼ä¸º </span><code>count</code><span>ã€‚å½“çº¿ç¨‹ä½¿ç”¨ </span><code>countDown()</code><span> æ–¹æ³•æ—¶,å…¶å®ä½¿ç”¨äº†</span><code>tryReleaseShared</code><span>æ–¹æ³•ä»¥ CAS çš„æ“ä½œæ¥å‡å°‘ </span><code>state</code><span>,ç›´è‡³ </span><code>state</code><span> ä¸º 0 ã€‚å½“è°ƒç”¨ </span><code>await()</code><span> æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœ </span><code>state</code><span> ä¸ä¸º 0ï¼Œé‚£å°±è¯æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œ</span><code>await()</code><span> æ–¹æ³•å°±ä¼šä¸€ç›´é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´ </span><code>await()</code><span> æ–¹æ³•ä¹‹åçš„è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ç„¶åï¼Œ</span><code>CountDownLatch</code><span> ä¼šè‡ªæ—‹ CAS åˆ¤æ–­ </span><code>state == 0</code><span>ï¼Œå¦‚æœ </span><code>state == 0</code><span> çš„è¯ï¼Œå°±ä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œ</span><code>await()</code><span> æ–¹æ³•ä¹‹åçš„è¯­å¥å¾—åˆ°æ‰§è¡Œã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CountDownLatchExample1</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// å¤„ç†æ–‡ä»¶çš„æ•°é‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">threadCount</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆæ¨èä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ExecutorService</span> <span class="cm-variable">threadPool</span> <span class="cm-operator">=</span> <span class="cm-variable">Executors</span>.<span class="cm-variable">newFixedThreadPool</span>(<span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">CountDownLatch</span> <span class="cm-variable">countDownLatch</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CountDownLatch</span>(<span class="cm-variable">threadCount</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">threadCount</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">threadnum</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">threadPool</span>.<span class="cm-variable">execute</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//å¤„ç†æ–‡ä»¶çš„ä¸šåŠ¡æ“ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//......</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶å·²ç»è¢«å®Œæˆ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">countDownLatch</span>.<span class="cm-variable">countDown</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">countDownLatch</span>.<span class="cm-variable">await</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">threadPool</span>.<span class="cm-variable">shutdown</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"finish"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 667px;"></div><div class="CodeMirror-gutters" style="display: none; height: 667px;"></div></div></div></pre><p><strong><span>ä¸¤ç§ç”¨æ³•</span></strong></p><ol start='' ><li><p><span>æŸä¸€çº¿ç¨‹åœ¨å¼€å§‹è¿è¡Œå‰ç­‰å¾… n ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å°† </span><code>CountDownLatch</code><span> çš„è®¡æ•°å™¨åˆå§‹åŒ–ä¸º n ï¼š</span><code>new CountDownLatch(n)</code><span>ï¼Œæ¯å½“ä¸€ä¸ªä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå°±å°†è®¡æ•°å™¨å‡ 1 </span><code>countdownlatch.countDown()</code><span>ï¼Œå½“è®¡æ•°å™¨çš„å€¼å˜ä¸º 0 æ—¶ï¼Œåœ¨</span><code>CountDownLatchä¸Š await()</code><span> çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å¤šä¸ªç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚</span></p></li><li><p><span>å®ç°å¤šä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡çš„æœ€å¤§å¹¶è¡Œæ€§ã€‚æ³¨æ„æ˜¯å¹¶è¡Œæ€§ï¼Œä¸æ˜¯å¹¶å‘ï¼Œå¼ºè°ƒçš„æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¼€å§‹æ‰§è¡Œã€‚ç±»ä¼¼äºèµ›è·‘ï¼Œå°†å¤šä¸ªçº¿ç¨‹æ”¾åˆ°èµ·ç‚¹ï¼Œç­‰å¾…å‘ä»¤æªå“ï¼Œç„¶ååŒæ—¶å¼€è·‘ã€‚åšæ³•æ˜¯åˆå§‹åŒ–ä¸€ä¸ªå…±äº«çš„ </span><code>CountDownLatch</code><span> å¯¹è±¡ï¼Œå°†å…¶è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 1 ï¼š</span><code>new CountDownLatch(1)</code><span>ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨å¼€å§‹æ‰§è¡Œä»»åŠ¡å‰é¦–å…ˆ </span><code>coundownlatch.await()</code><span>ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨ </span><code>countDown()</code><span> æ—¶ï¼Œè®¡æ•°å™¨å˜ä¸º 0ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«å”¤é†’ã€‚</span></p></li></ol><p><strong><span>ä¸è¶³</span></strong></p><p><code>CountDownLatch</code><span> æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“ </span><code>CountDownLatch</code><span> ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨ã€‚</span></p><h2 id='cyclicbarrierå¾ªç¯æ …æ '><span>CyclicBarrier(å¾ªç¯æ …æ )</span></h2><p><strong><span>ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</span></strong></p><p><span>å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚çº¿ç¨‹æ‰§è¡Œ await() æ–¹æ³•ä¹‹åè®¡æ•°å™¨ä¼šå‡ 1ï¼Œå¹¶è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0ï¼Œæ‰€æœ‰è°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</span></p><p><span>CyclicBarrier å’Œ CountdownLatch çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚</span></p><p><span>CyclicBarrier æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶ä¸­ parties æŒ‡ç¤ºè®¡æ•°å™¨çš„åˆå§‹å€¼ï¼ŒbarrierAction åœ¨æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœçš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">CyclicBarrier</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">parties</span>, <span class="cm-variable">Runnable</span> <span class="cm-variable">barrierAction</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">parties</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">0</span>) <span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IllegalArgumentException</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">parties</span> <span class="cm-operator">=</span> <span class="cm-variable">parties</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">count</span> <span class="cm-operator">=</span> <span class="cm-variable">parties</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">barrierCommand</span> <span class="cm-operator">=</span> <span class="cm-variable">barrierAction</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">CyclicBarrier</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">parties</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span>(<span class="cm-variable">parties</span>, <span class="cm-atom">null</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CyclicBarrierExample</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-variable">totalThread</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">CyclicBarrier</span> <span class="cm-variable">cyclicBarrier</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CyclicBarrier</span>(<span class="cm-variable">totalThread</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ExecutorService</span> <span class="cm-variable">executorService</span> <span class="cm-operator">=</span> <span class="cm-variable">Executors</span>.<span class="cm-variable">newCachedThreadPool</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">totalThread</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executorService</span>.<span class="cm-variable">execute</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">print</span>(<span class="cm-string">"before.."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cyclicBarrier</span>.<span class="cm-variable">await</span>();<span class="cm-comment">//æ¯æ¥ä¸€ä¸ªçº¿ç¨‹å°±åœ¨è¿™ç­‰ç€</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-operator">|</span> <span class="cm-variable">BrokenBarrierException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">print</span>(<span class="cm-string">"after.."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">executorService</span>.<span class="cm-variable">shutdown</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 460px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">before</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..<span class="cm-variable">after</span>..</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p>&nbsp;</p><h2 id='cyclicbarrier-å’Œ-countdownlatch-çš„åŒºåˆ«'><span>CyclicBarrier å’Œ CountDownLatch çš„åŒºåˆ«</span></h2><p><span>å¯¹äº </span><code>CountDownLatch</code><span> æ¥è¯´ï¼Œé‡ç‚¹æ˜¯â€œä¸€ä¸ªçº¿ç¨‹ï¼ˆå¤šä¸ªçº¿ç¨‹ï¼‰ç­‰å¾…â€ï¼Œè€Œå…¶ä»–çš„ N ä¸ªçº¿ç¨‹åœ¨å®Œæˆâ€œæŸä»¶äº‹æƒ…â€ä¹‹åï¼Œå¯ä»¥ç»ˆæ­¢ï¼Œä¹Ÿå¯ä»¥ç­‰å¾…ã€‚è€Œå¯¹äº </span><code>CyclicBarrier</code><span>ï¼Œé‡ç‚¹æ˜¯å¤šä¸ªçº¿ç¨‹ï¼Œåœ¨ä»»æ„ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰å®Œæˆï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚</span></p><p><code>CountDownLatch</code><span> æ˜¯è®¡æ•°å™¨ï¼Œçº¿ç¨‹å®Œæˆä¸€ä¸ªè®°å½•ä¸€ä¸ªï¼Œåªä¸è¿‡è®¡æ•°ä¸æ˜¯é€’å¢è€Œæ˜¯é€’å‡ï¼Œè€Œ </span><code>CyclicBarrier</code><span> æ›´åƒæ˜¯ä¸€ä¸ªé˜€é—¨ï¼Œéœ€è¦æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾ï¼Œé˜€é—¨æ‰èƒ½æ‰“å¼€ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚</span></p><h1 id='åä¸€åœºæ™¯é¢˜'><span>åä¸€ã€åœºæ™¯é¢˜</span></h1><h2 id='å“²å­¦å®¶å°±é¤é—®é¢˜'><span>å“²å­¦å®¶å°±é¤é—®é¢˜</span></h2><p><span>æœ‰äº”ä½å“²å­¦å®¶ï¼Œå›´ååœ¨åœ†æ¡Œæ—ã€‚ </span></p><ul><li><p><span>ä»–ä»¬åªåšä¸¤ä»¶äº‹ï¼Œæ€è€ƒå’Œåƒé¥­ï¼Œæ€è€ƒä¸€ä¼šåƒå£é¥­ï¼Œåƒå®Œé¥­åæ¥ç€æ€è€ƒã€‚ </span></p></li><li><p><span>åƒé¥­æ—¶è¦ç”¨ä¸¤æ ¹ç­·å­åƒï¼Œæ¡Œä¸Šå…±æœ‰ 5 æ ¹ç­·å­ï¼Œæ¯ä½å“²å­¦å®¶å·¦å³æ‰‹è¾¹å„æœ‰ä¸€æ ¹ç­·å­ã€‚ </span></p></li><li><p><span>å¦‚æœç­·å­è¢«èº«è¾¹çš„äººæ‹¿ç€ï¼Œè‡ªå·±å°±å¾—ç­‰å¾… </span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Chopstick</span> <span class="cm-keyword">extends</span> <span class="cm-variable">ReentrantLock</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Chopstick</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-variable">toString</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-string">"ç­·å­{"</span> <span class="cm-operator">+</span> <span class="cm-variable">name</span> <span class="cm-operator">+</span> <span class="cm-string">'}'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Philosopher</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Thread</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Chopstick</span> <span class="cm-variable">left</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Chopstick</span> <span class="cm-variable">right</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Philosopher</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable">Chopstick</span> <span class="cm-variable">left</span>, <span class="cm-variable">Chopstick</span> <span class="cm-variable">right</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>(<span class="cm-variable">name</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">left</span> <span class="cm-operator">=</span> <span class="cm-variable">left</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">right</span> <span class="cm-operator">=</span> <span class="cm-variable">right</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°è¯•è·å¾—å·¦æ‰‹ç­·å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">left</span>.<span class="cm-variable">tryLock</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å°è¯•è·å¾—å³æ‰‹ç­·å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">right</span>.<span class="cm-variable">tryLock</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eat</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">right</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">left</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">void</span> <span class="cm-variable">eat</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"eating..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Sleeper</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Chopstick</span> <span class="cm-variable">c1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Chopstick</span>(<span class="cm-string">"1"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Chopstick</span> <span class="cm-variable">c2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Chopstick</span>(<span class="cm-string">"2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Chopstick</span> <span class="cm-variable">c3</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Chopstick</span>(<span class="cm-string">"3"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Chopstick</span> <span class="cm-variable">c4</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Chopstick</span>(<span class="cm-string">"4"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Chopstick</span> <span class="cm-variable">c5</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Chopstick</span>(<span class="cm-string">"5"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Philosopher</span>(<span class="cm-string">"è‹æ ¼æ‹‰åº•"</span>, <span class="cm-variable">c1</span>, <span class="cm-variable">c2</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Philosopher</span>(<span class="cm-string">"æŸæ‹‰å›¾"</span>, <span class="cm-variable">c2</span>, <span class="cm-variable">c3</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Philosopher</span>(<span class="cm-string">"äºšé‡Œå£«å¤šå¾·"</span>, <span class="cm-variable">c3</span>, <span class="cm-variable">c4</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Philosopher</span>(<span class="cm-string">"èµ«æ‹‰å…‹åˆ©ç‰¹"</span>, <span class="cm-variable">c4</span>, <span class="cm-variable">c5</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Philosopher</span>(<span class="cm-string">"é˜¿åŸºç±³å¾·"</span>, <span class="cm-variable">c5</span>, <span class="cm-variable">c1</span>).<span class="cm-variable">start</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><h2 id='ç”Ÿäº§è€…æ¶ˆè´¹è€…'><span>ç”Ÿäº§è€…æ¶ˆè´¹è€…</span></h2><p><span>è¦ç‚¹ </span></p><ul><li><p><span>ä¸å‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„ GuardObject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æœå’Œæ¶ˆè´¹ç»“æœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº” </span></p></li><li><p><span>æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº </span></p></li><li><p><span>ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æœæ•°æ® </span></p></li><li><p><span>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ® </span></p></li><li><p><span>JDK ä¸­å„ç§é˜»å¡é˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Message</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">message</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Message</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">id</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">message</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">message</span> <span class="cm-operator">=</span> <span class="cm-variable">message</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">int</span> <span class="cm-variable">getId</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">getMessage</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">message</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">MessageQueue</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">LinkedList</span><span class="cm-operator">&lt;</span><span class="cm-variable">Message</span><span class="cm-operator">&gt;</span> <span class="cm-variable">queue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">capacity</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">MessageQueue</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">capacity</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">capacity</span> <span class="cm-operator">=</span> <span class="cm-variable">capacity</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedList</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Message</span> <span class="cm-variable">take</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">queue</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">queue</span>.<span class="cm-variable">isEmpty</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"æ²¡è´§äº†, wait"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Message</span> <span class="cm-variable">message</span> <span class="cm-operator">=</span> <span class="cm-variable">queue</span>.<span class="cm-variable">removeFirst</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">notifyAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">message</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">put</span>(<span class="cm-variable">Message</span> <span class="cm-variable">message</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">queue</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">queue</span>.<span class="cm-variable">size</span>() <span class="cm-operator">==</span> <span class="cm-variable">capacity</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"åº“å­˜å·²è¾¾ä¸Šé™, wait"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">addLast</span>(<span class="cm-variable">message</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">notifyAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1265px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1265px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">MessageQueue</span> <span class="cm-variable">messageQueue</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">MessageQueue</span>(<span class="cm-number">2</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 4 ä¸ªç”Ÿäº§è€…çº¿ç¨‹, ä¸‹è½½ä»»åŠ¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">4</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"download..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">response</span> <span class="cm-operator">=</span> <span class="cm-variable">Downloader</span>.<span class="cm-variable">download</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"try put message({})"</span>, <span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">messageQueue</span>.<span class="cm-variable">put</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Message</span>(<span class="cm-variable">id</span>, <span class="cm-variable">response</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">IOException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }, <span class="cm-string">"ç”Ÿäº§è€…"</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 1 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹, å¤„ç†ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Message</span> <span class="cm-variable">message</span> <span class="cm-operator">=</span> <span class="cm-variable">messageQueue</span>.<span class="cm-variable">take</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">response</span> <span class="cm-operator">=</span> (<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>) <span class="cm-variable">message</span>.<span class="cm-variable">getMessage</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"take message({}): [{}] lines"</span>, <span class="cm-variable">message</span>.<span class="cm-variable">getId</span>(), <span class="cm-variable">response</span>.<span class="cm-variable">size</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}, <span class="cm-string">"æ¶ˆè´¹è€…"</span>).<span class="cm-variable">start</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 575px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><h2 id='åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶'><span>åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</span></h2><p><span>æ¯”å¦‚ï¼Œå¿…é¡»å…ˆ 2 å 1 æ‰“å° </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// ç”¨æ¥åŒæ­¥çš„å¯¹è±¡</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">obj</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// t2 è¿è¡Œæ ‡è®°ï¼Œ ä»£è¡¨ t2 æ˜¯å¦æ‰§è¡Œè¿‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">boolean</span> <span class="cm-variable">t2runed</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">obj</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// å¦‚æœ t2 æ²¡æœ‰æ‰§è¡Œè¿‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-operator">!</span><span class="cm-variable">t2runed</span>) { </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// t1 å…ˆç­‰ä¸€ä¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">obj</span>.<span class="cm-variable">wait</span>(); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">t2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">obj</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// ä¿®æ”¹è¿è¡Œæ ‡è®°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t2runed</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// é€šçŸ¥ obj ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œå› æ­¤éœ€è¦ç”¨ notifyAllï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">obj</span>.<span class="cm-variable">notifyAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t1</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t2</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 805px;"></div><div class="CodeMirror-gutters" style="display: none; height: 805px;"></div></div></div></pre><h2 id='äº¤æ›¿è¾“å‡º'><span>äº¤æ›¿è¾“å‡º</span></h2><p><span>çº¿ç¨‹ 1 è¾“å‡º a 5 æ¬¡ï¼Œçº¿ç¨‹ 2 è¾“å‡º b 5 æ¬¡ï¼Œçº¿ç¨‹ 3 è¾“å‡º c 5 æ¬¡ã€‚ç°åœ¨è¦æ±‚è¾“å‡º abcabcabcabcabc æ€ä¹ˆå®ç° </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">SyncWaitNotify</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">flag</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">loopNumber</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">SyncWaitNotify</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">flag</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">loopNumber</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">flag</span> <span class="cm-operator">=</span> <span class="cm-variable">flag</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">loopNumber</span> <span class="cm-operator">=</span> <span class="cm-variable">loopNumber</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">print</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">waitFlag</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">nextFlag</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">str</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">loopNumber</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-keyword">this</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-keyword">this</span>.<span class="cm-variable">flag</span> <span class="cm-operator">!=</span> <span class="cm-variable">waitFlag</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">InterruptedException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">print</span>(<span class="cm-variable">str</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">flag</span> <span class="cm-operator">=</span> <span class="cm-variable">nextFlag</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">notifyAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">SyncWaitNotify</span> <span class="cm-variable">syncWaitNotify</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SyncWaitNotify</span>(<span class="cm-number">1</span>, <span class="cm-number">5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">syncWaitNotify</span>.<span class="cm-variable">print</span>(<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-string">"a"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">syncWaitNotify</span>.<span class="cm-variable">print</span>(<span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-string">"b"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">syncWaitNotify</span>.<span class="cm-variable">print</span>(<span class="cm-number">3</span>, <span class="cm-number">1</span>, <span class="cm-string">"c"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 989px;"></div><div class="CodeMirror-gutters" style="display: none; height: 989px;"></div></div></div></pre><p>&nbsp;</p></div></div>

<script>(function(){var e=document.body.parentElement,t=[],n=null,i=document.body.classList.contains("typora-export-collapse-outline"),r=function(e,t,n){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var i=e.target;i&&i!=this;i=i.parentNode)if(i.matches(t)){!1===n.call(i,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)};function o(){return e.scrollTop}r("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),d(),!1}),r("click",".outline-item",function(e){var t=this.querySelector(".outline-label");if(location.hash="#"+t.getAttribute("href"),i){var n=this.closest(".outline-item-wrapper").classList;n.contains("outline-item-open")||n.add("outline-item-open"),c(),n.add("outline-item-active")}});var a,s,l=function(){var e=o();n=null;for(var i=0;i<t.length&&t[i][1]-e<60;i++)n=t[i]},c=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},d=function(){if(n){c();var e=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(n[0]):n[0])+'"]');if(e)if(i){var t=e.closest(".outline-item-open>ul>.outline-item-wrapper");if(t)t.classList.add("outline-item-active");else{for(var r=(e=e.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");r;)r=(e=r).parentElement.closest(".outline-item-wrapper");e.classList.add("outline-item-active")}}else e.closest(".outline-item-wrapper").classList.add("outline-item-active")}};window.addEventListener("scroll",function(e){a&&clearTimeout(a),a=setTimeout(function(){l(),d()},300)});var u=function(){s=setTimeout(function(){!function(){t=[];var e=o();document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(n=>{var i=n.getAttribute("id");t.push([i,e+n.getBoundingClientRect().y])})}(),l(),d()},300)};window.addEventListener("resize",function(e){s&&clearTimeout(s),u()}),u()})();</script></body>
</html>